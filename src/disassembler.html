<meta charset=utf-8>
<link rel=stylesheet href=style.css>
<title>Minix86 disassembler</title>

<h2>Mini x86 MS-DOS .COM disassembler</h2>
<br>
<br>
Demos:
<button id=hello>hello</button>
<button id=xor>xor</button>
<button id=xoranim>xor animated</button>
<button id=tunnel>tunnel</button>
<button id=m8trix>m8trix</button>
<button id=point16b>point16b</button>
<button id=dragonfade>dragonfade</button>
<button id=dirojed>dirojed</button>
<button id=fr01>fr01</button>
<button id=futura>futura</button>
<button id=megapole>megapole</button>
<button id=tube>tube</button>
<button id=tetris>4is256</button>
<button id=atraktor>atraktor</button>
<button id=puls>puls</button>
<button id=symetrie>symetrie</button>
<button id=quatro>quatro</button>
<button id=ms>motion sickness</button> or any file:
<input onchange="with(f=new FileReader)readAsArrayBuffer(files[0]),onload=u=>{u=new Uint8Array(f.result);if(u.length<=64*1024)d()}"type=file>

<br>
<br>

<pre>
<table id=t border cellspacing=0 cellpadding=4>
  <tr><th>@<th>hex<th>disassembled asm<th>original asm (for comparison)
  <tr><td id=td_address><td id=td_hex><td id=td_asm><td id=td_original>
</table>


<script>

/** Globals **/

// CP437 charset
cp437 = " ☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ ";

// All the bytes of the .COM file
bytes = [];

// Current cpu mode (16 or 32-bit)
cpu_mode = 32;


/** Disassembler **/

// Disassemble all the file
disassemble = function(){
  
  // Current byte
  current_byte = 0;

  // current address
  address = 0x100;

  // Current instruction's hex code
  hex = 0;

  // Current instruction's asm code
  asm = "";
  
  // Stop disassembling (after a ret instruction)
  stop = 0;

  // Disassemble
  for(current_byte = 0; current_byte < bytes.length; current_byte++){
    
    if(!stop){
    
      // Current instruction's size (in bytes)
      instruction_size = 0;
      
      // Default: decode a db instruction
    
      // Save its address
      td_address.innerHTML += b16(current_byte + 0x100, 2) + "<br>";
      
      // Save its hex value
      td_hex.innerHTML += b16(bytes[current_byte]) + "<br>";
      
      // Save its asm code
      td_asm.innerHTML += "db " + b16h(bytes[current_byte]) + "          ; '"+ cp437[bytes[current_byte]] + "'<br>";
    }
  }
}

/** Helpers **/

// @param s: sign
// @param o: temp operand value

// Convert a number to base 16
// @param n: number
// @param l: length (in bytes), default 1.
var b16 = (n, l) => {
  l = l || 1;
  return (1e9 + n.toString(16)).slice(-2 * l).toUpperCase();
}

// Same, with h suffix
var b16h = (n, l) => {
  return b16(n, l) + "h";
}
</script>
<!--script src=helpers.js></script>
<script src=disassembler.js></script-->
<script src=demos.js></script>