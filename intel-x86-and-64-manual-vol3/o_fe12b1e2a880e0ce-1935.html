<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1935</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1935-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1935.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:767px;white-space:nowrap" class="ft00">Vol. 3D&#160;43-3</p>
<p style="position:absolute;top:47px;left:614px;white-space:nowrap" class="ft01">ENCLAVE CODE&#160;DEBUG AND PROFILING</p>
<p style="position:absolute;top:450px;left:69px;white-space:nowrap" class="ft08">In this&#160;scenario,&#160;if&#160;the&#160;enclave is&#160;executing&#160;in VMX&#160;non-root operation&#160;and&#160;the&#160;“monitor trap flag”&#160;VM-execution&#160;<br/>control&#160;is 1, an MTF VM exit is pending on the instruction boundary after the AEX.&#160;No MTF VM exit&#160;occurs if another&#160;<br/>VM&#160;exit&#160;happens before reaching&#160;that instruction boundary.&#160;<br/>The value&#160;of&#160;the RFLAGS.TF bit at the end of AEX is the&#160;same as the&#160;value of&#160;RFLAGS.TF at the time of the enclave&#160;<br/>entry.</p>
<p style="position:absolute;top:573px;left:69px;white-space:nowrap" class="ft03">43.2.4&#160;</p>
<p style="position:absolute;top:573px;left:149px;white-space:nowrap" class="ft03">RFLAGS.TF Treatment on AEX</p>
<p style="position:absolute;top:602px;left:69px;white-space:nowrap" class="ft08">The&#160;value&#160;of EFLAGS.TF at&#160;the end of AEX from an&#160;opt-out&#160;enclave&#160;is same&#160;as the&#160;value of EFLAGS.TF at&#160;the&#160;time&#160;<br/>of the&#160;enclave entry.&#160;The&#160;value of EFLAGS.TF at&#160;the end of AEX&#160;from&#160;an&#160;opt-in enclave is&#160;unmodified.&#160;The&#160;<br/>EFLAGS.TF saved&#160;in GPR portion of the SSA&#160;on an&#160;AEX&#160;is&#160;0. For more detail&#160;see EENTER and&#160;ERESUME&#160;in Chapter&#160;5.</p>
<p style="position:absolute;top:685px;left:69px;white-space:nowrap" class="ft03">43.2.5&#160;</p>
<p style="position:absolute;top:685px;left:150px;white-space:nowrap" class="ft03">Restriction on&#160;Setting&#160;of&#160;TF&#160;after an Opt-Out Entry</p>
<p style="position:absolute;top:714px;left:69px;white-space:nowrap" class="ft08">Enclave entered&#160;through an&#160;opt-out entry is&#160;not allowed to&#160;set EFLAGS.TF.&#160;The POPF&#160;instruction forces&#160;RFLAGS.TF&#160;<br/>to&#160;0 if&#160;the enclave was&#160;entered through&#160;opt-out&#160;entry.</p>
<p style="position:absolute;top:781px;left:69px;white-space:nowrap" class="ft03">43.2.6&#160;</p>
<p style="position:absolute;top:781px;left:149px;white-space:nowrap" class="ft03">Trampoline Code Considerations</p>
<p style="position:absolute;top:810px;left:69px;white-space:nowrap" class="ft08">Any AEX from&#160;the&#160;enclave&#160;which results&#160;in&#160;the&#160;RFLAGS.TF =1&#160;on the&#160;reporting&#160;stack will result&#160;in a single-step #DB&#160;<br/>after the&#160;first instruction of the&#160;trampoline&#160;code&#160;if&#160;the trampoline is&#160;entered using&#160;the IRET&#160;instruction.</p>
<p style="position:absolute;top:882px;left:69px;white-space:nowrap" class="ft04">43.3&#160;</p>
<p style="position:absolute;top:882px;left:148px;white-space:nowrap" class="ft04">CODE AND DATA BREAKPOINTS</p>
<p style="position:absolute;top:945px;left:69px;white-space:nowrap" class="ft03">43.3.1 Breakpoint&#160;</p>
<p style="position:absolute;top:945px;left:243px;white-space:nowrap" class="ft03">Suppression</p>
<p style="position:absolute;top:974px;left:69px;white-space:nowrap" class="ft02">Following an&#160;opt-out entry:</p>
<p style="position:absolute;top:995px;left:69px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:996px;left:95px;white-space:nowrap" class="ft02">Instruction breakpoints are&#160;suppressed&#160;during execution in an&#160;enclave.&#160;</p>
<p style="position:absolute;top:1018px;left:69px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:1019px;left:95px;white-space:nowrap" class="ft02">Data breakpoints are&#160;not triggered on accesses to&#160;the address&#160;range&#160;defined by ELRANGE.</p>
<p style="position:absolute;top:1040px;left:69px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:1041px;left:95px;white-space:nowrap" class="ft02">Data breakpoints are&#160;triggered&#160;on accesses to&#160;addresses outside the&#160;ELRANGE</p>
<p style="position:absolute;top:397px;left:98px;white-space:nowrap" class="ft06">Figure&#160;43-2. &#160;Single Stepping&#160;with&#160;Opt-out&#160;Entry -AEX Due to&#160;Non-SMI Event Before&#160;Single-Step Boundary</p>
<p style="position:absolute;top:243px;left:323px;white-space:nowrap" class="ft07">Event Inside&#160;Enclave</p>
<p style="position:absolute;top:162px;left:132px;white-space:nowrap" class="ft02">EENTER</p>
<p style="position:absolute;top:190px;left:247px;white-space:nowrap" class="ft02">Inst1</p>
<p style="position:absolute;top:314px;left:138px;white-space:nowrap" class="ft07">RFLAGS.TF</p>
<p style="position:absolute;top:363px;left:136px;white-space:nowrap" class="ft07">VMCS.MTF</p>
<p style="position:absolute;top:178px;left:132px;white-space:nowrap" class="ft02">ERESUME</p>
<p style="position:absolute;top:190px;left:347px;white-space:nowrap" class="ft02">Inst2</p>
<p style="position:absolute;top:190px;left:447px;white-space:nowrap" class="ft02">Inst3</p>
<p style="position:absolute;top:190px;left:547px;white-space:nowrap" class="ft02">EEXIT</p>
<p style="position:absolute;top:191px;left:727px;white-space:nowrap" class="ft02">Inst4</p>
<p style="position:absolute;top:237px;left:720px;white-space:nowrap" class="ft07">TF/MTF</p>
<p style="position:absolute;top:252px;left:720px;white-space:nowrap" class="ft07">Handler</p>
<p style="position:absolute;top:346px;left:720px;white-space:nowrap" class="ft07">AEX</p>
<p style="position:absolute;top:361px;left:720px;white-space:nowrap" class="ft07">Handler</p>
<p style="position:absolute;top:312px;left:304px;white-space:nowrap" class="ft07">Single-Step #DB&#160;Pending</p>
<p style="position:absolute;top:360px;left:302px;white-space:nowrap" class="ft07">MTF&#160;VM Exit Pending</p>
<p style="position:absolute;top:253px;left:546px;white-space:nowrap" class="ft02">AEX</p>
<p style="position:absolute;top:292px;left:720px;white-space:nowrap" class="ft07">Higher Priority</p>
<p style="position:absolute;top:308px;left:720px;white-space:nowrap" class="ft07">Handler</p>
</div>
</body>
</html>
