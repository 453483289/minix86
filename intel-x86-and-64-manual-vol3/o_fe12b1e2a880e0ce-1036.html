<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1036</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1036-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1036.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">22-32&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">ARCHITECTURE&#160;COMPATIBILITY</p>
<p style="position:absolute;top:98px;left:68px;white-space:nowrap" class="ft02">22.31.3&#160;&#160;Fault Handling Effects on the Stack&#160;</p>
<p style="position:absolute;top:129px;left:68px;white-space:nowrap" class="ft06">During&#160;the handling of certain&#160;instructions, such&#160;as CALL&#160;and&#160;PUSHA,&#160;faults may&#160;occur in&#160;different sequences for&#160;<br/>the&#160;different&#160;processors. For&#160;example, during far calls,&#160;the&#160;Intel486&#160;processor pushes&#160;the old&#160;CS&#160;and&#160;EIP&#160;before&#160;a&#160;<br/>possible branch&#160;fault is resolved. A branch fault&#160;is a fault from a branch instruction occurring&#160;from&#160;a segment&#160;limit&#160;<br/>or access rights&#160;violation. If&#160;a branch&#160;fault&#160;is taken,&#160;the Intel486&#160;and P6&#160;family processors will have&#160;corrupted&#160;<br/>memory&#160;below the&#160;stack pointer.&#160;However,&#160;the ESP register&#160;is backed&#160;up to&#160;make the&#160;instruction restartable. The&#160;<br/>P6&#160;family processors issue&#160;the&#160;branch&#160;before the&#160;pushes. Therefore,&#160;if a&#160;branch fault does&#160;occur,&#160;these&#160;processors&#160;<br/>do not corrupt&#160;memory&#160;below the&#160;stack pointer.&#160;This&#160;implementation&#160;difference, however,&#160;does not constitute&#160;a&#160;<br/>compatibility problem, as only values&#160;at or above the stack&#160;pointer&#160;are&#160;considered to be valid.&#160;Other operations&#160;that&#160;<br/>encounter faults may also&#160;corrupt memory&#160;below&#160;the stack pointer and&#160;this behavior&#160;may vary on different&#160;imple-<br/>mentations.</p>
<p style="position:absolute;top:328px;left:68px;white-space:nowrap" class="ft02">22.31.4&#160;&#160;Interlevel RET/IRET From a 16-Bit Interrupt&#160;or Call&#160;Gate</p>
<p style="position:absolute;top:358px;left:68px;white-space:nowrap" class="ft06">If a call&#160;or&#160;interrupt is made from&#160;a 32-bit stack environment through a 16-bit&#160;gate, only 16&#160;bits of the old ESP&#160;can&#160;<br/>be pushed onto the stack. On the subsequent&#160;RET/IRET, the&#160;16-bit ESP&#160;is&#160;popped but the&#160;full 32-bit ESP is updated&#160;<br/>since control is&#160;being resumed&#160;in a 32-bit stack&#160;environment.&#160;The&#160;Intel486&#160;processor writes the&#160;SS&#160;selector into the&#160;<br/>upper 16&#160;bits&#160;of ESP.&#160;The P6&#160;family and&#160;Pentium&#160;processors&#160;write zeros into&#160;the upper 16 bits.&#160;&#160;&#160;&#160;&#160;</p>
<p style="position:absolute;top:463px;left:68px;white-space:nowrap" class="ft04">22.32&#160;&#160;MIXING 16-&#160;AND&#160;32-BIT SEGMENTS</p>
<p style="position:absolute;top:499px;left:68px;white-space:nowrap" class="ft06">The&#160;features of the&#160;16-bit Intel 286 processor are&#160;an object-code compatible&#160;subset&#160;of&#160;those of the&#160;32-bit IA-32&#160;<br/>processors. The&#160;D (default&#160;operation size)&#160;flag in segment descriptors&#160;indicates&#160;whether the&#160;processor&#160;treats a&#160;<br/>code&#160;or data segment as a&#160;16-bit&#160;or 32-bit segment;&#160;the B&#160;(default stack size)&#160;flag in segment descriptors indicates&#160;<br/>whether the&#160;processor&#160;treats a&#160;stack segment as&#160;a 16-bit or&#160;32-bit segment.<br/>The segment descriptors&#160;used&#160;by the&#160;Intel 286 processor are&#160;supported&#160;by the 32-bit&#160;IA-32 processors if the&#160;Intel-<br/>reserved&#160;word (highest&#160;word) of the&#160;descriptor&#160;is clear.&#160;On the&#160;32-bit IA-32 processors,&#160;this word includes the&#160;<br/>upper bits&#160;of the&#160;base&#160;address and&#160;the segment limit.<br/>The segment descriptors&#160;for&#160;data&#160;segments, code segments, local&#160;descriptor tables&#160;(there&#160;are&#160;no descriptors for&#160;<br/>global&#160;descriptor tables),&#160;and&#160;task&#160;gates are&#160;the same&#160;for the&#160;16-&#160;and&#160;32-bit&#160;processors.&#160;Other&#160;16-bit descriptors&#160;<br/>(TSS&#160;segment, call gate,&#160;interrupt gate, and&#160;trap&#160;gate)&#160;are&#160;supported by the&#160;32-bit processors.&#160;<br/>The 32-bit&#160;processors&#160;also have&#160;descriptors for TSS segments, call gates,&#160;interrupt gates, and&#160;trap&#160;gates&#160;that&#160;<br/>support&#160;the 32-bit&#160;architecture. Both kinds of&#160;descriptors&#160;can be used in&#160;the&#160;same&#160;system.<br/>For those&#160;segment descriptors common&#160;to&#160;both 16- and 32-bit&#160;processors, clear bits in the reserved word cause the&#160;<br/>32-bit&#160;processors&#160;to interpret these descriptors&#160;exactly as&#160;an Intel&#160;286 processor does,&#160;that is:</p>
<p style="position:absolute;top:766px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:766px;left:93px;white-space:nowrap" class="ft03">Base Address — The upper 8 bits of the&#160;32-bit base address are&#160;clear,&#160;which&#160;limits base&#160;addresses&#160;to 24&#160;bits.</p>
<p style="position:absolute;top:788px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:789px;left:93px;white-space:nowrap" class="ft03">Limit —&#160;The&#160;upper&#160;4 bits of the&#160;limit field are&#160;clear,&#160;restricting&#160;the&#160;value of&#160;the&#160;limit field to&#160;64&#160;KBytes.</p>
<p style="position:absolute;top:811px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:811px;left:93px;white-space:nowrap" class="ft06">Granularity bit — The&#160;G (granularity)&#160;flag is clear,&#160;indicating&#160;the value of the&#160;16-bit&#160;limit is interpreted&#160;in units&#160;<br/>of 1 byte.</p>
<p style="position:absolute;top:850px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:850px;left:93px;white-space:nowrap" class="ft06">Big bit — In&#160;a data-segment&#160;descriptor,&#160;the&#160;B&#160;flag&#160;is&#160;clear&#160;in the&#160;segment&#160;descriptor used by the&#160;32-bit&#160;<br/>processors, indicating the&#160;segment&#160;is&#160;no larger&#160;than 64&#160;KBytes.</p>
<p style="position:absolute;top:889px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:889px;left:93px;white-space:nowrap" class="ft06">Default bit&#160;— In a&#160;code-segment&#160;descriptor,&#160;the&#160;D&#160;flag is&#160;clear,&#160;indicating 16-bit&#160;addressing and operands&#160;are&#160;<br/>the&#160;default. In a&#160;stack-segment descriptor,&#160;the D flag is&#160;clear,&#160;indicating use&#160;of&#160;the SP&#160;register&#160;(instead of&#160;the&#160;<br/>ESP&#160;register) and&#160;a&#160;64-KByte&#160;maximum segment limit.</p>
<p style="position:absolute;top:946px;left:68px;white-space:nowrap" class="ft03">For information&#160;on&#160;mixing 16- and&#160;32-bit code in app<a href="o_fe12b1e2a880e0ce-997.html">lications, see Chapter&#160;21, “Mixing&#160;16-Bit and 32-Bit&#160;Code.”</a></p>
<p style="position:absolute;top:1002px;left:68px;white-space:nowrap" class="ft04">22.33&#160;&#160;SEGMENT AND ADDRESS WRAPAROUND</p>
<p style="position:absolute;top:1038px;left:68px;white-space:nowrap" class="ft06">This section discusses differences in&#160;segment&#160;and address&#160;wraparound&#160;between the&#160;P6&#160;family, Pentium,&#160;Intel486,&#160;<br/>Intel386, Intel 286,&#160;and&#160;8086 processors.</p>
</div>
</body>
</html>
