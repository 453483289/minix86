<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 730</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:14px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:12px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page730-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce730.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">18-94&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:99px;left:68px;white-space:nowrap" class="ft02">18.15.5.7&#160;&#160;&#160;EXTENDED&#160;CASCADING&#160;</p>
<p style="position:absolute;top:127px;left:68px;white-space:nowrap" class="ft06">Extended cascading is&#160;a model-specific&#160;feature in&#160;the&#160;Intel NetBurst&#160;microarchitecture with CPUID&#160;<br/>DisplayFamily_DisplayModel 0F_02, 0F_03, 0F_04, 0F_06.&#160;This&#160;feature&#160;uses bit 11&#160;in CCCRs associated&#160;with the&#160;IQ&#160;<br/>block.&#160;Se<a href="o_fe12b1e2a880e0ce-730.html">e Table&#160;18-65.</a>&#160;</p>
<p style="position:absolute;top:400px;left:68px;white-space:nowrap" class="ft06">The&#160;extended&#160;cascading feature&#160;can be&#160;adapted&#160;to the&#160;Interrupt&#160;based&#160;sampling&#160;usage&#160;model&#160;for&#160;performance&#160;<br/>monitoring. However,&#160;it&#160;is known that&#160;performance counters&#160;do not generate&#160;PMI in&#160;cascade&#160;mode&#160;or extended&#160;<br/>cascade&#160;mode&#160;due&#160;to an erratum.&#160;This erratum&#160;applies&#160;to processors with CPUID&#160;DisplayFamily_DisplayModel&#160;<br/>signature of 0F_02. For processors with CPUID&#160;DisplayFamily_DisplayModel signature&#160;of 0F_00&#160;and 0F_01,&#160;the&#160;<br/>erratum applies&#160;to processors with stepping encoding greater&#160;than&#160;09H.&#160;<br/>Counters 16 and&#160;17&#160;in the&#160;IQ block&#160;are frequently&#160;used&#160;in processor&#160;event-based sampling or at-retirement&#160;<br/>counting of&#160;events indicating a stalled condition&#160;in the&#160;pipeline.&#160;Neither counter 16 or 17 can initiate the cascading&#160;<br/>of&#160;counter pairs using&#160;the&#160;cascade bit in&#160;a CCCR.<br/>Extended cascading permits performance&#160;monitoring&#160;tools to&#160;use&#160;counters 16 and&#160;17&#160;to initiate&#160;cascading&#160;of two&#160;<br/>counters in&#160;the&#160;IQ&#160;block.&#160;Extended&#160;cascading&#160;from counter&#160;16&#160;and 17&#160;is&#160;conceptually similar&#160;to cascading other&#160;<br/>counters,&#160;but instead of using CASCADE bit of a&#160;CCCR, one&#160;of&#160;the four&#160;CASCNTxINTOy bits is&#160;used.&#160;</p>
<p style="position:absolute;top:621px;left:68px;white-space:nowrap" class="ft01">Example&#160;18-2.&#160;&#160;Scenario for Extended Cascading</p>
<p style="position:absolute;top:646px;left:68px;white-space:nowrap" class="ft07">A usage&#160;scenario for&#160;extended cascading is&#160;to sample instructions retired on logical processor 1 after the&#160;first 4096&#160;<br/>instructions&#160;retired on&#160;logical&#160;processor 0. A&#160;procedure to program extended&#160;cascading in this scenario is outlined&#160;<br/>below:<br/>1.&#160;Write the&#160;value 0&#160;to counter&#160;12.&#160;<br/>2.&#160;Write the&#160;value 04000603H to&#160;MSR_CRU_ESCR0&#160;(corresponding&#160;to selecting the&#160;NBOGNTAG&#160;and&#160;NBOGTAG&#160;</p>
<p style="position:absolute;top:743px;left:93px;white-space:nowrap" class="ft03">event masks with qualification&#160;restricted to logical processor 1).</p>
<p style="position:absolute;top:767px;left:68px;white-space:nowrap" class="ft03">3.&#160;Write the&#160;value 04038800H to MSR_IQ_CCCR0. This enables CASCNT4INTO0 and OVF_PMI. An&#160;ISR can sample&#160;</p>
<p style="position:absolute;top:784px;left:93px;white-space:nowrap" class="ft03">on instruction addresses in&#160;this&#160;case&#160;(do&#160;not set&#160;ENABLE,&#160;or&#160;CASCADE).</p>
<p style="position:absolute;top:808px;left:68px;white-space:nowrap" class="ft08">4.&#160;Write&#160;the value&#160;FFFFF000H into counter&#160;16.1.<br/>5.&#160;Write&#160;the value&#160;0400060CH to MSR_CRU_ESCR2&#160;(corresponding to&#160;selecting the&#160;NBOGNTAG and&#160;NBOGTAG&#160;</p>
<p style="position:absolute;top:848px;left:93px;white-space:nowrap" class="ft03">event masks</p>
<p style="position:absolute;top:847px;left:178px;white-space:nowrap" class="ft04">&#160;</p>
<p style="position:absolute;top:848px;left:183px;white-space:nowrap" class="ft03">with qualification restricted&#160;to logical processor 0).</p>
<p style="position:absolute;top:872px;left:68px;white-space:nowrap" class="ft08">6.&#160;Write the&#160;value 00039000H to&#160;MSR_IQ_CCCR4&#160;(set&#160;ENABLE bit,&#160;but not&#160;OVF_PMI).<br/>Another&#160;use&#160;for cascading is&#160;to locate&#160;stalled execution&#160;in&#160;a multithreaded application. Assume&#160;MOB replays&#160;in&#160;<br/>thread B cause thread A&#160;to stall.&#160;Getting&#160;a sample&#160;of the&#160;stalled execution&#160;in this&#160;scenario could&#160;be&#160;accomplished&#160;<br/>by:<br/>1.&#160;Set up counter B&#160;to&#160;count MOB replays on thread B.<br/>2.&#160;Set up counter A to&#160;count&#160;resource&#160;stalls on thread&#160;A; set its&#160;force overflow bit&#160;and&#160;the appropriate&#160;CASCNTx-</p>
<p style="position:absolute;top:994px;left:93px;white-space:nowrap" class="ft03">INTOy bit.</p>
<p style="position:absolute;top:1018px;left:68px;white-space:nowrap" class="ft03">3.&#160;Use the&#160;performance monitoring interrupt to&#160;capture the&#160;program execution&#160;data of&#160;the stalled thread.</p>
<p style="position:absolute;top:194px;left:305px;white-space:nowrap" class="ft05">Table&#160;18-65.&#160;&#160;CCR Names&#160;and&#160;Bit&#160;Positions&#160;</p>
<p style="position:absolute;top:227px;left:83px;white-space:nowrap" class="ft03">CCCR Name:Bit Position</p>
<p style="position:absolute;top:227px;left:311px;white-space:nowrap" class="ft03">Bit Name</p>
<p style="position:absolute;top:227px;left:602px;white-space:nowrap" class="ft03">Description</p>
<p style="position:absolute;top:256px;left:79px;white-space:nowrap" class="ft03">MSR_IQ_CCCR1|2:11</p>
<p style="position:absolute;top:256px;left:248px;white-space:nowrap" class="ft03">Reserved</p>
<p style="position:absolute;top:285px;left:79px;white-space:nowrap" class="ft03">MSR_IQ_CCCR0:11</p>
<p style="position:absolute;top:285px;left:248px;white-space:nowrap" class="ft03">CASCNT4INTO0</p>
<p style="position:absolute;top:285px;left:448px;white-space:nowrap" class="ft03">Allow counter 4 to&#160;cascade&#160;into&#160;counter&#160;0</p>
<p style="position:absolute;top:313px;left:79px;white-space:nowrap" class="ft03">MSR_IQ_CCCR3:11</p>
<p style="position:absolute;top:313px;left:248px;white-space:nowrap" class="ft03">CASCNT5INTO3</p>
<p style="position:absolute;top:313px;left:448px;white-space:nowrap" class="ft03">Allow counter 5 to&#160;cascade&#160;into&#160;counter&#160;3</p>
<p style="position:absolute;top:341px;left:79px;white-space:nowrap" class="ft03">MSR_IQ_CCCR4:11</p>
<p style="position:absolute;top:341px;left:248px;white-space:nowrap" class="ft03">CASCNT5INTO4</p>
<p style="position:absolute;top:341px;left:448px;white-space:nowrap" class="ft03">Allow counter 5 to&#160;cascade&#160;into&#160;counter&#160;4</p>
<p style="position:absolute;top:370px;left:79px;white-space:nowrap" class="ft03">MSR_IQ_CCCR5:11</p>
<p style="position:absolute;top:370px;left:248px;white-space:nowrap" class="ft03">CASCNT4INTO5</p>
<p style="position:absolute;top:370px;left:448px;white-space:nowrap" class="ft03">Allow counter 4 to&#160;cascade&#160;into&#160;counter&#160;5</p>
</div>
</body>
</html>
