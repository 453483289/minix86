<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 135</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:18px;font-family:Times;color:#000000;}
	.ft08{font-size:18px;font-family:Times;color:#0860a8;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft012{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page135-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce135.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:767px;white-space:nowrap" class="ft00">Vol. 3A&#160;4-31</p>
<p style="position:absolute;top:47px;left:793px;white-space:nowrap" class="ft01">PAGING</p>
<p style="position:absolute;top:102px;left:120px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:100px;left:146px;white-space:nowrap" class="ft03">For&#160;32-bit paging or&#160;if IA32_EFER.NXE&#160;=&#160;0,&#160;instructions may be fetched from&#160;any user-mode&#160;address.</p>
<p style="position:absolute;top:126px;left:120px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:124px;left:146px;white-space:nowrap" class="ft03">For PAE&#160;paging or&#160;IA-32e&#160;paging&#160;with IA32_EFER.NXE&#160;=&#160;1, instructions&#160;may be fetched from any&#160;user-</p>
<p style="position:absolute;top:141px;left:145px;white-space:nowrap" class="ft09">mode&#160;address with a&#160;translation for which&#160;the XD flag&#160;is 0&#160;in every paging-structure entry&#160;controlling&#160;<br/>the translation.</p>
<p style="position:absolute;top:183px;left:120px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:181px;left:146px;white-space:nowrap" class="ft03">Instructions may not be fetched from any&#160;supervisor-mode&#160;address.</p>
<p style="position:absolute;top:205px;left:69px;white-space:nowrap" class="ft09">A&#160;processor&#160;may cache information&#160;from the paging-structure entries in&#160;TLBs and paging-structure caches (see&#160;<br/><a href="o_fe12b1e2a880e0ce-139.html">Section&#160;4.10). The</a>se structures&#160;may&#160;include information&#160;about access rights.&#160;The processor may enforce&#160;access&#160;<br/>rights&#160;based on&#160;the TLBs and&#160;paging-structure caches&#160;instead of on&#160;the&#160;paging&#160;structures&#160;in memory.<br/>This&#160;fact implies that, if software&#160;modifies a&#160;paging-structure&#160;entry&#160;to change access&#160;rights, the&#160;processor&#160;might&#160;<br/>not&#160;use that change for a&#160;subsequent access&#160;to an&#160;affected&#160;linear&#160;address (see<a href="o_fe12b1e2a880e0ce-148.html">&#160;Section 4.10.4.3</a>).&#160;S<a href="o_fe12b1e2a880e0ce-147.html">ee&#160;Section&#160;<br/>4.10.4.2&#160;for how softw</a>are can&#160;ensure that&#160;the processor uses&#160;the&#160;modified&#160;access rights.</p>
<p style="position:absolute;top:346px;left:69px;white-space:nowrap" class="ft04">4.6.2 Protection&#160;</p>
<p style="position:absolute;top:346px;left:238px;white-space:nowrap" class="ft04">Keys</p>
<p style="position:absolute;top:376px;left:69px;white-space:nowrap" class="ft011">The&#160;protection-key&#160;feature provides an additional&#160;mechanism&#160;by&#160;which IA-32e&#160;paging controls access to&#160;user-<br/>mode&#160;addresses.&#160;When CR4.PKE&#160;=&#160;1,&#160;every&#160;linear address&#160;is associated&#160;with the&#160;4-bit&#160;<b>protection key</b>&#160;located in&#160;<br/>bits&#160;62:59 of&#160;the paging-structure entry&#160;that&#160;mapped the page containing&#160;the linear&#160;address (see<a href="o_fe12b1e2a880e0ce-123.html">&#160;Section 4.5). The&#160;<br/></a>PKRU register determines,&#160;for each protection&#160;key,&#160;whether user-mode&#160;addresses with that protection&#160;key may be&#160;<br/>read or&#160;written.<br/>If CR4.PKE&#160;=&#160;0,&#160;or if&#160;IA-32e&#160;paging&#160;is not active,&#160;the&#160;processor does not&#160;associate linear addresses&#160;with protection&#160;<br/>keys and does&#160;not use&#160;the access-control mechanism described&#160;in this section.&#160;In either of these&#160;cases,&#160;a reference&#160;<br/><a href="o_fe12b1e2a880e0ce-133.html">in Section 4.6.1 to a use</a>r-mode address with a protection key should&#160;be considered a reference&#160;to&#160;any&#160;user-mode&#160;<br/>address.<br/>The&#160;PKRU register (protection key&#160;rights for&#160;user pages)&#160;is&#160;a 32-bit register&#160;with&#160;the following format:&#160;for each&#160;<i>i</i>&#160;<br/>(0&#160;‚â§&#160;<i>i</i>&#160;‚â§&#160;15), PKRU[2<i>i</i>] is&#160;the&#160;<b>access-disable bit</b>&#160;for protection key&#160;<i>i</i>&#160;(AD<i>i</i>); PKRU[2<i>i</i>+1] is the&#160;<b>write-disable bit</b>&#160;<br/>for protection key&#160;<i>i</i>&#160;(WD<i>i</i>).<br/>Software&#160;can use&#160;the&#160;RDPKRU and&#160;WRPKRU instructions with ECX&#160;=&#160;0&#160;to read and&#160;write&#160;PKRU.&#160;In addition,&#160;the&#160;<br/>PKRU register is XSAVE-managed state&#160;and can thus be&#160;read&#160;and written by instructions&#160;in the&#160;XSAVE&#160;feature set.&#160;<br/>Se<a href="˛ˇ">e Chapter&#160;13,&#160;‚ÄúManaging&#160;State Using&#160;the XSAVE&#160;Feature&#160;Set,‚Äù of&#160;<i>Intel¬Æ 64 and&#160;IA-32 Architectures Software&#160;<br/>Developer‚Äôs Manual, Volume 1</i>&#160;for more&#160;</a>information about&#160;the XSAVE&#160;feature set.<br/>How a&#160;linear address‚Äôs protection&#160;key controls&#160;access&#160;to&#160;the&#160;address depends&#160;on the&#160;mode&#160;of&#160;a linear&#160;address:</p>
<p style="position:absolute;top:692px;left:69px;white-space:nowrap" class="ft07">‚Ä¢</p>
<p style="position:absolute;top:693px;left:95px;white-space:nowrap" class="ft09">A linear&#160;address‚Äôs protection controls only data accesses to&#160;the address. It&#160;does&#160;not in&#160;any way affect instruc-<br/>tions fetches from&#160;the&#160;address.</p>
<p style="position:absolute;top:731px;left:69px;white-space:nowrap" class="ft07">‚Ä¢</p>
<p style="position:absolute;top:732px;left:95px;white-space:nowrap" class="ft09">The&#160;protection key of a supervisor-mode&#160;address&#160;is ignored and does not control data accesses to the&#160;address.&#160;<br/><a href="o_fe12b1e2a880e0ce-133.html">Because of this, Section 4.6.1&#160;</a>does&#160;not&#160;refer&#160;to protection&#160;keys&#160;when&#160;specifying the access&#160;rights&#160;for&#160;<br/>supervisor-mode addresses.</p>
<p style="position:absolute;top:787px;left:69px;white-space:nowrap" class="ft07">‚Ä¢</p>
<p style="position:absolute;top:787px;left:95px;white-space:nowrap" class="ft010">Use of the&#160;protection&#160;key&#160;<i>i</i>&#160;of&#160;a user-mode address&#160;depends&#160;on&#160;the&#160;value of the&#160;PKRU register:<br/>‚Äî&#160;If&#160;&#160;AD<i>i&#160;</i>=&#160;1,&#160;no&#160;data accesses&#160;are permitted.<br/>‚Äî&#160;If&#160;&#160;WD<i>i&#160;</i>= 1, permission may&#160;be&#160;denied&#160;to&#160;certain data write&#160;accesses:</p>
<p style="position:absolute;top:861px;left:120px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:859px;left:146px;white-space:nowrap" class="ft03">User-mode&#160;write accesses&#160;are not permitted.</p>
<p style="position:absolute;top:885px;left:120px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:883px;left:146px;white-space:nowrap" class="ft03">Supervisor-mode write accesses are not permitted if CR0.WP&#160;= 1.&#160;(If CR0.WP&#160;= 0,&#160;WD<i>i</i>&#160;does&#160;not affect&#160;</p>
<p style="position:absolute;top:900px;left:145px;white-space:nowrap" class="ft03">supervisor-mode write&#160;accesses&#160;to user-mode&#160;addresses with protection key&#160;<i>i</i>.)</p>
<p style="position:absolute;top:955px;left:69px;white-space:nowrap" class="ft08">4.7&#160;PAGE-FAULT&#160;</p>
<p style="position:absolute;top:955px;left:272px;white-space:nowrap" class="ft08">EXCEPTIONS</p>
<p style="position:absolute;top:991px;left:69px;white-space:nowrap" class="ft09">Accesses using linear&#160;addresses may cause&#160;<b>page-fault exceptions</b>&#160;(#PF; exception&#160;14). An&#160;access&#160;to a&#160;linear&#160;<br/>address may cause&#160;a page-fault exception&#160;for&#160;either of&#160;two&#160;reasons: (1)&#160;there&#160;is no&#160;translation for the&#160;linear&#160;<br/>address; or&#160;(2)&#160;there is&#160;a translation for the&#160;linear address, but&#160;its access rights do&#160;not&#160;permit&#160;the access.</p>
</div>
</body>
</html>
