<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 146</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:8px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page146-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce146.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">4-42&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PAGING</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft02">—&#160;If CR4.PCIDE&#160;=&#160;1 and&#160;bit&#160;63 of&#160;the&#160;instruction’s&#160;source&#160;operand is&#160;1, the&#160;instruction&#160;is not&#160;required to&#160;</p>
<p style="position:absolute;top:117px;left:119px;white-space:nowrap" class="ft02">invalidate&#160;any TLB entries or entries in&#160;paging-structure&#160;caches.</p>
<p style="position:absolute;top:139px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:139px;left:93px;white-space:nowrap" class="ft05">MOV to&#160;CR4.&#160;The behavior&#160;of&#160;the instruction depends on&#160;the bits&#160;being modified:<br/>—&#160;The instruction invalidates&#160;all TLB entries (including&#160;global&#160;entries)&#160;and&#160;all entries in all&#160;paging-structure&#160;</p>
<p style="position:absolute;top:180px;left:119px;white-space:nowrap" class="ft02">caches&#160;(for all PCIDs)&#160;if (1)&#160;it changes the value of CR4.PGE;</p>
<p style="position:absolute;top:177px;left:524px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:180px;left:531px;white-space:nowrap" class="ft02">&#160;or (2)&#160;it changes the value of the CR4.PCIDE&#160;</p>
<p style="position:absolute;top:196px;left:119px;white-space:nowrap" class="ft02">from 1 to 0.</p>
<p style="position:absolute;top:220px;left:93px;white-space:nowrap" class="ft02">—&#160;The instruction invalidates&#160;all TLB entries and&#160;all entries in all paging-structure&#160;caches for the current PCID&#160;</p>
<p style="position:absolute;top:237px;left:119px;white-space:nowrap" class="ft02">if&#160;(1)&#160;it changes the&#160;value&#160;of CR4.PAE;&#160;or (2)&#160;it&#160;changes&#160;the value of&#160;CR4.SMEP from 0&#160;to 1.</p>
<p style="position:absolute;top:259px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:259px;left:93px;white-space:nowrap" class="ft06">Task switch.&#160;If&#160;a task switch changes the value of CR3,&#160;it invalidates&#160;all TLB entries associated with PCID&#160;000H&#160;<br/>except&#160;those&#160;for global pages.&#160;It also&#160;invalidates&#160;all entries in all paging-structure&#160;caches associated&#160;with PCID&#160;<br/>000H.</p>
<p style="position:absolute;top:290px;left:134px;white-space:nowrap" class="ft04">2</p>
<p style="position:absolute;top:314px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:315px;left:93px;white-space:nowrap" class="ft02">VMX transitions. See&#160;<a href="o_fe12b1e2a880e0ce-150.html">Section&#160;4.11.1</a>.</p>
<p style="position:absolute;top:339px;left:68px;white-space:nowrap" class="ft06">The&#160;processor is&#160;always free&#160;to&#160;invalidate additional entries&#160;in the&#160;TLBs and paging-structure caches. The following&#160;<br/>are some&#160;examples:</p>
<p style="position:absolute;top:377px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:378px;left:93px;white-space:nowrap" class="ft06">INVLPG&#160;may&#160;invalidate TLB entries for pages other than&#160;the one corresponding&#160;to its linear-address operand. It&#160;<br/>may&#160;invalidate&#160;TLB entries and&#160;paging-structure-cache&#160;entries associated&#160;with PCIDs other&#160;than&#160;the current&#160;<br/>PCID.</p>
<p style="position:absolute;top:433px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:433px;left:93px;white-space:nowrap" class="ft06">INVPCID may&#160;invalidate TLB entries&#160;for&#160;pages other&#160;than&#160;the&#160;one corresponding&#160;to the&#160;specified&#160;linear&#160;address.&#160;<br/>It&#160;may invalidate TLB entries&#160;and paging-structure-cache&#160;entries associated&#160;with PCIDs&#160;other than the specified&#160;<br/>PCID.</p>
<p style="position:absolute;top:488px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:489px;left:93px;white-space:nowrap" class="ft06">MOV to&#160;CR0&#160;may&#160;invalidate&#160;TLB entries&#160;even&#160;if CR0.PG&#160;is&#160;not changing.&#160;For example,&#160;this may&#160;occur if either&#160;<br/>CR0.CD&#160;or CR0.NW is&#160;modified.</p>
<p style="position:absolute;top:527px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:528px;left:93px;white-space:nowrap" class="ft06">MOV&#160;to CR3 may invalidate TLB entries for global pages.&#160;If CR4.PCIDE&#160;=&#160;1&#160;and bit&#160;63 of the instruction’s source&#160;<br/>operand is&#160;0,&#160;it may invalidate TLB entries and&#160;entries&#160;in&#160;the&#160;paging-structure caches&#160;associated&#160;with PCIDs&#160;<br/>other than the PCID it is&#160;establishing. It may invalidate entries&#160;if CR4.PCIDE&#160;=&#160;1 and&#160;bit&#160;63 of the instruction’s&#160;<br/>source operand&#160;is 1.&#160;</p>
<p style="position:absolute;top:599px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:600px;left:93px;white-space:nowrap" class="ft02">MOV to&#160;CR4 may&#160;invalidate TLB entries&#160;when&#160;changing&#160;CR4.PSE&#160;or when&#160;changing&#160;CR4.SMEP&#160;from 1 to 0.</p>
<p style="position:absolute;top:622px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:622px;left:93px;white-space:nowrap" class="ft06">On a processor supporting&#160;Hyper-Threading Technology, invalidations performed on one logical processor may&#160;<br/>invalidate entries in&#160;the TLBs and&#160;paging-structure&#160;caches used by other&#160;logical&#160;processors.</p>
<p style="position:absolute;top:663px;left:68px;white-space:nowrap" class="ft06">(Other instructions and operations may&#160;invalidate&#160;entries in the&#160;TLBs&#160;and the paging-structure caches,&#160;but the&#160;<br/>instructions identified&#160;above are&#160;recommended.)<br/>In addition to&#160;the instructions identified&#160;above, page&#160;faults&#160;invalidate entries in the TLBs&#160;and&#160;paging-structure&#160;<br/>caches. In particular, a&#160;page-fault&#160;exception resulting from an attempt to&#160;use&#160;a&#160;linear address&#160;will&#160;invalidate&#160;any&#160;<br/>TLB entries that&#160;are for a&#160;page number&#160;corresponding&#160;to&#160;that linear&#160;address and&#160;that are&#160;associated with the&#160;<br/>current PCID. It also invalidates all entries in the paging-structure caches that would be used&#160;for that&#160;linear address&#160;<br/>and&#160;that are associated with the&#160;current PCID.</p>
<p style="position:absolute;top:767px;left:380px;white-space:nowrap" class="ft04">3</p>
<p style="position:absolute;top:769px;left:387px;white-space:nowrap" class="ft02">&#160;These invalidations ensure&#160;that the&#160;page-fault&#160;exception will not&#160;</p>
<p style="position:absolute;top:786px;left:68px;white-space:nowrap" class="ft06">recur (if&#160;the faulting instruction is&#160;re-executed)&#160;if&#160;it would not be caused by the contents&#160;of&#160;the paging&#160;structures&#160;<br/>in&#160;memory&#160;(and if, therefore,&#160;it resulted from cached entries&#160;that&#160;were not&#160;invalidated after&#160;the paging&#160;structures&#160;<br/>were&#160;modified&#160;in&#160;memory).<br/>As&#160;noted&#160;<a href="o_fe12b1e2a880e0ce-140.html">in&#160;Section&#160;4.10.2,</a>&#160;some processors may choose to&#160;cache multiple smaller-page TLB entries for a&#160;transla-<br/>tion specified by the paging&#160;structures to use a page larger&#160;than&#160;4&#160;KBytes.&#160;There&#160;is&#160;no&#160;way&#160;for&#160;software&#160;to&#160;be&#160;aware&#160;<br/>that multiple&#160;translations&#160;for&#160;smaller pages&#160;have been&#160;used&#160;for&#160;a large&#160;page.&#160;The&#160;INVLPG&#160;instruction&#160;and page&#160;<br/>faults&#160;provide the same&#160;assurances that&#160;they provide&#160;when&#160;a single TLB entry is&#160;used: they&#160;invalidate&#160;all&#160;TLB&#160;<br/>entries&#160;corresponding to the&#160;translation&#160;specified by the&#160;paging&#160;structures.</p>
<p style="position:absolute;top:963px;left:68px;white-space:nowrap" class="ft02">1.&#160;If&#160;CR4.PGE&#160;is&#160;changing&#160;from&#160;0&#160;to&#160;1, there&#160;were&#160;no&#160;global&#160;TLB&#160;entries before&#160;the&#160;execution; if&#160;CR4.PGE is&#160;changing&#160;from&#160;1 to&#160;0, there&#160;</p>
<p style="position:absolute;top:979px;left:89px;white-space:nowrap" class="ft02">will be&#160;no&#160;global TLB entries after&#160;the execution.</p>
<p style="position:absolute;top:1000px;left:68px;white-space:nowrap" class="ft02">2.&#160;Task switches do not occur in IA-32e mode and thus cannot&#160;occur with&#160;IA-32e paging.&#160;Since&#160;CR4.PCIDE can be&#160;set only with IA-32e&#160;</p>
<p style="position:absolute;top:1017px;left:89px;white-space:nowrap" class="ft02">paging, task switches occur&#160;only with&#160;CR4.PCIDE&#160;=&#160;0.</p>
<p style="position:absolute;top:1038px;left:68px;white-space:nowrap" class="ft02">3.&#160;Unlike&#160;INVLPG,&#160;page&#160;faults&#160;need&#160;not invalidate&#160;all&#160;entries in&#160;the paging-structure&#160;caches, only those&#160;that&#160;would&#160;be&#160;used to&#160;translate&#160;</p>
<p style="position:absolute;top:1054px;left:89px;white-space:nowrap" class="ft02">the&#160;faulting linear&#160;address.</p>
</div>
</body>
</html>
