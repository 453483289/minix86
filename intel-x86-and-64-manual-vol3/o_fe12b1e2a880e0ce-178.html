<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 178</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:16px;font-family:Times;color:#ffffff;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:9px;line-height:11px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page178-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce178.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">5-26&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROTECTION</p>
<p style="position:absolute;top:98px;left:68px;white-space:nowrap" class="ft02">5.10.4&#160;</p>
<p style="position:absolute;top:98px;left:148px;white-space:nowrap" class="ft02">Checking Caller Access Privileges (ARPL Instruction)</p>
<p style="position:absolute;top:129px;left:68px;white-space:nowrap" class="ft07">The&#160;requestor’s privilege&#160;level (RPL) field of a&#160;segment&#160;selector&#160;is intended&#160;to carry the&#160;privilege level&#160;of&#160;a calling&#160;<br/>procedure&#160;(the&#160;calling procedure’s CPL) to&#160;a called procedure.&#160;The called procedure&#160;then uses the RPL to&#160;determine&#160;<br/>if access&#160;to a segment is allowed. The&#160;RPL is said to “weaken” the&#160;privilege&#160;level of the called procedure&#160;to&#160;that of&#160;<br/>the RPL.&#160;<br/>Operating-system procedures&#160;typically&#160;use the RPL to&#160;prevent less privileged application programs from accessing&#160;<br/>data located in more&#160;privileged segments.&#160;When&#160;an operating-system&#160;procedure&#160;(the called procedure)&#160;receives&#160;a&#160;<br/>segment selector&#160;from&#160;an&#160;application&#160;program&#160;(the calling&#160;procedure), it&#160;sets&#160;the segment selector’s&#160;RPL to&#160;the&#160;<br/>privilege level&#160;of&#160;the calling procedure. Then, when the&#160;operating&#160;system uses&#160;the segment selector to&#160;access&#160;its&#160;<br/>associated&#160;segment, the processor performs privilege&#160;checks using the calling procedure’s privilege&#160;level (stored&#160;in&#160;<br/>the RPL)&#160;rather&#160;than&#160;the numerically lower privilege&#160;level&#160;(the CPL) of the&#160;operating-system&#160;procedure.&#160;The&#160;RPL&#160;<br/>thus&#160;insures that&#160;the operating system&#160;does&#160;not access a&#160;segment&#160;on behalf of&#160;an&#160;application&#160;program unless&#160;that&#160;<br/>program itself&#160;has access to&#160;the segment.<br/><a href="o_fe12b1e2a880e0ce-178.html">Figure&#160;5-15</a>&#160;shows an&#160;example of how the&#160;processor&#160;uses the&#160;RPL&#160;field.&#160;In this example,&#160;an application program&#160;<br/>(located in code segment A) possesses&#160;a segment selector&#160;(segment selector D1) that&#160;points to&#160;a privileged data&#160;<br/>structure (that&#160;is,&#160;a data structure located&#160;in&#160;a data segment D at&#160;privilege&#160;level&#160;0).&#160;<br/>The application program cannot access data segment D,&#160;because it does not have sufficient privilege, but the oper-<br/>ating&#160;system&#160;(located&#160;in code segment C) can. So, in&#160;an&#160;attempt&#160;to access data&#160;segment&#160;D,&#160;the application&#160;<br/>program&#160;executes&#160;a call to the&#160;operating&#160;system&#160;and passes segment selector D1 to&#160;the operating&#160;system as&#160;a&#160;<br/>parameter on&#160;the stack. Before passing the segment&#160;selector, the (well&#160;behaved)&#160;application program sets&#160;the RPL&#160;<br/>of the segment selector&#160;to its&#160;current privilege&#160;level (which&#160;in&#160;this example is&#160;3). If the operating&#160;system attempts&#160;<br/>to access data segment D using segment selector D1, the&#160;processor compares the&#160;CPL (which is&#160;now 0 following&#160;<br/>the call), the RPL of segment selector&#160;D1,&#160;and the&#160;DPL of data&#160;segment D<b>&#160;</b>(which is&#160;0). Since the&#160;RPL&#160;is greater than&#160;<br/>the DPL, access to data segment D is denied. The processor’s protection mechanism&#160;thus protects data segment D&#160;<br/>from&#160;access by the&#160;operating system,&#160;because&#160;application program’s privilege&#160;level (represented&#160;by the&#160;RPL&#160;of&#160;<br/>segment&#160;selector&#160;B) is&#160;greater&#160;than the&#160;DPL of data segment D.</p>
<p style="position:absolute;top:1026px;left:215px;white-space:nowrap" class="ft05">Figure&#160;5-15.&#160;&#160;Use&#160;of&#160;RPL&#160;to&#160;Weaken&#160;Privilege&#160;Level&#160;of&#160;Called&#160;Procedure</p>
<p style="position:absolute;top:627px;left:451px;white-space:nowrap" class="ft00">Passed as a&#160;</p>
<p style="position:absolute;top:639px;left:443px;white-space:nowrap" class="ft00">parameter&#160;on</p>
<p style="position:absolute;top:652px;left:464px;white-space:nowrap" class="ft00">the stack.</p>
<p style="position:absolute;top:847px;left:608px;white-space:nowrap" class="ft00">Access</p>
<p style="position:absolute;top:871px;left:606px;white-space:nowrap" class="ft00">allowed</p>
<p style="position:absolute;top:981px;left:482px;white-space:nowrap" class="ft09">Access<br/>allowed</p>
<p style="position:absolute;top:669px;left:208px;white-space:nowrap" class="ft00">Application Program</p>
<p style="position:absolute;top:952px;left:346px;white-space:nowrap" class="ft00">Operating</p>
<p style="position:absolute;top:965px;left:359px;white-space:nowrap" class="ft00">System</p>
<p style="position:absolute;top:736px;left:210px;white-space:nowrap" class="ft00">Lowest Privilege</p>
<p style="position:absolute;top:995px;left:211px;white-space:nowrap" class="ft00">Highest Privilege</p>
<p style="position:absolute;top:731px;left:193px;white-space:nowrap" class="ft06">3</p>
<p style="position:absolute;top:817px;left:193px;white-space:nowrap" class="ft06">2</p>
<p style="position:absolute;top:903px;left:193px;white-space:nowrap" class="ft06">1</p>
<p style="position:absolute;top:990px;left:193px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:945px;left:641px;white-space:nowrap" class="ft00">Data</p>
<p style="position:absolute;top:956px;left:625px;white-space:nowrap" class="ft00">Segment D</p>
<p style="position:absolute;top:859px;left:630px;white-space:nowrap" class="ft00">not</p>
<p style="position:absolute;top:699px;left:580px;white-space:nowrap" class="ft00">Segment Sel.&#160;D1</p>
<p style="position:absolute;top:711px;left:640px;white-space:nowrap" class="ft00">RPL=3</p>
<p style="position:absolute;top:955px;left:503px;white-space:nowrap" class="ft00">Segment Sel. D2</p>
<p style="position:absolute;top:967px;left:563px;white-space:nowrap" class="ft00">RPL=0</p>
<p style="position:absolute;top:699px;left:325px;white-space:nowrap" class="ft00">Gate Selector B</p>
<p style="position:absolute;top:711px;left:386px;white-space:nowrap" class="ft00">RPL=3</p>
<p style="position:absolute;top:688px;left:246px;white-space:nowrap" class="ft00">Code</p>
<p style="position:absolute;top:699px;left:231px;white-space:nowrap" class="ft00">Segment A</p>
<p style="position:absolute;top:717px;left:230px;white-space:nowrap" class="ft00">CPL=3</p>
<p style="position:absolute;top:943px;left:425px;white-space:nowrap" class="ft00">Code</p>
<p style="position:absolute;top:954px;left:410px;white-space:nowrap" class="ft00">Segment C</p>
<p style="position:absolute;top:972px;left:409px;white-space:nowrap" class="ft00">DPL=0</p>
<p style="position:absolute;top:694px;left:472px;white-space:nowrap" class="ft00">Call</p>
<p style="position:absolute;top:705px;left:463px;white-space:nowrap" class="ft00">Gate B</p>
<p style="position:absolute;top:723px;left:452px;white-space:nowrap" class="ft00">DPL=3</p>
<p style="position:absolute;top:975px;left:624px;white-space:nowrap" class="ft00">DPL=0</p>
</div>
</body>
</html>
