<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 308</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:14px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:18px;font-family:Times;color:#0860a8;}
	.ft07{font-size:16px;font-family:Times;color:#0860a8;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page308-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce308.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">8-52&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">MULTIPLE-PROCESSOR&#160;MANAGEMENT</p>
<p style="position:absolute;top:99px;left:68px;white-space:nowrap" class="ft02">8.10.6.6 &#160;&#160;Eliminate Execution-Based Timing Loops</p>
<p style="position:absolute;top:127px;left:68px;white-space:nowrap" class="ft08">Intel discourages&#160;the&#160;use&#160;of timing loops that depend&#160;on a&#160;processor‚Äôs execution&#160;speed to&#160;measure&#160;time. There&#160;are&#160;<br/>several reasons:</p>
<p style="position:absolute;top:166px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:166px;left:93px;white-space:nowrap" class="ft08">Timing loops&#160;cause&#160;problems when&#160;they are calibrated on&#160;a&#160;IA-32 processor running&#160;at&#160;one frequency&#160;and then&#160;<br/>executed&#160;on&#160;a processor running at&#160;another frequency.&#160;</p>
<p style="position:absolute;top:205px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:205px;left:93px;white-space:nowrap" class="ft08">Routines for calibrating&#160;execution-based timing&#160;loops&#160;produce unpredictable&#160;results when&#160;run on&#160;an&#160;IA-32&#160;<br/>processor supporting&#160;Intel&#160;Hyper-Threading&#160;Technology.&#160;This is&#160;due&#160;to the&#160;sharing of execution&#160;resources&#160;<br/>between&#160;the logical processors within&#160;a physical package.&#160;</p>
<p style="position:absolute;top:262px;left:68px;white-space:nowrap" class="ft08">To&#160;avoid the problems described,&#160;timing&#160;loop&#160;routines must&#160;use a&#160;timing mechanism&#160;for&#160;the loop&#160;that does not&#160;<br/>depend&#160;on&#160;the execution speed&#160;of&#160;the logical processors in&#160;the&#160;system. The&#160;following&#160;sources are&#160;generally avail-<br/>able:</p>
<p style="position:absolute;top:317px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:318px;left:93px;white-space:nowrap" class="ft03">A&#160;high&#160;resolution&#160;system timer&#160;(for&#160;example,&#160;an Intel 8254).</p>
<p style="position:absolute;top:340px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:340px;left:93px;white-space:nowrap" class="ft03">A&#160;high resolution&#160;timer&#160;within&#160;the processor (such&#160;as, the local&#160;APIC timer&#160;or the&#160;time-stamp&#160;counter).</p>
<p style="position:absolute;top:364px;left:68px;white-space:nowrap" class="ft03">For addition<a href="˛ˇ">al information, see the&#160;<i>Intel¬Æ 64 and IA-32 Architectures&#160;Optimization&#160;Reference&#160;Manual</i></a>.</p>
<p style="position:absolute;top:409px;left:68px;white-space:nowrap" class="ft02">8.10.6.7 &#160;&#160;Place Locks and&#160;Semaphores in Aligned, 128-Byte&#160;Blocks&#160;of&#160;Memory</p>
<p style="position:absolute;top:437px;left:68px;white-space:nowrap" class="ft08">When software&#160;uses locks&#160;or semaphores&#160;to synchronize&#160;processes,&#160;threads, or&#160;other code&#160;sections;&#160;Intel&#160;recom-<br/>mends that only one&#160;lock&#160;or semaphore be present within&#160;a cache&#160;line (or&#160;128&#160;byte sector,&#160;if&#160;128-byte&#160;sector&#160;is&#160;<br/>supported). In&#160;processors based&#160;on Intel&#160;NetBurst microarchitecture (which&#160;support 128-byte sector consisting of&#160;<br/>two cache&#160;lines), following&#160;this recommendation&#160;means that&#160;each&#160;lock&#160;or semaphore&#160;should be contained in&#160;a 128-<br/>byte block&#160;of&#160;memory&#160;that begins on&#160;a 128-byte boundary. The&#160;practice&#160;minimizes&#160;the&#160;bus&#160;traffic required&#160;to&#160;<br/>service locks.</p>
<p style="position:absolute;top:575px;left:68px;white-space:nowrap" class="ft06">8.11&#160;</p>
<p style="position:absolute;top:575px;left:147px;white-space:nowrap" class="ft06">MP INITIALIZATION&#160;FOR P6 FAMILY PROCESSORS</p>
<p style="position:absolute;top:611px;left:68px;white-space:nowrap" class="ft08">This section describes the&#160;MP initialization process&#160;for systems that use multiple P6 family processors. This&#160;process&#160;<br/>uses the&#160;MP initialization protocol&#160;that was&#160;introduced&#160;with the&#160;Pentium&#160;<a href="o_fe12b1e2a880e0ce-274.html">Pro processor (see Section 8.4, ‚ÄúMultiple-<br/>Processor&#160;(MP)&#160;Initialization‚Äù). F</a>or P6&#160;family&#160;processors, this protocol&#160;is&#160;typically used to&#160;boot 2&#160;or 4&#160;processors&#160;<br/>that reside on single system bus; however,&#160;it can support from&#160;2 to&#160;15&#160;processors in&#160;a multi-clustered system when&#160;<br/>the APIC busses are tied together. Larger&#160;systems are not supported.</p>
<p style="position:absolute;top:728px;left:68px;white-space:nowrap" class="ft07">8.11.1&#160;</p>
<p style="position:absolute;top:728px;left:148px;white-space:nowrap" class="ft07">Overview&#160;of&#160;the MP Initialization Process For P6 Family Processors</p>
<p style="position:absolute;top:758px;left:68px;white-space:nowrap" class="ft09">During the&#160;execution of&#160;the MP initialization protocol, one processor is&#160;selected&#160;as the&#160;bootstrap processor (BSP)&#160;<br/>and the&#160;remaining&#160;processors&#160;are designated&#160;as&#160;application processors (APs<a href="o_fe12b1e2a880e0ce-274.html">), see Section 8.4.1,&#160;‚ÄúBSP&#160;and&#160;AP&#160;<br/>Processors.‚Äù</a>&#160;Thereafter,&#160;the BSP manages&#160;the initialization of itself&#160;and the&#160;APs.&#160;This initialization includes&#160;<br/>executing&#160;BIOS initialization code and operating-system initialization code.<br/>The MP protocol&#160;imposes&#160;the following requirements&#160;and restrictions&#160;on the&#160;system:</p>
<p style="position:absolute;top:853px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:854px;left:93px;white-space:nowrap" class="ft03">An&#160;APIC&#160;clock (APICLK) must be&#160;provided.</p>
<p style="position:absolute;top:876px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:877px;left:93px;white-space:nowrap" class="ft08">The&#160;MP protocol will be&#160;executed only after a power-up&#160;or RESET.&#160;If&#160;the MP&#160;protocol&#160;has been&#160;completed and a&#160;<br/>BSP&#160;has been chosen, subsequent&#160;INITs (either&#160;to a&#160;specific processor or&#160;system&#160;wide)&#160;do not&#160;cause&#160;the&#160;MP&#160;<br/>protocol to&#160;be&#160;repeated. Instead,&#160;each&#160;processor examines its&#160;BSP&#160;flag (in&#160;the APIC_BASE MSR) to&#160;determine&#160;<br/>whether&#160;it should&#160;execute&#160;the BIOS boot-strap code (if&#160;it&#160;is the&#160;BSP)&#160;or enter a wait-for-SIPI&#160;state (if&#160;it is&#160;an&#160;<br/>AP).</p>
<p style="position:absolute;top:964px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:965px;left:93px;white-space:nowrap" class="ft08">All devices in&#160;the system&#160;that&#160;are&#160;capable&#160;of delivering&#160;interrupts to&#160;the processors must be&#160;inhibited&#160;from&#160;<br/>doing&#160;so for the&#160;duration&#160;of&#160;the MP&#160;initialization protocol. The time&#160;during which interrupts&#160;must&#160;be inhibited&#160;<br/>includes&#160;the&#160;window between when the&#160;BSP&#160;issues an&#160;INIT-SIPI-SIPI sequence&#160;to an AP&#160;and when the&#160;AP&#160;<br/>responds to&#160;the last&#160;SIPI in&#160;the&#160;sequence.</p>
<p style="position:absolute;top:1039px;left:68px;white-space:nowrap" class="ft08">The following special-purpose&#160;interprocessor interrupts&#160;(IPIs)&#160;are&#160;used during the&#160;boot phase of&#160;the MP initializa-<br/>tion protocol. These IPIs are broadcast on the APIC&#160;bus.</p>
</div>
</body>
</html>
