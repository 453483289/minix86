<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 589</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:12px;font-family:Times;color:#0860a8;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page589-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce589.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;17-15</p>
<p style="position:absolute;top:47px;left:425px;white-space:nowrap" class="ft01">DEBUG, BRANCH&#160;PROFILE, TSC, AND RESOURCE MONITORING FEATURES</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">â€¢</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft03">The&#160;BTS&#160;buffer&#160;is&#160;almost&#160;full&#160;and reaches the&#160;interrupt&#160;threshold.</p>
<p style="position:absolute;top:124px;left:69px;white-space:nowrap" class="ft08"><a href="o_fe12b1e2a880e0ce-589.html">Table&#160;17-3 compares the&#160;</a>interaction of the processor with&#160;the PMI&#160;handler using&#160;the legacy versus streamlined&#160;<br/>Freeza_Perfmon_On_PMI&#160;interface.</p>
<p style="position:absolute;top:174px;left:107px;white-space:nowrap" class="ft04">Table 17-3.&#160;&#160;Legacy and&#160;Streamlined Operation with&#160;Freeze_Perfmon_On_PMI = 1,&#160;Counter&#160;Overflowed</p>
<p style="position:absolute;top:178px;left:799px;white-space:nowrap" class="ft05">&#160;&#160;</p>
<p style="position:absolute;top:497px;left:69px;white-space:nowrap" class="ft05">17.4.8 LBR&#160;</p>
<p style="position:absolute;top:497px;left:186px;white-space:nowrap" class="ft05">Stack&#160;</p>
<p style="position:absolute;top:528px;left:69px;white-space:nowrap" class="ft08">The last&#160;branch&#160;record stack&#160;and top-of-stack&#160;(TOS) pointer MSRs&#160;are supported&#160;across Intel 64&#160;and&#160;IA-32&#160;<br/>processor families. However,&#160;the number&#160;of&#160;MSRs in&#160;the&#160;LBR stack&#160;and the&#160;valid range&#160;of&#160;TOS pointer value can&#160;<br/>vary&#160;between&#160;different proce<a href="o_fe12b1e2a880e0ce-589.html">ssor families. Table&#160;17-4&#160;</a>lists&#160;the&#160;LBR&#160;stack&#160;size and TOS pointer range&#160;for&#160;several&#160;<br/>processor families according to the&#160;CPUID signatures of&#160;DisplayFamily_DisplayModel encoding (see&#160;CPUID instruc-<br/><a href="þÿ">tion in Chapter&#160;3&#160;</a>of<a href="þÿ">&#160;<i>IntelÂ® 64&#160;and&#160;IA-32&#160;Architectures Software&#160;Developerâ€™s&#160;Manual,&#160;Volume 2A</i></a>).&#160;</p>
<p style="position:absolute;top:1010px;left:69px;white-space:nowrap" class="ft08">The&#160;last branch recording mechanism tracks&#160;not&#160;only&#160;branch instructions (like JMP,&#160;Jcc, LOOP&#160;and CALL&#160;instruc-<br/>tions), but also other operations&#160;that cause a change in the instruction pointer (like external interrupts, traps and&#160;<br/>faults).&#160;The branch recording mechanisms generally&#160;employs&#160;a set of MSRs, referred to&#160;as last branch&#160;record&#160;(LBR)&#160;<br/>stack.&#160;The&#160;size and exact&#160;locations of the&#160;LBR&#160;stack are&#160;generally model-specific&#160;(see<a href="þÿ">&#160;Chapter 35, â€œModel-Specific&#160;</a></p>
<p style="position:absolute;top:214px;left:62px;white-space:nowrap" class="ft03">Legacy Freeze_Perfmon_On_PMI</p>
<p style="position:absolute;top:214px;left:349px;white-space:nowrap" class="ft03">Streamlined Freeze_Perfmon_On_PMI</p>
<p style="position:absolute;top:214px;left:627px;white-space:nowrap" class="ft03">Comment</p>
<p style="position:absolute;top:236px;left:62px;white-space:nowrap" class="ft03">Processor&#160;freezes the&#160;counters&#160;on&#160;overflow</p>
<p style="position:absolute;top:236px;left:349px;white-space:nowrap" class="ft03">Processor&#160;freezes the counters&#160;on&#160;overflow</p>
<p style="position:absolute;top:236px;left:627px;white-space:nowrap" class="ft03">Unchanged</p>
<p style="position:absolute;top:259px;left:62px;white-space:nowrap" class="ft03">Processor clears IA32_PERF_GLOBAL_CTRL</p>
<p style="position:absolute;top:259px;left:349px;white-space:nowrap" class="ft03">Processor set&#160;</p>
<p style="position:absolute;top:276px;left:349px;white-space:nowrap" class="ft03">IA32_PERF_GLOBAL_STATUS.CTR_FTZ</p>
<p style="position:absolute;top:298px;left:62px;white-space:nowrap" class="ft03">Handler reads IA32_PERF_GLOBAL_STATUS&#160;</p>
<p style="position:absolute;top:315px;left:62px;white-space:nowrap" class="ft03">(0x38E) to&#160;examine which counter(s) overflowed</p>
<p style="position:absolute;top:298px;left:349px;white-space:nowrap" class="ft03">mask&#160;= RDMSR(0x38E)</p>
<p style="position:absolute;top:298px;left:627px;white-space:nowrap" class="ft03">Similar</p>
<p style="position:absolute;top:337px;left:62px;white-space:nowrap" class="ft03">Handler services the PMI</p>
<p style="position:absolute;top:337px;left:349px;white-space:nowrap" class="ft03">Handler&#160;services the PMI</p>
<p style="position:absolute;top:337px;left:627px;white-space:nowrap" class="ft03">Unchanged</p>
<p style="position:absolute;top:360px;left:62px;white-space:nowrap" class="ft03">Handler&#160;writes&#160;1s to&#160;</p>
<p style="position:absolute;top:376px;left:62px;white-space:nowrap" class="ft03">IA32_PERF_GLOBAL_OVF_CTL (0x390)&#160;</p>
<p style="position:absolute;top:360px;left:349px;white-space:nowrap" class="ft03">Handler writes&#160;mask&#160;into&#160;</p>
<p style="position:absolute;top:376px;left:349px;white-space:nowrap" class="ft03">IA32_PERF_GLOBAL_OVF_RESET (0x390)&#160;</p>
<p style="position:absolute;top:399px;left:62px;white-space:nowrap" class="ft03">Processor clears IA32_PERF_GLOBAL_STATUS</p>
<p style="position:absolute;top:399px;left:349px;white-space:nowrap" class="ft03">Processor clears&#160;IA32_PERF_GLOBAL_STATUS&#160;Unchanged</p>
<p style="position:absolute;top:421px;left:62px;white-space:nowrap" class="ft03">Handler&#160;re-enables IA32_PERF_GLOBAL_CTRL</p>
<p style="position:absolute;top:421px;left:349px;white-space:nowrap" class="ft03">None</p>
<p style="position:absolute;top:421px;left:627px;white-space:nowrap" class="ft03">Reduced&#160;software&#160;overhead</p>
<p style="position:absolute;top:624px;left:277px;white-space:nowrap" class="ft04">Table 17-4.&#160;&#160; LBR&#160;Stack Size&#160;and&#160;TOS Pointer&#160;Range&#160;</p>
<p style="position:absolute;top:646px;left:79px;white-space:nowrap" class="ft03">DisplayFamily_DisplayModel</p>
<p style="position:absolute;top:646px;left:386px;white-space:nowrap" class="ft03">Size&#160;of&#160;LBR&#160;Stack</p>
<p style="position:absolute;top:646px;left:508px;white-space:nowrap" class="ft03">Component&#160;of&#160;an LBR&#160;Entry</p>
<p style="position:absolute;top:646px;left:693px;white-space:nowrap" class="ft03">Range&#160;of&#160;TOS&#160;Pointer</p>
<p style="position:absolute;top:669px;left:79px;white-space:nowrap" class="ft03">06_5CH, 06_5FH</p>
<p style="position:absolute;top:669px;left:386px;white-space:nowrap" class="ft03">32</p>
<p style="position:absolute;top:669px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;TO_IP</p>
<p style="position:absolute;top:669px;left:694px;white-space:nowrap" class="ft03">0&#160;to&#160;31</p>
<p style="position:absolute;top:691px;left:79px;white-space:nowrap" class="ft03">06_4EH,&#160;06_5EH, 06_8EH, 06_9EH</p>
<p style="position:absolute;top:691px;left:386px;white-space:nowrap" class="ft03">32</p>
<p style="position:absolute;top:691px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;TO_IP,&#160;LBR_INFO</p>
<p style="position:absolute;top:688px;left:660px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:950px;left:75px;white-space:nowrap" class="ft01">NOTES:</p>
<p style="position:absolute;top:969px;left:74px;white-space:nowrap" class="ft03">1.&#160;See&#160;<a href="o_fe12b1e2a880e0ce-605.html">Section 17.10.</a></p>
<p style="position:absolute;top:691px;left:694px;white-space:nowrap" class="ft03">0 to&#160;31</p>
<p style="position:absolute;top:714px;left:79px;white-space:nowrap" class="ft03">06_3DH, 06_47H,&#160;06_4FH, 06_56H</p>
<p style="position:absolute;top:714px;left:386px;white-space:nowrap" class="ft03">16</p>
<p style="position:absolute;top:714px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;TO_IP</p>
<p style="position:absolute;top:714px;left:694px;white-space:nowrap" class="ft03">0&#160;to&#160;15</p>
<p style="position:absolute;top:736px;left:79px;white-space:nowrap" class="ft03">06_3CH, 06_45H,&#160;06_46H, 06_3FH</p>
<p style="position:absolute;top:736px;left:386px;white-space:nowrap" class="ft03">16</p>
<p style="position:absolute;top:736px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;TO_IP</p>
<p style="position:absolute;top:736px;left:694px;white-space:nowrap" class="ft03">0&#160;to&#160;15</p>
<p style="position:absolute;top:759px;left:79px;white-space:nowrap" class="ft03">06_2AH, 06_2DH,&#160;06_3AH, 06_3EH</p>
<p style="position:absolute;top:759px;left:386px;white-space:nowrap" class="ft03">16</p>
<p style="position:absolute;top:759px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;TO_IP</p>
<p style="position:absolute;top:759px;left:694px;white-space:nowrap" class="ft03">0&#160;to&#160;15</p>
<p style="position:absolute;top:781px;left:79px;white-space:nowrap" class="ft03">06_1AH, 06_1EH,&#160;06_1FH, 06_2EH, 06_25H,&#160;</p>
<p style="position:absolute;top:796px;left:79px;white-space:nowrap" class="ft03">06_2CH, 06_2FH</p>
<p style="position:absolute;top:781px;left:386px;white-space:nowrap" class="ft03">16</p>
<p style="position:absolute;top:781px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;TO_IP</p>
<p style="position:absolute;top:781px;left:694px;white-space:nowrap" class="ft03">0&#160;to&#160;15</p>
<p style="position:absolute;top:819px;left:79px;white-space:nowrap" class="ft03">06_17H, 06_1DH</p>
<p style="position:absolute;top:819px;left:386px;white-space:nowrap" class="ft03">4</p>
<p style="position:absolute;top:819px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;&#160;TO_IP</p>
<p style="position:absolute;top:819px;left:694px;white-space:nowrap" class="ft03">0&#160;&#160;to&#160;&#160;3</p>
<p style="position:absolute;top:841px;left:79px;white-space:nowrap" class="ft03">06_0FH</p>
<p style="position:absolute;top:841px;left:386px;white-space:nowrap" class="ft03">4</p>
<p style="position:absolute;top:841px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;&#160;TO_IP</p>
<p style="position:absolute;top:841px;left:694px;white-space:nowrap" class="ft03">0&#160;&#160;to&#160;&#160;3</p>
<p style="position:absolute;top:864px;left:79px;white-space:nowrap" class="ft03">06_37H, 06_4AH,&#160;06_4CH, 06_4DH,&#160;06_5AH,&#160;</p>
<p style="position:absolute;top:879px;left:79px;white-space:nowrap" class="ft03">06_5DH</p>
<p style="position:absolute;top:864px;left:386px;white-space:nowrap" class="ft03">8</p>
<p style="position:absolute;top:864px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;&#160;TO_IP</p>
<p style="position:absolute;top:864px;left:694px;white-space:nowrap" class="ft03">0&#160;&#160;to&#160;&#160;7</p>
<p style="position:absolute;top:901px;left:79px;white-space:nowrap" class="ft03">06_1CH, 06_26H,&#160;06_27H, 06_35H,&#160;06_36H</p>
<p style="position:absolute;top:901px;left:386px;white-space:nowrap" class="ft03">8</p>
<p style="position:absolute;top:901px;left:508px;white-space:nowrap" class="ft03">FROM_IP,&#160;&#160;TO_IP</p>
<p style="position:absolute;top:901px;left:694px;white-space:nowrap" class="ft03">0&#160;&#160;to&#160;&#160;7</p>
</div>
</body>
</html>
