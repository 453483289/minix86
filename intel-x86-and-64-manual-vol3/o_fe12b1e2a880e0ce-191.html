<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 191</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:14px;font-family:Times;color:#0860a8;}
	.ft06{font-size:18px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page191-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce191.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:774px;white-space:nowrap" class="ft00">Vol. 3A&#160;6-5</p>
<p style="position:absolute;top:47px;left:609px;white-space:nowrap" class="ft01">INTERRUPT&#160;AND&#160;EXCEPTION HANDLING</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft07"><b>Faults&#160;</b>‚Äî A fault is&#160;an exception&#160;that&#160;can generally&#160;be&#160;corrected and&#160;that,&#160;once corrected, allows the&#160;program&#160;<br/>to be&#160;restarted with no&#160;loss of continuity. When a fault is reported, the&#160;processor restores&#160;the&#160;machine state&#160;to&#160;<br/>the&#160;state&#160;prior to&#160;the&#160;beginning of&#160;execution of the&#160;faulting&#160;instruction.&#160;The return&#160;address (saved&#160;contents&#160;of&#160;<br/>the&#160;CS and&#160;EIP registers)&#160;for&#160;the fault handler points&#160;to&#160;the faulting&#160;instruction, rather than to&#160;the instruction&#160;<br/>following&#160;the faulting instruction.</p>
<p style="position:absolute;top:188px;left:69px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:189px;left:95px;white-space:nowrap" class="ft07"><b>Traps&#160;</b>‚Äî&#160;A trap is&#160;an&#160;exception&#160;that&#160;is reported&#160;immediately following the&#160;execution of&#160;the trapping&#160;instruction.&#160;<br/>Traps&#160;allow&#160;execution of&#160;a program or task&#160;to be continued without&#160;loss of&#160;program&#160;continuity. The&#160;return&#160;<br/>address&#160;for&#160;the trap handler points&#160;to the&#160;instruction&#160;to be executed&#160;after the&#160;trapping&#160;instruction.</p>
<p style="position:absolute;top:244px;left:69px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:244px;left:95px;white-space:nowrap" class="ft07"><b>Aborts&#160;</b>‚Äî&#160;An abort&#160;is an&#160;exception that does&#160;not&#160;always&#160;report the&#160;precise location&#160;of&#160;the instruction causing&#160;<br/>the&#160;exception and&#160;does&#160;not&#160;allow a restart of the&#160;program or task&#160;that&#160;caused&#160;the exception.&#160;Aborts&#160;are used&#160;<br/>to&#160;report severe&#160;errors, such as&#160;hardware&#160;errors&#160;and inconsistent or&#160;illegal values in&#160;system&#160;tables.</p>
<p style="position:absolute;top:312px;left:433px;white-space:nowrap" class="ft05">NOTE</p>
<p style="position:absolute;top:337px;left:122px;white-space:nowrap" class="ft07">One exception&#160;subset&#160;normally reported&#160;as&#160;a fault is not restartable. Such exceptions&#160;result in&#160;loss&#160;<br/>of some&#160;processor&#160;state. For&#160;example, executing a&#160;POPAD instruction where the&#160;stack frame&#160;<br/>crosses&#160;over&#160;the end of the stack segment causes&#160;a fault&#160;to&#160;be reported. In this&#160;situation,&#160;the&#160;<br/>exception&#160;handler sees that&#160;the instruction pointer (CS:EIP)&#160;has been restored&#160;as&#160;if the&#160;POPAD&#160;<br/>instruction had&#160;not been executed. However,&#160;internal processor state&#160;(the general-purpose&#160;<br/>registers) will have&#160;been modified.&#160;Such cases are&#160;considered&#160;programming errors.&#160;An application&#160;<br/>causing this&#160;class of exceptions&#160;should be terminated by the operating&#160;system.</p>
<p style="position:absolute;top:492px;left:69px;white-space:nowrap" class="ft06">6.6&#160;</p>
<p style="position:absolute;top:492px;left:148px;white-space:nowrap" class="ft06">PROGRAM&#160;OR&#160;TASK&#160;RESTART</p>
<p style="position:absolute;top:528px;left:69px;white-space:nowrap" class="ft07">To&#160;allow the restarting of program or task&#160;following&#160;the&#160;handling of an&#160;exception or&#160;an&#160;interrupt,&#160;all&#160;exceptions&#160;<br/>(except aborts) are guaranteed to report exceptions on an&#160;instruction boundary.&#160;All interrupts are guaranteed to be&#160;<br/>taken on&#160;an&#160;instruction&#160;boundary.<br/>For&#160;fault-class exceptions, the return&#160;instruction pointer (saved when&#160;the processor generates an&#160;exception)&#160;points&#160;<br/>to&#160;the&#160;faulting&#160;instruction.&#160;So,&#160;when&#160;a&#160;program&#160;or&#160;task&#160;is&#160;restarted following the&#160;handling&#160;of&#160;a&#160;fault,&#160;the faulting&#160;<br/>instruction is restarted&#160;(re-executed).&#160;Restarting&#160;the faulting&#160;instruction is&#160;commonly&#160;used to&#160;handle exceptions&#160;<br/>that&#160;are&#160;generated when&#160;access&#160;to&#160;an&#160;operand&#160;is blocked. The most&#160;common example of&#160;this&#160;type&#160;of&#160;fault&#160;is&#160;a&#160;page-<br/>fault&#160;exception (#PF)&#160;that&#160;occurs&#160;when&#160;a program or&#160;task references&#160;an&#160;operand located on&#160;a page that is not in&#160;<br/>memory. When a page-fault exception&#160;occurs, the exception handler can load the page into&#160;memory&#160;and resume&#160;<br/>execution of the program or task&#160;by&#160;restarting&#160;the faulting&#160;instruction. To&#160;insure&#160;that&#160;the restart&#160;is&#160;handled trans-<br/>parently to the currently&#160;executing program&#160;or&#160;task, the&#160;processor saves the necessary&#160;registers&#160;and stack pointers&#160;<br/>to&#160;allow a&#160;restart&#160;to&#160;the state&#160;prior&#160;to&#160;the&#160;execution of&#160;the&#160;faulting&#160;instruction.<br/>For trap-class exceptions, the return instruction pointer&#160;points to the instruction following the&#160;trapping instruction.&#160;<br/>If a&#160;trap&#160;is detected during&#160;an instruction which transfers execution, the&#160;return instruction pointer&#160;reflects&#160;the&#160;<br/>transfer. For example, if&#160;a trap is&#160;detected&#160;while&#160;executing&#160;a JMP&#160;instruction, the&#160;return instruction pointer&#160;points&#160;<br/>to the destination of&#160;the&#160;JMP instruction, not to the next&#160;address past the JMP instruction. All&#160;trap exceptions allow&#160;<br/>program&#160;or task restart with no loss&#160;of&#160;continuity. For example,&#160;the&#160;overflow exception&#160;is a&#160;trap&#160;exception.&#160;Here,&#160;<br/>the&#160;return&#160;instruction&#160;pointer points to&#160;the instruction following the&#160;INTO&#160;instruction that tested&#160;EFLAGS.OF&#160;(over-<br/>flow) flag.&#160;The trap&#160;handler for this&#160;exception resolves the&#160;overflow condition. Upon return&#160;from the trap handler,&#160;<br/>program&#160;or task execution continues at&#160;the&#160;instruction following the&#160;INTO&#160;instruction.<br/>The abort-class exceptions&#160;do not support reliable&#160;restarting&#160;of the&#160;program&#160;or task. Abort handlers&#160;are&#160;designed&#160;<br/>to collect&#160;diagnostic&#160;information about the&#160;state of the&#160;processor when the abort exception occurred&#160;and then shut&#160;<br/>down&#160;the&#160;application and&#160;system&#160;as gracefully&#160;as&#160;possible.<br/>Interrupts rigorously support restarting of interrupted&#160;programs and&#160;tasks&#160;without&#160;loss of continuity.&#160;The&#160;return&#160;<br/>instruction pointer saved for an interrupt points&#160;to&#160;the&#160;next&#160;instruction to be&#160;executed at the&#160;instruction boundary&#160;<br/>where the&#160;processor&#160;took&#160;the interrupt. If&#160;the instruction just&#160;executed has a&#160;repeat prefix, the&#160;interrupt&#160;is taken&#160;<br/>at&#160;the end of the&#160;current iteration with the&#160;registers set&#160;to execute the&#160;next iteration.&#160;<br/>The ability&#160;of a&#160;P6&#160;family processor to&#160;speculatively execute&#160;instructions&#160;does&#160;not affect the&#160;taking of interrupts by&#160;<br/>the processor.&#160;Interrupts are&#160;taken&#160;at instruction boundaries&#160;located during&#160;the retirement phase of instruction&#160;<br/>execution;&#160;so they&#160;are always taken in&#160;the ‚Äúin-order‚Äù&#160;instruction stream.&#160;S<a href="˛ˇ">ee&#160;Chapter 2,&#160;‚ÄúIntel¬Æ&#160;64&#160;and&#160;IA-32&#160;</a></p>
</div>
</body>
</html>
