<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1249</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1249-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1249.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;33-11</p>
<p style="position:absolute;top:47px;left:436px;white-space:nowrap" class="ft01">HANDLING&#160;BOUNDARY&#160;CONDITIONS&#160;IN A VIRTUAL MACHINE MONITOR</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft05">error,&#160;the&#160;VMM error&#160;handler&#160;may then&#160;decide to&#160;inject&#160;an&#160;MCE&#160;abort into&#160;the guest VM for attempted&#160;guest&#160;VM&#160;<br/>error recovery.&#160;This would&#160;enable&#160;the guest OS the&#160;opportunity&#160;to take&#160;recovery&#160;actions specific to&#160;that guest.&#160;<br/>For&#160;MCA virtualization, the VMM must&#160;provide the&#160;guest physical address&#160;for memory&#160;errors instead&#160;of&#160;the system&#160;<br/>physical&#160;address when reporting the&#160;errors to&#160;the guest&#160;VM.&#160;To&#160;compute&#160;the guest physical address, the&#160;VMM&#160;<br/>needs&#160;to maintain a&#160;reverse mapping&#160;of&#160;system&#160;physical&#160;page addresses to&#160;guest physical page&#160;addresses.&#160;<br/>When the&#160;MCE&#160;is injected&#160;into the&#160;guest&#160;VM, the&#160;guest&#160;OS&#160;MCA handler&#160;would be invoked.&#160;The guest OS imple-<br/>ments the&#160;MCA handling guidelines&#160;and it&#160;could potentially&#160;terminate&#160;the interrupted thread of execution within&#160;the&#160;<br/>guest instead of terminating&#160;the&#160;VM. The guest&#160;OS&#160;may&#160;also&#160;disable&#160;use of the&#160;affected&#160;page by the&#160;guest. When&#160;<br/>disabling the&#160;page the VMM error handler may handle the case where a page is shared&#160;by the VMM&#160;and&#160;a&#160;guest or&#160;<br/>by two guests.&#160;In these cases the&#160;page use&#160;must&#160;be&#160;disabled in both contexts to&#160;ensure no&#160;subsequent&#160;consump-<br/>tion errors&#160;are generated.</p>
<p style="position:absolute;top:325px;left:69px;white-space:nowrap" class="ft03">33.4.3.5 &#160;&#160;Implementation Considerations for the MCA Virtualization Model</p>
<p style="position:absolute;top:353px;left:69px;white-space:nowrap" class="ft05">MCA virtualization&#160;may&#160;be done in&#160;either hosted VMMs&#160;or hypervisor-based VMMs. &#160;The&#160;error handling&#160;flow&#160;is&#160;<br/>similar&#160;to the&#160;flow described in&#160;the basic handling&#160;case. The major&#160;difference&#160;is that&#160;the recovery action includes&#160;<br/>injecting the&#160;MCE&#160;abort into&#160;the guest VM to&#160;enable recovery by&#160;the guest OS&#160;when&#160;the MCA interrupts&#160;the execu-<br/>tion of a&#160;guest&#160;VM.</p>
<p style="position:absolute;top:458px;left:69px;white-space:nowrap" class="ft04">33.5&#160;</p>
<p style="position:absolute;top:458px;left:148px;white-space:nowrap" class="ft04">HANDLING ACTIVITY STATES BY&#160;VMM</p>
<p style="position:absolute;top:494px;left:69px;white-space:nowrap" class="ft05">A&#160;VMM&#160;might place&#160;a logic processor&#160;in the wait-for-SIPI activity&#160;state&#160;if supporting&#160;certain guest operating system&#160;<br/>using the&#160;multi-processor (MP) start-up&#160;algorithm. A guest&#160;with&#160;direct&#160;access&#160;to the physical local&#160;APIC and using&#160;<br/>the MP start-up&#160;algorithm sends an INIT-SIPI-SIPI IPI sequence to start the application processor.&#160;In&#160;order to trap&#160;<br/>the SIPIs, the&#160;VMM must start&#160;the&#160;logic processor which is&#160;the target of the SIPIs in&#160;wait-for-SIPI&#160;mode.</p>
</div>
</body>
</html>
