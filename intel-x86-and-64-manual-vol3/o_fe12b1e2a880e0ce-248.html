<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 248</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:14px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page248-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce248.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">7-10&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">TASK&#160;MANAGEMENT</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft03">An&#160;interrupt&#160;or exception vector points&#160;to a&#160;task-gate descriptor&#160;in the&#160;IDT.</p>
<p style="position:absolute;top:122px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:123px;left:93px;white-space:nowrap" class="ft03">The&#160;current task&#160;executes&#160;an IRET&#160;when the&#160;NT&#160;flag in&#160;the EFLAGS&#160;register is&#160;set.&#160;</p>
<p style="position:absolute;top:147px;left:68px;white-space:nowrap" class="ft08">JMP,&#160;CALL, and&#160;IRET instructions,&#160;as well&#160;as interrupts&#160;and exceptions, are&#160;all mechanisms for&#160;redirecting a&#160;<br/>program.&#160;The referencing of&#160;a TSS&#160;descriptor or a&#160;task gate&#160;(when&#160;calling&#160;or jumping&#160;to a task) or the state of the&#160;<br/>NT&#160;flag (when executing an IRET instruction)&#160;determines&#160;whether a&#160;task switch occurs.<br/>The processor performs&#160;the following&#160;operations when switching to&#160;a new task:<br/>1.&#160;Obtains&#160;the TSS segment selector&#160;for&#160;the new task as&#160;the&#160;operand of the&#160;JMP&#160;or CALL&#160;instruction, from a task&#160;</p>
<p style="position:absolute;top:244px;left:93px;white-space:nowrap" class="ft03">gate,&#160;or from the&#160;previous task link field (for a&#160;task switch initiated with&#160;an IRET&#160;instruction).</p>
<p style="position:absolute;top:268px;left:68px;white-space:nowrap" class="ft03">2.&#160;Checks that the current (old) task is allowed to switch&#160;to the&#160;new task. Data-access privilege rules apply to JMP&#160;</p>
<p style="position:absolute;top:285px;left:93px;white-space:nowrap" class="ft06">and CALL&#160;instructions. The CPL&#160;of&#160;the&#160;current (old) task and the&#160;RPL&#160;of the segment selector for the&#160;new&#160;task&#160;<br/>must be less than or&#160;equal&#160;to the&#160;DPL of the TSS descriptor&#160;or&#160;task gate&#160;being referenced. Exceptions,&#160;<br/>interrupts&#160;(except for interrupts&#160;generated by the&#160;INT&#160;<i>n</i>&#160;instruction), and the&#160;IRET instruction are permitted&#160;to&#160;<br/>switch tasks regardless of the&#160;DPL&#160;of&#160;the destination task-gate&#160;or TSS descriptor.&#160;For&#160;interrupts generated by&#160;<br/>the INT<i>&#160;n&#160;</i>instruction, the&#160;DPL&#160;is checked.</p>
<p style="position:absolute;top:375px;left:68px;white-space:nowrap" class="ft03">3.&#160;Checks that the TSS descriptor of&#160;the new task is&#160;marked present and&#160;has a&#160;valid limit&#160;(greater&#160;than or equal&#160;</p>
<p style="position:absolute;top:391px;left:93px;white-space:nowrap" class="ft03">to 67H).</p>
<p style="position:absolute;top:415px;left:68px;white-space:nowrap" class="ft07">4.&#160;Checks that the&#160;new task is&#160;available&#160;(call,&#160;jump, exception, or&#160;interrupt) or&#160;busy (IRET&#160;return).<br/>5.&#160;Checks that&#160;the&#160;current (old) TSS,&#160;new&#160;TSS,&#160;and&#160;all&#160;segment descriptors&#160;used in&#160;the&#160;task&#160;switch are paged into&#160;</p>
<p style="position:absolute;top:456px;left:93px;white-space:nowrap" class="ft03">system memory.</p>
<p style="position:absolute;top:480px;left:68px;white-space:nowrap" class="ft03">6.&#160;If the&#160;task switch was&#160;initiated&#160;with&#160;a JMP or&#160;IRET instruction,&#160;the processor clears the&#160;busy (B) flag in the&#160;</p>
<p style="position:absolute;top:496px;left:93px;white-space:nowrap" class="ft06">current (old) task’s&#160;TSS&#160;descriptor;&#160;if initiated with&#160;a CALL instruction, an exception, or an interrupt: the&#160;busy&#160;<br/>(B) flag&#160;is&#160;left set.&#160;(S<a href="o_fe12b1e2a880e0ce-251.html">ee&#160;Table&#160;7-2.</a>)</p>
<p style="position:absolute;top:537px;left:68px;white-space:nowrap" class="ft03">7.&#160;If the&#160;task switch was initiated with&#160;an IRET instruction,&#160;the&#160;processor&#160;clears&#160;the NT&#160;flag in a&#160;temporarily&#160;saved&#160;</p>
<p style="position:absolute;top:553px;left:93px;white-space:nowrap" class="ft06">image&#160;of the&#160;EFLAGS register; if&#160;initiated&#160;with&#160;a&#160;CALL&#160;or&#160;JMP&#160;instruction,&#160;an&#160;exception,&#160;or&#160;an&#160;interrupt,&#160;the&#160;NT&#160;<br/>flag is&#160;left unchanged in the&#160;saved EFLAGS&#160;image.</p>
<p style="position:absolute;top:594px;left:68px;white-space:nowrap" class="ft03">8.&#160;Saves the state of the current (old) task&#160;in the current&#160;task’s&#160;TSS.&#160;The processor finds the&#160;base address of&#160;the&#160;</p>
<p style="position:absolute;top:610px;left:93px;white-space:nowrap" class="ft06">current TSS in&#160;the&#160;task register and then copies the&#160;states&#160;of&#160;the&#160;following&#160;registers into the&#160;current TSS: all the&#160;<br/>general-purpose registers, segment selectors from the&#160;segment registers, the temporarily saved image of the&#160;<br/>EFLAGS register, and&#160;the instruction pointer register&#160;(EIP).</p>
<p style="position:absolute;top:667px;left:68px;white-space:nowrap" class="ft03">9.&#160;If the task switch was initiated with a CALL instruction,&#160;an exception, or an interrupt, the processor will set the&#160;</p>
<p style="position:absolute;top:684px;left:93px;white-space:nowrap" class="ft06">NT&#160;flag&#160;in the&#160;EFLAGS loaded from the&#160;new&#160;task. If initiated with&#160;an IRET&#160;instruction or JMP instruction,&#160;the NT&#160;<br/>flag&#160;will&#160;reflect&#160;the state&#160;of NT in the&#160;EFLAGS loaded&#160;from the&#160;new&#160;ta<a href="o_fe12b1e2a880e0ce-251.html">sk (see Table 7-2).</a></p>
<p style="position:absolute;top:724px;left:68px;white-space:nowrap" class="ft03">10.&#160;If the&#160;task switch was&#160;initiated&#160;with&#160;a CALL&#160;instruction, JMP instruction,&#160;an exception, or an&#160;interrupt,&#160;the&#160;</p>
<p style="position:absolute;top:741px;left:93px;white-space:nowrap" class="ft06">processor sets the&#160;busy (B) flag in&#160;the&#160;new task’s&#160;TSS descriptor; if initiated with an IRET instruction, the&#160;busy&#160;<br/>(B) flag is&#160;left set.</p>
<p style="position:absolute;top:781px;left:68px;white-space:nowrap" class="ft08">11.&#160;Loads the task register&#160;with the segment selector and&#160;descriptor for the&#160;new&#160;task's TSS.<br/>12.&#160;The&#160;TSS state is loaded&#160;into&#160;the&#160;processor.&#160;This includes&#160;the LDTR register, the PDBR (control register CR3), the&#160;</p>
<p style="position:absolute;top:822px;left:93px;white-space:nowrap" class="ft06">EFLAGS&#160;register,&#160;the EIP register, the general-purpose registers, and the segment selectors. A&#160;fault during the&#160;<br/>load of this&#160;state may corrupt&#160;architectural&#160;state. (If paging&#160;is not enabled,&#160;a PDBR value&#160;is read from the&#160;new&#160;<br/>task's TSS,&#160;but it&#160;is not loaded&#160;into&#160;CR3.)</p>
<p style="position:absolute;top:879px;left:68px;white-space:nowrap" class="ft03">13.&#160;The&#160;descriptors associated&#160;with the&#160;segment selectors are&#160;loaded&#160;and qualified.&#160;Any errors associated with this&#160;</p>
<p style="position:absolute;top:895px;left:93px;white-space:nowrap" class="ft03">loading and&#160;qualification occur in&#160;the context&#160;of&#160;the&#160;new task&#160;and may&#160;corrupt architectural state.</p>
<p style="position:absolute;top:930px;left:428px;white-space:nowrap" class="ft05">NOTES</p>
<p style="position:absolute;top:955px;left:120px;white-space:nowrap" class="ft06">If all checks and saves&#160;have&#160;been&#160;carried out successfully,&#160;the processor commits to&#160;the task&#160;<br/>switch. If an&#160;unrecoverable error&#160;occurs in&#160;steps&#160;1 through 11,&#160;the processor does not complete&#160;the&#160;<br/>task switch and insures that&#160;the processor is&#160;returned&#160;to its&#160;state&#160;prior to&#160;the execution&#160;of the&#160;<br/>instruction that&#160;initiated&#160;the&#160;task switch.</p>
<p style="position:absolute;top:1038px;left:120px;white-space:nowrap" class="ft06">If&#160;an unrecoverable error&#160;occurs&#160;in step 12,&#160;architectural state&#160;may&#160;be&#160;corrupted,&#160;but an attempt&#160;<br/>will be made&#160;to&#160;handle the&#160;error&#160;in&#160;the prior execution environment. If an&#160;unrecoverable error&#160;</p>
</div>
</body>
</html>
