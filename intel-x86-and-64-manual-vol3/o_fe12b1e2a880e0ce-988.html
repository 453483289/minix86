<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 988</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:14px;font-family:Times;color:#0860a8;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page988-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce988.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">20-12&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">8086&#160;EMULATION</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft07"><a href="o_fe12b1e2a880e0ce-71.html">Register”). This&#160;</a>field&#160;also controls the&#160;enabling of the&#160;VIF and VIP flags&#160;in the&#160;EFLAGS&#160;register&#160;when&#160;the VME&#160;<br/>flag is set. The VIF&#160;and&#160;VIP flags are provided to&#160;assist&#160;in the handling of class 2 maskable hardware interrupts.</p>
<p style="position:absolute;top:139px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:139px;left:93px;white-space:nowrap" class="ft07"><b>VME flag (bit&#160;0 in control register CR4)</b>&#160;—&#160;Enables&#160;the virtual mode&#160;extension for the processor&#160;when&#160;set&#160;<br/>(see<a href="o_fe12b1e2a880e0ce-75.html">&#160;Section 2.5, “Control&#160;Registers”).</a></p>
<p style="position:absolute;top:178px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:178px;left:93px;white-space:nowrap" class="ft07"><b>Software&#160;interrupt redirection bit map&#160;(32&#160;bytes in&#160;the TSS,&#160;se<a href="o_fe12b1e2a880e0ce-994.html">e Figure&#160;20-5)&#160;</a></b>— Contains 256 flags&#160;<br/>that&#160;indicates&#160;how class 3&#160;software&#160;interrupts&#160;should be handled&#160;when they&#160;occur in virtual-8086 mode.&#160;A&#160;<br/>software interrupt can&#160;be&#160;directed either to&#160;the interrupt and&#160;exception handlers in&#160;the currently running&#160;8086&#160;<br/>program or&#160;to the&#160;protected-mode interrupt and&#160;exception handlers.</p>
<p style="position:absolute;top:250px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:250px;left:93px;white-space:nowrap" class="ft07"><b>The&#160;virtual interrupt flag&#160;(VIF) and&#160;virtual interrupt pending&#160;flag&#160;(VIP)&#160;in&#160;the EFLAGS&#160;register&#160;</b>—&#160;<br/>Provides&#160;<b>virtual interrupt&#160;support</b>&#160;for the&#160;handling of class 2&#160;maskable hardware interrupts (see<a href="o_fe12b1e2a880e0ce-991.html">&#160;Section&#160;<br/>20.3.2, “Class 2—Maskable Hardware&#160;Interrupt&#160;Handling in Virtual-8086 Mode&#160;Using the&#160;Virtual Interrupt&#160;<br/>Mechanism”).</a>&#160;</p>
<p style="position:absolute;top:334px;left:432px;white-space:nowrap" class="ft05">NOTE</p>
<p style="position:absolute;top:360px;left:120px;white-space:nowrap" class="ft07">The VME flag,&#160;software interrupt redirection&#160;bit&#160;map,&#160;and&#160;VIF and VIP flags are only available in IA-<br/>32 processors that&#160;support the virtual mode&#160;extensions. These extensions&#160;were introduced in&#160;the&#160;<br/>IA-32&#160;architecture&#160;with&#160;the Pentium processor.</p>
<p style="position:absolute;top:417px;left:68px;white-space:nowrap" class="ft07">The following sections&#160;describe&#160;the&#160;actions that processor&#160;takes and the possible actions&#160;of interrupt and exception&#160;<br/>handlers&#160;for&#160;the two classes of interrupts described in the&#160;previous&#160;paragraphs. These&#160;sections&#160;describe&#160;three&#160;<br/>possible types of interrupt and&#160;exception handlers:</p>
<p style="position:absolute;top:472px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:472px;left:93px;white-space:nowrap" class="ft07"><b>Protected-mode&#160;interrupt and exceptions&#160;handlers</b>&#160;— These are&#160;the&#160;standard handlers that the processor&#160;<br/>calls through&#160;the protected-mode&#160;IDT.</p>
<p style="position:absolute;top:511px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:511px;left:93px;white-space:nowrap" class="ft07"><b>Virtual-8086&#160;monitor&#160;interrupt and exception handlers&#160;</b>— These&#160;handlers are&#160;resident in the&#160;virtual-8086&#160;<br/>monitor,&#160;and they are commonly accessed&#160;through a&#160;general-protection exception&#160;(#GP,&#160;interrupt&#160;13)&#160;that&#160;is&#160;<br/>directed to&#160;the protected-mode general-protection exception&#160;handler.</p>
<p style="position:absolute;top:566px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:567px;left:93px;white-space:nowrap" class="ft07"><b>8086&#160;program&#160;interrupt&#160;and exception handlers</b>&#160;—&#160;These&#160;handlers are part&#160;of the&#160;8086 program that&#160;is&#160;<br/>running&#160;in virtual-8086 mode.</p>
<p style="position:absolute;top:607px;left:68px;white-space:nowrap" class="ft07">The following sections describe how&#160;these&#160;handlers&#160;are&#160;used, depending on&#160;the selected class and method of inter-<br/>rupt and exception handling.</p>
<p style="position:absolute;top:674px;left:68px;white-space:nowrap" class="ft06">20.3.1&#160;</p>
<p style="position:absolute;top:674px;left:148px;white-space:nowrap" class="ft06">Class 1—Hardware&#160;Interrupt&#160;and&#160;Exception Handling in Virtual-8086 Mode</p>
<p style="position:absolute;top:705px;left:68px;white-space:nowrap" class="ft07">In virtual-8086 mode,&#160;the&#160;Pentium,&#160;P6&#160;family, Pentium&#160;4,&#160;and&#160;Intel Xeon processors handle hardware&#160;interrupts&#160;<br/>and exceptions in the&#160;same manner as they are&#160;handled&#160;by&#160;the&#160;Intel486&#160;and Intel386&#160;processors.&#160;They invoke&#160;the&#160;<br/>protected-mode interrupt&#160;or exception&#160;handler that&#160;the interrupt&#160;or&#160;exception vector points&#160;to in&#160;the IDT.&#160;Here, the&#160;<br/>IDT entry&#160;must contain&#160;either&#160;a 32-bit trap or interrupt gate&#160;or a task&#160;gate. The&#160;following&#160;sections&#160;describe various&#160;<br/>ways that&#160;a virtual-8086 mode interrupt&#160;or exception&#160;can be&#160;handled&#160;after the&#160;protected-mode&#160;handler has&#160;been&#160;<br/>invoked.<br/>Se<a href="o_fe12b1e2a880e0ce-991.html">e Section 20.3.2,&#160;“Class 2—Maskable Hardware Interrupt&#160;Handling in Virtual-8086 Mode&#160;Using the Virtual Inter-<br/>rupt Mechanism”, for a&#160;</a>description&#160;of&#160;the virtual interrupt mechanism that is&#160;available for handling maskable&#160;hard-<br/>ware interrupts while in virtual-8086 mode.&#160;When this mechanism is&#160;either not available&#160;or not enabled, maskable&#160;<br/>hardware&#160;interrupts are handled in&#160;the same&#160;manner&#160;as&#160;exceptions, as&#160;described in the&#160;following&#160;sections.</p>
<p style="position:absolute;top:905px;left:68px;white-space:nowrap" class="ft05">20.3.1.1 &#160;&#160;Handling an&#160;Interrupt or Exception&#160;Through a Protected-Mode Trap or Interrupt Gate</p>
<p style="position:absolute;top:934px;left:68px;white-space:nowrap" class="ft09">When an&#160;interrupt or&#160;exception vector points&#160;to a&#160;32-bit trap or interrupt gate in&#160;the IDT,&#160;the&#160;gate&#160;must&#160;in turn&#160;<br/>point to a nonconforming,&#160;privilege-level&#160;0,&#160;code segment.&#160;When&#160;accessing this code segment, processor performs&#160;<br/>the following&#160;steps.<br/>1.&#160;Switches&#160;to 32-bit&#160;protected&#160;mode&#160;and&#160;privilege&#160;level&#160;0.<br/>2.&#160;Saves&#160;the&#160;state&#160;of&#160;the processor on the&#160;privilege-level 0&#160;stack.&#160;The states of the&#160;EIP,&#160;CS,&#160;EFLAGS,&#160;ESP,&#160;SS,&#160;ES,&#160;</p>
<p style="position:absolute;top:1031px;left:93px;white-space:nowrap" class="ft02">DS, FS, and&#160;GS&#160;registers are&#160;sa<a href="o_fe12b1e2a880e0ce-989.html">ved (see Figure&#160;20-4).</a></p>
</div>
</body>
</html>
