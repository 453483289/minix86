<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 997</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:21px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page997-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce997.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:768px;white-space:nowrap" class="ft00">Vol. 3B&#160;21-1</p>
<p style="position:absolute;top:96px;left:699px;white-space:nowrap" class="ft01">CHAPTER 21</p>
<p style="position:absolute;top:120px;left:483px;white-space:nowrap" class="ft01">MIXING 16-BIT AND 32-BIT CODE</p>
<p style="position:absolute;top:190px;left:68px;white-space:nowrap" class="ft06">Program&#160;modules&#160;written&#160;to run on&#160;IA-32 processors can&#160;be&#160;either&#160;16-bit modules or 32-bit&#160;modules.&#160;<a href="o_fe12b1e2a880e0ce-997.html">Table&#160;21-1</a>&#160;<br/>shows the&#160;characteristic&#160;of&#160;16-bit and 32-bit modules.</p>
<p style="position:absolute;top:445px;left:68px;white-space:nowrap" class="ft06">The&#160;IA-32&#160;processors function&#160;most&#160;efficiently when&#160;executing 32-bit program modules.&#160;They can, however,&#160;also&#160;<br/>execute&#160;16-bit program modules, in&#160;any of the&#160;following&#160;ways:</p>
<p style="position:absolute;top:484px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:484px;left:93px;white-space:nowrap" class="ft02">In real-address mode.</p>
<p style="position:absolute;top:506px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:507px;left:93px;white-space:nowrap" class="ft02">In virtual-8086&#160;mode.</p>
<p style="position:absolute;top:529px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:529px;left:93px;white-space:nowrap" class="ft02">System management&#160;mode (SMM).</p>
<p style="position:absolute;top:551px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:552px;left:93px;white-space:nowrap" class="ft06">As a protected-mode task, when&#160;the code, data, and stack&#160;segments for the task are all configured&#160;as a 16-bit&#160;<br/>segments.</p>
<p style="position:absolute;top:590px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:591px;left:93px;white-space:nowrap" class="ft02">By&#160;integrating 16-bit and 32-bit segments into&#160;a single&#160;protected-mode&#160;task.</p>
<p style="position:absolute;top:613px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:613px;left:93px;white-space:nowrap" class="ft02">By&#160;integrating&#160;16-bit operations into&#160;32-bit code&#160;segments.</p>
<p style="position:absolute;top:637px;left:68px;white-space:nowrap" class="ft06">Real-address&#160;mode,&#160;virtual-8086 mode, and&#160;SMM are native&#160;16-bit modes.&#160;A&#160;legacy program assembled&#160;and/or&#160;<br/>compiled to&#160;run&#160;on an Intel 8086&#160;or Intel&#160;286&#160;processor&#160;should run in&#160;real-address mode&#160;or virtual-8086 mode&#160;<br/>without modification. Sixteen-bit&#160;program&#160;modules can&#160;also be written to&#160;run&#160;in real-address mode for handling&#160;<br/>system initialization or&#160;to&#160;run&#160;in SMM&#160;for&#160;handling system&#160;management functions.&#160;Se<a href="o_fe12b1e2a880e0ce-977.html">e Chapter 20,&#160;“8086 Emula-<br/>tion,”</a>&#160;for detailed&#160;information&#160;on real-address mode&#160;and virtual-8086 mode<a href="o_fe12b1e2a880e0ce-1251.html">; see Chapter&#160;34, “System Manage-<br/>ment&#160;Mode,”&#160;for in</a>formation&#160;on&#160;SMM.<br/>This chapter describes how&#160;to integrate&#160;16-bit program&#160;modules with 32-bit&#160;program&#160;modules when operating&#160;in&#160;<br/>protected mode and&#160;how&#160;to&#160;mix&#160;16-bit and&#160;32-bit code within 32-bit code segments.</p>
<p style="position:absolute;top:816px;left:68px;white-space:nowrap" class="ft04">21.1&#160;</p>
<p style="position:absolute;top:816px;left:147px;white-space:nowrap" class="ft04">DEFINING&#160;16-BIT AND 32-BIT&#160;PROGRAM MODULES</p>
<p style="position:absolute;top:852px;left:68px;white-space:nowrap" class="ft06">The&#160;following&#160;IA-32 architecture mechanisms are&#160;used&#160;to&#160;distinguish&#160;between&#160;and&#160;support 16-bit and&#160;32-bit&#160;<br/>segments and&#160;operations:</p>
<p style="position:absolute;top:890px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:891px;left:93px;white-space:nowrap" class="ft02">The D (default operand&#160;and address&#160;size) flag&#160;in code-segment&#160;descriptors.</p>
<p style="position:absolute;top:913px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:913px;left:93px;white-space:nowrap" class="ft02">The B&#160;(default stack&#160;size) flag&#160;in stack-segment&#160;descriptors.</p>
<p style="position:absolute;top:935px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:936px;left:93px;white-space:nowrap" class="ft02">16-bit and&#160;32-bit call&#160;gates, interrupt gates,&#160;and trap gates.</p>
<p style="position:absolute;top:958px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:958px;left:93px;white-space:nowrap" class="ft02">Operand-size&#160;and&#160;address-size instruction prefixes.</p>
<p style="position:absolute;top:980px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:981px;left:93px;white-space:nowrap" class="ft02">16-bit and&#160;32-bit general-purpose&#160;registers.</p>
<p style="position:absolute;top:1005px;left:68px;white-space:nowrap" class="ft06">The&#160;D flag&#160;in a&#160;code-segment&#160;descriptor determines&#160;the&#160;default&#160;operand-size&#160;and address-size&#160;for the&#160;instructions&#160;<br/>of&#160;a code segment.&#160;(In real-address&#160;mode and&#160;virtual-8086&#160;mode,&#160;which&#160;do not use segment descriptors, the&#160;<br/>default is 16&#160;bits.) A code segment with its&#160;D flag set is a&#160;32-bit segment; a code segment&#160;with its D flag clear is a&#160;<br/>16-bit&#160;segment.</p>
<p style="position:absolute;top:237px;left:232px;white-space:nowrap" class="ft05">Table 21-1.&#160;&#160;Characteristics&#160;of&#160;16-Bit and 32-Bit Program&#160;Modules</p>
<p style="position:absolute;top:262px;left:163px;white-space:nowrap" class="ft02">Characteristic</p>
<p style="position:absolute;top:262px;left:391px;white-space:nowrap" class="ft02">16-Bit&#160;Program&#160;Modules</p>
<p style="position:absolute;top:262px;left:639px;white-space:nowrap" class="ft02">32-Bit Program&#160;Modules</p>
<p style="position:absolute;top:286px;left:76px;white-space:nowrap" class="ft02">Segment Size</p>
<p style="position:absolute;top:286px;left:344px;white-space:nowrap" class="ft02">0 to&#160;64&#160;KBytes</p>
<p style="position:absolute;top:286px;left:596px;white-space:nowrap" class="ft02">0&#160;to&#160;4 GBytes</p>
<p style="position:absolute;top:310px;left:76px;white-space:nowrap" class="ft02">Operand Sizes</p>
<p style="position:absolute;top:310px;left:344px;white-space:nowrap" class="ft02">8&#160;bits&#160;and 16&#160;bits</p>
<p style="position:absolute;top:310px;left:596px;white-space:nowrap" class="ft02">8&#160;bits&#160;and 32&#160;bits</p>
<p style="position:absolute;top:334px;left:76px;white-space:nowrap" class="ft02">Pointer Offset&#160;Size&#160;(Address Size)</p>
<p style="position:absolute;top:334px;left:344px;white-space:nowrap" class="ft02">16 bits</p>
<p style="position:absolute;top:334px;left:596px;white-space:nowrap" class="ft02">32 bits</p>
<p style="position:absolute;top:358px;left:76px;white-space:nowrap" class="ft02">Stack&#160;Pointer Size</p>
<p style="position:absolute;top:358px;left:344px;white-space:nowrap" class="ft02">16 Bits</p>
<p style="position:absolute;top:358px;left:596px;white-space:nowrap" class="ft02">32 Bits</p>
<p style="position:absolute;top:382px;left:76px;white-space:nowrap" class="ft02">Control Transfers&#160;Allowed to&#160;Code&#160;Segments&#160;</p>
<p style="position:absolute;top:399px;left:76px;white-space:nowrap" class="ft02">of&#160;This&#160;Size</p>
<p style="position:absolute;top:382px;left:344px;white-space:nowrap" class="ft02">16&#160;Bits</p>
<p style="position:absolute;top:382px;left:596px;white-space:nowrap" class="ft02">32&#160;Bits</p>
</div>
</body>
</html>
