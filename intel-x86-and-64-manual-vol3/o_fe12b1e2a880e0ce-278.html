<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 278</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:12px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:20px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:21px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page278-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce278.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">8-22&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">MULTIPLE-PROCESSOR&#160;MANAGEMENT</p>
<p style="position:absolute;top:523px;left:68px;white-space:nowrap" class="ft05">16.&#160;Reads&#160;and evaluates the&#160;COUNT&#160;variable and establishes a&#160;processor&#160;count.<br/>17.&#160;If necessary,&#160;reconfigures the&#160;APIC&#160;and&#160;continues with the&#160;remaining system&#160;diagnostics&#160;as appropriate.</p>
<p style="position:absolute;top:592px;left:68px;white-space:nowrap" class="ft03">8.4.4.2&#160;&#160;</p>
<p style="position:absolute;top:592px;left:152px;white-space:nowrap" class="ft03">Typical AP&#160;Initialization Sequence</p>
<p style="position:absolute;top:620px;left:68px;white-space:nowrap" class="ft05">When an AP receives&#160;the&#160;SIPI, it begins executing BIOS AP initialization code at the vector&#160;encoded in the SIPI. The&#160;<br/>AP initialization code&#160;typically&#160;performs&#160;the following operations:<br/>1.&#160;Waits&#160;on&#160;the BIOS initialization Lock&#160;Semaphore. When&#160;control&#160;of&#160;the semaphore is&#160;attained, initialization&#160;</p>
<p style="position:absolute;top:677px;left:93px;white-space:nowrap" class="ft02">continues.</p>
<p style="position:absolute;top:701px;left:68px;white-space:nowrap" class="ft05">2.&#160;Loads the microcode&#160;update into the&#160;processor.<br/>3.&#160;Initializes&#160;the MTRRs&#160;(using&#160;the&#160;same mapping that&#160;was used&#160;for the&#160;BSP).<br/>4.&#160;Enables the&#160;cache.<br/>5.&#160;Executes the&#160;CPUID instruction with a&#160;value&#160;of 0H in&#160;the EAX register, then&#160;reads the&#160;EBX,&#160;ECX,&#160;and&#160;EDX&#160;</p>
<p style="position:absolute;top:790px;left:93px;white-space:nowrap" class="ft02">registers&#160;to determine if the AP is&#160;“GenuineIntel.”</p>
<p style="position:absolute;top:814px;left:68px;white-space:nowrap" class="ft02">6.&#160;Executes the&#160;CPUID instruction with a&#160;value&#160;of 1H in&#160;the EAX register, then&#160;saves the values in&#160;the EAX,&#160;ECX,&#160;</p>
<p style="position:absolute;top:830px;left:93px;white-space:nowrap" class="ft02">and EDX&#160;registers in&#160;a system&#160;configuration&#160;space&#160;in RAM for&#160;use later.</p>
<p style="position:absolute;top:854px;left:68px;white-space:nowrap" class="ft02">7.&#160;Switches to&#160;protected mode&#160;and&#160;ensures that&#160;the APIC&#160;address space is&#160;mapped to&#160;the strong&#160;uncacheable&#160;</p>
<p style="position:absolute;top:871px;left:93px;white-space:nowrap" class="ft02">(UC)&#160;memory&#160;type.</p>
<p style="position:absolute;top:895px;left:68px;white-space:nowrap" class="ft02">8.&#160;Determines&#160;the AP’s&#160;APIC&#160;ID&#160;from the local APIC ID&#160;register,&#160;and&#160;adds&#160;it to&#160;the MP&#160;and&#160;ACPI&#160;tables&#160;and&#160;</p>
<p style="position:absolute;top:911px;left:93px;white-space:nowrap" class="ft02">optionally to&#160;the system&#160;configuration space&#160;in&#160;RAM.</p>
<p style="position:absolute;top:935px;left:68px;white-space:nowrap" class="ft02">9.&#160;Initializes&#160;and configures the local&#160;APIC by setting&#160;bit&#160;8&#160;in&#160;the SVR register and setting up&#160;the LVT3 (error&#160;LVT)&#160;</p>
<p style="position:absolute;top:952px;left:93px;white-space:nowrap" class="ft02">for error&#160;handling (as described in steps&#160;9 and&#160;10&#160;<a href="o_fe12b1e2a880e0ce-276.html">in Section&#160;8.4.4.1, “Typical BSP Initialization&#160;Sequence”).</a></p>
<p style="position:absolute;top:976px;left:68px;white-space:nowrap" class="ft05">10.&#160;Configures&#160;the&#160;APs SMI execution environment.&#160;(Each AP&#160;and the&#160;BSP must&#160;have&#160;a different SMBASE&#160;address.)<br/>11.&#160;Increments&#160;the COUNT&#160;variable&#160;by 1.<br/>12.&#160;Releases&#160;the&#160;semaphore.<br/>13.&#160;Executes&#160;one&#160;of the&#160;following:</p>
<p style="position:absolute;top:122px;left:221px;white-space:nowrap" class="ft04">Table&#160;8-1. &#160;Broadcast&#160;INIT-SIPI-SIPI&#160;Sequence&#160;and Choice&#160;of&#160;Timeouts&#160;</p>
<p style="position:absolute;top:144px;left:75px;white-space:nowrap" class="ft02">INIT-SIPI-SIPI when the expected processor&#160;count&#160;is&#160;unknown</p>
<p style="position:absolute;top:144px;left:466px;white-space:nowrap" class="ft02">INIT-SIPI-SIPI when the expected processor&#160;count&#160;is&#160;known</p>
<p style="position:absolute;top:166px;left:73px;white-space:nowrap" class="ft09">MOV ESI, ICR_LOW;&#160;Load&#160;address&#160;of&#160;ICR low&#160;dword into&#160;ESI.<br/>MOV EAX, 000C4500H; Load&#160;ICR encoding for broadcast INIT IPI&#160;<br/>; to&#160;all APs into&#160;EAX.<br/>MOV [ESI], EAX; Broadcast INIT IPI to&#160;all&#160;APs<br/>; 10-millisecond delay loop.<br/>MOV EAX,&#160;000C46XXH;&#160;Load ICR encoding for broadcast SIPI IP<br/>; to&#160;all APs into&#160;EAX,&#160;where xx&#160;is&#160;the vector computed in step 10.<br/>MOV [ESI], EAX; Broadcast SIPI IPI to&#160;all APs<br/>; 200-microsecond delay loop<br/>MOV [ESI], EAX; Broadcast second SIPI IPI to&#160;all APs<br/>;Waits for the timer&#160;interrupt until the timer expires</p>
<p style="position:absolute;top:166px;left:457px;white-space:nowrap" class="ft08">MOV ESI, ICR_LOW; Load address of&#160;ICR low dword&#160;into&#160;ESI.<br/>MOV EAX, 000C4500H; Load&#160;ICR encoding for broadcast INIT IPI&#160;<br/>; to&#160;all APs&#160;into&#160;EAX.<br/>MOV [ESI], EAX; Broadcast INIT IPI to&#160;all APs<br/>; 10-millisecond delay loop.<br/>MOV EAX, 000C46XXH; Load ICR encoding for broadcast SIPI IP<br/>; to&#160;all APs into&#160;EAX,&#160;where xx is the vector&#160;computed&#160;in&#160;step&#160;10.<br/>MOV [ESI], EAX; Broadcast SIPI IPI to&#160;all APs<br/>; 200 microsecond delay loop with check to&#160;see if COUNT has<br/>; reached the&#160;expected&#160;processor&#160;count. If&#160;COUNT&#160;reaches<br/>; expected&#160;processor&#160;count,&#160;cancel timer and&#160;go to&#160;step&#160;16.<br/>MOV [ESI], EAX; Broadcast second SIPI&#160;IPI to&#160;all APs<br/>; Wait&#160;for the timer interrupt&#160;polling COUNT.&#160;If COUNT reaches<br/>; expected&#160;processor&#160;count,&#160;cancel timer and&#160;go to&#160;step&#160;16.<br/>; If timer expires, go to&#160;step 16.</p>
</div>
</body>
</html>
