<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1931</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:19px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1931-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1931.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:760px;white-space:nowrap" class="ft00">Vol. 3D&#160;42-13</p>
<p style="position:absolute;top:47px;left:438px;white-space:nowrap" class="ft01">INTEL® SGX INTERACTIONS WITH IA32&#160;AND INTEL® 64&#160;ARCHITECTURE</p>
<p style="position:absolute;top:97px;left:69px;white-space:nowrap" class="ft02">42.16&#160;&#160;INTEL® SGX INTERACTIONS WITH PROTECTED&#160;MODE VIRTUAL&#160;</p>
<p style="position:absolute;top:123px;left:147px;white-space:nowrap" class="ft02">INTERRUPTS</p>
<p style="position:absolute;top:157px;left:69px;white-space:nowrap" class="ft06">ENCLS[EENTER] modifies&#160;neither&#160;EFLAGS.VIP nor EFLAGS.VIF.<br/>ENCLS[ERESUME] loads EFLAGS&#160;in&#160;a&#160;manner&#160;similar&#160;to&#160;that&#160;of&#160;an&#160;execution of IRET&#160;with CPL&#160;= 3.&#160;This&#160;means that&#160;<br/>ERESUME modifies&#160;neither&#160;EFLAGS.VIP nor&#160;EFLAGS.VIF&#160;regardless of&#160;the value of&#160;the EFLAGS&#160;image&#160;in the&#160;SSA&#160;<br/>frame.&#160;<br/>AEX saves EFLAGS.VIP and EFLAGS.VIF unmodified into the&#160;EFLAGS&#160;image in the SSA&#160;frame.&#160;AEX modifies neither&#160;<br/>EFLAGS.VIP&#160;nor&#160;EFLAGS.VIF after&#160;saving&#160;EFLAGS.&#160;<br/>If CR4.PVI&#160;=&#160;1,&#160;CPL&#160;= 3,&#160;EFLAGS.VM&#160;= 0,&#160;IOPL&#160;&lt;&#160;3,&#160;EFLAGS.VIP&#160;=&#160;1,&#160;and&#160;EFLAGS.VIF&#160;= 0,&#160;execution&#160;of STI causes&#160;<br/>a #GP&#160;fault. In&#160;this&#160;case, STI&#160;modifies neither&#160;EFLAGS.IF&#160;nor EFLAGS.VIF. This&#160;behavior applies&#160;without change&#160;<br/>within an enclave (where&#160;CPL&#160;is always 3). Note that,&#160;if&#160;IOPL&#160;=&#160;3, STI always&#160;sets EFLAGS.IF without&#160;fault;&#160;<br/>CR4.PVI, EFLAGS.VIP, and EFLAGS.VIF are&#160;neither consulted nor modified in&#160;this&#160;case.&#160;</p>
<p style="position:absolute;top:379px;left:69px;white-space:nowrap" class="ft02">42.17&#160;&#160;INTEL SGX INTERACTION WITH PROTECTION KEYS</p>
<p style="position:absolute;top:415px;left:69px;white-space:nowrap" class="ft03">SGX&#160;interactions with&#160;PKRU are&#160;as&#160;follows:</p>
<p style="position:absolute;top:436px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:436px;left:95px;white-space:nowrap" class="ft06">CPUID.(EAX=12H, ECX=1):ECX.PKRU indicates whether&#160;SECS.ATTRIBUTES.XFRM.PKRU&#160;can be set.&#160;If&#160;<br/>SECS.ATTRIBUTES.XFRM.PKRU is&#160;set, then&#160;PKRU is saved&#160;and cleared as&#160;part&#160;of AEX&#160;and is restored&#160;as part of&#160;<br/>ERESUME. If&#160;CR4.PKE is&#160;set,&#160;an enclave can&#160;execute RDPKRU and&#160;WRKRU independent&#160;of whether&#160;<br/>SECS.ATTRIBUTES.XFRM.PKRU is&#160;set.</p>
<p style="position:absolute;top:510px;left:69px;white-space:nowrap" class="ft03">SGX interactions&#160;with domain&#160;permission checks are as follows:</p>
<p style="position:absolute;top:541px;left:150px;white-space:nowrap" class="ft03">1)&#160;If&#160;CR4.PKE&#160;is not set,&#160;then legacy and SGX permission checks&#160;are&#160;not effected.</p>
<p style="position:absolute;top:573px;left:150px;white-space:nowrap" class="ft03">2)&#160;If CR4.PKE is&#160;set,&#160;then domain&#160;permission&#160;checks are applied to&#160;all&#160;non-enclave access and&#160;</p>
<p style="position:absolute;top:592px;left:177px;white-space:nowrap" class="ft07">enclave accesses&#160;to user pages in&#160;addition&#160;to legacy and SGX permission checks at&#160;a higher&#160;<br/>priority than SGX permission checks.</p>
<p style="position:absolute;top:643px;left:150px;white-space:nowrap" class="ft03">3)&#160;Implicit accesses&#160;aren't subject&#160;to domain permission checks.</p>
</div>
</body>
</html>
