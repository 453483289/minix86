<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 275</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page275-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce275.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:767px;white-space:nowrap" class="ft00">Vol. 3A&#160;8-19</p>
<p style="position:absolute;top:47px;left:619px;white-space:nowrap" class="ft01">MULTIPLE-PROCESSOR&#160;MANAGEMENT</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft06">Following a&#160;power-up or reset,&#160;the APs&#160;complete&#160;a minimal self-configuration, then&#160;wait&#160;for a&#160;startup signal&#160;(a SIPI&#160;<br/>message)&#160;from the BSP processor.&#160;Upon&#160;receiving a SIPI message, an AP executes the BIOS&#160;AP configuration&#160;code,&#160;<br/>which&#160;ends with the&#160;AP being placed&#160;in halt&#160;state.<br/>For Intel 64&#160;and IA-32&#160;processors&#160;supporting Intel Hyper-Threading Technology, the&#160;MP initialization protocol&#160;treats&#160;<br/>each of&#160;the&#160;logical processors on the&#160;system bus&#160;or coherent link&#160;domain&#160;as a&#160;separate processor (with a&#160;unique&#160;<br/>APIC&#160;ID). During&#160;boot-up,&#160;one&#160;of&#160;the logical processors&#160;is selected as&#160;the BSP and&#160;the remainder of the logical&#160;<br/>processors are designated&#160;as&#160;APs.</p>
<p style="position:absolute;top:257px;left:69px;white-space:nowrap" class="ft03">8.4.2&#160;</p>
<p style="position:absolute;top:257px;left:150px;white-space:nowrap" class="ft03">MP Initialization Protocol Requirements and Restrictions</p>
<p style="position:absolute;top:288px;left:69px;white-space:nowrap" class="ft02">The MP initialization protocol&#160;imposes&#160;the following&#160;requirements&#160;and restrictions&#160;on the&#160;system:</p>
<p style="position:absolute;top:310px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:310px;left:95px;white-space:nowrap" class="ft06">The MP protocol&#160;is executed&#160;only after a power-up&#160;or&#160;RESET.&#160;If&#160;the MP protocol&#160;has completed&#160;and a&#160;BSP&#160;is&#160;<br/>chosen, subsequent INITs (either&#160;to a&#160;specific&#160;processor&#160;or system wide) do&#160;not&#160;cause&#160;the&#160;MP protocol&#160;to be&#160;<br/>repeated. Instead,&#160;each&#160;logical processor examines&#160;its&#160;BSP&#160;flag&#160;(in&#160;the&#160;IA32_APIC_BASE MSR) to&#160;determine&#160;<br/>whether&#160;it&#160;should&#160;execute&#160;the&#160;BIOS&#160;boot-strap&#160;code&#160;(if&#160;it&#160;is&#160;the BSP) or&#160;enter a&#160;wait-for-SIPI state&#160;(if it&#160;is an&#160;<br/>AP).</p>
<p style="position:absolute;top:398px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:399px;left:95px;white-space:nowrap" class="ft06">All devices in&#160;the&#160;system that&#160;are&#160;capable&#160;of delivering&#160;interrupts to&#160;the processors must be inhibited&#160;from&#160;<br/>doing so for&#160;the duration&#160;of&#160;the MP&#160;initialization protocol. The time&#160;during&#160;which&#160;interrupts must be&#160;inhibited&#160;<br/>includes&#160;the&#160;window between when the&#160;BSP&#160;issues an&#160;INIT-SIPI-SIPI sequence&#160;to an AP&#160;and when the&#160;AP&#160;<br/>responds to&#160;the last&#160;SIPI in&#160;the&#160;sequence.</p>
<p style="position:absolute;top:499px;left:69px;white-space:nowrap" class="ft03">8.4.3&#160;</p>
<p style="position:absolute;top:499px;left:149px;white-space:nowrap" class="ft03">MP Initialization Protocol Algorithm for MP Systems</p>
<p style="position:absolute;top:529px;left:69px;white-space:nowrap" class="ft07">Following&#160;a&#160;power-up&#160;or&#160;RESET&#160;of&#160;an&#160;MP&#160;system,&#160;the&#160;processors in the&#160;system&#160;execute the MP initialization protocol&#160;<br/>algorithm to&#160;initialize&#160;each&#160;of&#160;the logical processors on&#160;the&#160;system bus or coherent link domain.&#160;In the&#160;course of&#160;<br/>executing&#160;this algorithm, the&#160;following boot-up&#160;and initialization operations&#160;are carried out:<br/>1.&#160;Each logical processor is assigned a unique&#160;APIC ID, based on system&#160;topology. The unique ID is a 32-bit value&#160;</p>
<p style="position:absolute;top:603px;left:95px;white-space:nowrap" class="ft06">if&#160;the&#160;processor supports&#160;CPUID leaf&#160;0BH, otherwise&#160;the unique ID is an 8-bit&#160;value.&#160;(see<a href="o_fe12b1e2a880e0ce-279.html">&#160;Section 8.4.5,&#160;“Identi-<br/>fying Logical&#160;Processors&#160;in an MP System”).&#160;</a></p>
<p style="position:absolute;top:643px;left:69px;white-space:nowrap" class="ft07">2.&#160;Each logical processor is&#160;assigned&#160;a unique&#160;arbitration&#160;priority&#160;based on its&#160;APIC&#160;ID.<br/>3.&#160;Each logical processor executes&#160;its&#160;internal BIST simultaneously&#160;with the&#160;other logical processors in&#160;the&#160;</p>
<p style="position:absolute;top:684px;left:95px;white-space:nowrap" class="ft02">system.&#160;</p>
<p style="position:absolute;top:708px;left:69px;white-space:nowrap" class="ft02">4.&#160;Upon completion of the BIST, the logical processors use&#160;a hardware-defined&#160;selection mechanism to select the&#160;</p>
<p style="position:absolute;top:724px;left:95px;white-space:nowrap" class="ft08">BSP&#160;and the APs from the available&#160;logical processors on&#160;the&#160;system&#160;bus. The BSP selection mechanism differs&#160;<br/>depending&#160;on the&#160;family,&#160;model,&#160;and&#160;stepping&#160;IDs&#160;of the&#160;processors,&#160;as&#160;follows:&#160;<br/>—&#160;Later&#160;generations&#160;of IA processors within&#160;family&#160;0FH&#160;<a href="o_fe12b1e2a880e0ce-274.html">(see Section 8.4),</a>&#160;IA&#160;processors with&#160;system bus&#160;</p>
<p style="position:absolute;top:781px;left:120px;white-space:nowrap" class="ft06">(family=06H,&#160;extended_model=0,&#160;model&gt;=0EH), or&#160;all&#160;other modern&#160;Intel processors (family=06H,&#160;<br/>extended_model&gt;0):</p>
<p style="position:absolute;top:823px;left:120px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:822px;left:146px;white-space:nowrap" class="ft02">The logical processors begin monitoring the&#160;BNR#&#160;signal, which&#160;is toggling. When&#160;the BNR# pin&#160;stops&#160;</p>
<p style="position:absolute;top:838px;left:145px;white-space:nowrap" class="ft02">toggling,&#160;each processor attempts to&#160;issue&#160;a NOP special cycle&#160;on&#160;the system&#160;bus.&#160;</p>
<p style="position:absolute;top:864px;left:120px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:862px;left:146px;white-space:nowrap" class="ft02">The logical processor with the&#160;highest&#160;arbitration&#160;priority succeeds&#160;in&#160;issuing&#160;a NOP&#160;special cycle and is&#160;</p>
<p style="position:absolute;top:879px;left:145px;white-space:nowrap" class="ft06">nominated the BSP.&#160;This processor sets the&#160;BSP&#160;flag&#160;in&#160;its IA32_APIC_BASE MSR,&#160;then fetches and&#160;<br/>begins executing BIOS&#160;boot-strap code,&#160;beginning at&#160;the&#160;reset vector (physical address&#160;FFFF&#160;FFF0H).</p>
<p style="position:absolute;top:921px;left:120px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:919px;left:146px;white-space:nowrap" class="ft02">The remaining logical&#160;processors (that&#160;failed in issuing&#160;a NOP&#160;special&#160;cycle)&#160;are designated as APs. They&#160;</p>
<p style="position:absolute;top:936px;left:145px;white-space:nowrap" class="ft02">leave their&#160;BSP&#160;flags in&#160;the clear state and&#160;enter a&#160;“wait-for-SIPI&#160;state.”</p>
<p style="position:absolute;top:960px;left:94px;white-space:nowrap" class="ft02">—&#160;Early generations of IA processors within family&#160;0FH (family=0FH, model=0H, stepping&lt;=09H),&#160;P6 family&#160;</p>
<p style="position:absolute;top:976px;left:120px;white-space:nowrap" class="ft06">or older processors supporting MP operations&#160;(family=06H, extended_model=0,&#160;model&lt;=0DH; or&#160;family&#160;<br/>&lt;06H):</p>
<p style="position:absolute;top:1018px;left:120px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:1017px;left:146px;white-space:nowrap" class="ft02">Each&#160;processor broadcasts a BIPI&#160;to “all including self.”&#160;The&#160;first processor that&#160;broadcasts a BIPI (and&#160;</p>
<p style="position:absolute;top:1033px;left:145px;white-space:nowrap" class="ft02">thus receives&#160;its own BIPI&#160;vector), selects itself as&#160;the&#160;BSP&#160;and&#160;sets the&#160;BSP&#160;flag in&#160;its IA32_APIC_BASE&#160;</p>
</div>
</body>
</html>
