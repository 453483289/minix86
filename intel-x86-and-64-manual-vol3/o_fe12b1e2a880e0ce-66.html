<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 66</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:8px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page66-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce066.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">2-4&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">SYSTEM&#160;ARCHITECTURE&#160;OVERVIEW</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft06">Each&#160;segment&#160;descriptor has&#160;an&#160;associated segment selector. A segment selector provides the&#160;software that&#160;uses&#160;<br/>it with an&#160;index into the&#160;GDT&#160;or LDT (the&#160;offset&#160;of its&#160;associated segment descriptor), a&#160;global/local&#160;flag&#160;(deter-<br/>mines whether the&#160;selector points&#160;to the&#160;GDT or&#160;the LDT),&#160;and&#160;access rights information.&#160;<br/>To&#160;access a&#160;byte in&#160;a segment,&#160;a segment selector and an&#160;offset must be supplied. The segment selector provides&#160;<br/>access to the segment descriptor for the segment&#160;(in&#160;the GDT or LDT). From&#160;the segment descriptor,&#160;the&#160;processor&#160;<br/>obtains&#160;the base address&#160;of&#160;the segment in&#160;the linear&#160;address space.&#160;The&#160;offset&#160;then provides the&#160;location of the&#160;<br/>byte&#160;relative&#160;to&#160;the base address. This&#160;mechanism can&#160;be&#160;used to&#160;access&#160;any valid&#160;code, data,&#160;or stack segment,&#160;<br/>provided&#160;the segment is&#160;accessible from&#160;the&#160;current privilege&#160;level (CPL) at&#160;which the&#160;processor is&#160;operating.&#160;The&#160;<br/>CPL is&#160;defined&#160;as the protection&#160;level&#160;of the&#160;currently executing code&#160;segment.<br/>Se<a href="o_fe12b1e2a880e0ce-64.html">e Figure&#160;2-1.</a>&#160;The&#160;solid&#160;arrows&#160;in the&#160;figure&#160;indicate a&#160;linear address, dashed&#160;lines indicate a&#160;segment&#160;selector,&#160;<br/>and the&#160;dotted arrows indicate a&#160;physical&#160;address.&#160;For&#160;simplicity,&#160;many&#160;of the&#160;segment&#160;selectors are&#160;shown as&#160;<br/>direct&#160;pointers&#160;to a&#160;segment.&#160;However,&#160;the&#160;actual path from&#160;a segment selector&#160;to&#160;its associated&#160;segment&#160;is always&#160;<br/>through a GDT or&#160;LDT.<br/>The linear&#160;address&#160;of&#160;the base of the&#160;GDT is&#160;contained in&#160;the GDT&#160;register (GDTR); the linear&#160;address of the LDT is&#160;<br/>contained in&#160;the LDT register&#160;(LDTR).</p>
<p style="position:absolute;top:398px;left:68px;white-space:nowrap" class="ft03">2.1.1.1&#160;&#160;</p>
<p style="position:absolute;top:398px;left:152px;white-space:nowrap" class="ft03">Global and Local Descriptor&#160;Tables&#160;in IA-32e&#160;Mode</p>
<p style="position:absolute;top:427px;left:68px;white-space:nowrap" class="ft06">GDTR and LDTR registers are expanded to 64-bits wide&#160;in both IA-32e sub-modes (64-bit mode and compatibility&#160;<br/>mode).&#160;For more information:&#160;see<a href="o_fe12b1e2a880e0ce-104.html">&#160;Section 3.5.2,&#160;“Segment Descriptor&#160;Tables in&#160;IA-32e&#160;Mode.”<br/></a>Global&#160;and local&#160;descriptor tables&#160;are&#160;expanded&#160;in 64-bit mode&#160;to&#160;support 64-bit&#160;base&#160;addresses, (16-byte LDT&#160;<br/>descriptors&#160;hold a&#160;64-bit base address&#160;and various attributes). In&#160;compatibility&#160;mode, descriptors are&#160;not&#160;<br/>expanded.&#160;</p>
<p style="position:absolute;top:551px;left:68px;white-space:nowrap" class="ft04">2.1.2&#160;</p>
<p style="position:absolute;top:551px;left:148px;white-space:nowrap" class="ft04">System Segments, Segment Descriptors, and Gates</p>
<p style="position:absolute;top:581px;left:68px;white-space:nowrap" class="ft06">Besides&#160;code, data,&#160;and stack segments that&#160;make&#160;up the execution&#160;environment of a&#160;program&#160;or procedure,&#160;the&#160;<br/>architecture defines two system&#160;segments: the&#160;task-state&#160;segment&#160;(TSS)&#160;and the LDT.&#160;The GDT&#160;is not&#160;considered&#160;<br/>a segment because it&#160;is not accessed&#160;by&#160;means&#160;of a segment selector and segment descriptor.&#160;TSSs and LDTs&#160;have&#160;<br/>segment&#160;descriptors defined for&#160;them.<br/>The&#160;architecture also&#160;defines&#160;a set of special&#160;descriptors&#160;called gates (call&#160;gates,&#160;interrupt gates, trap gates,&#160;and&#160;<br/>task gates).&#160;These provide protected gateways to system&#160;procedures and handlers that may operate at a different&#160;<br/>privilege&#160;level than application&#160;programs&#160;and most procedures. For example,&#160;a CALL to&#160;a call&#160;gate&#160;can provide&#160;<br/>access to a&#160;procedure&#160;in&#160;a code segment that is at the same&#160;or a numerically lower privilege level (more privileged)&#160;<br/>than the&#160;current&#160;code&#160;segment. To&#160;access&#160;a&#160;procedure&#160;through a&#160;call gate,&#160;the calling&#160;procedure</p>
<p style="position:absolute;top:718px;left:715px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:721px;left:722px;white-space:nowrap" class="ft02">&#160;supplies&#160;the&#160;</p>
<p style="position:absolute;top:737px;left:68px;white-space:nowrap" class="ft06">selector&#160;for the call gate. The processor then performs an&#160;access rights check on the&#160;call gate, comparing the CPL&#160;<br/>with&#160;the privilege&#160;level of the&#160;call gate&#160;and the&#160;destination code segment pointed to&#160;by&#160;the call gate.&#160;<br/>If access&#160;to the&#160;destination&#160;code&#160;segment&#160;is allowed,&#160;the&#160;processor&#160;gets&#160;the segment selector for the&#160;destination&#160;<br/>code segment and&#160;an offset&#160;into&#160;that code segment from&#160;the&#160;call&#160;gate. If the&#160;call&#160;requires&#160;a change&#160;in privilege&#160;<br/>level,&#160;the processor also&#160;switches to&#160;the stack for the targeted&#160;privilege&#160;level. The&#160;segment&#160;selector for the&#160;new&#160;<br/>stack is&#160;obtained&#160;from&#160;the TSS for the currently running&#160;task.&#160;Gates&#160;also facilitate transitions&#160;between&#160;16-bit and&#160;<br/>32-bit code segments,&#160;and vice&#160;versa.&#160;</p>
<p style="position:absolute;top:888px;left:68px;white-space:nowrap" class="ft03">2.1.2.1&#160;&#160;</p>
<p style="position:absolute;top:888px;left:152px;white-space:nowrap" class="ft03">Gates&#160;in&#160;IA-32e&#160;Mode</p>
<p style="position:absolute;top:916px;left:68px;white-space:nowrap" class="ft06">In&#160;IA-32e mode, the following descriptors&#160;are&#160;16-byte&#160;descriptors (expanded&#160;to&#160;allow&#160;a 64-bit&#160;base): LDT descrip-<br/>tors,&#160;64-bit TSSs,&#160;call gates, interrupt&#160;gates,&#160;and trap gates.<br/>Call&#160;gates facilitate&#160;transitions between 64-bit&#160;mode&#160;and compatibility mode. Task gates are&#160;not supported&#160;in IA-<br/>32e&#160;mode. On privilege&#160;level changes, stack segment selectors&#160;are not read&#160;from the&#160;TSS.&#160;Instead,&#160;they are set&#160;to&#160;<br/>NULL.</p>
<p style="position:absolute;top:1038px;left:68px;white-space:nowrap" class="ft02">1.&#160;The&#160;word&#160;“procedure”&#160;is&#160;commonly&#160;used&#160;in&#160;this&#160;document&#160;as&#160;a&#160;general&#160;term&#160;for&#160;a&#160;logical&#160;unit&#160;or&#160;block&#160;of&#160;code&#160;(such&#160;as&#160;a&#160;program, pro-</p>
<p style="position:absolute;top:1054px;left:89px;white-space:nowrap" class="ft02">cedure, function, or&#160;routine).&#160;</p>
</div>
</body>
</html>
