<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 978</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page978-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce978.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">20-2&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">8086&#160;EMULATION</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft06">The&#160;16-bit FLAGS register contains status&#160;and control flags. (This register is mapped to the 16&#160;least significant&#160;<br/>bits of the&#160;32-bit EFLAGS&#160;register.)</p>
<p style="position:absolute;top:139px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:139px;left:93px;white-space:nowrap" class="ft06">All of the&#160;Intel&#160;8086&#160;instructions are&#160;supported&#160;(see<a href="o_fe12b1e2a880e0ce-979.html">&#160;Section 20.1.3,&#160;‚ÄúInstructions Supported in&#160;Real-Address&#160;<br/>Mode‚Äù).</a></p>
<p style="position:absolute;top:178px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:178px;left:93px;white-space:nowrap" class="ft06">A&#160;single, 16-bit-wide stack&#160;is provided for handling procedure&#160;calls&#160;and invocations of interrupt and&#160;exception&#160;<br/>handlers.&#160;This&#160;stack&#160;is contained in&#160;the stack segment identified&#160;with the&#160;SS&#160;register.&#160;The&#160;SP&#160;(stack pointer)&#160;<br/>register contains an&#160;offset&#160;into&#160;the stack segment.&#160;The stack&#160;grows&#160;down&#160;(toward lower segment offsets) from&#160;<br/>the stack pointer.&#160;The&#160;BP&#160;(base&#160;pointer) register also contains an offset into the stack segment&#160;that&#160;can&#160;be used&#160;<br/>as&#160;a pointer to a&#160;parameter list. When a CALL&#160;instruction is&#160;executed,&#160;the processor pushes the&#160;current&#160;<br/>instruction pointer (the&#160;16&#160;least-significant bits of the&#160;EIP&#160;register and,&#160;on&#160;far calls,&#160;the current&#160;value of the CS&#160;<br/>register) onto the&#160;stack. On&#160;a return,&#160;initiated with a&#160;RET instruction, the processor pops the saved&#160;instruction&#160;<br/>pointer from the stack into the EIP register (and&#160;CS register&#160;on far returns).&#160;When&#160;an implicit call to an interrupt&#160;<br/>or exception handler is&#160;executed,&#160;the processor pushes&#160;the&#160;EIP,&#160;CS,&#160;and EFLAGS (low-order&#160;16-bits only)&#160;<br/>registers&#160;onto&#160;the stack. On&#160;a return from an&#160;interrupt or&#160;exception handler,&#160;initiated with an&#160;IRET instruction,&#160;<br/>the processor pops the&#160;saved instruction pointer&#160;and&#160;EFLAGS image from the&#160;stack&#160;into the&#160;EIP,&#160;CS, and&#160;<br/>EFLAGS registers.</p>
<p style="position:absolute;top:382px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:382px;left:93px;white-space:nowrap" class="ft06">A&#160;single&#160;interrupt&#160;table,&#160;called&#160;the ‚Äúinterrupt&#160;vector&#160;table‚Äù&#160;or ‚Äúinterrupt table,‚Äù is&#160;provided&#160;for handling&#160;<br/>interrupts&#160;and&#160;exceptions<a href="o_fe12b1e2a880e0ce-981.html">&#160;(see Figure&#160;20-2). The interrupt</a>&#160;table (which has 4-byte entries) takes the&#160;place&#160;of&#160;<br/>the interrupt&#160;descriptor table&#160;(IDT,&#160;with&#160;8-byte entries) used&#160;when handling&#160;protected-mode&#160;interrupts&#160;and&#160;<br/>exceptions.&#160;Interrupt and&#160;exception vector numbers&#160;provide an&#160;index to&#160;entries in&#160;the interrupt table.&#160;Each&#160;<br/>entry&#160;provides&#160;a pointer (called a&#160;‚Äúvector‚Äù)&#160;to an interrupt-&#160;or exception-handling&#160;<a href="o_fe12b1e2a880e0ce-980.html">procedure. See Section&#160;<br/>20.1.4,&#160;‚ÄúInterrupt&#160;and Exception Handling‚Äù,&#160;</a>for&#160;more details.&#160;It is&#160;possible for software&#160;to relocate the&#160;IDT by&#160;<br/>means of&#160;the&#160;LIDT&#160;instruction&#160;on IA-32 processors beginning with the&#160;Intel386 processor.</p>
<p style="position:absolute;top:503px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:504px;left:93px;white-space:nowrap" class="ft06">The&#160;x87 FPU is&#160;active and&#160;available&#160;to execute x87 FPU&#160;instructions in&#160;real-address&#160;mode. Programs written&#160;to&#160;<br/>run on the Intel&#160;8087&#160;and Intel&#160;287 math coprocessors&#160;can be run in&#160;real-address&#160;mode&#160;without modification.</p>
<p style="position:absolute;top:544px;left:68px;white-space:nowrap" class="ft06">The following extensions to&#160;the Intel 8086&#160;execution environment are&#160;available&#160;in&#160;the IA-32 architecture‚Äôs&#160;real-<br/>address mode. If backwards compatibility to&#160;Intel&#160;286 and Intel 8086 processors&#160;is&#160;required, these features should&#160;<br/>not be used in new programs&#160;written&#160;to run in real-address&#160;mode.</p>
<p style="position:absolute;top:599px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:600px;left:93px;white-space:nowrap" class="ft03">Two additional segment registers&#160;(FS&#160;and GS) are available.</p>
<p style="position:absolute;top:622px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:622px;left:93px;white-space:nowrap" class="ft06">Many&#160;of the integer&#160;and system instructions that&#160;have been added&#160;to later IA-32&#160;processors can be&#160;executed&#160;in&#160;<br/>real-address mode&#160;(see<a href="o_fe12b1e2a880e0ce-979.html">&#160;Section 20.1.3, ‚ÄúInstructions Supported in Real-Address&#160;Mode‚Äù).&#160;</a></p>
<p style="position:absolute;top:661px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:661px;left:93px;white-space:nowrap" class="ft06">The&#160;32-bit&#160;operand prefix&#160;can be used in real-address&#160;mode&#160;programs to execute&#160;the&#160;32-bit forms of instruc-<br/>tions.&#160;This prefix&#160;also allows real-address&#160;mode programs to&#160;use the&#160;processor‚Äôs 32-bit&#160;general-purpose&#160;<br/>registers.</p>
<p style="position:absolute;top:716px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:717px;left:93px;white-space:nowrap" class="ft03">The&#160;32-bit&#160;address prefix&#160;can be used in&#160;real-address mode&#160;programs,&#160;allowing&#160;32-bit offsets.</p>
<p style="position:absolute;top:741px;left:68px;white-space:nowrap" class="ft06">The following sections&#160;describe address&#160;formation, registers, available&#160;instructions, and interrupt&#160;and exception&#160;<br/>handling&#160;in&#160;real-address mode. For information&#160;on I/O in&#160;real-address mode,&#160;se<a href="˛ˇ">e Chapter&#160;18,&#160;‚ÄúInput/Output‚Äù,</a>&#160;of&#160;<br/><a href="˛ˇ">the&#160;<i>Intel¬Æ&#160;64 and IA-32 Architectures&#160;Software&#160;Developer‚Äôs Manual, Volume&#160;1</i>.&#160;</a></p>
<p style="position:absolute;top:824px;left:68px;white-space:nowrap" class="ft05">20.1.1 Address&#160;</p>
<p style="position:absolute;top:824px;left:218px;white-space:nowrap" class="ft05">Translation in Real-Address Mode</p>
<p style="position:absolute;top:855px;left:68px;white-space:nowrap" class="ft06">In real-address mode,&#160;the processor does not&#160;interpret&#160;segment selectors as&#160;indexes&#160;into a&#160;descriptor table;&#160;<br/>instead,&#160;it uses them&#160;directly to&#160;form linear addresses&#160;as&#160;the 8086&#160;processor does.&#160;It shifts the&#160;segment&#160;selector&#160;<br/>left by&#160;4 bits to&#160;form a&#160;20-bit base address&#160;<a href="o_fe12b1e2a880e0ce-979.html">(see&#160;Figure&#160;20-1). The&#160;</a>offset into a&#160;segment&#160;is added to the base&#160;<br/>address to&#160;create&#160;a linear&#160;address that&#160;maps directly to&#160;the&#160;physical address&#160;space.&#160;<br/>When using&#160;8086-style&#160;address translation,&#160;it&#160;is possible&#160;to specify addresses&#160;larger&#160;than 1&#160;MByte.&#160;For&#160;example,&#160;<br/>with&#160;a segment selector value&#160;of FFFFH&#160;and an offset of FFFFH, the&#160;linear (and physical) address would be 10FFEFH&#160;<br/>(1 megabyte plus 64 KBytes).&#160;The 8086&#160;processor,&#160;which can&#160;form&#160;addresses&#160;only&#160;up&#160;to 20 bits long,&#160;truncates the&#160;<br/>high-order bit,&#160;thereby ‚Äúwrapping‚Äù&#160;this address&#160;to FFEFH. When&#160;operating in real-address&#160;mode, however,&#160;the&#160;<br/>processor&#160;does&#160;not truncate&#160;such&#160;an address and uses&#160;it as&#160;a physical address. (Note, however,&#160;that&#160;for&#160;IA-32&#160;<br/>processors&#160;beginning with the&#160;Intel486 processor,&#160;the&#160;A20M# signal&#160;can be used in&#160;real-address mode to&#160;mask&#160;<br/>address&#160;line&#160;A20,&#160;thereby&#160;mimicking&#160;the&#160;20-bit&#160;wrap-around&#160;behavior of the 8086 processor.)&#160;Care should be&#160;take&#160;<br/>to ensure&#160;that A20M#&#160;based address wrapping&#160;is&#160;handled&#160;correctly in&#160;multiprocessor based&#160;system.</p>
</div>
</body>
</html>
