<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1270</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:14px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1270-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1270.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">34-20&#160;Vol. 3C</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">SYSTEM&#160;MANAGEMENT&#160;MODE</p>
<p style="position:absolute;top:99px;left:68px;white-space:nowrap" class="ft02">34.15.2.1&#160;&#160;&#160;Architectural State&#160;Before&#160;a VM&#160;Exit</p>
<p style="position:absolute;top:127px;left:68px;white-space:nowrap" class="ft07">System-management interrupts (SMIs) that&#160;cause SMM VM&#160;exits&#160;always do&#160;so directly.&#160;They do&#160;not save&#160;state&#160;to&#160;<br/>SMRAM&#160;as they&#160;do under the&#160;default treatment.</p>
<p style="position:absolute;top:188px;left:68px;white-space:nowrap" class="ft02">34.15.2.2 &#160;&#160;Updating the&#160;Current-VMCS and Executive-VMCS Pointers</p>
<p style="position:absolute;top:217px;left:68px;white-space:nowrap" class="ft08">SMM&#160;VM&#160;exits&#160;begin by performing&#160;the following steps:<br/>1.&#160;The&#160;executive-VMCS&#160;pointer field in&#160;the&#160;SMM-transfer VMCS&#160;is&#160;loaded&#160;as follows:</p>
<p style="position:absolute;top:265px;left:93px;white-space:nowrap" class="ft09">—&#160;If the&#160;SMM VM&#160;exit commenced&#160;in VMX non-root&#160;operation, it&#160;receives the&#160;current-VMCS pointer.<br/>—&#160;If&#160;the&#160;SMM&#160;VM&#160;exit&#160;commenced&#160;in&#160;VMX&#160;root&#160;operation,&#160;it&#160;receives&#160;the VMXON pointer.</p>
<p style="position:absolute;top:313px;left:68px;white-space:nowrap" class="ft07">2.&#160;The current-VMCS&#160;pointer is&#160;loaded with the&#160;value of the&#160;SMM-transfer VMCS&#160;pointer.<br/>The&#160;last step&#160;ensures that the&#160;current VMCS&#160;is the&#160;SMM-transfer VMCS.&#160;VM-exit&#160;information is&#160;recorded&#160;in&#160;that&#160;<br/>VMCS, and VM-entry control fields in that&#160;VMCS are updated.&#160;State&#160;is&#160;saved into the guest-state area of that VMCS.&#160;<br/>The VM-exit controls&#160;and host-state&#160;area&#160;of&#160;that VMCS determine&#160;how the&#160;VM&#160;exit&#160;operates.</p>
<p style="position:absolute;top:414px;left:68px;white-space:nowrap" class="ft02">34.15.2.3&#160;&#160;&#160;Recording VM-Exit Information</p>
<p style="position:absolute;top:442px;left:68px;white-space:nowrap" class="ft07">SMM VM&#160;exits differ&#160;from&#160;other VM&#160;exit&#160;with&#160;regard&#160;to&#160;the way they record VM-exit&#160;information.&#160;The&#160;differences&#160;<br/>follow.</p>
<p style="position:absolute;top:481px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:481px;left:93px;white-space:nowrap" class="ft08"><b>Exit reason</b>.<br/>—&#160;Bits&#160;15:0 of this field contain the basic exit reason. The field is loaded&#160;with&#160;the&#160;reason for&#160;the SMM VM&#160;exit:&#160;</p>
<p style="position:absolute;top:522px;left:119px;white-space:nowrap" class="ft07">I/O&#160;SMI&#160;(an SMI arrived&#160;immediately after&#160;retirement&#160;of an&#160;I/O instruction),&#160;other SMI,&#160;or VMCALL.&#160;See&#160;<br/><a href="o_fe12b1e2a880e0ce-1961.html">Appendix&#160;C, “VMX&#160;Basic Exit Reasons”.</a></p>
<p style="position:absolute;top:562px;left:93px;white-space:nowrap" class="ft03">—&#160;SMM&#160;VM&#160;exits&#160;are&#160;the only VM&#160;exits that&#160;may occur&#160;in VMX root&#160;operation. Because&#160;the SMM-transfer&#160;</p>
<p style="position:absolute;top:579px;left:119px;white-space:nowrap" class="ft07">monitor may need to&#160;know whether it&#160;was invoked&#160;from VMX&#160;root or&#160;VMX non-root operation,&#160;this&#160;<br/>information is stored&#160;in bit&#160;29&#160;of the&#160;exit-reason field&#160;(see<a href="o_fe12b1e2a880e0ce-1067.html">&#160;Table&#160;24-14</a>&#160;in&#160;<a href="o_fe12b1e2a880e0ce-1067.html">Section 24.9.1</a>).&#160;The bit is&#160;set by&#160;<br/>SMM&#160;VM&#160;exits&#160;from VMX root&#160;operation.</p>
<p style="position:absolute;top:636px;left:93px;white-space:nowrap" class="ft03">—&#160;If&#160;the&#160;SMM VM&#160;exit occurred in&#160;VMX non-root operation&#160;and&#160;an MTF VM&#160;exit was pending,&#160;bit&#160;28 of&#160;the exit-</p>
<p style="position:absolute;top:652px;left:119px;white-space:nowrap" class="ft03">reason field&#160;is set; otherwise, it&#160;is cleared.</p>
<p style="position:absolute;top:676px;left:93px;white-space:nowrap" class="ft03">—&#160;Bits&#160;27:16&#160;and bits&#160;31:30&#160;are&#160;cleared.</p>
<p style="position:absolute;top:698px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:699px;left:93px;white-space:nowrap" class="ft07"><b>Exit qualification.</b>&#160;For&#160;an SMM&#160;VM&#160;exit&#160;due an&#160;SMI that arrives&#160;immediately after&#160;the retirement of an&#160;I/O&#160;<br/>instruction, the exit&#160;qualification contains information&#160;about&#160;the&#160;I/O instruction that&#160;retired immediately before&#160;<br/>the&#160;SMI.&#160;It has the&#160;format&#160;<a href="o_fe12b1e2a880e0ce-1270.html">given in Table&#160;34-9.</a></p>
<p style="position:absolute;top:763px;left:97px;white-space:nowrap" class="ft06">Table&#160;34-9.&#160;&#160;Exit&#160;Qualification&#160;for&#160;SMIs&#160;That&#160;Arrive&#160;Immediately&#160;After&#160;the&#160;Retirement&#160;of&#160;an&#160;I/O&#160;Instruction</p>
<p style="position:absolute;top:796px;left:78px;white-space:nowrap" class="ft03">Bit&#160;Position(s)</p>
<p style="position:absolute;top:796px;left:205px;white-space:nowrap" class="ft03">Contents</p>
<p style="position:absolute;top:825px;left:78px;white-space:nowrap" class="ft03">2:0</p>
<p style="position:absolute;top:825px;left:204px;white-space:nowrap" class="ft03">Size of&#160;access:</p>
<p style="position:absolute;top:845px;left:216px;white-space:nowrap" class="ft03">0&#160;=&#160;&#160;1-byte</p>
<p style="position:absolute;top:862px;left:216px;white-space:nowrap" class="ft03">1&#160;=&#160;&#160;2-byte</p>
<p style="position:absolute;top:879px;left:216px;white-space:nowrap" class="ft03">3&#160;=&#160;&#160;4-byte</p>
<p style="position:absolute;top:916px;left:204px;white-space:nowrap" class="ft03">Other&#160;values&#160;not used.</p>
<p style="position:absolute;top:945px;left:78px;white-space:nowrap" class="ft03">3</p>
<p style="position:absolute;top:945px;left:204px;white-space:nowrap" class="ft03">Direction of&#160;the attempted access (0&#160;=&#160;OUT,&#160;1&#160;=&#160;IN)</p>
<p style="position:absolute;top:973px;left:78px;white-space:nowrap" class="ft03">4</p>
<p style="position:absolute;top:973px;left:204px;white-space:nowrap" class="ft03">String instruction&#160;(0&#160;=&#160;not&#160;string; 1&#160;=&#160;string)</p>
<p style="position:absolute;top:1002px;left:78px;white-space:nowrap" class="ft03">5</p>
<p style="position:absolute;top:1002px;left:204px;white-space:nowrap" class="ft03">REP prefixed (0&#160;=&#160;not&#160;REP; 1&#160;=&#160;REP)</p>
<p style="position:absolute;top:1030px;left:78px;white-space:nowrap" class="ft03">6</p>
<p style="position:absolute;top:1030px;left:204px;white-space:nowrap" class="ft03">Operand&#160;encoding&#160;(0&#160;=&#160;DX,&#160;1&#160;=&#160;immediate)</p>
</div>
</body>
</html>
