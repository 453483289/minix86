<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 648</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:14px;font-family:Times;color:#0860a8;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft011{font-size:8px;line-height:12px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page648-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce648.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">18-12&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft08">Effectively,&#160;the IA32_PERF_GLOBAL_STATUS.CTR_FRZ bit&#160;also serve&#160;as an read-only&#160;control to enable&#160;<br/>programmable&#160;performance&#160;counters&#160;and fixed counters in&#160;the&#160;core&#160;PMU.&#160;To&#160;enable counting&#160;with&#160;the&#160;<br/>performance&#160;counters,&#160;the following expression&#160;must hold&#160;with architectural perfmon&#160;version 4 or&#160;higher:</p>
<p style="position:absolute;top:159px;left:119px;white-space:nowrap" class="ft03">‚Ä¢</p>
<p style="position:absolute;top:157px;left:144px;white-space:nowrap" class="ft02">(IA32_PERFEVTSELn.EN &amp; IA32_PERF_GLOBAL_CTRL.PMCn &amp;&#160;</p>
<p style="position:absolute;top:174px;left:143px;white-space:nowrap" class="ft02">(!IA32_PERF_GLOBAL_STATUS.CTR_FRZ) )&#160;=&#160;1 for programmable&#160;counter ‚Äòn‚Äô,&#160;or&#160;</p>
<p style="position:absolute;top:199px;left:119px;white-space:nowrap" class="ft03">‚Ä¢</p>
<p style="position:absolute;top:198px;left:144px;white-space:nowrap" class="ft02">(IA32_PERF_FIXED_CRTL.ENi &amp;&#160;IA32_PERF_GLOBAL_CTRL.FCi &amp;&#160;</p>
<p style="position:absolute;top:214px;left:143px;white-space:nowrap" class="ft02">(!IA32_PERF_GLOBAL_STATUS.CTR_FRZ) )&#160;=&#160;1 for fixed&#160;counter&#160;‚Äòi‚Äô</p>
<p style="position:absolute;top:238px;left:68px;white-space:nowrap" class="ft08">The&#160;read-only enable interface&#160;IA32_PERF_GLOBAL_STATUS.CTR_FRZ provides&#160;a&#160;more&#160;efficient&#160;flow for a&#160;PMI&#160;<br/>handler to&#160;use IA32_DEBUGCTL.Freeza_Perfmon_On_PMI to&#160;filter&#160;out data that may distort&#160;target workload&#160;anal-<br/><a href="o_fe12b1e2a880e0ce-589.html">ysis, see Table 17-3.</a>&#160;It should&#160;be&#160;noted&#160;the IA32_PERF_GLOBAL_CTRL&#160;register continue to&#160;serve as&#160;the primary&#160;<br/>interface to&#160;control&#160;all performance&#160;counters of the&#160;logical&#160;processor.&#160;<br/>For&#160;example,&#160;when&#160;the&#160;Freeze-On-PMI&#160;mode&#160;is&#160;not being used,&#160;a PMI handler would be setting&#160;<br/>IA32_PERF_GLOBAL_CTRL&#160;as&#160;the very last&#160;step to&#160;commence the overall operation&#160;after configuring&#160;the individual&#160;<br/>counter registers, controls and PEBS facility.&#160;This does not only assure atomic monitoring but also avoids unneces-<br/>sary&#160;complications (e.g. race conditions) when software&#160;attempts&#160;to change&#160;the&#160;core PMU configuration&#160;while&#160;some&#160;<br/>counters are&#160;kept&#160;enabled.<br/>Additionally, IA32_PERF_GLOBAL_STATUS.TraceToPAPMI[bit 55]:&#160;On processors that support Intel&#160;Processor Trace&#160;<br/>and configured&#160;to&#160;store trace&#160;output packets to physical&#160;memory using the ToPA&#160;scheme,&#160;bit 55&#160;is set when a PMI&#160;<br/>occurred&#160;due&#160;to&#160;a ToPA&#160;entry memory buffer&#160;was completely filled.&#160;<br/>IA32_PERF_GLOBAL_STATUS also provides an&#160;indicator&#160;to&#160;distinguish interaction of&#160;performance monitoring oper-<br/>ations with other&#160;side-band activities, which apply Intel&#160;SGX on processors that&#160;support&#160;SGX (For additional infor-<br/>mation&#160;about In<a href="˛ˇ">tel SGX, see ‚ÄúIntel¬Æ&#160;Software&#160;Guard Extensions&#160;Programming&#160;Reference‚Äù.):</a></p>
<p style="position:absolute;top:514px;left:68px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:514px;left:93px;white-space:nowrap" class="ft08">IA32_PERF_GLOBAL_STATUS.ASCI[bit 60]: This bit&#160;is&#160;set&#160;when data accumulated&#160;in any&#160;of&#160;the configured&#160;<br/>performance counters&#160;(i.e.&#160;IA32_PMCx or&#160;IA32_</p>
<p style="position:absolute;top:531px;left:418px;white-space:nowrap" class="ft02">FIXED_CTRx)&#160;may include contributions from&#160;direct or&#160;indirect&#160;</p>
<p style="position:absolute;top:547px;left:93px;white-space:nowrap" class="ft08">operation of Intel SGX&#160;to protect an enclave&#160;(since&#160;the last&#160;time IA32_PERF_GLOBAL_STATUS.ASCI was&#160;<br/>cleared).&#160;</p>
<p style="position:absolute;top:906px;left:68px;white-space:nowrap" class="ft08">Note,&#160;a&#160;processor‚Äôs support&#160;for IA32_PERF_GLOBAL_STATUS.TraceToPAPMI[bit&#160;55]&#160;is enumerated&#160;as&#160;a result of&#160;<br/>CPUID&#160;enumerated&#160;capability of Intel&#160;Processor&#160;Trace&#160;and&#160;the&#160;use&#160;of the&#160;ToPA&#160;buffer&#160;scheme.&#160;Support&#160;of&#160;<br/>IA32_PERF_GLOBAL_STATUS.ASCI[bit 60] is&#160;enumerated&#160;by&#160;the CPUID&#160;enumeration of Intel SGX.</p>
<p style="position:absolute;top:983px;left:68px;white-space:nowrap" class="ft05">18.2.4.2 &#160;&#160;IA32_PERF_GLOBAL_STATUS_RESET and&#160;IA32_PERF_GLOBAL_STATUS_SET MSRS</p>
<p style="position:absolute;top:1012px;left:68px;white-space:nowrap" class="ft08">With&#160;architectural&#160;performance monitoring version 3&#160;and&#160;lower,&#160;clearing of&#160;the&#160;set&#160;bits in&#160;<br/>IA32_PERF_GLOBAL_STATUS&#160;MSR by software&#160;is done&#160;via&#160;IA32_PERF_GLOBAL_OVF_CTRL MSR.&#160;Starting with&#160;<br/>architectural&#160;performance monitoring version 4, software can manage the&#160;overflow&#160;and other&#160;indicators&#160;in&#160;<br/>IA32_PERF_GLOBAL_STATUS&#160;using separate&#160;interfaces&#160;to set or clear individual&#160;bits.&#160;</p>
<p style="position:absolute;top:851px;left:164px;white-space:nowrap" class="ft06">Figure&#160;18-10.&#160;&#160;IA32_PERF_GLOBAL_STATUS&#160;MSR&#160;and Architectural&#160;Perfmon&#160;Version&#160;4</p>
<p style="position:absolute;top:814px;left:702px;white-space:nowrap" class="ft00">Reserved</p>
<p style="position:absolute;top:637px;left:289px;white-space:nowrap" class="ft07">62</p>
<p style="position:absolute;top:801px;left:149px;white-space:nowrap" class="ft011">IA32_FIXED_CTR2 Overflow<br/>IA32_FIXED_CTR1 Overflow<br/>IA32_FIXED_CTR0 Overflow</p>
<p style="position:absolute;top:788px;left:149px;white-space:nowrap" class="ft07">TraceToPAPMI</p>
<p style="position:absolute;top:638px;left:722px;white-space:nowrap" class="ft07">..&#160;1&#160;0</p>
<p style="position:absolute;top:793px;left:536px;white-space:nowrap" class="ft07">IA32_PMC0 Overflow</p>
<p style="position:absolute;top:639px;left:526px;white-space:nowrap" class="ft07">31</p>
<p style="position:absolute;top:639px;left:513px;white-space:nowrap" class="ft07">32</p>
<p style="position:absolute;top:639px;left:500px;white-space:nowrap" class="ft07">33</p>
<p style="position:absolute;top:639px;left:487px;white-space:nowrap" class="ft07">34</p>
<p style="position:absolute;top:639px;left:474px;white-space:nowrap" class="ft07">35</p>
<p style="position:absolute;top:637px;left:276px;white-space:nowrap" class="ft07">63</p>
<p style="position:absolute;top:709px;left:150px;white-space:nowrap" class="ft011">CondChgd<br/>OvfDSBuffer</p>
<p style="position:absolute;top:638px;left:709px;white-space:nowrap" class="ft07">..</p>
<p style="position:absolute;top:638px;left:695px;white-space:nowrap" class="ft07">N</p>
<p style="position:absolute;top:761px;left:535px;white-space:nowrap" class="ft07">...................... Overflow</p>
<p style="position:absolute;top:748px;left:536px;white-space:nowrap" class="ft07">IA32_PMC(N-1) Overflow</p>
<p style="position:absolute;top:735px;left:150px;white-space:nowrap" class="ft07">OvfUncore</p>
<p style="position:absolute;top:636px;left:305px;white-space:nowrap" class="ft07">61</p>
<p style="position:absolute;top:776px;left:536px;white-space:nowrap" class="ft07">IA32_PMC1 Overflow</p>
<p style="position:absolute;top:636px;left:320px;white-space:nowrap" class="ft07">60&#160;59&#160;58</p>
<p style="position:absolute;top:638px;left:395px;white-space:nowrap" class="ft07">55</p>
<p style="position:absolute;top:748px;left:150px;white-space:nowrap" class="ft07">ASCI</p>
<p style="position:absolute;top:775px;left:149px;white-space:nowrap" class="ft07">LBR_Frz</p>
<p style="position:absolute;top:762px;left:150px;white-space:nowrap" class="ft07">CTR_Frz</p>
</div>
</body>
</html>
