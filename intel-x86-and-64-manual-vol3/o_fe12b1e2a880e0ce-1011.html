<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1011</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1011-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1011.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:768px;white-space:nowrap" class="ft00">Vol. 3B&#160;22-7</p>
<p style="position:absolute;top:47px;left:657px;white-space:nowrap" class="ft01">ARCHITECTURE&#160;COMPATIBILITY</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft06">processor/Intel&#160;487&#160;SX math coprocessor system&#160;or an&#160;Intel386 processor/Intel&#160;387 math coprocessor system,&#160;<br/>will&#160;run with at most&#160;minor modifications on a Pentium 4,&#160;Intel Xeon, or P6&#160;family&#160;processor.&#160;To&#160;port&#160;code&#160;directly&#160;<br/>from&#160;an&#160;Intel&#160;286&#160;processor/Intel&#160;287&#160;math&#160;coprocessor&#160;system&#160;or&#160;an&#160;Intel&#160;8086&#160;processor/8087&#160;math&#160;copro-<br/>cessor system&#160;to&#160;a Pentium 4, Intel Xeon, P6 family,&#160;or&#160;Pentium processor,&#160;certain additional issues&#160;must be&#160;<br/>addressed.&#160;<br/>In&#160;the following&#160;sections,&#160;the term&#160;‚Äú32-bit x87&#160;FPUs‚Äù refers&#160;to the P6 family, Pentium, and Intel486 DX processors,&#160;<br/>and to the&#160;Intel&#160;487 SX and Intel&#160;387 math coprocessors;&#160;the term ‚Äú16-bit IA-32 math&#160;coprocessors‚Äù&#160;refers to the&#160;<br/>Intel&#160;287&#160;and&#160;8087&#160;math coprocessors.</p>
<p style="position:absolute;top:274px;left:69px;white-space:nowrap" class="ft03">22.18.1&#160;&#160;Control Register CR0 Flags</p>
<p style="position:absolute;top:304px;left:69px;white-space:nowrap" class="ft06">The ET, NE, and MP flags in&#160;control register&#160;CR0 control&#160;the&#160;interface between&#160;the integer unit of&#160;an IA-32 processor&#160;<br/>and either its&#160;internal x87 FPU&#160;or&#160;an external&#160;math&#160;coprocessor.&#160;The&#160;effect of&#160;these flags in the&#160;various&#160;IA-32&#160;<br/>processors are described in the&#160;following&#160;paragraphs.<br/>The&#160;ET&#160;(extension type) flag&#160;(bit&#160;4&#160;of&#160;the CR0&#160;register)&#160;is&#160;used&#160;in&#160;the Intel386&#160;processor&#160;to indicate whether the&#160;<br/>math coprocessor in&#160;the system&#160;is an Intel&#160;287&#160;math&#160;coprocessor&#160;(flag is&#160;clear)&#160;or&#160;an Intel&#160;387 DX math copro-<br/>cessor&#160;(flag is&#160;set). This&#160;bit is&#160;hardwired&#160;to 1&#160;in&#160;the P6 family,&#160;Pentium, and&#160;Intel486 processors.<br/>The NE (Numeric Exception) flag&#160;(bit&#160;5&#160;of&#160;the CR0 register)&#160;is used in&#160;the P6&#160;family, Pentium,&#160;and Intel486 proces-<br/>sors&#160;to determine whether unmasked&#160;floating-point&#160;exceptions are reported internally&#160;through&#160;interrupt vector 16&#160;<br/>(flag&#160;is set) or&#160;externally&#160;through an&#160;external interrupt (flag is clear).&#160;On&#160;a hardware&#160;reset, the NE flag is&#160;initialized&#160;<br/>to 0, so&#160;software using the automatic internal error-reporting mechanism must&#160;set&#160;this flag&#160;to 1. This&#160;flag is&#160;nonex-<br/>istent on&#160;the Intel386&#160;processor.<br/>As on the Intel 286&#160;and&#160;Intel386 processors, the MP&#160;(monitor&#160;coprocessor) flag (bit&#160;1&#160;of register CR0)&#160;determines&#160;<br/>whether the WAIT/FWAIT&#160;instructions or waiting-type&#160;floating-point instructions trap when the context&#160;of&#160;the x87&#160;<br/>FPU is different from that of&#160;the currently-executing task. If the MP and TS&#160;flag are set, then a WAIT/FWAIT instruc-<br/>tion and waiting&#160;instructions will cause&#160;a device-not-available&#160;exception (interrupt vector&#160;7).&#160;The MP flag is&#160;used on&#160;<br/>the Intel 286 and&#160;Intel386&#160;processors to&#160;support&#160;the use&#160;of a WAIT/FWAIT&#160;instruction&#160;to wait&#160;on a device&#160;other&#160;<br/>than&#160;a&#160;math&#160;coprocessor.&#160;The device reports its&#160;status through the&#160;BUSY#&#160;pin.&#160;Since the&#160;P6&#160;family, Pentium,&#160;and&#160;<br/>Intel486&#160;processors&#160;do&#160;not&#160;have&#160;such&#160;a&#160;pin,&#160;the&#160;MP&#160;flag&#160;has no&#160;relevant&#160;use and should be&#160;set to&#160;1&#160;for normal oper-<br/>ation.</p>
<p style="position:absolute;top:674px;left:69px;white-space:nowrap" class="ft03">22.18.2&#160;&#160;x87 FPU Status Word</p>
<p style="position:absolute;top:705px;left:69px;white-space:nowrap" class="ft06">This section identifies differences to the&#160;x87&#160;FPU status&#160;word for&#160;the&#160;different&#160;IA-32 processors and math coproces-<br/>sors, the&#160;reason&#160;for the&#160;differences,&#160;and their&#160;impact on&#160;software.</p>
<p style="position:absolute;top:766px;left:69px;white-space:nowrap" class="ft04">22.18.2.1&#160;&#160;&#160;Condition&#160;Code&#160;Flags (C0&#160;through C3)</p>
<p style="position:absolute;top:794px;left:69px;white-space:nowrap" class="ft06">The&#160;following information pertains&#160;to differences in&#160;the use&#160;of the&#160;condition code&#160;flags&#160;(C0&#160;through C3) located in&#160;<br/>bits&#160;8,&#160;9,&#160;10,&#160;and 14&#160;of the&#160;x87&#160;FPU status&#160;word.<br/>After execution&#160;of&#160;an FINIT instruction&#160;or&#160;a&#160;hardware reset on a 32-bit x87 FPU,&#160;the condition&#160;code flags are set to&#160;<br/>0.&#160;The same operations on a 16-bit IA-32 math coprocessor leave these&#160;flags intact (they contain their prior value).&#160;<br/>This difference in&#160;operation&#160;has no impact&#160;on software&#160;and provides a&#160;consistent state&#160;after&#160;reset.<br/>Transcendental instruction results&#160;in the&#160;core range&#160;of&#160;the&#160;P6&#160;family&#160;and Pentium processors may&#160;differ from the&#160;<br/>Intel486&#160;DX processor and&#160;Intel&#160;487&#160;SX math&#160;coprocessor by&#160;2 to&#160;3 units&#160;in the&#160;last place (ulps)‚Äî(see ‚ÄúTranscen-<br/>dental Instruction&#160;Accuracy‚Äù&#160;<a href="˛ˇ">in Chapter&#160;8,&#160;‚ÄúProgramming&#160;with the&#160;x87 FPU,‚Äù of the&#160;<i>Intel¬Æ 64&#160;and IA-32 Architec-<br/>tures&#160;Software Developer‚Äôs Manual, Volume 1</i></a>).&#160;As&#160;a result, the&#160;value saved&#160;in&#160;the C1&#160;flag may also differ.<br/>After an&#160;incomplete FPREM/FPREM1&#160;instruction,&#160;the C0, C1, and C3&#160;flags are set to&#160;0&#160;on the&#160;32-bit x87 FPUs.&#160;After&#160;<br/>the same&#160;operation on a&#160;16-bit IA-32&#160;math coprocessor,&#160;these&#160;flags&#160;are&#160;left intact.&#160;<br/>On&#160;the 32-bit x87&#160;FPUs,&#160;the&#160;C2 flag serves&#160;as an incomplete&#160;flag for the FTAN&#160;instruction.&#160;On the 16-bit&#160;IA-32 math&#160;<br/>coprocessors, the&#160;C2&#160;flag&#160;is undefined for the&#160;FPTAN&#160;instruction. This&#160;difference&#160;has no impact on software,&#160;<br/>because&#160;Intel&#160;287&#160;or&#160;8087&#160;programs do&#160;not check C2&#160;after an&#160;FPTAN instruction.&#160;The&#160;use of&#160;this&#160;flag on&#160;later&#160;<br/>processors allows fast&#160;checking of operand&#160;range.</p>
</div>
</body>
</html>
