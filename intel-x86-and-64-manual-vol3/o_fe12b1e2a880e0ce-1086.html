<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1086</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1086-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1086.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">25-12&#160;Vol. 3C</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">VMX NON-ROOT&#160;OPERATION</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft08">If the default&#160;treatment of SMIs&#160;and&#160;S<a href="o_fe12b1e2a880e0ce-1266.html">MM (see Section&#160;34.14</a>)&#160;is active,&#160;the VMX-preemption timer&#160;counts&#160;<br/>across an SMI to VMX&#160;non-root operation, subsequent execution in SMM, and the return from SMM via the RSM&#160;<br/>instruction. However,&#160;the timer&#160;can cause&#160;a VM&#160;exit only&#160;from VMX&#160;non-root&#160;operation. If&#160;the timer&#160;expires&#160;<br/>during&#160;SMI,&#160;in SMM,&#160;or during&#160;RSM,&#160;a timer-induced&#160;VM&#160;exit occurs immediately after&#160;RSM&#160;with&#160;its normal&#160;<br/>priority unless&#160;it is&#160;blocked&#160;based&#160;on activity<a href="o_fe12b1e2a880e0ce-1079.html">&#160;state (Section&#160;25.2).</a></p>
<p style="position:absolute;top:188px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:189px;left:93px;white-space:nowrap" class="ft08">If the dual-monitor treatment&#160;of&#160;SMIs and&#160;<a href="o_fe12b1e2a880e0ce-1269.html">SMM (see Section 34.15) i</a>s&#160;active,&#160;transitions into&#160;and out of&#160;SMM&#160;<br/>are VM&#160;exits and VM&#160;entries,&#160;respectively. The treatment&#160;of the VMX-preemption&#160;timer by those&#160;transitions is&#160;<br/>mostly the&#160;same as&#160;for&#160;ordinary VM&#160;exits and&#160;VM&#160;entrie<a href="o_fe12b1e2a880e0ce-1269.html">s; Section 34.15.2&#160;</a><a href="o_fe12b1e2a880e0ce-1272.html">and Section&#160;34.15.4 d</a>etail&#160;some&#160;<br/>differences.</p>
<p style="position:absolute;top:289px;left:68px;white-space:nowrap" class="ft04">25.5.2&#160;</p>
<p style="position:absolute;top:289px;left:148px;white-space:nowrap" class="ft04">Monitor Trap Flag</p>
<p style="position:absolute;top:319px;left:68px;white-space:nowrap" class="ft08">The&#160;<b>monitor&#160;trap&#160;flag</b>&#160;is&#160;a debugging feature&#160;that causes&#160;VM&#160;exits&#160;to occur on&#160;certain instruction boundaries in&#160;<br/>VMX&#160;non-root operation.&#160;Such VM&#160;exits are&#160;called&#160;<b>MTF VM&#160;exits</b>.&#160;An MTF VM&#160;exit may occur on&#160;an&#160;instruction&#160;<br/>boundary in&#160;VMX non-root operation as&#160;follows:</p>
<p style="position:absolute;top:374px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:375px;left:93px;white-space:nowrap" class="ft08">If the&#160;‚Äúmonitor&#160;trap&#160;flag‚Äù VM-execution control&#160;is 1&#160;and&#160;VM&#160;entry is&#160;injecting a&#160;vectored event (see&#160;<a href="o_fe12b1e2a880e0ce-1110.html">Section&#160;<br/>26.5.1),&#160;</a>an MTF VM&#160;exit is&#160;pending on the&#160;instruction&#160;boundary before the&#160;first instruction following&#160;the&#160;<br/>VM&#160;entry.</p>
<p style="position:absolute;top:430px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:430px;left:93px;white-space:nowrap" class="ft08">If VM&#160;entry is&#160;injecting a&#160;pending&#160;MTF&#160;VM&#160;exit&#160;(see&#160;<a href="o_fe12b1e2a880e0ce-1113.html">Section&#160;26.5.2),&#160;</a>an MTF VM&#160;exit is&#160;pending on&#160;the&#160;<br/>instruction boundary&#160;before&#160;the&#160;first instruction following&#160;the VM&#160;entry.&#160;This is&#160;the case even&#160;if&#160;the ‚Äúmonitor&#160;<br/>trap&#160;flag‚Äù VM-execution&#160;control&#160;is 0.</p>
<p style="position:absolute;top:485px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:486px;left:93px;white-space:nowrap" class="ft08">If the ‚Äúmonitor&#160;trap&#160;flag‚Äù VM-execution control&#160;is 1,&#160;VM&#160;entry&#160;is not injecting&#160;an event,&#160;and a&#160;pending event&#160;<br/>(e.g.,&#160;debug&#160;exception or&#160;interrupt) is&#160;delivered before&#160;an instruction can&#160;execute, an&#160;MTF&#160;VM&#160;exit&#160;is pending&#160;<br/>on the&#160;instruction boundary following delivery&#160;of&#160;the event (or&#160;any nested&#160;exception).</p>
<p style="position:absolute;top:541px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:541px;left:93px;white-space:nowrap" class="ft09">Suppose&#160;that&#160;the ‚Äúmonitor trap flag‚Äù VM-execution control&#160;is 1, VM&#160;entry&#160;is not injecting an event, and&#160;the first&#160;<br/>instruction following VM&#160;entry&#160;is a&#160;REP-prefixed string&#160;instruction:<br/>‚Äî&#160;If&#160;the&#160;first iteration of the instruction causes&#160;a fault,&#160;an MTF VM&#160;exit is&#160;pending&#160;on&#160;the instruction boundary&#160;</p>
<p style="position:absolute;top:598px;left:119px;white-space:nowrap" class="ft03">following&#160;delivery of the&#160;fault (or any&#160;nested exception).</p>
<p style="position:absolute;top:622px;left:93px;white-space:nowrap" class="ft03">‚Äî&#160;If&#160;the first&#160;iteration&#160;of&#160;the&#160;instruction does&#160;not cause&#160;a fault,&#160;an MTF VM&#160;exit is&#160;pending on&#160;the&#160;instruction&#160;</p>
<p style="position:absolute;top:639px;left:119px;white-space:nowrap" class="ft03">boundary after&#160;that iteration.</p>
<p style="position:absolute;top:661px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:661px;left:93px;white-space:nowrap" class="ft08">Suppose&#160;that&#160;the ‚Äúmonitor trap flag‚Äù VM-execution control&#160;is 1, VM&#160;entry&#160;is not injecting an event, and&#160;the first&#160;<br/>instruction following&#160;VM&#160;entry is&#160;the&#160;XBEGIN&#160;instruction.&#160;In this case, an&#160;MTF&#160;VM&#160;exit is&#160;pending at the&#160;fallback&#160;<br/>instruction address&#160;of the XBEGIN instruction. This behavior applies regardless of&#160;whether advanced&#160;debugging&#160;<br/>of&#160;RTM&#160;transactional regions has been&#160;enable<a href="˛ˇ">d (see Section 16.3.7, ‚ÄúRTM-Enabled Debugger&#160;Support,‚Äù&#160;</a>of&#160;<br/><a href="˛ˇ"><i>Intel¬Æ 64 and&#160;IA-32 Architectures Software&#160;Developer‚Äôs&#160;Manual,&#160;Volume 1</i>).</a></p>
<p style="position:absolute;top:749px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:750px;left:93px;white-space:nowrap" class="ft09">Suppose&#160;that&#160;the ‚Äúmonitor trap flag‚Äù VM-execution control&#160;is 1, VM&#160;entry&#160;is not injecting an event, and&#160;the first&#160;<br/>instruction following VM&#160;entry&#160;is neither<b>&#160;</b>a REP-prefixed&#160;string instruction or&#160;the&#160;XBEGIN&#160;instruction:<br/>‚Äî&#160;If&#160;the&#160;instruction causes a&#160;fault, an MTF VM&#160;exit is&#160;pending&#160;on&#160;the&#160;instruction boundary following&#160;delivery of&#160;</p>
<p style="position:absolute;top:807px;left:119px;white-space:nowrap" class="ft03">the fault (or&#160;any nested exception).</p>
<p style="position:absolute;top:804px;left:358px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:831px;left:93px;white-space:nowrap" class="ft03">‚Äî&#160;If&#160;the instruction does not&#160;cause a&#160;fault, an&#160;MTF&#160;VM&#160;exit is&#160;pending on the instruction boundary&#160;following&#160;</p>
<p style="position:absolute;top:847px;left:119px;white-space:nowrap" class="ft08">execution of that&#160;instruction. If the&#160;instruction&#160;is&#160;INT3&#160;or&#160;INTO, this&#160;boundary follows&#160;delivery of any&#160;<br/>software&#160;exception. If the instruction is INT&#160;<i>n</i>, this boundary follows delivery&#160;of&#160;a&#160;software&#160;interrupt.&#160;If&#160;the&#160;<br/>instruction&#160;is HLT,&#160;the&#160;MTF VM&#160;exit will be from the&#160;HLT activity&#160;state.</p>
<p style="position:absolute;top:904px;left:68px;white-space:nowrap" class="ft08">No MTF VM&#160;exit&#160;occurs if another&#160;VM&#160;exit occurs before&#160;reaching the instruction boundary on&#160;which&#160;an MTF VM&#160;exit&#160;<br/>would be&#160;pending&#160;(e.g.,&#160;due&#160;to an&#160;exception or triple&#160;fault).<br/>An MTF VM&#160;exit occurs&#160;on&#160;the instruction boundary&#160;on&#160;which it&#160;is pending unless&#160;a higher priority&#160;event takes&#160;<br/>precedence&#160;or the&#160;MTF&#160;VM&#160;exit&#160;is blocked&#160;due&#160;to the&#160;activity state:</p>
<p style="position:absolute;top:983px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:984px;left:93px;white-space:nowrap" class="ft08">System-management&#160;interrupts (SMIs), INIT&#160;signals,&#160;and&#160;higher priority events&#160;take&#160;priority&#160;over MTF&#160;<br/>VM&#160;exits. MTF VM&#160;exits take&#160;priority&#160;over&#160;debug-trap exceptions&#160;and lower priority&#160;events.</p>
<p style="position:absolute;top:1038px;left:68px;white-space:nowrap" class="ft03">1.&#160;This item&#160;includes&#160;the cases of&#160;an&#160;invalid&#160;opcode&#160;exception‚Äî#UD‚Äî generated by&#160;the UD2 instruction and a BOUND-range exceeded&#160;</p>
<p style="position:absolute;top:1054px;left:89px;white-space:nowrap" class="ft03">exception‚Äî#BR‚Äîgenerated&#160;by the BOUND instruction.</p>
</div>
</body>
</html>
