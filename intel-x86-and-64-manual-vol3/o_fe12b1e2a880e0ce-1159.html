<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1159</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1159-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1159.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;28-11</p>
<p style="position:absolute;top:47px;left:581px;white-space:nowrap" class="ft01">VMX SUPPORT&#160;FOR ADDRESS TRANSLATION</p>
<p style="position:absolute;top:100px;left:120px;white-space:nowrap" class="ft02">i)&#160;If&#160;the access fails because&#160;of&#160;an EPT&#160;misconfiguration&#160;or an&#160;EPT violation&#160;(see above), an&#160;EPT-induced&#160;</p>
<p style="position:absolute;top:117px;left:146px;white-space:nowrap" class="ft02">VM&#160;exit occurs.</p>
<p style="position:absolute;top:141px;left:120px;white-space:nowrap" class="ft02">ii)&#160;If&#160;the access does not cause&#160;an&#160;EPT-induced&#160;VM&#160;exit, memory is&#160;accessed using&#160;the ultimate&#160;physical&#160;</p>
<p style="position:absolute;top:157px;left:146px;white-space:nowrap" class="ft02">address (the&#160;translation,&#160;using EPT,&#160;of&#160;the&#160;ultimate&#160;guest-physical&#160;address).</p>
<p style="position:absolute;top:181px;left:69px;white-space:nowrap" class="ft05">If CR0.PG&#160;= 0, a linear address is treated&#160;as a guest-physical address&#160;and is translated&#160;using EPT (see above). This&#160;<br/>process, if&#160;it completes without&#160;an EPT violation or EPT misconfiguration,&#160;produces&#160;a physical address&#160;and deter-<br/>mines the privileges allowed&#160;by the&#160;EPT paging-structure entries. If these&#160;privileges do&#160;not allow the access to the&#160;<br/>physical&#160;<a href="o_fe12b1e2a880e0ce-1156.html">address (see Section 28.2.3.2), an&#160;</a>EPT violation occurs. Otherwise, memory&#160;is accessed&#160;using the&#160;phys-<br/>ical address.</p>
<p style="position:absolute;top:298px;left:69px;white-space:nowrap" class="ft03">28.2.4&#160;</p>
<p style="position:absolute;top:298px;left:149px;white-space:nowrap" class="ft03">Accessed and Dirty Flags for EPT</p>
<p style="position:absolute;top:328px;left:69px;white-space:nowrap" class="ft05">The Intel&#160;64 architecture&#160;supports&#160;<b>accessed and dirty flags</b>&#160;in&#160;ordinary&#160;paging-structure entries<a href="o_fe12b1e2a880e0ce-137.html">&#160;(see Section&#160;<br/>4.8). Some</a>&#160;processors also support corresponding&#160;flags in&#160;EPT&#160;paging-structure entries. Software should read the&#160;<br/>VMX capability MSR&#160;IA32_VMX_EPT_VPID_CAP (see<a href="o_fe12b1e2a880e0ce-1949.html">&#160;Appendix&#160;A.10)&#160;</a>to determine whether the&#160;processor&#160;supports&#160;<br/>this feature.<br/>Software can&#160;enable&#160;accessed and dirty&#160;flags for EPT using&#160;bit&#160;6&#160;of the extended-page-table pointer (EPTP), a VM-<br/>execution&#160;control field&#160;(see<a href="o_fe12b1e2a880e0ce-1061.html">&#160;Table&#160;24-8 in&#160;Section&#160;24.6.11</a>). If this&#160;bit&#160;is 1, the processor&#160;will set&#160;the&#160;accessed and&#160;<br/>dirty flags&#160;for&#160;EPT as&#160;described&#160;below.&#160;In&#160;addition,&#160;setting&#160;this&#160;flag causes&#160;processor accesses to&#160;guest&#160;paging-<br/>structure&#160;entries to&#160;be&#160;treated&#160;as writes&#160;(see&#160;below and<a href="o_fe12b1e2a880e0ce-1156.html">&#160;Section 28.2.3.2).<br/></a>For&#160;any EPT&#160;paging-structure entry that&#160;is used during&#160;guest-physical-address&#160;translation,&#160;bit&#160;8&#160;is the&#160;accessed&#160;<br/>flag. For a&#160;EPT paging-structure entry&#160;that&#160;maps a&#160;page&#160;(as&#160;opposed&#160;to referencing another&#160;EPT paging structure),&#160;<br/>bit&#160;9&#160;is&#160;the dirty&#160;flag.<br/>Whenever&#160;the processor uses&#160;an EPT&#160;paging-structure entry&#160;as part of guest-physical-address translation,&#160;it&#160;sets&#160;<br/>the&#160;accessed flag&#160;in&#160;that&#160;entry&#160;(if it&#160;is not already set).<br/>Whenever there is&#160;a write&#160;to&#160;a guest-physical&#160;address,&#160;the processor sets the&#160;dirty flag&#160;(if it&#160;is not already set) in&#160;<br/>the EPT paging-structure entry&#160;that&#160;identifies the&#160;final&#160;physical address&#160;for&#160;the guest-physical&#160;address (either an&#160;<br/>EPT PTE&#160;or an EPT paging-structure entry&#160;in&#160;which&#160;bit&#160;7&#160;is 1).<br/>When accessed&#160;and dirty flags&#160;for&#160;EPT&#160;are enabled, processor accesses&#160;to guest paging-structure entries are&#160;<br/>treated as&#160;writes&#160;(see<a href="o_fe12b1e2a880e0ce-1156.html">&#160;Section 28.2.3.2). Thus, such an&#160;</a>access&#160;will cause&#160;the processor to&#160;set the dirty&#160;flag in&#160;the&#160;<br/>EPT&#160;paging-structure&#160;entry that identifies the final&#160;physical address&#160;of&#160;the guest paging-structure&#160;entry.<br/>(This does not apply to loads&#160;of the PDPTE registers for&#160;PAE&#160;paging by the&#160;MOV to CR&#160;instruction; see&#160;<a href="o_fe12b1e2a880e0ce-117.html">Section 4.4.1.&#160;<br/></a>Those loads&#160;of guest&#160;PDPTEs&#160;are treated&#160;as reads and&#160;do&#160;not&#160;cause&#160;the processor to&#160;set the&#160;dirty&#160;flag in&#160;any&#160;EPT&#160;<br/>paging-structure entry.)<br/>These flags are “sticky,” meaning&#160;that,&#160;once set, the&#160;processor&#160;does not clear them; only software&#160;can clear them.<br/>A&#160;processor&#160;may cache&#160;information&#160;from the&#160;EPT&#160;paging-structure entries&#160;in TLBs and&#160;paging-structure caches&#160;<br/>(see&#160;<a href="o_fe12b1e2a880e0ce-1161.html">Section&#160;28.3). This&#160;</a>fact implies that, if software&#160;changes an&#160;accessed&#160;flag or&#160;a dirty flag&#160;from&#160;1 to&#160;0,&#160;the&#160;<br/>processor might not set the corresponding bit in memory on&#160;a subsequent access using an affected&#160;guest-physical&#160;<br/>address.</p>
<p style="position:absolute;top:868px;left:69px;white-space:nowrap" class="ft03">28.2.5 Page-Modification&#160;</p>
<p style="position:absolute;top:868px;left:300px;white-space:nowrap" class="ft03">Logging</p>
<p style="position:absolute;top:898px;left:69px;white-space:nowrap" class="ft05">When accessed&#160;and dirty flags&#160;for&#160;EPT&#160;are enabled, software&#160;can track&#160;writes&#160;to guest-physical&#160;addresses&#160;using a&#160;<br/>feature called&#160;<b>page-modification logging</b>.<br/>Software&#160;can enable&#160;page-modification logging&#160;by&#160;setting&#160;the “enable PML”&#160;VM-execution control (see&#160;<a href="o_fe12b1e2a880e0ce-1057.html">Table&#160;24-7</a>&#160;<br/><a href="o_fe12b1e2a880e0ce-1055.html">in Section 24.6.2).&#160;</a>When this control is&#160;1,&#160;the processor adds&#160;entries to&#160;the&#160;<b>page-modification log</b>&#160;as described&#160;<br/>below.&#160;The page-modification log&#160;is a 4-KByte region of memory&#160;located at&#160;the physical address in the&#160;PML address&#160;<br/>VM-execution&#160;control&#160;field. The page-modification log&#160;consists of 512&#160;64-bit entries;&#160;the&#160;PML index&#160;VM-execution&#160;<br/>control&#160;field&#160;indicates&#160;the&#160;next&#160;entry to use.<br/>Before&#160;allowing a guest-physical&#160;access, the processor may determine&#160;that it first&#160;needs to&#160;set&#160;an accessed or&#160;dirty&#160;<br/><a href="o_fe12b1e2a880e0ce-1159.html">flag for EPT (see Section 28.2.4).</a>&#160;When&#160;this&#160;happens, the processor&#160;examines&#160;the PML&#160;index. If the&#160;PML index is&#160;</p>
</div>
</body>
</html>
