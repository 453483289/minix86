<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1259</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:18px;font-family:Times;color:#000000;}
	.ft07{font-size:12px;font-family:Times;color:#0860a8;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:20px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1259-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1259.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:769px;white-space:nowrap" class="ft00">Vol. 3C&#160;34-9</p>
<p style="position:absolute;top:47px;left:666px;white-space:nowrap" class="ft01">SYSTEM&#160;MANAGEMENT&#160;MODE</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08">For systems that explicitly flush the&#160;caches upon entering&#160;SMM (the third method described above), the&#160;cache flush&#160;<br/>can be&#160;accomplished by asserting the&#160;FLUSH# pin&#160;at the&#160;same&#160;time&#160;as&#160;the request to&#160;enter&#160;SMM (generally initi-<br/>ated by asserting the&#160;SMI# pin). The&#160;priorities&#160;of&#160;the&#160;FLUSH# and SMI# pins&#160;are such that the&#160;FLUSH# is serviced&#160;<br/>first. To&#160;guarantee this behavior, the processor requires that the following&#160;constraints on the&#160;interaction of FLUSH#&#160;<br/>and SMI# be&#160;met.&#160;In&#160;a system where&#160;the FLUSH# and&#160;SMI#&#160;pins are&#160;synchronous and&#160;the set up&#160;and hold&#160;times&#160;<br/>are met, then&#160;the FLUSH# and&#160;SMI#&#160;pins may be asserted&#160;in the&#160;same clock.&#160;In&#160;asynchronous&#160;systems, the&#160;<br/>FLUSH# pin&#160;must&#160;be&#160;asserted at least one clock before the SMI# pin to&#160;guarantee that&#160;the FLUSH#&#160;pin&#160;is serviced&#160;<br/>first.&#160;<br/>Upon leaving SMM (for systems that explicitly&#160;flush the caches), the&#160;WBINVD&#160;instruction should be&#160;executed prior&#160;<br/>to leaving&#160;SMM to&#160;flush the caches.</p>
<p style="position:absolute;top:291px;left:428px;white-space:nowrap" class="ft03">NOTES</p>
<p style="position:absolute;top:316px;left:122px;white-space:nowrap" class="ft08">In systems&#160;based on the&#160;Pentium&#160;processor&#160;that use&#160;the FLUSH#&#160;pin to&#160;write&#160;back and invalidate&#160;<br/>cache contents&#160;before entering SMM,&#160;the&#160;processor will prefetch at least one&#160;cache line in between&#160;<br/>when the Flush Acknowledge cycle is run and the subsequent recognition of SMI#&#160;and the assertion&#160;<br/>of SMIACT#.&#160;<br/>It is&#160;the obligation of the&#160;system&#160;to&#160;ensure that&#160;these&#160;lines are&#160;not cached by returning&#160;KEN#&#160;<br/>inactive&#160;to&#160;the Pentium processor.</p>
<p style="position:absolute;top:441px;left:69px;white-space:nowrap" class="ft03">34.4.2.1 &#160;&#160;System&#160;Management&#160;Range Registers (SMRR)</p>
<p style="position:absolute;top:469px;left:69px;white-space:nowrap" class="ft08">SMI handler code and&#160;data stored by SMM code resides in&#160;SMRAM. The SMRR&#160;interface is an enhancement&#160;in Intel&#160;<br/>64 architecture to&#160;limit&#160;cacheable reference of&#160;addresses&#160;in SMRAM to code running&#160;in&#160;SMM.&#160;The&#160;SMRR interface&#160;<br/>can be configured&#160;only&#160;by code running in SMM.&#160;Details&#160;of&#160;SMRR is&#160;desc<a href="o_fe12b1e2a880e0ce-437.html">ribed in Section 11.11.2.4.</a></p>
<p style="position:absolute;top:546px;left:69px;white-space:nowrap" class="ft04">34.5&#160;</p>
<p style="position:absolute;top:546px;left:148px;white-space:nowrap" class="ft04">SMI HANDLER EXECUTION ENVIRONMENT</p>
<p style="position:absolute;top:582px;left:69px;white-space:nowrap" class="ft08"><a href="o_fe12b1e2a880e0ce-1259.html">Section 34.5.1 de</a>scribes the initial execution environment&#160;for an SMI handler.&#160;An SMI&#160;handler may re-configure its&#160;<br/>execution&#160;environment to&#160;other supported&#160;oper<a href="o_fe12b1e2a880e0ce-1260.html">ating modes. Section&#160;34.5.2&#160;</a>discusses modifications an&#160;SMI&#160;<br/>handler can&#160;make&#160;to&#160;its execution&#160;environment.</p>
<p style="position:absolute;top:665px;left:69px;white-space:nowrap" class="ft05">34.5.1&#160;</p>
<p style="position:absolute;top:665px;left:149px;white-space:nowrap" class="ft05">Initial SMM Execution Environment</p>
<p style="position:absolute;top:696px;left:69px;white-space:nowrap" class="ft08">After saving the current context of&#160;the processor,&#160;the processor initializes its&#160;core registers to the&#160;values&#160;shown in&#160;<br/><a href="o_fe12b1e2a880e0ce-1259.html">Table 34-4</a>.&#160;Upon&#160;entering SMM,&#160;the PE&#160;and&#160;PG&#160;flags&#160;in control&#160;register CR0 are cleared,&#160;which places the processor&#160;<br/>in&#160;an environment similar&#160;to real-address mode.&#160;The differences between the SMM execution environment&#160;and&#160;the&#160;<br/>real-address mode&#160;execution environment&#160;are as&#160;follows:</p>
<p style="position:absolute;top:767px;left:69px;white-space:nowrap" class="ft06">•</p>
<p style="position:absolute;top:768px;left:95px;white-space:nowrap" class="ft02">The&#160;addressable&#160;address&#160;space&#160;ranges&#160;from 0&#160;to&#160;FFFFFFFFH (4 GBytes).&#160;</p>
<p style="position:absolute;top:790px;left:69px;white-space:nowrap" class="ft06">•</p>
<p style="position:absolute;top:790px;left:95px;white-space:nowrap" class="ft02">The&#160;normal&#160;64-KByte segment limit&#160;for&#160;real-address mode&#160;is increased&#160;to 4&#160;GBytes.</p>
<p style="position:absolute;top:812px;left:69px;white-space:nowrap" class="ft06">•</p>
<p style="position:absolute;top:813px;left:95px;white-space:nowrap" class="ft08">The&#160;default operand and address&#160;sizes are set to 16 bits, which restricts the addressable SMRAM address space&#160;<br/>to&#160;the&#160;1-MByte&#160;real-address mode&#160;limit for native real-address-mode&#160;code.&#160;However,&#160;operand-size and&#160;<br/>address-size override&#160;prefixes&#160;can be used&#160;to&#160;access the&#160;address space&#160;beyond the&#160;1-MByte.</p>
<p style="position:absolute;top:877px;left:279px;white-space:nowrap" class="ft07">Table 34-4. &#160;Processor Register&#160;Initialization in SMM</p>
<p style="position:absolute;top:901px;left:76px;white-space:nowrap" class="ft02">Register</p>
<p style="position:absolute;top:901px;left:375px;white-space:nowrap" class="ft02">Contents</p>
<p style="position:absolute;top:929px;left:76px;white-space:nowrap" class="ft02">General-purpose&#160;registers</p>
<p style="position:absolute;top:929px;left:375px;white-space:nowrap" class="ft02">Undefined</p>
<p style="position:absolute;top:953px;left:76px;white-space:nowrap" class="ft02">EFLAGS</p>
<p style="position:absolute;top:953px;left:375px;white-space:nowrap" class="ft02">00000002H</p>
<p style="position:absolute;top:977px;left:76px;white-space:nowrap" class="ft02">EIP</p>
<p style="position:absolute;top:977px;left:375px;white-space:nowrap" class="ft02">00008000H</p>
<p style="position:absolute;top:1001px;left:76px;white-space:nowrap" class="ft02">CS selector</p>
<p style="position:absolute;top:1001px;left:375px;white-space:nowrap" class="ft02">SMM Base&#160;shifted&#160;right 4&#160;bits&#160;(default&#160;3000H)</p>
<p style="position:absolute;top:1025px;left:76px;white-space:nowrap" class="ft02">CS base</p>
<p style="position:absolute;top:1025px;left:375px;white-space:nowrap" class="ft02">SMM Base&#160;(default&#160;30000H)</p>
<p style="position:absolute;top:1049px;left:76px;white-space:nowrap" class="ft02">DS, ES,&#160;FS, GS, SS&#160;Selectors</p>
<p style="position:absolute;top:1049px;left:375px;white-space:nowrap" class="ft02">0000H</p>
</div>
</body>
</html>
