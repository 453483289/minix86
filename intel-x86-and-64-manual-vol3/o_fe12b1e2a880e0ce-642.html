<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 642</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page642-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce642.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">18-6&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft07">This&#160;event counts mispredicted branch instructions at retirement. It&#160;counts the retirement of the last&#160;micro-op&#160;<br/>of&#160;a branch instruction in the&#160;architectural&#160;path&#160;of&#160;execution&#160;and&#160;experienced misprediction in the branch&#160;<br/>prediction hardware.&#160;<br/>Branch&#160;prediction hardware is&#160;implementation-specific&#160;across microarchitectures;&#160;value comparison&#160;to&#160;<br/>estimate&#160;performance&#160;differences&#160;is not recommended.&#160;</p>
<p style="position:absolute;top:207px;left:432px;white-space:nowrap" class="ft03">NOTE</p>
<p style="position:absolute;top:232px;left:120px;white-space:nowrap" class="ft07">Programming&#160;decisions or&#160;software&#160;precisians on&#160;functionality should&#160;not&#160;be&#160;based on the event&#160;<br/>values or dependent on&#160;the existence of&#160;performance&#160;monitoring&#160;events.</p>
<p style="position:absolute;top:299px;left:68px;white-space:nowrap" class="ft04">18.2.2&#160;</p>
<p style="position:absolute;top:299px;left:148px;white-space:nowrap" class="ft04">Architectural Performance Monitoring Version 2</p>
<p style="position:absolute;top:330px;left:68px;white-space:nowrap" class="ft02">The&#160;enhanced&#160;features&#160;provided&#160;by&#160;architectural&#160;performance monitoring&#160;version 2&#160;include&#160;the following:</p>
<p style="position:absolute;top:352px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:352px;left:93px;white-space:nowrap" class="ft07"><b>Fixed-function performance&#160;counter register and&#160;associated control register</b>&#160;— Three&#160;of the&#160;architec-<br/>tural&#160;performance events&#160;are counted&#160;using&#160;three&#160;fixed-function&#160;MSRs (IA32_FIXED_CTR0 through&#160;<br/>IA32_FIXED_CTR2).&#160;Each of the&#160;fixed-function&#160;PMC can count only one&#160;architectural&#160;performance event.&#160;<br/>Configuring the fixed-function PMCs&#160;is done&#160;by writing&#160;to&#160;bit fields in the MSR (IA32_FIXED_CTR_CTRL) located&#160;<br/>at&#160;address 38DH.&#160;Unlike&#160;configuring performance&#160;events for general-purpose&#160;PMCs (IA32_PMCx)&#160;via UMASK&#160;<br/>field in (IA32_PERFEVTSELx),&#160;configuring,&#160;programming&#160;IA32_FIXED_CTR_CTRL&#160;for fixed-function PMCs&#160;do&#160;<br/>not require&#160;any&#160;UMASK.</p>
<p style="position:absolute;top:479px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:480px;left:93px;white-space:nowrap" class="ft09"><b>Simplified event&#160;programming</b>&#160;—&#160;Most frequent&#160;operation in&#160;programming performance&#160;events are&#160;<br/>enabling/disabling&#160;event counting and&#160;checking the status&#160;of counter overflows. Architectural performance&#160;<br/>event version 2&#160;provides&#160;three&#160;architectural&#160;MSRs:<br/>—&#160;IA32_PERF_GLOBAL_CTRL&#160;allows software&#160;to enable/disable&#160;event counting of all&#160;or any&#160;combination of&#160;</p>
<p style="position:absolute;top:553px;left:119px;white-space:nowrap" class="ft02">fixed-function PMCs (IA32_FIXED_CTRx)&#160;or any general-purpose PMCs via a&#160;single&#160;WRMSR.</p>
<p style="position:absolute;top:577px;left:93px;white-space:nowrap" class="ft02">—&#160;IA32_PERF_GLOBAL_STATUS allows software&#160;to query&#160;counter overflow&#160;conditions&#160;on any&#160;combination&#160;of&#160;</p>
<p style="position:absolute;top:594px;left:119px;white-space:nowrap" class="ft02">fixed-function PMCs or general-purpose&#160;PMCs via&#160;a single RDMSR.</p>
<p style="position:absolute;top:618px;left:93px;white-space:nowrap" class="ft02">—&#160;IA32_PERF_GLOBAL_OVF_CTRL&#160;allows software to&#160;clear&#160;counter overflow conditions on any combination of&#160;</p>
<p style="position:absolute;top:634px;left:119px;white-space:nowrap" class="ft02">fixed-function PMCs or general-purpose&#160;PMCs via&#160;a single WRMSR.</p>
<p style="position:absolute;top:656px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:657px;left:93px;white-space:nowrap" class="ft09"><b>PMI Overhead Mitigation&#160;</b>— Architectural performance monitoring version 2&#160;introduces&#160;two&#160;bit&#160;field&#160;interface&#160;<br/>in&#160;IA32_DEBUGCTL for PMI service routine&#160;to&#160;accumulate&#160;performance&#160;monitoring&#160;data&#160;and LBR records with&#160;<br/>reduced&#160;perturbation&#160;from servicing&#160;the&#160;PMI.&#160;The two bit fields&#160;are:<br/>—&#160;IA32_DEBUGCTL.Freeze_LBR_On_PMI(bit 11).&#160;In architectural performance&#160;monitoring version&#160;2, only the&#160;</p>
<p style="position:absolute;top:730px;left:119px;white-space:nowrap" class="ft07">legacy semantic&#160;behavior is&#160;supported.&#160;See<a href="o_fe12b1e2a880e0ce-588.html">&#160;Section 17.4.7 for de</a>tails&#160;of&#160;the legacy Freeze LBRs on PMI&#160;<br/>control.</p>
<p style="position:absolute;top:771px;left:93px;white-space:nowrap" class="ft02">—&#160;IA32_DEBUGCTL.Freeze_PerfMon_On_PMI(bit 12). In architectural performance&#160;monitoring version 2, only&#160;</p>
<p style="position:absolute;top:787px;left:119px;white-space:nowrap" class="ft07">the&#160;legacy semantic beha<a href="o_fe12b1e2a880e0ce-588.html">vior is supported. See Section 17.4.7 for details</a>&#160;of the&#160;legacy Freeze&#160;LBRs on PMI&#160;<br/>control.</p>
<p style="position:absolute;top:828px;left:68px;white-space:nowrap" class="ft07">The facilities&#160;provided by architectural performance&#160;monitoring version 2 can be queried&#160;from&#160;CPUID leaf&#160;0AH&#160;by&#160;<br/>examining&#160;the&#160;content of register&#160;EDX:</p>
<p style="position:absolute;top:866px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:867px;left:93px;white-space:nowrap" class="ft07">Bits 0 through 4&#160;of&#160;CPUID.0AH.EDX indicates&#160;the number&#160;of&#160;fixed-function performance counters available per&#160;<br/>core,</p>
<p style="position:absolute;top:905px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:906px;left:93px;white-space:nowrap" class="ft07">Bits&#160;5 through 12 of CPUID.0AH.EDX&#160;indicates&#160;the bit-width of&#160;fixed-function performance&#160;counters.&#160;Bits&#160;<br/>beyond&#160;the width of&#160;the fixed-function counter&#160;are&#160;reserved&#160;and must be written&#160;as&#160;zeros.</p>
<p style="position:absolute;top:955px;left:434px;white-space:nowrap" class="ft02">NOTE</p>
<p style="position:absolute;top:976px;left:120px;white-space:nowrap" class="ft07">Early generation of processors based&#160;on Intel&#160;Core&#160;microarchitecture may report in&#160;<br/>CPUID.0AH:EDX of&#160;support for&#160;version 2 but&#160;indicating incorrect&#160;information of version 2&#160;facilities.</p>
<p style="position:absolute;top:1015px;left:93px;white-space:nowrap" class="ft07">The&#160;IA32_FIXED_CTR_CTRL&#160;MSR include multiple sets&#160;of 4-bit&#160;field,&#160;each 4 bit&#160;field&#160;controls the operation of a&#160;<br/>fixed-function performance&#160;counter.<a href="o_fe12b1e2a880e0ce-643.html">&#160;Figure&#160;18-2 shows the&#160;</a>layout of 4-bit controls for each&#160;fixed-function&#160;PMC.&#160;<br/>Two sub-fields are currently defined within each&#160;control. The&#160;definitions of the bit&#160;fields&#160;are:</p>
</div>
</body>
</html>
