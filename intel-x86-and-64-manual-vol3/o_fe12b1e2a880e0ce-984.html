<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 984</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page984-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce984.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">20-8&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">8086&#160;EMULATION</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft05">When running multiple virtual-8086-mode&#160;tasks. Here,&#160;paging&#160;allows the&#160;lower 1&#160;MByte&#160;of the&#160;linear address&#160;<br/>space for each virtual-8086-mode task&#160;to be&#160;mapped&#160;to a&#160;different physical address&#160;location.</p>
<p style="position:absolute;top:139px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:139px;left:93px;white-space:nowrap" class="ft05">When&#160;emulating the&#160;8086 address-wraparound that&#160;occurs at&#160;1 MByte.&#160;When&#160;using 8086-style&#160;address&#160;trans-<br/>lation, it is possible to&#160;specify addresses&#160;larger than 1&#160;MByte.&#160;These addresses&#160;automatically wraparound in&#160;the&#160;<br/>Intel&#160;8086&#160;processor (s<a href="o_fe12b1e2a880e0ce-978.html">ee Section 20.1.1,&#160;“Address Translation&#160;in&#160;Real-Address Mode”).</a>&#160;If&#160;any 8086 programs&#160;<br/>depend&#160;on address wraparound, the same&#160;effect&#160;can be&#160;achieved&#160;in&#160;a&#160;virtual-8086-mode task by mapping the&#160;<br/>linear addresses between 100000H&#160;and&#160;110000H and&#160;linear&#160;addresses between 0&#160;and&#160;10000H to the&#160;same&#160;<br/>physical addresses.</p>
<p style="position:absolute;top:244px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:244px;left:93px;white-space:nowrap" class="ft05">When sharing&#160;the 8086&#160;operating-system services&#160;or&#160;ROM code that is&#160;common&#160;to several&#160;8086 programs&#160;<br/>running&#160;as&#160;different 8086-mode tasks.</p>
<p style="position:absolute;top:283px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:283px;left:93px;white-space:nowrap" class="ft03">When redirecting&#160;or trapping&#160;references&#160;to memory-mapped I/O&#160;devices.</p>
<p style="position:absolute;top:334px;left:68px;white-space:nowrap" class="ft04">20.2.4&#160;</p>
<p style="position:absolute;top:334px;left:148px;white-space:nowrap" class="ft04">Protection within a Virtual-8086 Task</p>
<p style="position:absolute;top:364px;left:68px;white-space:nowrap" class="ft05">Protection&#160;is not enforced&#160;between the&#160;segments&#160;of&#160;an&#160;8086&#160;program.&#160;Either&#160;of&#160;the following&#160;techniques&#160;can be&#160;<br/>used to&#160;protect&#160;the system&#160;software running in&#160;a virtual-8086-mode&#160;task&#160;from&#160;the 8086 program:</p>
<p style="position:absolute;top:403px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:403px;left:93px;white-space:nowrap" class="ft05">Reserve the&#160;first 1&#160;MByte plus 64&#160;KBytes&#160;of each&#160;task’s&#160;linear&#160;address space&#160;for&#160;the&#160;8086&#160;program.&#160;An&#160;8086&#160;<br/>processor task cannot generate&#160;addresses outside&#160;this range.</p>
<p style="position:absolute;top:442px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:442px;left:93px;white-space:nowrap" class="ft05">Use the&#160;U/S flag&#160;of&#160;page-table entries&#160;to protect the&#160;virtual-8086 monitor and&#160;other system&#160;software&#160;in the&#160;<br/>virtual-8086 mode&#160;task space.&#160;When&#160;the&#160;processor is&#160;in&#160;virtual-8086&#160;mode,&#160;the&#160;CPL&#160;is 3.&#160;Therefore,&#160;an 8086&#160;<br/>processor program has only user privileges. If the&#160;pages of the virtual-8086 monitor have&#160;supervisor privilege,&#160;<br/>they cannot&#160;be&#160;accessed&#160;by the&#160;8086 program.</p>
<p style="position:absolute;top:542px;left:68px;white-space:nowrap" class="ft04">20.2.5&#160;</p>
<p style="position:absolute;top:542px;left:148px;white-space:nowrap" class="ft04">Entering Virtual-8086 Mode</p>
<p style="position:absolute;top:573px;left:68px;white-space:nowrap" class="ft05"><a href="o_fe12b1e2a880e0ce-985.html">Figure&#160;20-3&#160;</a>summarizes&#160;the methods of entering and&#160;leaving virtual-8086 mode.&#160;The&#160;processor switches&#160;to&#160;<br/>virtual-8086&#160;mode&#160;in either&#160;of the&#160;following situations:</p>
<p style="position:absolute;top:611px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:612px;left:93px;white-space:nowrap" class="ft07">Task switch when&#160;the&#160;VM&#160;flag is&#160;set&#160;to 1&#160;in the&#160;EFLAGS&#160;register image stored in&#160;the TSS for the&#160;task.&#160;Here the&#160;<br/>task switch can&#160;be&#160;initiated&#160;in either&#160;of two ways:<br/>—&#160;A&#160;CALL&#160;or JMP instruction.<br/>—&#160;An IRET&#160;instruction,&#160;where&#160;the NT&#160;flag&#160;in the&#160;EFLAGS image&#160;is&#160;set to&#160;1.</p>
<p style="position:absolute;top:698px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:699px;left:93px;white-space:nowrap" class="ft05">Return from&#160;a protected-mode&#160;interrupt or exception&#160;handler when the&#160;VM flag&#160;is set to 1 in the EFLAGS&#160;<br/>register image&#160;on the&#160;stack.</p>
<p style="position:absolute;top:739px;left:68px;white-space:nowrap" class="ft05">When&#160;a task&#160;switch&#160;is used&#160;to enter virtual-8086 mode,&#160;the TSS for the&#160;virtual-8086-mode task&#160;must&#160;be&#160;a 32-bit&#160;<br/>TSS.&#160;(If the new&#160;TSS is a 16-bit TSS,&#160;the upper word of the EFLAGS register is not&#160;in&#160;the TSS,&#160;causing the&#160;processor&#160;<br/>to clear the&#160;VM&#160;flag when it&#160;loads&#160;the EFLAGS&#160;register.)&#160;The processor updates&#160;the VM flag prior&#160;to loading the&#160;<br/>segment registers&#160;from&#160;their images in&#160;the&#160;new TSS.&#160;The&#160;new&#160;setting&#160;of&#160;the VM&#160;flag&#160;determines whether the&#160;<br/>processor interprets&#160;the contents&#160;of&#160;the segment registers as&#160;8086-style segment selectors&#160;or&#160;protected-mode&#160;<br/>segment selectors.&#160;When&#160;the VM flag&#160;is set,&#160;the segment registers&#160;are loaded&#160;from&#160;the TSS,&#160;using&#160;8086-style&#160;<br/>address translation&#160;to form base&#160;addresses.&#160;<br/>Se<a href="o_fe12b1e2a880e0ce-987.html">e&#160;Section&#160;20.3, “Interrupt&#160;and Exception Handling in&#160;Virtual-8086&#160;Mode”, for information&#160;</a>on entering virtual-<br/>8086 mode on a&#160;return from&#160;an interrupt&#160;or exception&#160;handler.</p>
</div>
</body>
</html>
