<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1762</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1762-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1762.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">36-78&#160;Vol. 3C</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">INTEL¬Æ PROCESSOR TRACE</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02"><a href="o_fe12b1e2a880e0ce-1762.html">In Table&#160;36-52,</a>&#160;PktEn is&#160;evaluated&#160;based&#160;on (TiggerEn &amp;&#160;ContextEn &amp; FilterEn&#160;&amp; BranchEn&#160;&amp; PTWEn).</p>
<p style="position:absolute;top:447px;left:68px;white-space:nowrap" class="ft03">36.8 SOFTWARE&#160;</p>
<p style="position:absolute;top:447px;left:257px;white-space:nowrap" class="ft03">CONSIDERATIONS</p>
<p style="position:absolute;top:509px;left:68px;white-space:nowrap" class="ft04">36.8.1&#160;</p>
<p style="position:absolute;top:509px;left:148px;white-space:nowrap" class="ft04">Tracing SMM Code</p>
<p style="position:absolute;top:538px;left:68px;white-space:nowrap" class="ft08">Nothing prevents an SMM&#160;handler from&#160;configuring&#160;and enabling packet&#160;generation for&#160;its own use.&#160;As described in&#160;<br/><a href="o_fe12b1e2a880e0ce-1708.html">Section&#160;</a>,&#160;SMI will always clear TraceEn,&#160;so the&#160;SMM handler would have&#160;to set TraceEn in&#160;order to&#160;enable&#160;tracing.&#160;<br/>There are some&#160;unique aspects and guidelines&#160;involved with&#160;tracing&#160;SMM code, which&#160;follows:<br/>1.&#160;SMM should save&#160;away&#160;the existing values of&#160;any&#160;configuration MSRs that SMM intends to modify for tracing.</p>
<p style="position:absolute;top:612px;left:93px;white-space:nowrap" class="ft02">This will&#160;allow the non-SMM&#160;tracing context&#160;to be&#160;restored&#160;before RSM.&#160;</p>
<p style="position:absolute;top:636px;left:68px;white-space:nowrap" class="ft02">2.&#160;It is recommended that SMM&#160;wait until it&#160;sets&#160;CSbase&#160;to 0 before&#160;enabling&#160;packet generation, to&#160;avoid&#160;possible&#160;</p>
<p style="position:absolute;top:652px;left:93px;white-space:nowrap" class="ft02">LIP&#160;vs RIP confusion.&#160;</p>
<p style="position:absolute;top:676px;left:68px;white-space:nowrap" class="ft08">3.&#160;Packet&#160;output cannot be&#160;directed&#160;to&#160;SMRR&#160;memory,&#160;even&#160;while&#160;tracing&#160;in SMM.&#160;<br/>4.&#160;Before performing&#160;RSM,&#160;SMM&#160;should take&#160;care to&#160;restore&#160;modified&#160;configuration MSRs to&#160;the values&#160;they had&#160;</p>
<p style="position:absolute;top:717px;left:93px;white-space:nowrap" class="ft07">immediately after #SMI.&#160;This involves first&#160;disabling packet generation by&#160;clearing TraceEn,&#160;then&#160;restoring any&#160;<br/>other&#160;configuration MSRs&#160;that&#160;were&#160;modified.&#160;</p>
<p style="position:absolute;top:757px;left:68px;white-space:nowrap" class="ft02">5.&#160;RSM</p>
<p style="position:absolute;top:781px;left:93px;white-space:nowrap" class="ft02">‚Äî&#160;Software must ensure&#160;that TraceEn=0 at the time&#160;of&#160;RSM.&#160;Tracing&#160;RSM is not a supported usage model, and&#160;</p>
<p style="position:absolute;top:798px;left:119px;white-space:nowrap" class="ft02">the&#160;packets generated&#160;by&#160;RSM&#160;are&#160;undefined.</p>
<p style="position:absolute;top:822px;left:93px;white-space:nowrap" class="ft02">‚Äî&#160;For processors on&#160;which Intel PT and&#160;LBR use are&#160;mutually exclusive&#160;(see<a href="o_fe12b1e2a880e0ce-1713.html">&#160;Section 36.3.1.2), an</a>y&#160;RSM&#160;</p>
<p style="position:absolute;top:838px;left:119px;white-space:nowrap" class="ft02">during which TraceEn is&#160;restored to&#160;1&#160;will&#160;suspend&#160;any LBR or&#160;BTS logging.</p>
<p style="position:absolute;top:889px;left:68px;white-space:nowrap" class="ft04">36.8.2&#160;</p>
<p style="position:absolute;top:889px;left:148px;white-space:nowrap" class="ft04">Cooperative Transition of&#160;Multiple Trace Collection Agents</p>
<p style="position:absolute;top:918px;left:68px;white-space:nowrap" class="ft07">A third-party trace-collection tool&#160;should take&#160;into&#160;consideration&#160;the fact that&#160;it may&#160;be&#160;deployed on&#160;a&#160;processor&#160;<br/>that supports Intel&#160;PT&#160;but may run under&#160;any operating&#160;system.&#160;<br/>In such a deployment scenario,&#160;Intel recommends that tool agents follow similar principles&#160;of cooperative transition&#160;<br/>of&#160;single-use&#160;hardware&#160;resources, similar&#160;to how&#160;performance&#160;monitoring tools handle performance&#160;monitoring&#160;<br/>hardware:</p>
<p style="position:absolute;top:1012px;left:68px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:1012px;left:93px;white-space:nowrap" class="ft07">Respect the ‚Äúin-use‚Äù&#160;ownership of an agent who already&#160;configured the trace configuration MSRs, see architec-<br/>tural&#160;MSRs with the&#160;prefix ‚ÄúIA32_RTIT_‚Äù&#160;<a href="˛ˇ">in Chapter&#160;35,&#160;‚ÄúModel-Specific Registers (MSRs)‚Äù,&#160;</a>where ‚Äúin-use‚Äù&#160;can&#160;<br/>be&#160;determined&#160;by&#160;reading&#160;the&#160;‚Äúenable bits‚Äù&#160;in the&#160;configuration MSRs.</p>
<p style="position:absolute;top:154px;left:151px;white-space:nowrap" class="ft06">Table 36-52.&#160;PwrEvtEn&#160;and&#160;PTWEn Packet&#160;Generation under Different&#160;Enable Conditions</p>
<p style="position:absolute;top:178px;left:82px;white-space:nowrap" class="ft02">Case</p>
<p style="position:absolute;top:178px;left:202px;white-space:nowrap" class="ft02">Operation</p>
<p style="position:absolute;top:178px;left:349px;white-space:nowrap" class="ft02">PktEn&#160;</p>
<p style="position:absolute;top:195px;left:347px;white-space:nowrap" class="ft02">Before</p>
<p style="position:absolute;top:178px;left:402px;white-space:nowrap" class="ft02">PktEn&#160;</p>
<p style="position:absolute;top:195px;left:405px;white-space:nowrap" class="ft02">After</p>
<p style="position:absolute;top:178px;left:452px;white-space:nowrap" class="ft02">CntxEn&#160;</p>
<p style="position:absolute;top:195px;left:457px;white-space:nowrap" class="ft02">After</p>
<p style="position:absolute;top:178px;left:526px;white-space:nowrap" class="ft02">Other Dependencies</p>
<p style="position:absolute;top:178px;left:707px;white-space:nowrap" class="ft02">Packets&#160;Output</p>
<p style="position:absolute;top:218px;left:74px;white-space:nowrap" class="ft02">16.24a</p>
<p style="position:absolute;top:218px;left:132px;white-space:nowrap" class="ft02">PTWRITE rm32/64, no&#160;fault</p>
<p style="position:absolute;top:218px;left:345px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:218px;left:401px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:218px;left:452px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:218px;left:680px;white-space:nowrap" class="ft02">None</p>
<p style="position:absolute;top:243px;left:74px;white-space:nowrap" class="ft02">16.24b</p>
<p style="position:absolute;top:243px;left:132px;white-space:nowrap" class="ft02">PTWRITE rm32/64, no&#160;fault</p>
<p style="position:absolute;top:243px;left:345px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:243px;left:401px;white-space:nowrap" class="ft02">0</p>
<p style="position:absolute;top:243px;left:452px;white-space:nowrap" class="ft02">0</p>
<p style="position:absolute;top:243px;left:680px;white-space:nowrap" class="ft02">None</p>
<p style="position:absolute;top:267px;left:74px;white-space:nowrap" class="ft02">16.24d</p>
<p style="position:absolute;top:267px;left:132px;white-space:nowrap" class="ft02">PTWRITE rm32,&#160;no&#160;fault</p>
<p style="position:absolute;top:267px;left:345px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:267px;left:402px;white-space:nowrap" class="ft02">1</p>
<p style="position:absolute;top:267px;left:452px;white-space:nowrap" class="ft02">1</p>
<p style="position:absolute;top:267px;left:507px;white-space:nowrap" class="ft02">*&#160;FUP,&#160;IP=1 if FUPonPTW=1&#160;PTW(IP=1?,&#160;4B,&#160;</p>
<p style="position:absolute;top:283px;left:680px;white-space:nowrap" class="ft02">rm32_value),&#160;FUP(CLIP)?</p>
<p style="position:absolute;top:307px;left:74px;white-space:nowrap" class="ft02">16.24e</p>
<p style="position:absolute;top:307px;left:132px;white-space:nowrap" class="ft02">PTWRITE rm64,&#160;no&#160;fault</p>
<p style="position:absolute;top:307px;left:345px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:307px;left:402px;white-space:nowrap" class="ft02">1</p>
<p style="position:absolute;top:307px;left:452px;white-space:nowrap" class="ft02">1</p>
<p style="position:absolute;top:307px;left:507px;white-space:nowrap" class="ft02">*&#160;FUP,&#160;IP=1 if FUPonPTW=1&#160;PTW(IP=1?,&#160;8B,&#160;</p>
<p style="position:absolute;top:324px;left:680px;white-space:nowrap" class="ft02">rm64_value),&#160;FUP(CLIP)?</p>
<p style="position:absolute;top:348px;left:74px;white-space:nowrap" class="ft02">16.25a</p>
<p style="position:absolute;top:348px;left:132px;white-space:nowrap" class="ft02">PTWRITE mem32/64, fault</p>
<p style="position:absolute;top:348px;left:345px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:348px;left:402px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:348px;left:452px;white-space:nowrap" class="ft02">dc</p>
<p style="position:absolute;top:348px;left:680px;white-space:nowrap" class="ft02">See&#160;‚ÄúException/fault‚Äù&#160;</p>
<p style="position:absolute;top:364px;left:680px;white-space:nowrap" class="ft02">(cases 13[a-z<a href="o_fe12b1e2a880e0ce-1749.html">] in Table&#160;</a></p>
<p style="position:absolute;top:381px;left:680px;white-space:nowrap" class="ft02"><a href="o_fe12b1e2a880e0ce-1749.html">36-50) f</a>or BranchEn&#160;</p>
<p style="position:absolute;top:397px;left:680px;white-space:nowrap" class="ft02">packets.</p>
</div>
</body>
</html>
