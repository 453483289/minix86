<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 151</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page151-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce151.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:767px;white-space:nowrap" class="ft00">Vol. 3A&#160;4-47</p>
<p style="position:absolute;top:47px;left:793px;white-space:nowrap" class="ft01">PAGING</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft05">VPIDs provide a way for software to identify to the processor the&#160;address&#160;spaces&#160;for&#160;different “virtual&#160;processors.”&#160;<br/>The processor may&#160;use this&#160;identification&#160;to&#160;maintain&#160;concurrently&#160;information for multiple address&#160;spaces&#160;in its&#160;<br/>TLBs and&#160;paging-structure caches, even&#160;when&#160;non-zero&#160;PCIDs are not being&#160;used. See&#160;<a href="o_fe12b1e2a880e0ce-1149.html">Section&#160;28.1 for</a>&#160;details.<br/>When EPT is&#160;in&#160;use, the&#160;addresses in&#160;the paging-structures&#160;are not&#160;used&#160;as&#160;physical&#160;addresses&#160;to access memory&#160;<br/>and memory-mapped&#160;I/O.&#160;Instead,&#160;they&#160;are treated&#160;as&#160;<b>guest-physical</b>&#160;addresses&#160;and are translated through&#160;a&#160;<br/>set of EPT paging&#160;structures to produce physical addresses. EPT can also specify its own access&#160;rights and&#160;memory&#160;<br/>typing; these are&#160;used&#160;on&#160;conjunction with those&#160;specified&#160;in this chapter.&#160;See<a href="o_fe12b1e2a880e0ce-1149.html">&#160;Section 28.2&#160;</a>for more information.<br/>Both&#160;VPIDs&#160;and EPT may&#160;change the way that a&#160;processor maintains information&#160;in TLBs and&#160;paging structure&#160;<br/>caches and the&#160;ways&#160;in which&#160;software can&#160;manage that&#160;information. Some of&#160;the&#160;behaviors documented in&#160;<br/><a href="o_fe12b1e2a880e0ce-139.html">Section&#160;4.10&#160;</a>may change.&#160;See<a href="o_fe12b1e2a880e0ce-1161.html">&#160;Section 28.3</a>&#160;for details.</p>
<p style="position:absolute;top:319px;left:69px;white-space:nowrap" class="ft04">4.12&#160;</p>
<p style="position:absolute;top:319px;left:148px;white-space:nowrap" class="ft04">USING PAGING FOR VIRTUAL MEMORY</p>
<p style="position:absolute;top:355px;left:69px;white-space:nowrap" class="ft05">With&#160;paging,&#160;portions of&#160;the linear-address space need&#160;not&#160;be&#160;mapped to&#160;the physical-address&#160;space; data for&#160;the&#160;<br/>unmapped addresses&#160;can&#160;be&#160;stored externally (e.g.,&#160;on&#160;disk). This&#160;method of mapping the&#160;linear-address space is&#160;<br/>referred to as&#160;virtual memory&#160;or&#160;demand-paged virtual memory.<br/>Paging divides the&#160;linear address&#160;space into fixed-size&#160;pages that can&#160;be&#160;mapped into&#160;the&#160;physical-address&#160;space&#160;<br/>and/or external storage. When&#160;a program (or task) references&#160;a linear address, the processor uses paging to trans-<br/>late&#160;the&#160;linear&#160;address into&#160;a corresponding physical address&#160;if such an address&#160;is defined.<br/>If&#160;the page&#160;containing&#160;the linear address&#160;is not currently mapped&#160;into the&#160;physical-address space,&#160;the&#160;processor&#160;<br/>generates&#160;a page-fault exception as&#160;de<a href="o_fe12b1e2a880e0ce-135.html">scribed in Section 4.7.</a>&#160;The handler for page-fault exceptions&#160;typically&#160;<br/>directs&#160;the operating&#160;system or executive&#160;to load&#160;data&#160;for&#160;the&#160;unmapped&#160;page&#160;from external&#160;storage into physical&#160;<br/>memory (perhaps writing&#160;a different&#160;page from&#160;physical&#160;memory out to&#160;external storage&#160;in the&#160;process)&#160;and to&#160;<br/>map&#160;it&#160;using paging&#160;(by updating the paging structures).&#160;When the page&#160;has been&#160;loaded&#160;into physical memory,&#160;a&#160;<br/>return&#160;from the exception handler causes&#160;the instruction&#160;that&#160;generated&#160;the exception&#160;to be restarted.<br/>Paging differs from segmentation through its use of fixed-size pages. Unlike&#160;segments, which usually are the same&#160;<br/>size as the code or data structures they hold, pages have&#160;a fixed size. If segmentation&#160;is the only form of&#160;address&#160;<br/>translation&#160;used, a data structure present&#160;in physical memory&#160;will have&#160;all of&#160;its&#160;parts&#160;in memory.&#160;If paging is used,&#160;<br/>a data structure&#160;can&#160;be&#160;partly in&#160;memory&#160;and partly&#160;in disk&#160;storage.</p>
<p style="position:absolute;top:681px;left:69px;white-space:nowrap" class="ft04">4.13&#160;</p>
<p style="position:absolute;top:681px;left:148px;white-space:nowrap" class="ft04">MAPPING SEGMENTS TO&#160;PAGES</p>
<p style="position:absolute;top:717px;left:69px;white-space:nowrap" class="ft05">The&#160;segmentation and paging&#160;mechanisms provide&#160;support for a&#160;wide&#160;variety&#160;of approaches to&#160;memory manage-<br/>ment.&#160;When segmentation and&#160;paging&#160;are&#160;combined,&#160;segments can&#160;be&#160;mapped&#160;to pages&#160;in several ways.&#160;To&#160;imple-<br/>ment&#160;a flat (unsegmented)&#160;addressing environment, for&#160;example, all&#160;the&#160;code,&#160;data, and&#160;stack modules&#160;can be&#160;<br/>mapped to&#160;one or more&#160;large segments (up&#160;to 4-GBytes)&#160;that&#160;share&#160;same&#160;range of linear addresses&#160;(see&#160;<br/><a href="o_fe12b1e2a880e0ce-91.html">Figure&#160;3-2&#160;in Section 3.2.2). Here, se</a>gments are&#160;essentially&#160;invisible&#160;to&#160;applications&#160;and the&#160;operating-system or&#160;<br/>executive.&#160;If paging is&#160;used,&#160;the&#160;paging&#160;mechanism can&#160;map a&#160;single&#160;linear-address space (contained in&#160;a single&#160;<br/>segment)&#160;into virtual memory. Alternatively,&#160;each program (or&#160;task)&#160;can have&#160;its own large linear-address&#160;space&#160;<br/>(contained&#160;in its&#160;own&#160;segment), which&#160;is mapped&#160;into&#160;virtual memory through its&#160;own&#160;paging&#160;structures.<br/>Segments can&#160;be&#160;smaller than the&#160;size of&#160;a page. If one&#160;of&#160;these segments is&#160;placed in&#160;a&#160;page which is&#160;not&#160;shared&#160;<br/>with another&#160;segment,&#160;the&#160;extra memory is&#160;wasted. For example,&#160;a small data structure,&#160;such&#160;as&#160;a 1-Byte&#160;sema-<br/>phore,&#160;occupies&#160;4&#160;KBytes if it is&#160;placed in a&#160;page by&#160;itself. If&#160;many&#160;semaphores are used,&#160;it is more&#160;efficient to pack&#160;<br/>them into a&#160;single&#160;page.<br/>The&#160;Intel-64&#160;and IA-32 architectures do&#160;not enforce&#160;correspondence&#160;between&#160;the boundaries of pages&#160;and&#160;<br/>segments. A page&#160;can contain the&#160;end&#160;of&#160;one segment and&#160;the beginning&#160;of&#160;another.&#160;Similarly,&#160;a&#160;segment&#160;can&#160;<br/>contain the end&#160;of one&#160;page&#160;and&#160;the&#160;beginning&#160;of&#160;another.<br/>Memory-management&#160;software&#160;may be&#160;simpler and more efficient if&#160;it enforces some alignment&#160;between page&#160;and&#160;<br/>segment&#160;boundaries.&#160;For example,&#160;if&#160;a segment which can fit in one&#160;page is&#160;placed in&#160;two&#160;pages,&#160;there may be&#160;<br/>twice&#160;as much paging overhead&#160;to support access&#160;to that&#160;segment.</p>
</div>
</body>
</html>
