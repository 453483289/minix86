<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 983</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page983-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce983.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:768px;white-space:nowrap" class="ft00">Vol. 3B&#160;20-7</p>
<p style="position:absolute;top:47px;left:734px;white-space:nowrap" class="ft01">8086 EMULATION</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft05">When checking&#160;privileged instructions, on&#160;page&#160;accesses, or&#160;when&#160;performing other&#160;permission&#160;checks.&#160;<br/>(Virtual-8086&#160;mode always executes&#160;at CPL&#160;3.)</p>
<p style="position:absolute;top:167px;left:69px;white-space:nowrap" class="ft04">20.2.2&#160;</p>
<p style="position:absolute;top:167px;left:149px;white-space:nowrap" class="ft04">Structure of&#160;a Virtual-8086 Task</p>
<p style="position:absolute;top:198px;left:69px;white-space:nowrap" class="ft03">A&#160;virtual-8086-mode&#160;task consists&#160;of&#160;the following items:</p>
<p style="position:absolute;top:220px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:220px;left:95px;white-space:nowrap" class="ft03">A 32-bit TSS&#160;for&#160;the task.</p>
<p style="position:absolute;top:242px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:243px;left:95px;white-space:nowrap" class="ft03">The&#160;8086 program.</p>
<p style="position:absolute;top:265px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:265px;left:95px;white-space:nowrap" class="ft03">A&#160;virtual-8086&#160;monitor.</p>
<p style="position:absolute;top:287px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:288px;left:95px;white-space:nowrap" class="ft03">8086 operating-system&#160;services.</p>
<p style="position:absolute;top:312px;left:69px;white-space:nowrap" class="ft05">The TSS of the&#160;new&#160;task must be a&#160;32-bit TSS,&#160;not&#160;a 16-bit&#160;TSS,&#160;because the&#160;16-bit TSS does not&#160;load the&#160;most-<br/>significant&#160;word of&#160;the EFLAGS register, which contains&#160;the&#160;VM flag. All&#160;TSS’s,&#160;stacks, data, and code&#160;used to&#160;handle&#160;<br/>exceptions when in virtual-8086&#160;mode&#160;must also&#160;be&#160;32-bit segments.<br/>The processor enters&#160;virtual-8086 mode&#160;to run the 8086 program and returns&#160;to&#160;protected mode to&#160;run the&#160;virtual-<br/>8086 monitor.<br/>The virtual-8086 monitor is&#160;a 32-bit protected-mode&#160;code&#160;module that runs&#160;at a CPL of 0. The monitor&#160;consists&#160;of&#160;<br/>initialization, interrupt- and exception-handling, and I/O&#160;emulation procedures&#160;that emulate&#160;a personal&#160;computer&#160;<br/>or other 8086-based platform.&#160;Typically,&#160;the monitor is either&#160;part of or closely associated with the protected-mode&#160;<br/>general-protection&#160;(#GP) exception handler,&#160;which also&#160;runs at&#160;a CPL of&#160;0. As with any&#160;protected-mode&#160;code&#160;<br/>module, code-segment&#160;descriptors for&#160;the virtual-8086 monitor must exist&#160;in the&#160;GDT or&#160;in&#160;the&#160;task’s&#160;LDT.&#160;The&#160;<br/>virtual-8086&#160;monitor also may need&#160;data-segment descriptors so it can examine the&#160;IDT or other parts of the 8086&#160;<br/>program&#160;in the&#160;first&#160;1&#160;MByte&#160;of the&#160;address space.&#160;The linear&#160;addresses&#160;above 10FFEFH&#160;are available for the&#160;<br/>monitor,&#160;the operating&#160;system, and&#160;other system&#160;software.<br/>The&#160;8086&#160;operating-system services consists&#160;of&#160;a kernel and/or&#160;operating-system procedures&#160;that&#160;the&#160;8086&#160;<br/>program makes calls&#160;to. These services can&#160;be&#160;implemented in&#160;either&#160;of&#160;the following&#160;two ways:</p>
<p style="position:absolute;top:587px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:588px;left:95px;white-space:nowrap" class="ft06">They&#160;can be&#160;included&#160;in&#160;the&#160;8086&#160;program.&#160;This&#160;approach&#160;is desirable for either of the&#160;following&#160;reasons:<br/>—&#160;The&#160;8086 program code modifies the&#160;8086 operating-system&#160;services.<br/>—&#160;There is not sufficient development time to merge the&#160;8086&#160;operating-system&#160;services&#160;into main operating&#160;</p>
<p style="position:absolute;top:652px;left:120px;white-space:nowrap" class="ft03">system&#160;or&#160;executive.</p>
<p style="position:absolute;top:674px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:675px;left:95px;white-space:nowrap" class="ft06">They&#160;can be&#160;implemented or&#160;emulated&#160;in the&#160;virtual-8086 monitor.&#160;This approach is&#160;desirable&#160;for&#160;any of the&#160;<br/>following reasons:<br/>—&#160;The&#160;8086 operating-system&#160;procedures can be&#160;more&#160;easily&#160;coordinated&#160;among several virtual-8086 tasks.<br/>—&#160;Memory&#160;can be&#160;saved by&#160;not&#160;duplicating&#160;8086&#160;operating-system procedure code&#160;for several virtual-8086&#160;</p>
<p style="position:absolute;top:756px;left:120px;white-space:nowrap" class="ft03">tasks.</p>
<p style="position:absolute;top:780px;left:95px;white-space:nowrap" class="ft03">—&#160;The&#160;8086 operating-system&#160;procedures can be&#160;easily&#160;emulated&#160;by calls&#160;to the&#160;main&#160;operating system&#160;or&#160;</p>
<p style="position:absolute;top:796px;left:120px;white-space:nowrap" class="ft03">executive.</p>
<p style="position:absolute;top:820px;left:69px;white-space:nowrap" class="ft05">The approach chosen&#160;for&#160;implementing the 8086&#160;operating-system&#160;services&#160;may result in different virtual-8086-<br/>mode&#160;tasks using&#160;different 8086&#160;operating-system&#160;services.</p>
<p style="position:absolute;top:887px;left:69px;white-space:nowrap" class="ft04">20.2.3&#160;</p>
<p style="position:absolute;top:887px;left:150px;white-space:nowrap" class="ft04">Paging of&#160;Virtual-8086 Tasks</p>
<p style="position:absolute;top:918px;left:69px;white-space:nowrap" class="ft05">Even though a&#160;program&#160;running in&#160;virtual-8086&#160;mode can use&#160;only&#160;20-bit linear&#160;addresses,&#160;the processor converts&#160;<br/>these addresses&#160;into 32-bit linear addresses&#160;before mapping&#160;them&#160;to the physical address space.&#160;If paging&#160;is&#160;being&#160;<br/>used,&#160;the&#160;8086 address&#160;space&#160;for a&#160;program&#160;running&#160;in virtual-8086&#160;mode&#160;can be&#160;paged&#160;and&#160;located&#160;in a&#160;set of&#160;<br/>pages in&#160;physical&#160;address space.&#160;If&#160;paging&#160;is&#160;used, it&#160;is transparent to&#160;the program running in&#160;virtual-8086&#160;mode&#160;<br/>just&#160;as it&#160;is for any&#160;task running on the&#160;processor.<br/>Paging is&#160;not&#160;necessary for&#160;a single virtual-8086-mode&#160;task,&#160;but&#160;paging is&#160;useful or&#160;necessary in&#160;the&#160;following&#160;situ-<br/>ations:</p>
</div>
</body>
</html>
