<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 366</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:8px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page366-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce366.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">10-4&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">ADVANCED PROGRAMMABLE INTERRUPT CONTROLLER&#160;(APIC)</p>
<p style="position:absolute;top:97px;left:68px;white-space:nowrap" class="ft02">10.2&#160;</p>
<p style="position:absolute;top:97px;left:147px;white-space:nowrap" class="ft02">SYSTEM BUS VS. APIC BUS</p>
<p style="position:absolute;top:133px;left:68px;white-space:nowrap" class="ft07">For&#160;the P6 family and&#160;Pentium&#160;processors, the&#160;I/O APIC&#160;and&#160;local APICs communicate&#160;through the&#160;3-wire&#160;inter-<br/>APIC&#160;bus (see<a href="o_fe12b1e2a880e0ce-365.html">&#160;Figure&#160;10-3)</a>.&#160;Local APICs also&#160;use the&#160;APIC&#160;bus to&#160;send and&#160;receive&#160;IPIs. The&#160;APIC&#160;bus&#160;and its&#160;<br/>messages are&#160;invisible&#160;to software&#160;and&#160;are not&#160;classed&#160;as architectural.<br/>Beginning with&#160;the&#160;Pentium&#160;4 and&#160;Intel Xeon processors,&#160;the&#160;I/O APIC and&#160;local APICs (using&#160;the xAPIC&#160;architec-<br/>ture) communicate through&#160;the&#160;system bus (see<a href="o_fe12b1e2a880e0ce-365.html">&#160;Figure&#160;10-2). The I/O APIC sen</a>ds interrupt&#160;requests to&#160;the&#160;<br/>processors on&#160;the system&#160;bus through bridge&#160;hardware&#160;that&#160;is part of the&#160;Intel chip set. The&#160;bridge&#160;hardware&#160;<br/>generates the&#160;interrupt messages&#160;that go&#160;to the&#160;local APICs. IPIs between local&#160;APICs&#160;are transmitted directly on&#160;<br/>the system&#160;bus.</p>
<p style="position:absolute;top:312px;left:68px;white-space:nowrap" class="ft02">10.3 THE&#160;</p>
<p style="position:absolute;top:312px;left:190px;white-space:nowrap" class="ft02">INTEL</p>
<p style="position:absolute;top:314px;left:244px;white-space:nowrap" class="ft01">®</p>
<p style="position:absolute;top:312px;left:258px;white-space:nowrap" class="ft02">&#160;82489DX EXTERNAL APIC, THE&#160;APIC,&#160;THE XAPIC, AND THE&#160;</p>
<p style="position:absolute;top:337px;left:146px;white-space:nowrap" class="ft02">X2APIC</p>
<p style="position:absolute;top:373px;left:68px;white-space:nowrap" class="ft03">The&#160;local APIC in the&#160;P6&#160;family&#160;and Pentium processors is&#160;an architectural subset&#160;of the&#160;Intel</p>
<p style="position:absolute;top:371px;left:691px;white-space:nowrap" class="ft04">®</p>
<p style="position:absolute;top:373px;left:702px;white-space:nowrap" class="ft03">&#160;82489DX&#160;external&#160;</p>
<p style="position:absolute;top:390px;left:68px;white-space:nowrap" class="ft07">APIC.&#160;S<a href="o_fe12b1e2a880e0ce-1031.html">ee Section 22.27.1,&#160;“Software Visible&#160;Differences Between&#160;the Local APIC&#160;and&#160;the 82489DX.”<br/></a>The APIC architecture&#160;used&#160;in&#160;the&#160;Pentium 4 and Intel Xeon&#160;processors&#160;(called the xAPIC architecture) is an exten-<br/>sion of the&#160;APIC&#160;architecture found&#160;in&#160;the P6 family&#160;processors. The primary difference between the&#160;APIC&#160;and&#160;<br/>xAPIC architectures is that&#160;with&#160;the&#160;xAPIC architecture,&#160;the local&#160;APICs and the&#160;I/O APIC communicate&#160;through the&#160;<br/>system bus.&#160;With the&#160;APIC architecture, they communicati<a href="o_fe12b1e2a880e0ce-366.html">on through the APIC bus (see Section 10.2, “System Bus&#160;<br/>Vs.&#160;APIC Bus”).</a>&#160;Also,&#160;some&#160;APIC&#160;architectural features have&#160;been extended&#160;and/or modified in the xAPIC architec-<br/>ture.&#160;These extensions and modifications are de<a href="o_fe12b1e2a880e0ce-366.html">scribed in Section 10.4 through Section 1</a><a href="o_fe12b1e2a880e0ce-394.html">0.10.<br/></a>The basic operating&#160;mode of the xAPIC&#160;is&#160;<b>xAPIC mode</b>.&#160;The&#160;x2APIC architecture&#160;is&#160;an extension of&#160;the&#160;xAPIC&#160;<br/>architecture,&#160;primarily&#160;to increase processor addressability.&#160;The&#160;x2APIC architecture provides backward compati-<br/>bility&#160;to the&#160;xAPIC architecture&#160;and&#160;forward extendability for future&#160;Intel platform innovations.&#160;These&#160;extensions&#160;<br/>and modifications&#160;are supported&#160;by a&#160;new&#160;mode of execution (<b>x2APIC mode</b>) are&#160;detailed&#160;<a href="o_fe12b1e2a880e0ce-398.html">in Section 10.12.</a></p>
<p style="position:absolute;top:624px;left:68px;white-space:nowrap" class="ft02">10.4 LOCAL&#160;</p>
<p style="position:absolute;top:624px;left:212px;white-space:nowrap" class="ft02">APIC</p>
<p style="position:absolute;top:660px;left:68px;white-space:nowrap" class="ft07">The following sections&#160;describe&#160;the&#160;architecture of the local&#160;APIC&#160;and&#160;how to&#160;detect it, identify it, and determine its&#160;<br/>status. Descriptions of how to progra<a href="o_fe12b1e2a880e0ce-374.html">m the local APIC are given in Section&#160;10.5.1, “Local Vector Table,” and Section&#160;<br/></a><a href="o_fe12b1e2a880e0ce-380.html">10.6.1,&#160;“Interrupt Command&#160;Register&#160;(ICR).”</a></p>
<p style="position:absolute;top:743px;left:68px;white-space:nowrap" class="ft06">10.4.1&#160;</p>
<p style="position:absolute;top:743px;left:148px;white-space:nowrap" class="ft06">The Local APIC Block Diagram</p>
<p style="position:absolute;top:774px;left:68px;white-space:nowrap" class="ft07"><a href="o_fe12b1e2a880e0ce-367.html">Figure&#160;10-4&#160;</a>gives a&#160;functional&#160;block diagram for the&#160;local&#160;APIC. Software interacts with the&#160;local APIC by reading&#160;<br/>and writing&#160;its registers. APIC registers are&#160;memory-mapped to a&#160;4-KByte region of the&#160;processor’s physical&#160;<br/>address space with an&#160;initial starting&#160;address of FEE00000H. For correct&#160;APIC&#160;operation, this&#160;address space must&#160;<br/>be mapped&#160;to an&#160;area of memory that&#160;has&#160;been designated&#160;as&#160;strong uncacheable (UC). Se<a href="o_fe12b1e2a880e0ce-418.html">e&#160;Section&#160;11.3,&#160;<br/>“Methods of Caching Available.”<br/></a>In MP system&#160;configurations, the&#160;APIC&#160;registers for Intel&#160;64&#160;or IA-32 processors on the&#160;system bus&#160;are&#160;initially&#160;<br/>mapped&#160;to the&#160;same 4-KByte&#160;region of&#160;the physical address space.&#160;Software&#160;has the&#160;option of changing&#160;initial&#160;<br/>mapping to&#160;a different 4-KByte&#160;region&#160;for&#160;all the&#160;local&#160;APICs&#160;or of&#160;mapping&#160;the APIC registers&#160;for each&#160;local APIC to&#160;<br/>its own 4-KByte region.&#160;<a href="o_fe12b1e2a880e0ce-371.html">Section&#160;10.4.5,&#160;“Relocating&#160;the&#160;Local&#160;APIC&#160;Registers,” describe</a>s&#160;how&#160;to relocate the&#160;base&#160;<br/>address for APIC registers.<br/>On processors supporting x2APIC&#160;architecture&#160;(indicated&#160;by CPUID.01H:ECX[21]&#160;=&#160;1),&#160;the local&#160;APIC&#160;supports&#160;<br/>operation both in&#160;xAPIC&#160;mode&#160;and (if enabled&#160;by&#160;software) in x2APIC mode.&#160;x2APIC mode&#160;provides&#160;extended&#160;<br/>processor addre<a href="o_fe12b1e2a880e0ce-398.html">ssability (see Section 10.12).</a></p>
</div>
</body>
</html>
