<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 607</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:9px;line-height:13px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page607-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce607.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;17-33</p>
<p style="position:absolute;top:47px;left:425px;white-space:nowrap" class="ft01">DEBUG, BRANCH&#160;PROFILE, TSC, AND RESOURCE MONITORING FEATURES</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft08"><b>CPL-qualified&#160;debug store&#160;(DS)&#160;feature flag (CPUID.1:ECX.DS-CPL[bit&#160;4])</b>&#160;— Indicates that&#160;the&#160;<br/>processor&#160;provides&#160;a CPL-qualified&#160;debug store (DS) mechanism,&#160;which allows software&#160;to selectively&#160;skip&#160;<br/>sending and&#160;storing BTMs, according to&#160;specified current&#160;privilege&#160;level settings,&#160;into&#160;a memory-resident BTS&#160;<br/>buffer.</p>
<p style="position:absolute;top:172px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:172px;left:95px;white-space:nowrap" class="ft03"><b>IA32_MISC_ENABLE&#160;MSR</b>&#160;— Indicates&#160;that&#160;the processor provides the&#160;BTS&#160;facilities.</p>
<p style="position:absolute;top:194px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:195px;left:95px;white-space:nowrap" class="ft08"><b>Last branch record (LBR) stack&#160;</b>—&#160;The LBR&#160;stack is&#160;a circular&#160;stack&#160;that&#160;consists&#160;of four&#160;MSRs&#160;<br/>(MSR_LASTBRANCH_0 through MSR_LASTBRANCH_3)&#160;for the Pentium&#160;4&#160;and&#160;Intel Xeon&#160;processor&#160;family&#160;<br/>[CPUID&#160;family&#160;0FH,&#160;models&#160;0H-02H].&#160;The&#160;LBR&#160;stack consists&#160;of&#160;16&#160;MSR&#160;pairs&#160;<br/>(MSR_LASTBRANCH_0_FROM_IP&#160;through MSR_LASTBRANCH_15_FROM_IP&#160;and&#160;<br/>MSR_LASTBRANCH_0_TO_IP&#160;through&#160;MSR_LASTBRANCH_15_TO_IP)&#160;for the Pentium 4&#160;and&#160;Intel Xeon&#160;<br/>processor&#160;family [CPUID&#160;family 0FH, model&#160;03H].</p>
<p style="position:absolute;top:299px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:300px;left:95px;white-space:nowrap" class="ft08"><b>Last&#160;branch&#160;record top-of-stack (TOS) pointer&#160;</b>—&#160;The&#160;TOS Pointer MSR&#160;contains&#160;a 2-bit pointer (0-3) to&#160;<br/>the&#160;MSR&#160;in the&#160;LBR&#160;stack&#160;that contains the most recent branch, interrupt,&#160;or&#160;exception recorded&#160;for the&#160;<br/>Pentium&#160;4 and&#160;Intel&#160;Xeon processor family [CPUID&#160;family&#160;0FH, models 0H-02H].&#160;This&#160;pointer becomes a&#160;4-bit&#160;<br/>pointer&#160;(0-15)&#160;for&#160;the Pentium 4 and&#160;Intel Xeon processor family&#160;[CPUID family&#160;0FH,&#160;model 03H].&#160;See&#160;also:&#160;<br/><a href="o_fe12b1e2a880e0ce-608.html">Table&#160;17-18</a>,<a href="o_fe12b1e2a880e0ce-607.html">&#160;Figure&#160;17-12, and Sect</a><a href="o_fe12b1e2a880e0ce-608.html">ion 17.11.2,&#160;“LBR Stack for&#160;Processors Based on Intel NetBurst®&#160;Microar-<br/>chitecture.”</a></p>
<p style="position:absolute;top:404px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:405px;left:95px;white-space:nowrap" class="ft03"><b>Last&#160;exception record&#160;</b>— See&#160;<a href="o_fe12b1e2a880e0ce-609.html">Section&#160;17.11.3,&#160;“Last Exception&#160;Records.”</a></p>
<p style="position:absolute;top:455px;left:69px;white-space:nowrap" class="ft05">17.11.1 MSR_DEBUGCTLA&#160;</p>
<p style="position:absolute;top:455px;left:296px;white-space:nowrap" class="ft05">MSR&#160;</p>
<p style="position:absolute;top:486px;left:69px;white-space:nowrap" class="ft08">The MSR_DEBUGCTLA MSR enables&#160;and disables&#160;the various&#160;last&#160;branch recording mechanisms described&#160;in&#160;the&#160;<br/>previous section. This register can&#160;be&#160;written to using&#160;the WRMSR&#160;instruction, when operating&#160;at privilege&#160;level&#160;0&#160;<br/>or&#160;when&#160;in real-address&#160;mode.&#160;A protected-mode&#160;operating&#160;system procedure&#160;is required&#160;to provide user access to&#160;<br/>this register<a href="o_fe12b1e2a880e0ce-607.html">.&#160;Figure&#160;17-12&#160;</a>shows the&#160;flags&#160;in the&#160;MSR_DEBUGCTLA MSR.&#160;The&#160;functions of&#160;these flags are&#160;as&#160;<br/>follows:</p>
<p style="position:absolute;top:574px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:574px;left:95px;white-space:nowrap" class="ft08"><b>LBR (last&#160;branch/interrupt/exception) flag (bit&#160;0)&#160;—&#160;</b>When&#160;set,&#160;the processor records a&#160;running trace&#160;of&#160;<br/>the most recent branches,&#160;interrupts, and/or&#160;exceptions&#160;taken by&#160;the processor (prior&#160;to a&#160;debug exception&#160;<br/>being&#160;generated)&#160;in the&#160;last branch record (LBR)&#160;stack.&#160;Each branch,&#160;interrupt,&#160;or exception is&#160;recorded&#160;as a&#160;<br/>64-bit branch&#160;record. The processor clears&#160;this flag&#160;whenever&#160;a&#160;debug&#160;exception&#160;is generated&#160;(for example,&#160;<br/>when&#160;an instruction or&#160;data&#160;breakpoint or&#160;a single-step&#160;trap occurs).&#160;Se<a href="o_fe12b1e2a880e0ce-608.html">e Section 17.11.2,&#160;“LBR Stack for&#160;<br/>Processors Based on Intel&#160;NetBurst® Microarchitecture.”</a></p>
<p style="position:absolute;top:679px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:679px;left:95px;white-space:nowrap" class="ft08"><b>BTF&#160;(single-step&#160;on&#160;branches)&#160;flag&#160;(bit&#160;1)&#160;—&#160;</b>When set, the processor treats&#160;the TF flag&#160;in the&#160;EFLAGS&#160;<br/>register as&#160;a&#160;“single-step&#160;on branches” flag&#160;rather than&#160;a “single-step&#160;on&#160;instructions” flag.&#160;This mechanism&#160;<br/>allows single-stepping the&#160;processor&#160;on taken&#160;branches.&#160;See<a href="o_fe12b1e2a880e0ce-587.html">&#160;Section 17.4.3,&#160;“Single-Stepping on&#160;Branches.”</a></p>
<p style="position:absolute;top:734px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:735px;left:95px;white-space:nowrap" class="ft08"><b>TR&#160;(trace&#160;message&#160;enable)&#160;flag&#160;(bit&#160;2)&#160;—&#160;</b>When&#160;set,&#160;branch trace messages are&#160;enabled.&#160;Thereafter,&#160;when&#160;<br/>the processor detects a taken branch, interrupt, or exception,&#160;it sends the&#160;branch record out on&#160;the&#160;system bus&#160;<br/>as a&#160;branch trace&#160;message&#160;(BTM).&#160;S<a href="o_fe12b1e2a880e0ce-587.html">ee Section 17.4.4, “Branch Trace&#160;Messages.”</a></p>
<p style="position:absolute;top:1013px;left:190px;white-space:nowrap" class="ft06">Figure&#160;17-12. &#160;MSR_DEBUGCTLA MSR for&#160;Pentium&#160;4&#160;and&#160;Intel Xeon Processors</p>
<p style="position:absolute;top:820px;left:253px;white-space:nowrap" class="ft07">31</p>
<p style="position:absolute;top:954px;left:278px;white-space:nowrap" class="ft00">TR&#160;—&#160;Trace&#160;messages enable</p>
<p style="position:absolute;top:924px;left:279px;white-space:nowrap" class="ft00">BTINT&#160;—&#160;Branch&#160;trace interrupt</p>
<p style="position:absolute;top:968px;left:278px;white-space:nowrap" class="ft09">BTF&#160;—&#160;Single-step&#160;on branches<br/>LBR&#160;—&#160;Last branch/interrupt/exception</p>
<p style="position:absolute;top:820px;left:587px;white-space:nowrap" class="ft07">5&#160;4&#160;3&#160;2&#160;1&#160;0</p>
<p style="position:absolute;top:939px;left:279px;white-space:nowrap" class="ft00">BTS&#160;—&#160;Branch trace store</p>
<p style="position:absolute;top:848px;left:405px;white-space:nowrap" class="ft00">Reserved</p>
<p style="position:absolute;top:820px;left:572px;white-space:nowrap" class="ft07">6</p>
<p style="position:absolute;top:820px;left:558px;white-space:nowrap" class="ft07">7</p>
<p style="position:absolute;top:909px;left:279px;white-space:nowrap" class="ft00">BTS_OFF_OS&#160;—&#160;Disable storing CPL_0 BTS</p>
<p style="position:absolute;top:894px;left:278px;white-space:nowrap" class="ft00">BTS_OFF_USR&#160;—&#160;Disable storing non-CPL_0 BTS</p>
</div>
</body>
</html>
