<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 666</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:14px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page666-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce666.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">18-30&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:98px;left:68px;white-space:nowrap" class="ft02">18.7.1&#160;</p>
<p style="position:absolute;top:98px;left:148px;white-space:nowrap" class="ft02">Processor Event Based Sampling (PEBS)</p>
<p style="position:absolute;top:129px;left:68px;white-space:nowrap" class="ft06">Processor&#160;event based sampling (PEBS)&#160;on the&#160;Goldmont&#160;microarchitecture is&#160;enhanced&#160;over&#160;prior generations&#160;<br/>with&#160;respect to&#160;sampling support of precise&#160;events&#160;and&#160;non-precise&#160;events. In&#160;the Goldmont&#160;microarchitecture,&#160;<br/>PEBS&#160;is supported&#160;using&#160;IA32_PMC0 for all&#160;events (see<a href="o_fe12b1e2a880e0ce-591.html">&#160;Section 17.4.9).</a>&#160;<br/>PEBS uses&#160;a debug store&#160;mechanism&#160;to store a&#160;set of architectural state information for&#160;the&#160;processor at the time&#160;<br/>the sample was&#160;generated.&#160;</p>
<p style="position:absolute;top:228px;left:68px;white-space:nowrap" class="ft08">Precise events work the&#160;same way&#160;as&#160;on the Silvermont&#160;microarchitecture.&#160;They can capture&#160;precise&#160;eventingIP asso-<br/>ciated&#160;with&#160;a retired&#160;instruction&#160;that&#160;caused&#160;the event.&#160;</p>
<p style="position:absolute;top:243px;left:434px;white-space:nowrap" class="ft03">The&#160;PEBS record provides architectural state&#160;of the&#160;instruc-</p>
<p style="position:absolute;top:259px;left:68px;white-space:nowrap" class="ft06">tion executed after&#160;the instruction that caused the event&#160;<a href="o_fe12b1e2a880e0ce-656.html">(See Section 18.4.4&#160;and&#160;</a><a href="o_fe12b1e2a880e0ce-591.html">Section 17.4.9</a>).&#160;The PEBS record&#160;<br/>also provides architectural state&#160;of the&#160;processor&#160;after the&#160;instruction that&#160;caused&#160;the&#160;event completes. The&#160;list&#160;of&#160;<br/>precise events&#160;supported&#160;in the&#160;Goldmont&#160;microarchitecture is&#160;<a href="o_fe12b1e2a880e0ce-666.html">shown in&#160;Table&#160;18-19.<br/></a>In the&#160;Goldmont microarchitecture, the&#160;PEBS facility&#160;also supports the&#160;use of non-precise events&#160;to record&#160;<br/>processor&#160;state&#160;information into PEBS records with the&#160;same&#160;format as&#160;with precise&#160;events.<br/>However,&#160;a&#160;non-precise&#160;event may&#160;not be&#160;attributable to&#160;a particular retired instruction or&#160;the time&#160;of&#160;instruction&#160;<br/>execution.&#160;When the&#160;counter overflows, a&#160;PEBS record&#160;will&#160;be&#160;generated&#160;at the next opportunity. Consider&#160;the&#160;<br/>event ICACHE.HIT.&#160;When the&#160;counter overflows,&#160;the&#160;processor is fetching future&#160;instructions. The&#160;PEBS record will&#160;<br/>be&#160;generated&#160;at the&#160;next opportunity&#160;and&#160;capture the&#160;state at&#160;the processor's&#160;current retirement&#160;point. Other&#160;<br/>examples of a&#160;non-precise&#160;events are&#160;CPU_CLK_UNHALTED.CORE_P and&#160;HARDWARE_INTERRUPTS.RECEIVED.&#160;<br/>There may be many instructions&#160;in&#160;various&#160;stages&#160;of execution,&#160;multiple or&#160;zero instructions being retired&#160;each&#160;<br/>cycle&#160;as CPU_CLK_UNHALTED.CORE_P increments. HARDWARE_INTERRUPTS.RECEIVED&#160;increments&#160;independent&#160;<br/>of any&#160;instructions being executed. The&#160;PEBS&#160;record&#160;will be generated at&#160;the next&#160;opportunity,&#160;capturing&#160;the&#160;<br/>processor&#160;state&#160;when&#160;the&#160;machine received&#160;the&#160;interrupt,&#160;even if&#160;interrupts are&#160;masked.&#160;The PEBS facility thus&#160;<br/>allows for&#160;identification of the&#160;instructions&#160;which were&#160;executing&#160;when the&#160;event overflowed.<br/>After generating a record,&#160;the PEBS facility reloads the counter&#160;and resumes execution,&#160;just&#160;as is done for&#160;precise&#160;<br/>events. Unlike&#160;interrupt-based sampling,&#160;which&#160;requires&#160;an interrupt service&#160;routine&#160;to&#160;collect the&#160;sample&#160;and&#160;<br/>reload the counter,&#160;the PEBS facility&#160;can collect samples even&#160;when&#160;interrupts are masked&#160;</p>
<p style="position:absolute;top:564px;left:676px;white-space:nowrap" class="ft04">and&#160;without using NMI</p>
<p style="position:absolute;top:562px;left:828px;white-space:nowrap" class="ft03">.&#160;</p>
<p style="position:absolute;top:579px;left:68px;white-space:nowrap" class="ft06">Since&#160;a PEBS&#160;record&#160;is&#160;generated&#160;immediately when a&#160;counter for a&#160;non-precise&#160;event&#160;is enabled,&#160;it&#160;may&#160;also be&#160;<br/>generated&#160;after an&#160;overflow&#160;is set by an&#160;MSR write&#160;to IA32_PERF_GLOBAL_STATUS_SET.</p>
<p style="position:absolute;top:623px;left:199px;white-space:nowrap" class="ft05">Table 18-19.&#160;&#160;Precise&#160;Events&#160;Supported&#160;by&#160;the Goldmont&#160;Microarchitecture</p>
<p style="position:absolute;top:645px;left:76px;white-space:nowrap" class="ft03">Event Name</p>
<p style="position:absolute;top:645px;left:402px;white-space:nowrap" class="ft03">Event&#160;Select</p>
<p style="position:absolute;top:645px;left:518px;white-space:nowrap" class="ft03">Sub-event&#160;</p>
<p style="position:absolute;top:645px;left:714px;white-space:nowrap" class="ft03">UMask</p>
<p style="position:absolute;top:667px;left:76px;white-space:nowrap" class="ft03">LD_BLOCKS</p>
<p style="position:absolute;top:667px;left:402px;white-space:nowrap" class="ft03">03H</p>
<p style="position:absolute;top:667px;left:518px;white-space:nowrap" class="ft03">DATA_UNKNOWN</p>
<p style="position:absolute;top:667px;left:714px;white-space:nowrap" class="ft03">01H</p>
<p style="position:absolute;top:690px;left:518px;white-space:nowrap" class="ft03">STORE_FORWARD</p>
<p style="position:absolute;top:690px;left:714px;white-space:nowrap" class="ft03">02H</p>
<p style="position:absolute;top:712px;left:518px;white-space:nowrap" class="ft03">4K_ALIAS</p>
<p style="position:absolute;top:712px;left:714px;white-space:nowrap" class="ft03">04H</p>
<p style="position:absolute;top:735px;left:518px;white-space:nowrap" class="ft03">UTLB_MISS</p>
<p style="position:absolute;top:735px;left:714px;white-space:nowrap" class="ft03">08H</p>
<p style="position:absolute;top:757px;left:518px;white-space:nowrap" class="ft03">ALL_BLOCK</p>
<p style="position:absolute;top:757px;left:714px;white-space:nowrap" class="ft03">10H</p>
<p style="position:absolute;top:780px;left:76px;white-space:nowrap" class="ft03">MISALIGN_MEM_REF</p>
<p style="position:absolute;top:780px;left:402px;white-space:nowrap" class="ft03">13H</p>
<p style="position:absolute;top:780px;left:518px;white-space:nowrap" class="ft03">LOAD_PAGE_SPLIT</p>
<p style="position:absolute;top:780px;left:714px;white-space:nowrap" class="ft03">02H</p>
<p style="position:absolute;top:802px;left:518px;white-space:nowrap" class="ft03">STORE_PAGE_SPLIT</p>
<p style="position:absolute;top:802px;left:714px;white-space:nowrap" class="ft03">04H</p>
<p style="position:absolute;top:825px;left:76px;white-space:nowrap" class="ft03">INST_RETIRED</p>
<p style="position:absolute;top:825px;left:402px;white-space:nowrap" class="ft03">C0H</p>
<p style="position:absolute;top:825px;left:518px;white-space:nowrap" class="ft03">ANY</p>
<p style="position:absolute;top:825px;left:714px;white-space:nowrap" class="ft03">00H</p>
<p style="position:absolute;top:847px;left:76px;white-space:nowrap" class="ft03">UOPS_RETITRED</p>
<p style="position:absolute;top:847px;left:402px;white-space:nowrap" class="ft03">C2H</p>
<p style="position:absolute;top:847px;left:518px;white-space:nowrap" class="ft03">ANY</p>
<p style="position:absolute;top:847px;left:714px;white-space:nowrap" class="ft03">00H</p>
<p style="position:absolute;top:870px;left:518px;white-space:nowrap" class="ft03">LD_SPLITSMS</p>
<p style="position:absolute;top:870px;left:714px;white-space:nowrap" class="ft03">01H</p>
<p style="position:absolute;top:892px;left:76px;white-space:nowrap" class="ft03">BR_INST_RETIRED</p>
<p style="position:absolute;top:892px;left:402px;white-space:nowrap" class="ft03">C4H</p>
<p style="position:absolute;top:892px;left:518px;white-space:nowrap" class="ft03">ALL_BRANCHES</p>
<p style="position:absolute;top:892px;left:714px;white-space:nowrap" class="ft03">00H</p>
<p style="position:absolute;top:915px;left:518px;white-space:nowrap" class="ft03">JCC</p>
<p style="position:absolute;top:915px;left:714px;white-space:nowrap" class="ft03">7EH</p>
<p style="position:absolute;top:937px;left:518px;white-space:nowrap" class="ft03">TAKEN_JCC</p>
<p style="position:absolute;top:937px;left:714px;white-space:nowrap" class="ft03">FEH</p>
<p style="position:absolute;top:960px;left:518px;white-space:nowrap" class="ft03">CALL</p>
<p style="position:absolute;top:960px;left:714px;white-space:nowrap" class="ft03">F9H</p>
<p style="position:absolute;top:982px;left:518px;white-space:nowrap" class="ft03">REL_CALL</p>
<p style="position:absolute;top:982px;left:714px;white-space:nowrap" class="ft03">FDH</p>
<p style="position:absolute;top:1005px;left:518px;white-space:nowrap" class="ft03">IND_CALL</p>
<p style="position:absolute;top:1005px;left:714px;white-space:nowrap" class="ft03">FBH</p>
<p style="position:absolute;top:1027px;left:518px;white-space:nowrap" class="ft03">NON_RETURN_IND</p>
<p style="position:absolute;top:1027px;left:714px;white-space:nowrap" class="ft03">EBH</p>
<p style="position:absolute;top:1050px;left:518px;white-space:nowrap" class="ft03">FAR_BRANCH</p>
<p style="position:absolute;top:1050px;left:714px;white-space:nowrap" class="ft03">BFH</p>
</div>
</body>
</html>
