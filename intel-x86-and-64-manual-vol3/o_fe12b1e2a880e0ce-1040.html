<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1040</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:12px;font-family:Times;color:#0860a8;}
	.ft08{font-size:8px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1040-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1040.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">22-36&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">ARCHITECTURE&#160;COMPATIBILITY</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft09"><a href="o_fe12b1e2a880e0ce-507.html">See&#160;Chapter 15,&#160;‚ÄúMachine-Check&#160;Architecture,‚Äù&#160;for m</a>ore&#160;information&#160;on&#160;the machine-check exception&#160;and the&#160;<br/>machine-check architecture.</p>
<p style="position:absolute;top:167px;left:68px;white-space:nowrap" class="ft03">22.37.5 Performance-Monitoring&#160;</p>
<p style="position:absolute;top:167px;left:349px;white-space:nowrap" class="ft03">Counters</p>
<p style="position:absolute;top:198px;left:68px;white-space:nowrap" class="ft09">The P6 family&#160;and Pentium&#160;processors provide two&#160;performance-monitoring&#160;counters&#160;for use in monitoring&#160;internal&#160;<br/>hardware operations.&#160;The&#160;number of&#160;performance&#160;monitoring&#160;counters and&#160;associated programming interfaces&#160;<br/>may&#160;be&#160;implementation specific for Pentium 4&#160;processors,&#160;Pentium&#160;M&#160;processors. Later processors may have&#160;<br/>implemented&#160;these as part of an architectural performance monitoring&#160;feature. The architectural and non-architec-<br/>tural performance&#160;monitoring&#160;interfaces for different&#160;processor&#160;families&#160;are described<a href="o_fe12b1e2a880e0ce-637.html">&#160;in&#160;Chapter 18, ‚ÄúPerformance&#160;<br/>Monitoring,‚Äù</a><a href="˛ˇ">. Chapter 19,&#160;‚ÄúPerformance&#160;Monitoring Events.‚Äù</a>&#160;lists&#160;all&#160;the events&#160;that can&#160;be counted for architectural&#160;<br/>performance monitoring&#160;events&#160;and non-architectural&#160;events. The counters are&#160;set up, started, and stopped using&#160;<br/>two MSRs and the RDMSR and WRMSR instructions. For the P6&#160;family processors, the&#160;current&#160;count for&#160;a&#160;particular&#160;<br/>counter&#160;can be read using&#160;the new RDPMC&#160;instruction.<br/>The performance-monitoring counters&#160;are useful&#160;for&#160;debugging&#160;programs, optimizing&#160;code, diagnosing system&#160;fail-<br/>ures, or&#160;refining hardware designs.<a href="o_fe12b1e2a880e0ce-637.html">&#160;See&#160;Chapter&#160;18, ‚ÄúPerformance&#160;Monitoring,‚Äù&#160;for more&#160;</a>information on these&#160;<br/>counters.</p>
<p style="position:absolute;top:442px;left:68px;white-space:nowrap" class="ft04">22.38&#160;&#160;TWO WAYS&#160;TO&#160;RUN INTEL 286 PROCESSOR TASKS</p>
<p style="position:absolute;top:478px;left:68px;white-space:nowrap" class="ft02">When porting 16-bit&#160;programs&#160;to run on 32-bit&#160;IA-32 processors,&#160;there&#160;are two approaches&#160;to&#160;consider:</p>
<p style="position:absolute;top:500px;left:68px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:501px;left:93px;white-space:nowrap" class="ft09">Porting an entire 16-bit software&#160;system to&#160;a 32-bit&#160;processor,&#160;complete with&#160;the old operating&#160;system,&#160;loader,&#160;<br/>and&#160;system&#160;builder. Here, all tasks&#160;will&#160;have 16-bit TSSs. The&#160;32-bit&#160;processor&#160;is being used as if it&#160;were a faster&#160;<br/>version of the&#160;16-bit processor.</p>
<p style="position:absolute;top:556px;left:68px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:556px;left:93px;white-space:nowrap" class="ft09">Porting selected 16-bit&#160;applications&#160;to run in&#160;a 32-bit&#160;processor environment&#160;with&#160;a 32-bit&#160;operating&#160;system,&#160;<br/>loader,&#160;and system builder.&#160;Here,&#160;the TSSs&#160;used&#160;to represent 286&#160;tasks&#160;should be changed to 32-bit TSSs. It&#160;is&#160;<br/>possible to mix 16 and 32-bit TSSs, but the benefits are&#160;small and the&#160;problems are&#160;great. All tasks in a 32-bit&#160;<br/>software system&#160;should have&#160;32-bit TSSs. It&#160;is not necessary&#160;to change the 16-bit object&#160;modules&#160;themselves;&#160;<br/>TSSs are usually constructed by&#160;the operating&#160;system,&#160;by&#160;the loader,&#160;or by&#160;the system&#160;builder.&#160;Se<a href="o_fe12b1e2a880e0ce-997.html">e Chapter&#160;21,&#160;<br/>‚ÄúMixing&#160;16-Bit and 32-Bit&#160;Code,‚Äù</a>&#160;for more&#160;detailed information&#160;about mixing 16-bit&#160;and 32-bit&#160;code.</p>
<p style="position:absolute;top:663px;left:68px;white-space:nowrap" class="ft09">Because the&#160;32-bit processors use&#160;the contents&#160;of&#160;the&#160;reserved word of&#160;16-bit&#160;segment descriptors, 16-bit&#160;<br/>programs&#160;that&#160;place&#160;values in&#160;this word may&#160;not run correctly&#160;on&#160;the 32-bit&#160;processors.</p>
<p style="position:absolute;top:735px;left:68px;white-space:nowrap" class="ft04">22.39&#160;&#160;INITIAL STATE OF&#160;PENTIUM, PENTIUM&#160;PRO&#160;AND&#160;PENTIUM&#160;4&#160;PROCESSORS</p>
<p style="position:absolute;top:771px;left:68px;white-space:nowrap" class="ft09"><a href="o_fe12b1e2a880e0ce-1040.html">Table 22-10</a>&#160;shows&#160;the state of&#160;the&#160;flags and&#160;other registers following power-up for the&#160;Pentium, Pentium Pro and&#160;<br/>Pentium 4&#160;processors.&#160;The state of control&#160;register&#160;CR0&#160;is&#160;60000010H&#160;(see<a href="o_fe12b1e2a880e0ce-314.html">&#160;Figure&#160;9-1 ‚ÄúContents of CR0&#160;Register&#160;<br/>after Reset‚Äù&#160;in t</a>he&#160;<a href="˛ˇ"><i>Intel¬Æ 64 and&#160;IA-32 Architectures Software&#160;Developer‚Äôs&#160;Manual,&#160;Volume 3A</i>)</a>.&#160;This&#160;places&#160;the&#160;<br/>processor&#160;in real-address mode&#160;with paging disabled.</p>
<p style="position:absolute;top:875px;left:68px;white-space:nowrap" class="ft07">Table&#160;22-10.&#160; Processor&#160;State&#160;Following&#160;Power-up/Reset/INIT&#160;for&#160;Pentium,&#160;Pentium&#160;Pro&#160;and&#160;Pentium&#160;4&#160;Processors</p>
<p style="position:absolute;top:900px;left:113px;white-space:nowrap" class="ft02">Register</p>
<p style="position:absolute;top:900px;left:252px;white-space:nowrap" class="ft02">Pentium 4&#160;Processor</p>
<p style="position:absolute;top:900px;left:457px;white-space:nowrap" class="ft02">Pentium Pro Processor</p>
<p style="position:absolute;top:900px;left:677px;white-space:nowrap" class="ft02">Pentium&#160;Processor</p>
<p style="position:absolute;top:924px;left:74px;white-space:nowrap" class="ft02">EFLAGS</p>
<p style="position:absolute;top:921px;left:118px;white-space:nowrap" class="ft08">1</p>
<p style="position:absolute;top:924px;left:215px;white-space:nowrap" class="ft02">00000002H</p>
<p style="position:absolute;top:924px;left:426px;white-space:nowrap" class="ft02">00000002H</p>
<p style="position:absolute;top:924px;left:637px;white-space:nowrap" class="ft02">00000002H</p>
<p style="position:absolute;top:948px;left:74px;white-space:nowrap" class="ft02">EIP</p>
<p style="position:absolute;top:948px;left:215px;white-space:nowrap" class="ft02">0000FFF0H</p>
<p style="position:absolute;top:948px;left:426px;white-space:nowrap" class="ft02">0000FFF0H</p>
<p style="position:absolute;top:948px;left:637px;white-space:nowrap" class="ft02">0000FFF0H</p>
<p style="position:absolute;top:971px;left:74px;white-space:nowrap" class="ft02">CR0</p>
<p style="position:absolute;top:971px;left:215px;white-space:nowrap" class="ft02">60000010H</p>
<p style="position:absolute;top:969px;left:287px;white-space:nowrap" class="ft08">2</p>
<p style="position:absolute;top:972px;left:426px;white-space:nowrap" class="ft02">60000010H</p>
<p style="position:absolute;top:969px;left:498px;white-space:nowrap" class="ft08">2</p>
<p style="position:absolute;top:972px;left:637px;white-space:nowrap" class="ft02">60000010H</p>
<p style="position:absolute;top:969px;left:709px;white-space:nowrap" class="ft08">2</p>
<p style="position:absolute;top:996px;left:74px;white-space:nowrap" class="ft02">CR2, CR3, CR4</p>
<p style="position:absolute;top:996px;left:215px;white-space:nowrap" class="ft02">00000000H</p>
<p style="position:absolute;top:996px;left:426px;white-space:nowrap" class="ft02">00000000H</p>
<p style="position:absolute;top:996px;left:637px;white-space:nowrap" class="ft02">00000000H</p>
</div>
</body>
</html>
