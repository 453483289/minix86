<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1718</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:14px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1718-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1718.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">36-34&#160;Vol. 3C</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">INTEL® PROCESSOR TRACE</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft07">normal&#160;binding and ordering&#160;rules that apply to&#160;these packets outside&#160;of&#160;PSB+ can be&#160;ignored&#160;when these&#160;packets&#160;<br/>are between a&#160;PSB&#160;and PSBEND. They&#160;inform&#160;the decoder&#160;of&#160;the&#160;state&#160;of&#160;the processor at&#160;the time&#160;of the&#160;PSB.<br/>PSB+ can&#160;include:</p>
<p style="position:absolute;top:161px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:162px;left:93px;white-space:nowrap" class="ft02">Timestamp&#160;(TSC), if IA32_RTIT_CTL.TSCEn=1.&#160;</p>
<p style="position:absolute;top:184px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:184px;left:93px;white-space:nowrap" class="ft02">Timestamp-MTC Align (TMA), if&#160;IA32_RTIT_CTL.TSCEn=1 &amp;&amp; IA32_RTIT_CTL.MTCEn=1.</p>
<p style="position:absolute;top:206px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:207px;left:93px;white-space:nowrap" class="ft06">Paging Info Packet (PIP),&#160;if ContextEn=1 and&#160;IA32_RTIT_CTL.OS=1.&#160;The&#160;non-root bit (NR)&#160;is set if the logical&#160;<br/>processor is in&#160;VMX non-root operation and the “conceal&#160;VMX non-root&#160;operation&#160;from Intel&#160;PT”.&#160;VM-execution&#160;<br/>control is&#160;0.</p>
<p style="position:absolute;top:262px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:262px;left:93px;white-space:nowrap" class="ft06">VMCS packet, if either the logical is in VMX root operation or&#160;the logical&#160;processor&#160;is in VMX&#160;non-root operation&#160;<br/>and the&#160;“conceal VMX non-root&#160;operation from Intel PT”&#160;VM-execution control is&#160;0.</p>
<p style="position:absolute;top:301px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:301px;left:93px;white-space:nowrap" class="ft02">Core Bus Ratio (CBR).</p>
<p style="position:absolute;top:323px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:324px;left:93px;white-space:nowrap" class="ft02">MODE.TSX,&#160;if&#160;ContextEn=1&#160;and BranchEn = 1.&#160;</p>
<p style="position:absolute;top:346px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:346px;left:93px;white-space:nowrap" class="ft02">MODE.Exec, if&#160;PacketEn=1.&#160;</p>
<p style="position:absolute;top:368px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:369px;left:93px;white-space:nowrap" class="ft02">Flow&#160;Update&#160;Packet&#160;(FUP),&#160;if&#160;PacketEn=1.</p>
<p style="position:absolute;top:391px;left:68px;white-space:nowrap" class="ft06">PSB is generated only&#160;when&#160;TriggerEn=1; hence PSB+&#160;has&#160;the same dependencies.&#160;The ordering of&#160;packets within&#160;<br/>PSB+ is&#160;not fixed.&#160;Timing&#160;packets such&#160;as CYC&#160;and&#160;MTC&#160;may be generated between PSB and PSBEND, and&#160;their&#160;<br/>meanings are the&#160;same as&#160;outside&#160;PSB+.<br/>Note&#160;that an&#160;overflow can&#160;occur during PSB+,&#160;and this&#160;could cause the PSBEND packet to&#160;be&#160;lost. For this reason,&#160;<br/>the OVF packet&#160;should also&#160;be&#160;viewed&#160;as terminating&#160;PSB+.</p>
<p style="position:absolute;top:514px;left:68px;white-space:nowrap" class="ft04">36.3.8&#160;</p>
<p style="position:absolute;top:514px;left:148px;white-space:nowrap" class="ft04">Internal Buffer Overflow</p>
<p style="position:absolute;top:543px;left:68px;white-space:nowrap" class="ft06">In the&#160;rare&#160;circumstances when new packets&#160;need&#160;to be&#160;generated but&#160;the&#160;processor’s&#160;dedicated internal buffers&#160;<br/>are&#160;all full,&#160;an “internal buffer&#160;overflow” occurs.&#160;On such&#160;an overflow packet generation&#160;ceases&#160;(as packets&#160;would&#160;<br/>need to enter the&#160;processor’s internal&#160;buffer) until the&#160;overflow&#160;resolves. Once&#160;resolved, packet generation&#160;<br/>resumes.<br/>When the&#160;buffer overflow is&#160;cleared,&#160;an OVF pack<a href="o_fe12b1e2a880e0ce-1738.html">et (Section 36.4.2.16</a>)&#160;is&#160;generated,&#160;and&#160;the&#160;processor ensures&#160;<br/>that&#160;packets which&#160;follow the OVF&#160;are&#160;not&#160;compressed (IP compression&#160;or RET&#160;compression)&#160;against packets that&#160;<br/>were lost.&#160;<br/>If&#160;IA32_RTIT_CTL.BranchEn = 1,&#160;the&#160;OVF&#160;packet will be followed&#160;by&#160;a FUP if&#160;the&#160;overflow resolves&#160;while&#160;Pack-<br/>etEn=1. If&#160;the overflow resolves&#160;while&#160;PacketEn = 0&#160;no packet&#160;is generated, but&#160;a TIP.PGE will naturally be gener-<br/>ated&#160;later,&#160;once&#160;PacketEn&#160;= 1.&#160;The&#160;payload of the FUP or&#160;TIP.PGE will be&#160;the&#160;Current IP&#160;of the first instruction upon&#160;<br/>which tracing resumes&#160;after the&#160;overflow&#160;is cleared. Between the&#160;OVF&#160;and following FUP&#160;or&#160;TIP.PGE,&#160;there may&#160;be&#160;<br/>packets that do not depend on PacketEn,&#160;such as timing&#160;packets. If the overflow resolves&#160;while&#160;PacketEn=0, other&#160;<br/>packets&#160;that are&#160;not dependent&#160;on PacketEn may come&#160;before&#160;the TIP.PGE.&#160;</p>
<p style="position:absolute;top:797px;left:68px;white-space:nowrap" class="ft05">36.3.8.1 &#160;&#160;Overflow&#160;Impact on Enables</p>
<p style="position:absolute;top:824px;left:68px;white-space:nowrap" class="ft06">The address&#160;comparisons to&#160;ADDRn ranges,&#160;for IP&#160;filtering&#160;and&#160;TraceStop<a href="o_fe12b1e2a880e0ce-1689.html">&#160;(Section 36.2.4.3</a>),&#160;continue during&#160;a&#160;<br/>buffer&#160;overflow,&#160;and TriggerEn,&#160;ContextEn,&#160;and&#160;FilterEn may change during&#160;a buffer&#160;overflow. Like&#160;other packets,&#160;<br/>however,&#160;any&#160;TIP.PGE&#160;or&#160;TIP.PGD&#160;packets&#160;that&#160;would have&#160;been generated will&#160;be&#160;lost.&#160;Further,&#160;<br/>IA32_RTIT_STATUS.PacketByteCnt will not&#160;increment,&#160;since it&#160;is only&#160;incremented when packets&#160;are generated.<br/>If a&#160;TraceStop event occurs during the&#160;buffer&#160;overflow,&#160;IA32_RTIT_STATUS.Stopped will still&#160;be set, tracing will&#160;<br/>cease as a&#160;result. However,&#160;the TraceStop&#160;packet, and any&#160;TIP.PGD that&#160;result from the&#160;TraceStop,&#160;may be&#160;<br/>dropped.</p>
<p style="position:absolute;top:973px;left:68px;white-space:nowrap" class="ft05">36.3.8.2 &#160;&#160;Overflow&#160;Impact on Timing&#160;Packets</p>
<p style="position:absolute;top:1000px;left:68px;white-space:nowrap" class="ft06">Any timing&#160;packets that are generated during&#160;a&#160;buffer&#160;overflow&#160;will be dropped.&#160;If&#160;only&#160;a few MTC&#160;packets are&#160;<br/>dropped,&#160;a&#160;decoder should&#160;be&#160;able&#160;to detect&#160;this by noticing that&#160;the time&#160;value in&#160;the first MTC&#160;packet after&#160;the&#160;<br/>buffer&#160;overflow incremented&#160;by more&#160;than one.&#160;If the buffer&#160;overflow lasted long&#160;enough&#160;that 256&#160;MTC packets are&#160;<br/>lost (and&#160;thus&#160;the MTC&#160;packet&#160;‘wraps’&#160;its 8-bit CTC value),&#160;then the decoder may be&#160;unable&#160;to properly understand&#160;</p>
</div>
</body>
</html>
