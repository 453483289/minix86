<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1166</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1166-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1166.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">28-18&#160;Vol. 3C</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">VMX SUPPORT&#160;FOR&#160;ADDRESS TRANSLATION</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft07">Software&#160;should&#160;use&#160;the&#160;INVEPT instruction with&#160;the ‚Äúsingle-context‚Äù&#160;INVEPT type after&#160;making&#160;any of the&#160;<br/>following&#160;changes to&#160;an EPT&#160;paging-structure entry (the&#160;INVEPT&#160;descriptor should&#160;contain&#160;an EPTP value that&#160;<br/>references ‚Äî&#160;directly or&#160;indirectly ‚Äî&#160;the modified EPT&#160;paging&#160;structure):<br/>‚Äî&#160;Changing&#160;any of the&#160;privilege bits&#160;2:0 from 1&#160;to 0.<br/>‚Äî&#160;Changing&#160;the physical address&#160;in bits&#160;51:12.<br/>‚Äî&#160;Clearing bit&#160;8&#160;(the accessed flag)&#160;if&#160;accessed and dirty&#160;flags for EPT will be enabled.<br/>‚Äî&#160;For an&#160;EPT&#160;PDPTE or an&#160;EPT&#160;PDE,&#160;changing&#160;bit&#160;7&#160;(which determines whether&#160;the&#160;entry maps&#160;a page).<br/>‚Äî&#160;For&#160;&#160;the<b>&#160;last</b>&#160;EPT paging-structure entry used to translate a&#160;guest-physical address (an&#160;EPT PDPTE with bit&#160;7&#160;</p>
<p style="position:absolute;top:270px;left:119px;white-space:nowrap" class="ft06">set to&#160;1, an EPT PDE with&#160;bit&#160;7&#160;set to&#160;1, or an&#160;EPT&#160;PTE),&#160;changing&#160;either&#160;bits&#160;5:3&#160;or&#160;bit&#160;6. (These&#160;bits&#160;<br/>determine&#160;the effective&#160;memory type of accesses&#160;using&#160;that EPT&#160;<a href="o_fe12b1e2a880e0ce-1160.html">paging-structure entry; see Section&#160;<br/>28.2.6.</a>)</p>
<p style="position:absolute;top:327px;left:93px;white-space:nowrap" class="ft03">‚Äî&#160;For&#160;&#160;the<b>&#160;last</b>&#160;EPT paging-structure entry used to translate a&#160;guest-physical address (an&#160;EPT PDPTE with bit&#160;7&#160;</p>
<p style="position:absolute;top:343px;left:119px;white-space:nowrap" class="ft06">set to&#160;1, an EPT PDE with&#160;bit&#160;7&#160;set to&#160;1, or an&#160;EPT&#160;PTE), clearing bit&#160;9&#160;(the&#160;dirty flag) if accessed&#160;and dirty&#160;<br/>flags for EPT&#160;will be&#160;enabled.</p>
<p style="position:absolute;top:382px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:382px;left:93px;white-space:nowrap" class="ft06">Software&#160;should&#160;use&#160;the&#160;INVEPT instruction with&#160;the ‚Äúsingle-context‚Äù&#160;INVEPT type before a&#160;VM&#160;entry with an&#160;<br/>EPTP&#160;value X such&#160;that&#160;X[6]&#160;= 1&#160;(accessed&#160;and dirty&#160;flags&#160;for&#160;EPT are enabled)&#160;if&#160;the logical processor had&#160;<br/>earlier been in&#160;VMX&#160;non-root operation with an&#160;EPTP&#160;value Y&#160;such&#160;that Y[6]&#160;= 0 (accessed&#160;and dirty&#160;flags&#160;for&#160;<br/>EPT are not enabled)&#160;and&#160;Y[51:12]&#160;=&#160;X[51:12].</p>
<p style="position:absolute;top:454px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:454px;left:93px;white-space:nowrap" class="ft06">Software may&#160;use the INVEPT instruction after&#160;modifying&#160;a present EPT paging-structure entry&#160;to&#160;change&#160;any&#160;<br/>of the&#160;privilege&#160;bits&#160;2:0 from 0&#160;to 1.&#160;Failure&#160;to do&#160;so&#160;may&#160;cause an&#160;EPT&#160;violation&#160;that would not&#160;otherwise&#160;occur.&#160;<br/>Because&#160;an EPT&#160;violation&#160;invalidates any&#160;mappings&#160;that would be used by the access&#160;that caused the&#160;EPT&#160;<br/><a href="o_fe12b1e2a880e0ce-1163.html">violation (see Section 28.3.3.1)</a>, an EPT violation will not recur if the&#160;original access is&#160;performed again, even if&#160;<br/>the INVEPT&#160;instruction&#160;is not executed.</p>
<p style="position:absolute;top:542px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:543px;left:93px;white-space:nowrap" class="ft06">Because&#160;a logical processor does&#160;not cache&#160;any&#160;information&#160;derived&#160;from EPT paging-structure entries that&#160;are&#160;<br/>not&#160;present or misconfigured<a href="o_fe12b1e2a880e0ce-1155.html">&#160;(see Section 28.2.3.1)</a>, it&#160;is not necessary&#160;to execute INVEPT&#160;following&#160;modifi-<br/>cation of&#160;an&#160;EPT paging-structure&#160;entry&#160;that had&#160;been&#160;not present or&#160;misconfigured.</p>
<p style="position:absolute;top:598px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:598px;left:93px;white-space:nowrap" class="ft06">As&#160;de<a href="o_fe12b1e2a880e0ce-1176.html">tailed in&#160;Section&#160;29.4.5,&#160;</a>an access to&#160;the APIC-access page&#160;might not cause an&#160;APIC-access&#160;VM&#160;exit&#160;if&#160;<br/>software does not properly invalidate&#160;information that&#160;may be cached from the&#160;EPT paging&#160;structures.&#160;If&#160;EPT&#160;<br/>was in&#160;use on&#160;a&#160;logical&#160;processor&#160;at one&#160;time with EPTP&#160;X,&#160;it is&#160;recommended that software&#160;use&#160;the INVEPT&#160;<br/>instruction with the&#160;‚Äúsingle-context‚Äù&#160;INVEPT&#160;type&#160;and&#160;with EPTP X in&#160;the INVEPT&#160;descriptor before&#160;a VM&#160;entry&#160;<br/>on the&#160;same&#160;logical processor that&#160;enables EPT&#160;with&#160;EPTP&#160;X&#160;and either (a)&#160;the&#160;‚Äúvirtualize APIC accesses‚Äù VM-<br/>execution control&#160;was changed from&#160;0&#160;to 1;&#160;or (b)&#160;the&#160;value of the&#160;APIC-access address&#160;was changed.</p>
<p style="position:absolute;top:703px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:703px;left:93px;white-space:nowrap" class="ft06">Software&#160;can use the INVEPT&#160;instruction with the ‚Äúall-context‚Äù&#160;INVEPT type immediately&#160;after execution of&#160;the&#160;<br/>VMXON instruction or&#160;immediately prior&#160;to execution&#160;of&#160;the VMXOFF instruction.&#160;Either prevents&#160;potentially&#160;<br/>undesired retention&#160;of&#160;information&#160;cached from EPT&#160;paging structures&#160;between&#160;separate uses of&#160;VMX&#160;<br/>operation.</p>
<p style="position:absolute;top:777px;left:68px;white-space:nowrap" class="ft06">In&#160;a system&#160;containing&#160;more than&#160;one&#160;logical&#160;processor,&#160;software&#160;must account for the&#160;fact that information&#160;from&#160;<br/>an&#160;EPT paging-structure&#160;entry may&#160;be&#160;cached on&#160;logical processors&#160;other than the one&#160;that&#160;modifies&#160;that entry.&#160;The&#160;<br/>process&#160;of propagating&#160;the&#160;changes to a&#160;paging-structure&#160;entry is&#160;commonly referred&#160;to as&#160;‚ÄúTLB shootdown.‚Äù&#160;A&#160;<br/>discussion of&#160;TLB shootdown appears&#160;<a href="o_fe12b1e2a880e0ce-149.html">in Section 4.10.5, ‚ÄúPropagation of Paging-Structure&#160;Changes to&#160;Multiple&#160;<br/>Processors,‚Äù</a>&#160;in&#160;<a href="˛ˇ">the&#160;<i>Intel¬Æ 64&#160;and&#160;IA-32&#160;Architectures Software&#160;Developer‚Äôs&#160;Manual,&#160;Volume 3A</i></a>.</p>
</div>
</body>
</html>
