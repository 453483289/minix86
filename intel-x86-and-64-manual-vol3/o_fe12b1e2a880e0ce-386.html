<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 386</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:20px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page386-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce386.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">10-24&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">ADVANCED PROGRAMMABLE INTERRUPT CONTROLLER&#160;(APIC)</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">1.&#160;<b>Flat&#160;Model&#160;</b>—&#160;This model&#160;is selected by programming DFR&#160;bits&#160;28&#160;through 31&#160;to 1111. Here, a&#160;unique&#160;logical&#160;</p>
<p style="position:absolute;top:117px;left:93px;white-space:nowrap" class="ft05">APIC&#160;ID can&#160;be established&#160;for up to&#160;8&#160;local APICs&#160;by setting a different bit in&#160;the logical&#160;APIC&#160;ID&#160;field of the LDR&#160;<br/>for&#160;each&#160;local&#160;APIC. A group of&#160;local&#160;APICs&#160;can&#160;then&#160;be&#160;selected by setting one&#160;or&#160;more&#160;bits in&#160;the MDA.&#160;<br/>Each&#160;local APIC performs&#160;a bit-wise AND&#160;of&#160;the MDA and&#160;its logical APIC&#160;ID.&#160;If&#160;a&#160;true condition&#160;is detected,&#160;the&#160;<br/>local&#160;APIC&#160;accepts&#160;the IPI message. A broadcast to&#160;all APICs&#160;is&#160;achieved by setting the&#160;MDA&#160;to 1s.</p>
<p style="position:absolute;top:196px;left:68px;white-space:nowrap" class="ft02">2.&#160;<b>Cluster Model&#160;</b>— This&#160;model is&#160;selected&#160;by programming DFR&#160;bits&#160;28&#160;through 31&#160;to 0000.&#160;This&#160;model supports&#160;</p>
<p style="position:absolute;top:213px;left:93px;white-space:nowrap" class="ft05">two&#160;basic&#160;destination&#160;schemes: flat cluster and&#160;hierarchical&#160;cluster.<br/>The&#160;flat cluster destination&#160;model&#160;is only supported&#160;for&#160;P6&#160;family&#160;and&#160;Pentium&#160;processors.&#160;Using&#160;this&#160;model,&#160;all&#160;<br/>APICs&#160;are assumed to&#160;be connected&#160;through the APIC bus.&#160;Bits&#160;60&#160;through 63 of&#160;the MDA&#160;contains the&#160;encoded&#160;<br/>address of the destination&#160;cluster&#160;and bits 56 through&#160;59&#160;identify up&#160;to four local&#160;APICs&#160;within&#160;the cluster (each&#160;<br/>bit is&#160;assigned&#160;to one&#160;local APIC in&#160;the&#160;cluster,&#160;as&#160;in&#160;the&#160;flat connection model).&#160;To&#160;identify one&#160;or&#160;more local&#160;<br/>APICs, bits 60 through 63 of the&#160;MDA&#160;are compared with&#160;bits 28 through 31 of the&#160;LDR to&#160;determine if a&#160;local&#160;<br/>APIC is&#160;part of the cluster.&#160;Bits 56 through&#160;59 of&#160;the&#160;MDA are compared with Bits&#160;24&#160;through 27&#160;of the&#160;LDR to&#160;<br/>identify a&#160;local APICs within the&#160;cluster.&#160;<br/>Sets&#160;of processors within&#160;a cluster&#160;can be specified&#160;by&#160;writing the&#160;target&#160;cluster&#160;address in bits 60 through 63&#160;<br/>of the&#160;MDA&#160;and setting&#160;selected bits&#160;in bits 56&#160;through 59&#160;of the&#160;MDA,&#160;corresponding to&#160;the chosen&#160;members&#160;<br/>of&#160;the cluster.&#160;In&#160;this mode, 15&#160;clusters (with cluster&#160;addresses of 0 through 14) each&#160;having&#160;4&#160;local&#160;APICs&#160;can&#160;<br/>be specified in&#160;the&#160;message. For&#160;the P6&#160;and Pentium processor’s&#160;local APICs,&#160;however,&#160;the&#160;APIC arbitration&#160;ID&#160;<br/>supports&#160;only 15&#160;APIC&#160;agents. Therefore,&#160;the total&#160;number&#160;of&#160;processors&#160;and&#160;their local&#160;APICs supported&#160;in&#160;<br/>this&#160;mode&#160;is&#160;limited&#160;to&#160;15.&#160;Broadcast&#160;to all&#160;local APICs is&#160;achieved&#160;by&#160;setting&#160;all destination bits&#160;to one. This&#160;<br/>guarantees&#160;a match on all&#160;clusters&#160;and selects all APICs&#160;in each&#160;cluster.&#160;A&#160;broadcast&#160;IPI&#160;or I/O&#160;subsystem&#160;<br/>broadcast interrupt with&#160;lowest priority&#160;delivery mode&#160;is not supported&#160;in cluster&#160;mode&#160;and must not be&#160;<br/>configured by&#160;software.<br/>The&#160;hierarchical cluster destination&#160;model&#160;can be used&#160;with&#160;Pentium&#160;4,&#160;Intel&#160;Xeon, P6 family, or&#160;Pentium&#160;<br/>processors. With&#160;this model, a&#160;hierarchical&#160;network can be created&#160;by&#160;connecting different flat clusters via&#160;<br/>independent system or&#160;APIC buses.&#160;This&#160;scheme requires&#160;a cluster manager&#160;within&#160;each cluster,&#160;which&#160;is&#160;<br/>responsible&#160;for&#160;handling message passing between system or&#160;APIC&#160;buses.&#160;One cluster&#160;contains up to&#160;4 agents.&#160;<br/>Thus 15 cluster&#160;managers,&#160;each&#160;with&#160;4 agents,&#160;can form&#160;a network of&#160;up&#160;to 60 APIC&#160;agents.&#160;Note that&#160;hierar-<br/>chical APIC&#160;networks&#160;requires&#160;a special&#160;cluster manager&#160;device,&#160;which is&#160;not part&#160;of the&#160;local or&#160;the I/O&#160;APIC&#160;<br/>units.</p>
<p style="position:absolute;top:645px;left:428px;white-space:nowrap" class="ft04">NOTES</p>
<p style="position:absolute;top:670px;left:120px;white-space:nowrap" class="ft05">All&#160;processors that&#160;have&#160;their APIC software enabled&#160;(using&#160;the spurious vector enable/disable&#160;bit)&#160;<br/>must&#160;have&#160;their DFRs (Destination&#160;Format Registers)&#160;programmed identically.<br/>The&#160;default mode&#160;for DFR is&#160;flat mode.&#160;If&#160;you are using&#160;cluster mode,&#160;DFRs&#160;must be&#160;programmed&#160;<br/>before&#160;the&#160;APIC&#160;is software&#160;enabled. Since&#160;some&#160;chipsets do not accurately track&#160;a system&#160;view&#160;of&#160;<br/>the logical mode, program&#160;DFRs&#160;as soon&#160;as&#160;possible after&#160;starting&#160;the processor.</p>
<p style="position:absolute;top:785px;left:68px;white-space:nowrap" class="ft04">10.6.2.3 &#160;&#160;Broadcast/Self Delivery&#160;Mode</p>
<p style="position:absolute;top:814px;left:68px;white-space:nowrap" class="ft05">The&#160;destination&#160;shorthand field&#160;of the&#160;ICR allows the&#160;delivery mode&#160;to&#160;be&#160;by-passed in favor&#160;of broadcasting the IPI&#160;<br/>to all&#160;the processors on&#160;the&#160;system bus and/or&#160;back to&#160;itself (see<a href="o_fe12b1e2a880e0ce-380.html">&#160;Section 10.6.1, “Interrupt&#160;Command Register&#160;<br/>(ICR)”).&#160;</a>Three destination shorthands are supported:&#160;self,&#160;all excluding&#160;self,&#160;and all including self. The destination&#160;<br/>mode&#160;is ignored when a&#160;destination shorthand&#160;is used.</p>
<p style="position:absolute;top:907px;left:68px;white-space:nowrap" class="ft04">10.6.2.4 &#160;&#160;Lowest&#160;Priority Delivery&#160;Mode</p>
<p style="position:absolute;top:936px;left:68px;white-space:nowrap" class="ft05">With lowest priority&#160;delivery mode, the ICR is&#160;programmed to&#160;send&#160;an IPI&#160;to several&#160;processors on the&#160;system bus,&#160;<br/>using the&#160;logical&#160;or shorthand destination mechanism for&#160;selecting&#160;the processor.&#160;The selected processors then&#160;<br/>arbitrate&#160;with&#160;one another over the&#160;system&#160;bus or&#160;the APIC bus, with the&#160;lowest-priority processor accepting&#160;the&#160;<br/>IPI.&#160;<br/>For systems&#160;based&#160;on the&#160;Intel&#160;Xeon&#160;processor,&#160;the chipset bus&#160;controller accepts messages&#160;from&#160;the I/O&#160;APIC&#160;<br/>agents in&#160;the system&#160;and directs interrupts to&#160;the processors on&#160;the&#160;system bus. When&#160;using&#160;the lowest&#160;priority&#160;<br/>delivery mode, the&#160;chipset chooses&#160;a target&#160;processor to receive the&#160;interrupt out of&#160;the set&#160;of&#160;possible targets. The&#160;<br/>Pentium&#160;4 processor provides a&#160;special bus&#160;cycle&#160;on the&#160;system bus&#160;that informs&#160;the chipset of&#160;the&#160;current task&#160;</p>
</div>
</body>
</html>
