<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1059</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1059-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1059.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;24-13</p>
<p style="position:absolute;top:47px;left:591px;white-space:nowrap" class="ft01">VIRTUAL MACHINE CONTROL STRUCTURES</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08">An execution of MOV to CR3&#160;in VMX&#160;non-root&#160;operation&#160;does&#160;not&#160;cause&#160;a VM&#160;exit&#160;if its&#160;source operand matches&#160;one&#160;<br/>of these values. If the&#160;CR3-target count is&#160;<i>n</i>, only&#160;the first&#160;<i>n</i>&#160;CR3-target&#160;values are&#160;considered;&#160;if&#160;the CR3-target&#160;<br/>count is&#160;0, MOV to&#160;CR3 always causes&#160;a VM&#160;exit<br/>There are no limitations&#160;on&#160;the values&#160;that can&#160;be written&#160;for&#160;the CR3-target values. VM&#160;entry&#160;<a href="o_fe12b1e2a880e0ce-1094.html">fails (see Section&#160;<br/>26.2)&#160;</a>if&#160;the CR3-target count&#160;is greater than&#160;4.<br/>Future processors may support&#160;a different&#160;number of CR3-target values. Software&#160;should&#160;read&#160;the&#160;VMX capability&#160;<br/>MSR&#160;IA32_VMX_MIS<a href="o_fe12b1e2a880e0ce-1947.html">C (see Appendix&#160;A.6)&#160;</a>to determine&#160;the&#160;number&#160;of values supported.</p>
<p style="position:absolute;top:265px;left:69px;white-space:nowrap" class="ft04">24.6.8&#160;</p>
<p style="position:absolute;top:265px;left:149px;white-space:nowrap" class="ft04">Controls for APIC Virtualization</p>
<p style="position:absolute;top:295px;left:69px;white-space:nowrap" class="ft02">There are three&#160;mechanisms&#160;by which&#160;software accesses&#160;registers of&#160;the&#160;logical&#160;processor‚Äôs local&#160;APIC:</p>
<p style="position:absolute;top:317px;left:69px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:318px;left:95px;white-space:nowrap" class="ft010">If the local&#160;APIC is&#160;in&#160;xAPIC mode, it can perform memory-mapped accesses to addresses&#160;in the 4-KByte page&#160;<br/>referenced&#160;by the&#160;physical&#160;address in&#160;the IA32_APIC_BASE&#160;MSR (see<a href="o_fe12b1e2a880e0ce-370.html">&#160;Section 10.4.4,&#160;‚ÄúLocal APIC Status and&#160;<br/>Location‚Äù in</a><a href="˛ˇ">&#160;the&#160;<i>Intel¬Æ&#160;64&#160;and&#160;IA-32&#160;Architectures Software Developer‚Äôs&#160;Manual,&#160;Volume&#160;3A</i></a>&#160;and&#160;<a href="˛ˇ"><i>Intel¬Æ 64&#160;<br/>Architecture&#160;Processor Topology&#160;Enumeration</i></a>).</p>
<p style="position:absolute;top:365px;left:413px;white-space:nowrap" class="ft06">1</p>
<p style="position:absolute;top:389px;left:69px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:390px;left:95px;white-space:nowrap" class="ft08">If the&#160;local APIC is&#160;in x2APIC mode, it&#160;can accesses the&#160;local&#160;APIC‚Äôs&#160;registers using&#160;the&#160;RDMSR&#160;and&#160;WRMSR&#160;<br/>instructions (see&#160;<a href="˛ˇ"><i>Intel¬Æ 64 Architecture Processor Topology&#160;Enumeration</i></a>).</p>
<p style="position:absolute;top:428px;left:69px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:429px;left:95px;white-space:nowrap" class="ft02">In&#160;64-bit mode,&#160;it can&#160;access the local&#160;APIC‚Äôs&#160;task-priority&#160;register (TPR) using&#160;the MOV&#160;CR8 instruction.</p>
<p style="position:absolute;top:453px;left:69px;white-space:nowrap" class="ft08">There are five&#160;processor-based VM-execution&#160;controls&#160;(s<a href="o_fe12b1e2a880e0ce-1055.html">ee Section 24.6.2</a>)&#160;that control such&#160;accesses. There are&#160;<br/>‚Äúuse&#160;TPR shadow‚Äù,&#160;‚Äúvirtualize&#160;APIC accesses‚Äù,&#160;‚Äúvirtualize&#160;x2APIC mode‚Äù,&#160;‚Äúvirtual-interrupt delivery‚Äù, and&#160;‚ÄúAPIC-<br/>register&#160;virtualization‚Äù.&#160;These&#160;controls&#160;interact&#160;with&#160;the following fields:</p>
<p style="position:absolute;top:508px;left:69px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:508px;left:95px;white-space:nowrap" class="ft08"><b>APIC-access address</b>&#160;(64 bits).&#160;This field&#160;contains the&#160;physical&#160;address of&#160;the&#160;4-KByte&#160;<b>APIC-access page</b>.&#160;<br/>If&#160;the ‚Äúvirtualize APIC accesses‚Äù&#160;VM-execution&#160;control&#160;is 1,&#160;access&#160;to&#160;this page&#160;may cause VM&#160;exits or&#160;be&#160;<br/>virtualized by the&#160;processor.&#160;See<a href="o_fe12b1e2a880e0ce-1171.html">&#160;Section&#160;29.4.<br/></a>The&#160;APIC-access address exists&#160;only on processors that&#160;support the 1-setting of the&#160;‚Äúvirtualize APIC accesses‚Äù&#160;<br/>VM-execution control.</p>
<p style="position:absolute;top:602px;left:69px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:603px;left:95px;white-space:nowrap" class="ft09"><b>Virtual-APIC address</b>&#160;(64 bits). This field contains the physical&#160;address of the&#160;4-KByte&#160;<b>virtual-APIC page</b>.&#160;<br/>The&#160;processor uses&#160;the virtual-APIC page&#160;to virtualize certain accesses to&#160;APIC&#160;registers and&#160;to manage&#160;virtual&#160;<br/><a href="o_fe12b1e2a880e0ce-1167.html">interrupts; see Chapter&#160;29.<br/></a>Depending on the&#160;setting&#160;of the&#160;controls&#160;indicated earlier,&#160;the virtual-APIC page&#160;may be accessed&#160;by the&#160;<br/>following operations:<br/>‚Äî&#160;The MOV&#160;CR8&#160;instructions&#160;<a href="o_fe12b1e2a880e0ce-1171.html">(see Section 29.3).<br/></a>‚Äî&#160;Accesses to the&#160;APIC-access page&#160;if, in addition, the&#160;‚Äúvirtualize APIC accesses‚Äù VM-execution&#160;control&#160;is 1&#160;</p>
<p style="position:absolute;top:739px;left:120px;white-space:nowrap" class="ft02">(s<a href="o_fe12b1e2a880e0ce-1171.html">ee Section&#160;29.4).</a></p>
<p style="position:absolute;top:763px;left:95px;white-space:nowrap" class="ft02">‚Äî&#160;The&#160;RDMSR&#160;and WRMSR instructions if, in addition,&#160;the&#160;value&#160;of ECX is in the&#160;range&#160;800H‚Äì8FFH (indicating&#160;</p>
<p style="position:absolute;top:780px;left:120px;white-space:nowrap" class="ft02">an APIC MSR) and the&#160;‚Äúvirtualize&#160;x2APIC mode‚Äù&#160;VM-execution&#160;control&#160;is 1&#160;(see<a href="o_fe12b1e2a880e0ce-1178.html">&#160;Section 29.5).</a></p>
<p style="position:absolute;top:802px;left:95px;white-space:nowrap" class="ft08">If the ‚Äúuse TPR shadow‚Äù VM-execution control is 1, VM&#160;entry ensures that the virtual-APIC address is 4-KByte&#160;<br/>aligned.&#160;The virtual-APIC address&#160;exists&#160;only on processors that&#160;support&#160;the&#160;1-setting of the ‚Äúuse&#160;TPR&#160;shadow‚Äù&#160;<br/>VM-execution control.</p>
<p style="position:absolute;top:857px;left:69px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:858px;left:95px;white-space:nowrap" class="ft08"><b>TPR threshold</b>&#160;(32 bits). Bits&#160;3:0&#160;of&#160;this field determine&#160;the threshold below&#160;which bits&#160;7:4&#160;of&#160;VTPR (see&#160;<br/><a href="o_fe12b1e2a880e0ce-1167.html">Section 29.1.1) cannot fall.</a>&#160;If&#160;the ‚Äúvirtual-interrupt&#160;delivery‚Äù VM-execution control is 0, a VM&#160;exit occurs after&#160;<br/>an operation (e.g.,&#160;an execution&#160;of MOV to CR8)&#160;that&#160;reduces the value of those bits below the TPR threshold.&#160;<br/>S<a href="o_fe12b1e2a880e0ce-1168.html">ee Section 29.1.2.<br/></a>The&#160;TPR threshold exists only&#160;on processors that support the 1-setting of the ‚Äúuse TPR shadow‚Äù&#160;VM-execution&#160;<br/>control.</p>
<p style="position:absolute;top:968px;left:69px;white-space:nowrap" class="ft05">‚Ä¢</p>
<p style="position:absolute;top:969px;left:95px;white-space:nowrap" class="ft08"><b>EOI-exit&#160;bitmap</b>&#160;(4 fields; 64&#160;bits each).&#160;These&#160;fields&#160;are supported&#160;only&#160;on&#160;processors&#160;that support the&#160;1-<br/>setting&#160;of the&#160;‚Äúvirtual-interrupt&#160;delivery‚Äù VM-execution&#160;control.&#160;They are&#160;used&#160;to determine which virtualized&#160;<br/>writes&#160;to the&#160;APIC‚Äôs&#160;EOI register&#160;cause VM&#160;exits:</p>
<p style="position:absolute;top:1054px;left:69px;white-space:nowrap" class="ft02">1.&#160;If the local APIC does&#160;not support x2APIC mode, it is always in xAPIC mode.</p>
</div>
</body>
</html>
