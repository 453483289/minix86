<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1019</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1019-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1019.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;22-15</p>
<p style="position:absolute;top:47px;left:657px;white-space:nowrap" class="ft01">ARCHITECTURE&#160;COMPATIBILITY</p>
<p style="position:absolute;top:98px;left:69px;white-space:nowrap" class="ft02">22.18.12&#160;FPU Instruction Synchronization</p>
<p style="position:absolute;top:129px;left:69px;white-space:nowrap" class="ft07">On the 32-bit x87 FPUs, all&#160;floating-point instructions are automatically synchronized; that is, the processor&#160;auto-<br/>matically waits until the previous floating-point&#160;instruction&#160;has&#160;completed before completing the next&#160;floating-point&#160;<br/>instruction. No&#160;explicit&#160;WAIT/FWAIT instructions are&#160;required&#160;to&#160;assure this&#160;synchronization.&#160;For the&#160;8087 math&#160;<br/>coprocessors, explicit&#160;waits are required before each floating-point&#160;instruction to ensure&#160;synchronization. Although&#160;<br/>8087 programs having explicit WAIT&#160;instructions execute perfectly on the&#160;32-bit IA-32&#160;processors without&#160;reas-<br/>sembly,&#160;these WAIT instructions are&#160;unnecessary.</p>
<p style="position:absolute;top:267px;left:69px;white-space:nowrap" class="ft04">22.19 SERIALIZING&#160;</p>
<p style="position:absolute;top:267px;left:271px;white-space:nowrap" class="ft04">INSTRUCTIONS</p>
<p style="position:absolute;top:303px;left:69px;white-space:nowrap" class="ft07">Certain&#160;instructions have&#160;been defined to serialize&#160;instruction&#160;execution to ensure that modifications to flags, regis-<br/>ters&#160;and memory are&#160;completed before the&#160;next&#160;instruction&#160;is executed (or&#160;in P6 family&#160;processor&#160;terminology&#160;<br/>‚Äúcommitted&#160;to machine state‚Äù). Because the&#160;P6&#160;family&#160;processors&#160;use branch-prediction&#160;and out-of-order execu-<br/>tion techniques to improve performance,&#160;instruction&#160;execution&#160;is not generally&#160;serialized&#160;until the&#160;results of an&#160;<br/>executed instruction are&#160;committed&#160;to&#160;machine&#160;state&#160;(see&#160;<a href="˛ˇ">Chapter 2, ‚ÄúIntel¬Æ&#160;64&#160;and IA-32 Architectures,‚Äù in&#160;</a>the&#160;<br/><a href="˛ˇ"><i>Intel¬Æ&#160;64&#160;and IA-32&#160;Architectures&#160;Software Developer‚Äôs Manual, Volume 1</i>).&#160;<br/></a>As a&#160;result,&#160;at places&#160;in&#160;a program&#160;or&#160;task where it&#160;is critical to&#160;have&#160;execution&#160;completed for all&#160;previous instruc-<br/>tions before&#160;executing&#160;the&#160;next&#160;instruction&#160;(for&#160;example,&#160;at a&#160;branch, at&#160;the&#160;end&#160;of&#160;a procedure, or in&#160;multipro-<br/>cessor dependent code), it is&#160;useful&#160;to&#160;add&#160;a serializing instruction. See&#160;<a href="o_fe12b1e2a880e0ce-273.html">Section 8.3, ‚ÄúSerializing Instructions,‚Äù&#160;for&#160;<br/></a>more&#160;information on&#160;serializing instructions.</p>
<p style="position:absolute;top:514px;left:69px;white-space:nowrap" class="ft04">22.20&#160;&#160;FPU AND MATH COPROCESSOR INITIALIZATION</p>
<p style="position:absolute;top:550px;left:69px;white-space:nowrap" class="ft07"><a href="o_fe12b1e2a880e0ce-314.html">Table&#160;9-1&#160;</a>shows the&#160;states&#160;of the&#160;FPUs in&#160;the&#160;P6&#160;family,&#160;Pentium, Intel486 processors and of the&#160;Intel&#160;387 math&#160;<br/>coprocessor and&#160;Intel&#160;287 coprocessor following&#160;a power-up,&#160;reset, or&#160;INIT,&#160;or following the&#160;execution of an&#160;<br/>FINIT/FNINIT instruction. The following is some additional&#160;compatibility information concerning&#160;the&#160;initialization of&#160;<br/>x87 FPUs and&#160;math&#160;coprocessors.</p>
<p style="position:absolute;top:650px;left:69px;white-space:nowrap" class="ft02">22.20.1 Intel</p>
<p style="position:absolute;top:649px;left:186px;white-space:nowrap" class="ft01">¬Æ</p>
<p style="position:absolute;top:650px;left:204px;white-space:nowrap" class="ft02">387 and Intel</p>
<p style="position:absolute;top:649px;left:313px;white-space:nowrap" class="ft01">¬Æ</p>
<p style="position:absolute;top:650px;left:330px;white-space:nowrap" class="ft02">287 Math Coprocessor Initialization</p>
<p style="position:absolute;top:681px;left:69px;white-space:nowrap" class="ft03">Following an&#160;Intel386&#160;processor reset,&#160;the processor identifies its&#160;coprocessor&#160;type&#160;(Intel</p>
<p style="position:absolute;top:678px;left:669px;white-space:nowrap" class="ft06">¬Æ</p>
<p style="position:absolute;top:681px;left:685px;white-space:nowrap" class="ft03">287 or&#160;Intel</p>
<p style="position:absolute;top:678px;left:764px;white-space:nowrap" class="ft06">¬Æ</p>
<p style="position:absolute;top:681px;left:779px;white-space:nowrap" class="ft03">387 DX&#160;</p>
<p style="position:absolute;top:697px;left:69px;white-space:nowrap" class="ft07">math coprocessor) by&#160;sampling its&#160;ERROR#&#160;input some&#160;time&#160;after the&#160;falling edge&#160;of RESET# signal&#160;and&#160;before&#160;<br/>execution of the first floating-point&#160;instruction.&#160;The Intel&#160;287&#160;coprocessor keeps&#160;its&#160;ERROR# output&#160;in inactive&#160;<br/>state after&#160;hardware&#160;reset;&#160;the Intel&#160;387 coprocessor keeps&#160;its ERROR# output&#160;in&#160;active&#160;state after&#160;hardware&#160;<br/>reset.&#160;<br/>Upon hardware reset or execution of the FINIT/FNINIT instruction, the&#160;Intel&#160;387 math coprocessor signals an error&#160;<br/>condition. The P6 family, Pentium,&#160;and&#160;Intel486&#160;processors,&#160;like&#160;the&#160;Intel&#160;287&#160;coprocessor,&#160;do&#160;not.</p>
<p style="position:absolute;top:838px;left:69px;white-space:nowrap" class="ft02">22.20.2&#160;&#160;Intel486 SX Processor and Intel&#160;487&#160;SX Math Coprocessor Initialization</p>
<p style="position:absolute;top:868px;left:69px;white-space:nowrap" class="ft07">When&#160;initializing&#160;an&#160;Intel486&#160;SX processor and an&#160;Intel&#160;487&#160;SX math&#160;coprocessor,&#160;the initialization routine should&#160;<br/>check&#160;the presence&#160;of&#160;the math coprocessor and&#160;should&#160;set the&#160;FPU related&#160;flags (EM, MP, and&#160;NE)&#160;in control&#160;<br/>register&#160;CR0&#160;accordingly (see<a href="o_fe12b1e2a880e0ce-75.html">&#160;Section 2.5, ‚ÄúControl&#160;Registers,‚Äù for a&#160;</a>complete&#160;<a href="o_fe12b1e2a880e0ce-1020.html">description of these flags). Table&#160;<br/>22-2&#160;gives the&#160;</a>recommended&#160;settings for these&#160;flags when the math coprocessor is present.&#160;The&#160;FSTCW instruction&#160;<br/>will give&#160;a value&#160;of&#160;FFFFH for the&#160;Intel486 SX&#160;microprocessor and&#160;037FH&#160;for&#160;the Intel&#160;487&#160;SX math coprocessor.</p>
</div>
</body>
</html>
