<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 609</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:8px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#0860a8;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:18px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;font-family:Times;color:#000000;}
	.ft09{font-size:12px;font-family:Times;color:#0860a8;}
	.ft010{font-size:9px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft012{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft013{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft014{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page609-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce609.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;17-35</p>
<p style="position:absolute;top:47px;left:425px;white-space:nowrap" class="ft01">DEBUG, BRANCH&#160;PROFILE, TSC, AND RESOURCE MONITORING FEATURES</p>
<p style="position:absolute;top:469px;left:69px;white-space:nowrap" class="ft011">Additional&#160;information is&#160;saved if an&#160;exception or&#160;interrupt occurs in&#160;conjunction&#160;with&#160;a branch instruction.&#160;If&#160;a&#160;<br/>branch instruction generates&#160;a trap type exception, two&#160;branch records are&#160;stored&#160;in the&#160;LBR stack:&#160;a branch&#160;<br/>record for the&#160;branch&#160;instruction&#160;followed&#160;by a&#160;branch&#160;record for the&#160;exception.<br/>If a&#160;branch instruction is&#160;immediately&#160;followed&#160;by an interrupt,&#160;a branch&#160;record&#160;is stored in&#160;the LBR&#160;stack for the&#160;<br/>branch&#160;instruction&#160;followed&#160;by a record for the interrupt.&#160;</p>
<p style="position:absolute;top:593px;left:69px;white-space:nowrap" class="ft03">17.11.3&#160;&#160;Last&#160;Exception Records</p>
<p style="position:absolute;top:624px;left:69px;white-space:nowrap" class="ft02">The Pentium 4, Intel Xeon, Pentium M, Intel</p>
<p style="position:absolute;top:621px;left:360px;white-space:nowrap" class="ft04"><i>®</i></p>
<p style="position:absolute;top:624px;left:371px;white-space:nowrap" class="ft02">&#160;Core™ Solo, Intel</p>
<p style="position:absolute;top:621px;left:491px;white-space:nowrap" class="ft04"><i>®</i></p>
<p style="position:absolute;top:624px;left:502px;white-space:nowrap" class="ft02">&#160;Core™ Duo,&#160;Intel</p>
<p style="position:absolute;top:621px;left:621px;white-space:nowrap" class="ft04"><i>®</i></p>
<p style="position:absolute;top:624px;left:631px;white-space:nowrap" class="ft02">&#160;Core™2&#160;Duo,&#160;Intel</p>
<p style="position:absolute;top:621px;left:759px;white-space:nowrap" class="ft04"><i>®</i></p>
<p style="position:absolute;top:624px;left:769px;white-space:nowrap" class="ft02">&#160;Core™&#160;i7&#160;</p>
<p style="position:absolute;top:640px;left:69px;white-space:nowrap" class="ft02">and Intel</p>
<p style="position:absolute;top:638px;left:130px;white-space:nowrap" class="ft04"><i>®</i></p>
<p style="position:absolute;top:640px;left:140px;white-space:nowrap" class="ft02">&#160;Atom™ processors provide two MSRs&#160;(the&#160;MSR_LER_TO_LIP&#160;and&#160;the&#160;MSR_LER_FROM_LIP&#160;MSRs) that&#160;</p>
<p style="position:absolute;top:657px;left:69px;white-space:nowrap" class="ft011">duplicate&#160;the functions of the LastExceptionToIP and LastExceptionFromIP MSRs found in the P6&#160;family processors.&#160;<br/>The MSR_LER_TO_LIP&#160;and&#160;MSR_LER_FROM_LIP MSRs contain a&#160;branch record&#160;for the&#160;last branch that&#160;the&#160;<br/>processor took prior&#160;to an&#160;exception or interrupt being generated.</p>
<p style="position:absolute;top:745px;left:69px;white-space:nowrap" class="ft05">17.12&#160;&#160;LAST&#160;BRANCH, INTERRUPT, AND&#160;EXCEPTION RECORDING (INTEL® CORE™&#160;</p>
<p style="position:absolute;top:771px;left:147px;white-space:nowrap" class="ft05">SOLO AND INTEL® CORE™</p>
<p style="position:absolute;top:776px;left:377px;white-space:nowrap" class="ft06">&#160;</p>
<p style="position:absolute;top:771px;left:380px;white-space:nowrap" class="ft05">DUO PROCESSORS)</p>
<p style="position:absolute;top:807px;left:69px;white-space:nowrap" class="ft012">Intel Core Solo and Intel Core Duo processors provide last&#160;branch interrupt and exception recording. This capability&#160;<br/>is&#160;almost identical to&#160;that&#160;found in Pentium 4&#160;and&#160;Intel Xeon processors.&#160;There&#160;are differences in&#160;the stack&#160;and in&#160;<br/>some&#160;MSR names and locations.&#160;<br/>Note the&#160;following:</p>
<p style="position:absolute;top:886px;left:69px;white-space:nowrap" class="ft07">•</p>
<p style="position:absolute;top:886px;left:95px;white-space:nowrap" class="ft014"><b>IA32_DEBUGCTL MSR —&#160;</b>Enables debug&#160;trace interrupt, debug&#160;trace&#160;store,&#160;trace messages enable,&#160;<br/>performance monitoring breakpoint flags, single stepping&#160;on branches, and last branch. IA32_DEBUGCTL MSR&#160;<br/>is located at&#160;register address&#160;01D9H.&#160;<br/>S<a href="o_fe12b1e2a880e0ce-610.html">ee Figure&#160;17-14</a>&#160;for the&#160;layout and&#160;the entries&#160;below for a&#160;description of the&#160;flags:<br/>—&#160;<b>LBR (last branch/interrupt/exception) flag (bit 0)&#160;—&#160;</b>When set, the&#160;processor records a running trace&#160;</p>
<p style="position:absolute;top:982px;left:120px;white-space:nowrap" class="ft011">of&#160;the&#160;most recent branches,&#160;interrupts, and/or&#160;exceptions&#160;taken by&#160;the processor (prior&#160;to a&#160;debug&#160;<br/>exception&#160;being generated) in the&#160;last&#160;branch record&#160;(LBR) stack.&#160;For&#160;more&#160;information, see the&#160;“Last&#160;<br/>Branch Record&#160;(LBR) Stack”&#160;below.</p>
<p style="position:absolute;top:1039px;left:94px;white-space:nowrap" class="ft02">—&#160;<b>BTF&#160;(single-step&#160;on&#160;branches)&#160;flag&#160;(bit&#160;1)&#160;—&#160;</b>When&#160;set,&#160;the processor treats the&#160;TF flag&#160;in the&#160;EFLAGS&#160;</p>
<p style="position:absolute;top:1056px;left:120px;white-space:nowrap" class="ft02">register as a “single-step&#160;on branches”&#160;flag rather than&#160;a&#160;“single-step on&#160;instructions” flag. This mechanism&#160;</p>
<p style="position:absolute;top:406px;left:237px;white-space:nowrap" class="ft09">Figure&#160;17-13. &#160;LBR MSR Branch Record&#160;Layout for&#160;the&#160;Pentium 4&#160;</p>
<p style="position:absolute;top:424px;left:345px;white-space:nowrap" class="ft09">and Intel Xeon&#160;Processor Family</p>
<p style="position:absolute;top:171px;left:230px;white-space:nowrap" class="ft06">63</p>
<p style="position:absolute;top:190px;left:487px;white-space:nowrap" class="ft00">From Linear Address</p>
<p style="position:absolute;top:169px;left:634px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:191px;left:279px;white-space:nowrap" class="ft00">To&#160;Linear&#160;Address</p>
<p style="position:absolute;top:279px;left:232px;white-space:nowrap" class="ft06">63</p>
<p style="position:absolute;top:300px;left:487px;white-space:nowrap" class="ft00">From Linear Address</p>
<p style="position:absolute;top:279px;left:633px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:342px;left:631px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:342px;left:230px;white-space:nowrap" class="ft06">63</p>
<p style="position:absolute;top:361px;left:488px;white-space:nowrap" class="ft00">To&#160;Linear Address</p>
<p style="position:absolute;top:171px;left:421px;white-space:nowrap" class="ft06">32&#160;-&#160;31</p>
<p style="position:absolute;top:154px;left:232px;white-space:nowrap" class="ft00">MSR_LASTBRANCH_0 through MSR_LASTBRANCH_3&#160;</p>
<p style="position:absolute;top:140px;left:231px;white-space:nowrap" class="ft010"><b>CPUID Family 0FH, Models 0H-02H</b></p>
<p style="position:absolute;top:360px;left:281px;white-space:nowrap" class="ft00">Reserved</p>
<p style="position:absolute;top:245px;left:232px;white-space:nowrap" class="ft010"><b>CPUID Family 0FH, Model 03H-04H</b></p>
<p style="position:absolute;top:299px;left:278px;white-space:nowrap" class="ft00">Reserved</p>
<p style="position:absolute;top:260px;left:232px;white-space:nowrap" class="ft00">MSR_LASTBRANCH_0_FROM_IP through&#160;MSR_LASTBRANCH_15_FROM_IP</p>
<p style="position:absolute;top:342px;left:421px;white-space:nowrap" class="ft06">32&#160;-&#160;31</p>
<p style="position:absolute;top:279px;left:419px;white-space:nowrap" class="ft06">32&#160;-&#160;31</p>
<p style="position:absolute;top:328px;left:230px;white-space:nowrap" class="ft00">MSR_LASTBRANCH_0_TO_IP through MSR_LASTBRANCH_15_TO_IP</p>
</div>
</body>
</html>
