<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1037</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#0860a8;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1037-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1037.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;22-33</p>
<p style="position:absolute;top:47px;left:657px;white-space:nowrap" class="ft01">ARCHITECTURE&#160;COMPATIBILITY</p>
<p style="position:absolute;top:98px;left:69px;white-space:nowrap" class="ft02">22.33.1 Segment&#160;</p>
<p style="position:absolute;top:98px;left:226px;white-space:nowrap" class="ft02">Wraparound</p>
<p style="position:absolute;top:129px;left:69px;white-space:nowrap" class="ft07">On the 8086&#160;processor,&#160;an attempt&#160;to&#160;access a&#160;memory&#160;operand that crosses offset 65,535&#160;or 0FFFFH&#160;or offset 0&#160;<br/>(for example,&#160;moving&#160;a word to&#160;offset&#160;65,535&#160;or pushing&#160;a word when the&#160;stack pointer is&#160;set to&#160;1)&#160;causes&#160;the&#160;<br/>offset&#160;to wrap&#160;around modulo&#160;65,536&#160;or 010000H.&#160;With&#160;the Intel 286 processor,&#160;any base&#160;and&#160;offset&#160;combination&#160;<br/>that&#160;addresses beyond&#160;16&#160;MBytes wraps around to&#160;the&#160;1 MByte&#160;of&#160;the address&#160;space. The P6 family,&#160;Pentium,&#160;<br/>Intel486,&#160;and Intel386&#160;processors&#160;in real-address&#160;mode&#160;generate&#160;an exception&#160;in these&#160;cases:&#160;</p>
<p style="position:absolute;top:217px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:217px;left:95px;white-space:nowrap" class="ft07">A&#160;general-protection exception&#160;(#GP) if the segment&#160;is&#160;a&#160;data segment (that&#160;is,&#160;if the&#160;CS, DS,&#160;ES, FS, or&#160;GS&#160;<br/>register is&#160;being used&#160;to&#160;address the&#160;segment).</p>
<p style="position:absolute;top:256px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:256px;left:95px;white-space:nowrap" class="ft03">A stack-fault&#160;exception (#SS) if&#160;the&#160;segment is&#160;a stack&#160;segment (that&#160;is,&#160;if the&#160;SS&#160;register&#160;is being used).&#160;</p>
<p style="position:absolute;top:280px;left:69px;white-space:nowrap" class="ft07">An&#160;exception&#160;to this&#160;behavior occurs when a&#160;stack access&#160;is&#160;data aligned, and&#160;the stack&#160;pointer is&#160;pointing&#160;to the&#160;<br/>last aligned&#160;piece&#160;of data that size&#160;at the&#160;top&#160;of&#160;the stack&#160;(ESP&#160;is FFFFFFFCH). When&#160;this data&#160;is popped, no&#160;<br/>segment limit&#160;violation&#160;occurs&#160;and&#160;the stack pointer will wrap&#160;around to&#160;0.&#160;<br/>The address space of the P6&#160;family,&#160;Pentium, and&#160;Intel486&#160;processors may wraparound&#160;at 1&#160;MByte in real-address&#160;<br/>mode.&#160;An&#160;external A20M#&#160;pin forces&#160;wraparound&#160;if enabled.&#160;On&#160;Intel 8086&#160;processors,&#160;it&#160;is possible&#160;to specify&#160;<br/>addresses greater than&#160;1 MByte.&#160;For example,&#160;with a&#160;selector value&#160;FFFFH and&#160;an offset of FFFFH, the&#160;effective&#160;<br/>address would be&#160;10FFEFH (1&#160;MByte plus 65519&#160;bytes).&#160;The&#160;8086 processor,&#160;which can&#160;form addresses up&#160;to 20&#160;<br/>bits long, truncates the uppermost bit, which “wraps” this&#160;address to FFEFH. However,&#160;the P6 family, Pentium, and&#160;<br/>Intel486 processors do not truncate&#160;this bit&#160;if A20M# is&#160;not enabled.&#160;<br/>If&#160;a stack operation&#160;wraps around the&#160;address limit, shutdown occurs.&#160;(The&#160;8086 processor does not&#160;have&#160;a&#160;shut-<br/>down mode or&#160;a&#160;limit.)&#160;<br/>The behavior&#160;when&#160;executing near&#160;the limit&#160;of&#160;a 4-GByte&#160;selector (limit = FFFFFFFFH) is&#160;different&#160;between&#160;the&#160;<br/>Pentium&#160;Pro and the&#160;Pentium&#160;4 family of processors.&#160;On&#160;the Pentium Pro,&#160;instructions which cross the&#160;limit --&#160;for&#160;<br/>example, a&#160;two byte&#160;instruction such&#160;as&#160;INC EAX that is encoded as FFH C0H starting exactly at the limit&#160;faults for&#160;<br/>a segment violation&#160;(a one byte instruction at FFFFFFFFH does not&#160;cause&#160;an exception).&#160;Using the Pentium&#160;4&#160;micro-<br/>processor family,&#160;neither of&#160;these situations&#160;causes a&#160;fault.<br/>Segment wraparound&#160;and the functionality of A20M# is used primarily by older operating systems and not used by&#160;<br/>modern&#160;operating systems. On&#160;newer&#160;Intel 64 processors,&#160;A20M# may&#160;be&#160;absent.&#160;</p>
<p style="position:absolute;top:646px;left:69px;white-space:nowrap" class="ft05">22.34&#160;&#160;STORE BUFFERS AND MEMORY ORDERING</p>
<p style="position:absolute;top:682px;left:69px;white-space:nowrap" class="ft07">The Pentium 4, Intel Xeon,&#160;and P6 family&#160;processors provide a&#160;store&#160;buffer for temporary&#160;storage of writes&#160;(stores)&#160;<br/>to memory (see<a href="o_fe12b1e2a880e0ce-432.html">&#160;Section 11.10,&#160;“Store Buffer”</a>). Writes&#160;stored in&#160;the store buffer(s)&#160;are always&#160;written&#160;to memory&#160;<br/>in&#160;program order,&#160;with&#160;the exception&#160;of “fast string” store&#160;operations (see&#160;<a href="o_fe12b1e2a880e0ce-268.html">Section 8.2.4,&#160;“Fast-String Operation&#160;and&#160;<br/>Out-of-Order Stores”).<br/></a>The Pentium processor has two store&#160;buffers,&#160;one corresponding&#160;to each of the&#160;pipelines.&#160;Writes&#160;in&#160;these&#160;buffers&#160;<br/>are always written to&#160;memory&#160;in&#160;the order&#160;they&#160;were generated by the&#160;processor&#160;core.<br/>It&#160;should be noted that&#160;only memory writes&#160;are buffered&#160;and I/O&#160;writes&#160;are&#160;not.&#160;The Pentium 4,&#160;Intel Xeon, P6&#160;<br/>family,&#160;Pentium, and&#160;Intel486 processors do&#160;not synchronize the&#160;completion of&#160;memory&#160;writes on the bus&#160;and&#160;<br/>instruction execution&#160;after a&#160;write.&#160;An I/O,&#160;locked,&#160;or serializing instruction needs&#160;to be&#160;executed&#160;to&#160;synchronize&#160;<br/>writes&#160;with&#160;the ne<a href="o_fe12b1e2a880e0ce-273.html">xt instruction (see Section 8.3, “Serializing&#160;Instructions”).<br/></a>The&#160;Pentium&#160;4,&#160;Intel Xeon,&#160;and P6 family processors use&#160;processor&#160;ordering&#160;to maintain consistency in&#160;the order&#160;<br/>that data&#160;is&#160;read&#160;(loaded) and&#160;written&#160;(stored)&#160;in a&#160;program&#160;and the&#160;order&#160;the processor actually carries out the&#160;<br/>reads&#160;and writes.&#160;With this type of&#160;ordering, reads can be&#160;carried out speculatively and in any&#160;order,&#160;reads can&#160;pass&#160;<br/>buffered writes, and&#160;writes to memory are&#160;always carried out in&#160;program&#160;order.&#160;(S<a href="o_fe12b1e2a880e0ce-261.html">ee Section 8.2,&#160;“Memory&#160;<br/>Ordering,”&#160;for m</a>ore&#160;information about processor ordering.)&#160;The&#160;Pentium&#160;III&#160;processor introduced a&#160;new&#160;instruction&#160;<br/>to serialize&#160;writes and make&#160;them globally visible. Memory ordering issues can arise between a&#160;producer&#160;and a&#160;<br/>consumer&#160;of data. The&#160;SFENCE instruction provides&#160;a&#160;performance-efficient way of ensuring&#160;ordering&#160;between&#160;<br/>routines&#160;that produce weakly-ordered&#160;results and&#160;routines&#160;that consume&#160;this&#160;data.<br/>No&#160;re-ordering of&#160;reads occurs&#160;on&#160;the Pentium&#160;processor,&#160;except&#160;under the&#160;<a href="o_fe12b1e2a880e0ce-262.html">condition noted in Section 8.2.1,&#160;<br/>“Memory Ordering in&#160;the Intel</a></p>
<p style="position:absolute;top:1023px;left:271px;white-space:nowrap" class="ft06"><a href="o_fe12b1e2a880e0ce-262.html">®</a></p>
<p style="position:absolute;top:1026px;left:282px;white-space:nowrap" class="ft03"><a href="o_fe12b1e2a880e0ce-262.html">&#160;Pentium</a></p>
<p style="position:absolute;top:1023px;left:341px;white-space:nowrap" class="ft06"><a href="o_fe12b1e2a880e0ce-262.html">®</a></p>
<p style="position:absolute;top:1026px;left:352px;white-space:nowrap" class="ft03"><a href="o_fe12b1e2a880e0ce-262.html">&#160;and&#160;Intel486</a></p>
<p style="position:absolute;top:1023px;left:443px;white-space:nowrap" class="ft06"><a href="o_fe12b1e2a880e0ce-262.html">™</a></p>
<p style="position:absolute;top:1026px;left:453px;white-space:nowrap" class="ft03"><a href="o_fe12b1e2a880e0ce-262.html">&#160;Processors,”</a>&#160;and&#160;in the&#160;following paragraph describing&#160;</p>
<p style="position:absolute;top:1042px;left:69px;white-space:nowrap" class="ft03">the Intel486&#160;processor.&#160;</p>
</div>
</body>
</html>
