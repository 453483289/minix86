<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 584</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:18px;font-family:Times;color:#0860a8;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page584-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce584.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">17-10&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">DEBUG,&#160;BRANCH&#160;PROFILE,&#160;TSC,&#160;AND RESOURCE&#160;MONITORING&#160;FEATURES</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft08">ation&#160;clears&#160;the TF flag. After saving the return&#160;address or&#160;switching&#160;tasks, the external&#160;interrupt input&#160;is&#160;examined&#160;<br/>before the&#160;first instruction of the&#160;single-step handler&#160;executes. If&#160;the&#160;external&#160;interrupt is&#160;still&#160;pending,&#160;then&#160;it&#160;is&#160;<br/>serviced. The external&#160;interrupt&#160;handler does not&#160;run&#160;in&#160;single-step mode. To&#160;single&#160;step an&#160;interrupt&#160;handler,&#160;<br/>single&#160;step an INT&#160;<i>n</i>&#160;instruction that&#160;calls the&#160;interrupt&#160;handler.</p>
<p style="position:absolute;top:194px;left:68px;white-space:nowrap" class="ft04">17.3.1.5 &#160;&#160;Task-Switch Exception Condition</p>
<p style="position:absolute;top:223px;left:68px;white-space:nowrap" class="ft08">The processor generates a debug exception after a task switch&#160;if&#160;the T flag of the new task's&#160;TSS is&#160;set. This excep-<br/>tion is&#160;generated&#160;after program control has&#160;passed to&#160;the&#160;new task, and&#160;prior to&#160;the execution&#160;of the&#160;first&#160;instruc-<br/>tion of that&#160;task. The exception&#160;handler can&#160;detect this condition&#160;by examining the&#160;BT&#160;flag&#160;of&#160;the&#160;DR6&#160;register.<br/>If entry 1 (#DB) in the IDT&#160;is a&#160;task&#160;gate,&#160;the T&#160;bit&#160;of&#160;the&#160;corresponding TSS&#160;should&#160;not be&#160;set. Failure&#160;to observe&#160;<br/>this rule&#160;will&#160;put&#160;the&#160;processor in a&#160;loop.</p>
<p style="position:absolute;top:347px;left:68px;white-space:nowrap" class="ft05">17.3.2&#160;</p>
<p style="position:absolute;top:347px;left:148px;white-space:nowrap" class="ft05">Breakpoint&#160;Exception (#BP)‚ÄîInterrupt Vector 3</p>
<p style="position:absolute;top:377px;left:68px;white-space:nowrap" class="ft08">The breakpoint exception (interrupt 3)&#160;is caused by&#160;execution of an&#160;INT 3 instruction.&#160;S<a href="o_fe12b1e2a880e0ce-209.html">ee Chapter&#160;6,&#160;‚ÄúInterrupt&#160;<br/>3‚ÄîBreakpoint Exception (#BP).‚Äù&#160;</a>Debuggers use&#160;break&#160;exceptions&#160;in the&#160;same way that&#160;they use&#160;the breakpoint&#160;<br/>registers; that is, as&#160;a mechanism for suspending program execution&#160;to examine registers&#160;and memory locations.&#160;<br/>With earlier IA-32 processors,&#160;breakpoint&#160;exceptions are used extensively for setting instruction breakpoints.<br/>With&#160;the&#160;Intel386 and later IA-32 processors,&#160;it&#160;is more&#160;convenient&#160;to set breakpoints with&#160;the&#160;breakpoint-address&#160;<br/>registers&#160;(DR0 through DR3). However,&#160;the breakpoint&#160;exception&#160;still&#160;is useful for breakpointing debuggers,&#160;<br/>because&#160;a breakpoint exception can call a separate exception handler.&#160;The breakpoint exception&#160;is&#160;also useful when&#160;<br/>it&#160;is&#160;necessary to&#160;set&#160;more breakpoints than there are debug&#160;registers&#160;or when&#160;breakpoints&#160;are&#160;being&#160;placed&#160;in the&#160;<br/>source code of&#160;a program under&#160;development.</p>
<p style="position:absolute;top:567px;left:68px;white-space:nowrap" class="ft05">17.3.3&#160;</p>
<p style="position:absolute;top:567px;left:148px;white-space:nowrap" class="ft05">Debug Exceptions, Breakpoint&#160;Exceptions, and Restricted Transactional Memory&#160;</p>
<p style="position:absolute;top:588px;left:148px;white-space:nowrap" class="ft05">(RTM)</p>
<p style="position:absolute;top:619px;left:68px;white-space:nowrap" class="ft08"><a href="˛ˇ">Chapter 16,&#160;‚ÄúProgramming&#160;with Intel¬Æ&#160;Transactional Synchronization Extensions,‚Äù</a>&#160;of&#160;<a href="˛ˇ"><i>Intel¬Æ 64 and&#160;IA-32 Archi-<br/>tectures&#160;Software Developer‚Äôs Manual, Volume&#160;1</i></a>&#160;describes&#160;Restricted&#160;Transactional Memory (RTM).&#160;This is&#160;an&#160;<br/>instruction-set interface&#160;that allows software&#160;to identify&#160;<b>transactional regions</b>&#160;(or critical sections)&#160;using the&#160;<br/>XBEGIN&#160;and XEND&#160;instructions.<br/>Execution&#160;of an&#160;RTM transactional region begins with an XBEGIN instruction.&#160;If&#160;execution of the region successfully&#160;<br/>reaches&#160;an XEND instruction,&#160;the processor ensures that&#160;all memory&#160;operations&#160;performed within&#160;the region&#160;<br/>appear to&#160;have&#160;occurred instantaneously when&#160;viewed from&#160;other logical&#160;processors.&#160;Execution of an RTM transac-<br/>tion region&#160;does&#160;not succeed&#160;if&#160;the processor cannot&#160;commit the&#160;updates atomically.&#160;When this&#160;happens, the&#160;<br/>processor&#160;rolls back&#160;the execution, a&#160;process referred to&#160;as a&#160;<b>transactional abort</b>. In this&#160;case, the&#160;processor&#160;<br/>discards all&#160;updates&#160;performed&#160;in the&#160;region,&#160;restores&#160;architectural state&#160;to appear&#160;as if the execution&#160;had not&#160;<br/>occurred, and&#160;resumes execution at&#160;a fallback instruction&#160;address&#160;that was&#160;specified with the&#160;XBEGIN instruction.<br/>If debug&#160;exception (#DB) or&#160;breakpoint exception&#160;(#BP)&#160;occurs within an RTM transaction&#160;region,&#160;a transactional&#160;<br/>abort occurs,&#160;the&#160;processor&#160;sets EAX[4], and&#160;no exception&#160;is delivered.<br/>Software can&#160;enable&#160;<b>advanced&#160;debugging&#160;of&#160;RTM transactional&#160;regions</b>&#160;by&#160;setting&#160;DR7.RTM[bit&#160;11]&#160;and&#160;<br/>IA32_DEBUGCTL.RTM[bit&#160;15].&#160;If&#160;these&#160;bits&#160;are&#160;both set, the&#160;transactional abort&#160;caused by a&#160;#DB or #BP within&#160;an&#160;<br/>RTM transaction&#160;region&#160;does&#160;<b>not</b>&#160;resume&#160;execution at&#160;the&#160;fallback&#160;instruction&#160;address specified with&#160;the XBEGIN&#160;<br/>instruction that begin&#160;the&#160;region. Instead, execution is resumed at that&#160;XBEGIN instruction,&#160;and&#160;a #DB is delivered.&#160;<br/>(A&#160;#DB is&#160;delivered&#160;even&#160;if the&#160;transactional abort was&#160;caused&#160;by&#160;a #BP.) Such&#160;a #DB will&#160;clear DR6.RTM[bit&#160;16]&#160;<br/>(all&#160;other debug&#160;exceptions set DR6[16]).</p>
<p style="position:absolute;top:994px;left:68px;white-space:nowrap" class="ft07">17.4&#160;</p>
<p style="position:absolute;top:994px;left:147px;white-space:nowrap" class="ft07">LAST&#160;BRANCH, INTERRUPT, AND EXCEPTION RECORDING OVERVIEW</p>
<p style="position:absolute;top:1030px;left:68px;white-space:nowrap" class="ft08">P6 family processors introduced the&#160;ability&#160;to set&#160;breakpoints on taken branches,&#160;interrupts, and&#160;exceptions,&#160;and&#160;<br/>to single-step&#160;from&#160;one&#160;branch to the&#160;next.&#160;This capability&#160;has&#160;been modified and&#160;extended in the&#160;Pentium&#160;4, Intel&#160;</p>
</div>
</body>
</html>
