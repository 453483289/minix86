<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 144</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:8px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page144-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce144.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">4-40&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PAGING</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft06">A processor may&#160;or may not implement&#160;any&#160;of&#160;the paging-structure caches. Software should&#160;rely on neither&#160;their&#160;<br/>presence nor their absence.&#160;The&#160;processor&#160;may invalidate entries in these caches at&#160;any&#160;time. Because&#160;the&#160;<br/>processor may create the cache entries at the time of translation and not update them following subsequent modi-<br/>fications to the&#160;paging structures&#160;in memory, software&#160;should take care&#160;to&#160;invalidate&#160;the cache&#160;entries&#160;appropri-<br/>ately when causing&#160;such modifications.&#160;The&#160;invalidation of&#160;TLBs and the&#160;paging-structure&#160;caches&#160;is described&#160;in&#160;<br/><a href="o_fe12b1e2a880e0ce-145.html">Section 4.10.4.</a></p>
<p style="position:absolute;top:227px;left:68px;white-space:nowrap" class="ft03">4.10.3.2 &#160;&#160;Using the&#160;Paging-Structure&#160;Caches to&#160;Translate Linear Addresses</p>
<p style="position:absolute;top:256px;left:68px;white-space:nowrap" class="ft06">When a&#160;linear address is accessed, the processor uses a&#160;procedure such&#160;as the following to&#160;determine the physical&#160;<br/>address&#160;to which&#160;it translates&#160;and whether the&#160;access&#160;should be allowed:</p>
<p style="position:absolute;top:294px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:295px;left:93px;white-space:nowrap" class="ft06">If the processor&#160;finds a TLB entry that is for the page number of&#160;the&#160;linear address and that is associated with&#160;<br/>the current PCID (or&#160;which&#160;is&#160;global), it may use the physical address, access&#160;rights, and other&#160;attributes from&#160;<br/>that entry.</p>
<p style="position:absolute;top:349px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:350px;left:93px;white-space:nowrap" class="ft06">If the processor does not find a relevant TLB entry,&#160;it&#160;may use the upper bits of&#160;the linear address to select an&#160;<br/>entry from the&#160;PDE&#160;cache that&#160;is associated&#160;with the&#160;cu<a href="o_fe12b1e2a880e0ce-142.html">rrent PCID (Section 4.10.3.1&#160;</a>indicates&#160;which&#160;bits are&#160;<br/>used&#160;in&#160;each&#160;paging&#160;mode).&#160;It&#160;can&#160;then&#160;use&#160;that&#160;entry&#160;to complete&#160;the&#160;translation process (locating&#160;a PTE,&#160;etc.)&#160;<br/>as if it&#160;had&#160;traversed&#160;the&#160;PDE&#160;(and,&#160;for&#160;IA-32e&#160;paging,&#160;the&#160;PDPTE and&#160;PML4E)&#160;corresponding&#160;to&#160;the&#160;PDE-cache&#160;<br/>entry.</p>
<p style="position:absolute;top:438px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:439px;left:93px;white-space:nowrap" class="ft07">The&#160;following&#160;items apply when IA-32e&#160;paging&#160;is used:<br/>—&#160;If&#160;the processor does not find a relevant TLB entry&#160;or a&#160;relevant PDE-cache&#160;entry,&#160;it may&#160;use bits&#160;47:30 of&#160;</p>
<p style="position:absolute;top:479px;left:119px;white-space:nowrap" class="ft06">the linear&#160;address to&#160;select&#160;an entry&#160;from&#160;the PDPTE&#160;cache that is associated with the&#160;current&#160;PCID. It&#160;can&#160;<br/>then&#160;use that entry&#160;to&#160;complete the&#160;translation process&#160;(locating a&#160;PDE,&#160;etc.)&#160;as if&#160;it had&#160;traversed the&#160;<br/>PDPTE and&#160;the PML4E&#160;corresponding&#160;to the&#160;PDPTE-cache&#160;entry.</p>
<p style="position:absolute;top:536px;left:93px;white-space:nowrap" class="ft02">—&#160;If&#160;the processor does&#160;not&#160;find&#160;a&#160;relevant TLB entry,&#160;a&#160;relevant PDE-cache&#160;entry,&#160;or&#160;a relevant&#160;PDPTE-cache&#160;</p>
<p style="position:absolute;top:553px;left:119px;white-space:nowrap" class="ft06">entry,&#160;it&#160;may&#160;use bits&#160;47:39 of&#160;the linear address&#160;to&#160;select an&#160;entry from the&#160;PML4&#160;cache&#160;that&#160;is associated&#160;<br/>with the current PCID. It&#160;can then use that entry&#160;to&#160;complete the&#160;translation process (locating a&#160;PDPTE,&#160;<br/>etc.) as&#160;if it&#160;had traversed the&#160;corresponding&#160;PML4E.</p>
<p style="position:absolute;top:610px;left:68px;white-space:nowrap" class="ft06">(Any&#160;of&#160;the above&#160;steps&#160;would be&#160;skipped&#160;if&#160;the processor does not&#160;support the&#160;cache&#160;in question.)<br/>If&#160;the processor does not find&#160;a TLB or&#160;paging-structure-cache entry for the&#160;linear&#160;address,&#160;it uses&#160;the linear&#160;<br/>address&#160;to traverse&#160;the entire paging-structure hierarchy,&#160;as&#160;de<a href="o_fe12b1e2a880e0ce-111.html">scribed in Section 4.3, Section 4</a><a href="o_fe12b1e2a880e0ce-118.html">.4.2, and&#160;</a><a href="o_fe12b1e2a880e0ce-123.html">Section&#160;<br/>4.5.</a></p>
<p style="position:absolute;top:711px;left:68px;white-space:nowrap" class="ft03">4.10.3.3 &#160;&#160;Multiple Cached Entries&#160;for a&#160;Single Paging-Structure&#160;Entry</p>
<p style="position:absolute;top:739px;left:68px;white-space:nowrap" class="ft06">The&#160;paging-structure&#160;caches&#160;and TLBs may contain multiple&#160;entries&#160;associated with a single PCID and with&#160;infor-<br/>mation&#160;derived&#160;from&#160;a single&#160;paging-structure&#160;entry.&#160;The&#160;following&#160;items&#160;give&#160;some examples for IA-32e&#160;paging:</p>
<p style="position:absolute;top:778px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:778px;left:93px;white-space:nowrap" class="ft06">Suppose that&#160;two&#160;PML4Es contain the&#160;same physical&#160;address and&#160;thus reference the&#160;same page-directory-<br/>pointer table. Any PDPTE in that table may result in two PDPTE-cache entries,&#160;each associated with a different&#160;<br/>set of&#160;linear addresses. Specifically, suppose that the&#160;n</p>
<p style="position:absolute;top:818px;left:463px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:809px;left:470px;white-space:nowrap" class="ft05">th</p>
<p style="position:absolute;top:811px;left:481px;white-space:nowrap" class="ft02">&#160;and&#160;n</p>
<p style="position:absolute;top:818px;left:523px;white-space:nowrap" class="ft05">2</p>
<p style="position:absolute;top:809px;left:530px;white-space:nowrap" class="ft05">th</p>
<p style="position:absolute;top:811px;left:541px;white-space:nowrap" class="ft02">&#160;entries&#160;in the PML4 table contain the same&#160;</p>
<p style="position:absolute;top:828px;left:93px;white-space:nowrap" class="ft02">physical address. This&#160;implies&#160;that the&#160;physical&#160;address in the&#160;m</p>
<p style="position:absolute;top:825px;left:527px;white-space:nowrap" class="ft05">th</p>
<p style="position:absolute;top:828px;left:538px;white-space:nowrap" class="ft02">&#160;PDPTE in&#160;the page-directory-pointer table&#160;</p>
<p style="position:absolute;top:844px;left:93px;white-space:nowrap" class="ft02">would appear&#160;in the&#160;PDPTE-cache entries associated&#160;with both&#160;p</p>
<p style="position:absolute;top:851px;left:525px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:844px;left:532px;white-space:nowrap" class="ft02">&#160;and p</p>
<p style="position:absolute;top:851px;left:574px;white-space:nowrap" class="ft05">2</p>
<p style="position:absolute;top:844px;left:581px;white-space:nowrap" class="ft02">, where&#160;(p</p>
<p style="position:absolute;top:851px;left:650px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:844px;left:662px;white-space:nowrap" class="ft02">» 9)&#160;= n</p>
<p style="position:absolute;top:851px;left:718px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:844px;left:725px;white-space:nowrap" class="ft02">, (p</p>
<p style="position:absolute;top:851px;left:749px;white-space:nowrap" class="ft05">2</p>
<p style="position:absolute;top:844px;left:760px;white-space:nowrap" class="ft02">» 9)&#160;= n</p>
<p style="position:absolute;top:851px;left:817px;white-space:nowrap" class="ft05">2</p>
<p style="position:absolute;top:844px;left:823px;white-space:nowrap" class="ft02">,&#160;</p>
<p style="position:absolute;top:861px;left:93px;white-space:nowrap" class="ft02">and (p</p>
<p style="position:absolute;top:867px;left:137px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:861px;left:149px;white-space:nowrap" class="ft02">&amp; 1FFH)&#160;=&#160;(p</p>
<p style="position:absolute;top:867px;left:238px;white-space:nowrap" class="ft05">2</p>
<p style="position:absolute;top:861px;left:249px;white-space:nowrap" class="ft02">&amp; 1FFH)&#160;=&#160;m.&#160;This is&#160;because both&#160;PDPTE-cache&#160;entries use the&#160;same PDPTE, one&#160;</p>
<p style="position:absolute;top:877px;left:93px;white-space:nowrap" class="ft02">resulting from&#160;a reference from the&#160;n</p>
<p style="position:absolute;top:884px;left:344px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:875px;left:351px;white-space:nowrap" class="ft05">th</p>
<p style="position:absolute;top:877px;left:362px;white-space:nowrap" class="ft02">&#160;PML4E&#160;and&#160;one&#160;from&#160;the&#160;n</p>
<p style="position:absolute;top:884px;left:544px;white-space:nowrap" class="ft05">2</p>
<p style="position:absolute;top:875px;left:550px;white-space:nowrap" class="ft05">th</p>
<p style="position:absolute;top:877px;left:561px;white-space:nowrap" class="ft02">&#160;PML4E.</p>
<p style="position:absolute;top:899px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:900px;left:93px;white-space:nowrap" class="ft07">Suppose&#160;that the&#160;first PML4E (i.e.,&#160;the&#160;one in&#160;position 0) contains the&#160;physical&#160;address X in&#160;CR3 (the&#160;physical&#160;<br/>address of the&#160;PML4&#160;table).&#160;This implies the&#160;following:<br/>—&#160;Any&#160;PML4-cache entry&#160;associated&#160;with&#160;linear addresses with 0&#160;in bits&#160;47:39&#160;contains address X.<br/>—&#160;Any&#160;PDPTE-cache&#160;entry&#160;associated with linear&#160;addresses&#160;with&#160;0 in&#160;bits&#160;47:30 contains address&#160;X. This&#160;is&#160;</p>
<p style="position:absolute;top:981px;left:119px;white-space:nowrap" class="ft06">because&#160;the translation&#160;for a linear address&#160;for&#160;which the&#160;value&#160;of bits&#160;47:30&#160;is&#160;0 uses&#160;the&#160;value&#160;of&#160;<br/>bits&#160;47:39 (0) to&#160;locate a page-directory-pointer table at&#160;address X (the address of the&#160;PML4 table). It&#160;then&#160;<br/>uses&#160;the&#160;value&#160;of bits&#160;38:30&#160;(also 0)&#160;to&#160;find&#160;address X again and&#160;to store&#160;that address&#160;in&#160;the&#160;PDPTE-cache&#160;<br/>entry.</p>
</div>
</body>
</html>
