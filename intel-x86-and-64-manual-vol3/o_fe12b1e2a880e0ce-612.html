<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 612</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#0860a8;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:12px;font-family:Times;color:#0860a8;}
	.ft08{font-size:8px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page612-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce612.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">17-38&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">DEBUG,&#160;BRANCH&#160;PROFILE,&#160;TSC,&#160;AND RESOURCE&#160;MONITORING&#160;FEATURES</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft09"><b>Last Branch Record (LBR) Stack</b>&#160;— The LBR&#160;stack consists&#160;of&#160;8&#160;MSRs&#160;(MSR_LASTBRANCH_0 through&#160;<br/>MSR_LASTBRANCH_7); bits 31-0 hold&#160;the ‘from’&#160;address,&#160;bits&#160;63-32 hold&#160;the ‘to’ address. For Pentium M&#160;<br/>Processors,&#160;these&#160;pairs are&#160;located at&#160;register addresses&#160;040H-047H.&#160;See<a href="o_fe12b1e2a880e0ce-612.html">&#160;Figure&#160;17-17.</a></p>
<p style="position:absolute;top:155px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:156px;left:93px;white-space:nowrap" class="ft09"><b>Last Branch&#160;Record Top-of-Stack&#160;(TOS) Pointer&#160;</b>— The TOS Pointer MSR contains a 3-bit pointer (bits 2-0)&#160;<br/>to the&#160;MSR in the&#160;LBR stack that&#160;contains&#160;the&#160;most recent&#160;branch, interrupt, or exception recorded. For Pentium&#160;<br/>M Processors,&#160;this MSR&#160;is located at&#160;register address&#160;01C9H.</p>
<p style="position:absolute;top:405px;left:68px;white-space:nowrap" class="ft09">For more detail on these capabilities,&#160;se<a href="o_fe12b1e2a880e0ce-609.html">e Section 17.11.3,&#160;“Last Exception Records,” and Section 35.20, “MSRs In&#160;<br/></a><a href="o_fe12b1e2a880e0ce-1593.html">the Pentium M Processor.”</a></p>
<p style="position:absolute;top:477px;left:68px;white-space:nowrap" class="ft05">17.14&#160;&#160;LAST&#160;BRANCH, INTERRUPT, AND&#160;EXCEPTION</p>
<p style="position:absolute;top:503px;left:146px;white-space:nowrap" class="ft05">RECORDING (P6 FAMILY PROCESSORS)</p>
<p style="position:absolute;top:539px;left:68px;white-space:nowrap" class="ft09">The&#160;P6&#160;family processors provide five MSRs&#160;for&#160;recording&#160;the last&#160;branch,&#160;interrupt,&#160;or&#160;exception taken by the&#160;<br/>processor: DEBUGCTLMSR,&#160;LastBranchToIP, LastBranchFromIP, LastExceptionToIP,&#160;and LastExceptionFromIP.&#160;<br/>These&#160;registers can&#160;be&#160;used&#160;to collect&#160;last&#160;branch records,&#160;to set breakpoints&#160;on branches,&#160;interrupts, and&#160;excep-<br/>tions, and&#160;to single-step&#160;from one&#160;branch to&#160;the next.<br/>Se<a href="o_fe12b1e2a880e0ce-1281.html">e Chapter&#160;35,&#160;“Model-Specific&#160;Registers&#160;(MSRs),”</a>&#160;for a&#160;detailed description&#160;of&#160;each of the&#160;last&#160;branch recording&#160;<br/>MSRs.</p>
<p style="position:absolute;top:679px;left:68px;white-space:nowrap" class="ft06">17.14.1 DEBUGCTLMSR&#160;</p>
<p style="position:absolute;top:679px;left:273px;white-space:nowrap" class="ft06">Register</p>
<p style="position:absolute;top:710px;left:68px;white-space:nowrap" class="ft09">The version of the&#160;DEBUGCTLMSR&#160;register found in&#160;the P6&#160;family processors enables last&#160;branch, interrupt,&#160;and&#160;<br/>exception recording; taken branch&#160;breakpoints;&#160;the breakpoint reporting pins; and&#160;trace&#160;messages.&#160;This register&#160;<br/>can be written&#160;to using the WRMSR instruction, when operating at&#160;privilege level 0 or when in real-address mode.&#160;<br/>A protected-mode operating&#160;system&#160;procedure is&#160;required&#160;to provide&#160;user&#160;access&#160;to this register<a href="o_fe12b1e2a880e0ce-613.html">. Figure&#160;17-18&#160;<br/></a>shows&#160;the flags&#160;in the&#160;DEBUGCTLMSR&#160;register for the&#160;P6&#160;family processors.&#160;The&#160;functions of&#160;these flags are&#160;as&#160;<br/>follows:</p>
<p style="position:absolute;top:814px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:815px;left:93px;white-space:nowrap" class="ft09"><b>LBR (last&#160;branch/interrupt/exception) flag (bit&#160;0)&#160;—&#160;</b>When&#160;set, the&#160;processor&#160;records&#160;the source&#160;and&#160;<br/>target addresses (in the&#160;LastBranchToIP,&#160;LastBranchFromIP, LastExceptionToIP,&#160;and&#160;LastExceptionFromIP&#160;<br/>MSRs) for the last branch and&#160;the&#160;last exception or&#160;interrupt&#160;taken&#160;by the&#160;processor prior to&#160;a debug&#160;exception&#160;<br/>being&#160;generated.&#160;The processor clears this&#160;flag whenever&#160;a&#160;debug exception,&#160;such&#160;as an instruction or&#160;data&#160;<br/>breakpoint or single-step trap occurs.</p>
<p style="position:absolute;top:350px;left:217px;white-space:nowrap" class="ft07">Figure&#160;17-17.&#160; LBR&#160;Branch&#160;Record&#160;Layout for the Pentium&#160;M&#160;Processor</p>
<p style="position:absolute;top:293px;left:638px;white-space:nowrap" class="ft08">0</p>
<p style="position:absolute;top:294px;left:238px;white-space:nowrap" class="ft08">63</p>
<p style="position:absolute;top:313px;left:495px;white-space:nowrap" class="ft00">From Linear Address</p>
<p style="position:absolute;top:312px;left:288px;white-space:nowrap" class="ft00">To&#160;Linear&#160;Address</p>
<p style="position:absolute;top:294px;left:428px;white-space:nowrap" class="ft08">32&#160;-&#160;31</p>
<p style="position:absolute;top:269px;left:238px;white-space:nowrap" class="ft00">MSR_LASTBRANCH_0 through&#160;</p>
<p style="position:absolute;top:269px;left:440px;white-space:nowrap" class="ft00">MSR_LASTBRANCH_7</p>
</div>
</body>
</html>
