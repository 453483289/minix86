<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 725</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:20px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page725-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce725.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;18-89</p>
<p style="position:absolute;top:47px;left:672px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:98px;left:69px;white-space:nowrap" class="ft02">18.15.4&#160;&#160;Debug Store (DS) Mechanism</p>
<p style="position:absolute;top:129px;left:69px;white-space:nowrap" class="ft06">The debug&#160;store (DS)&#160;mechanism&#160;was introduced with processors&#160;based on Intel NetBurst&#160;microarchitecture&#160;to&#160;<br/>allow various types of information&#160;to be collected&#160;in&#160;memory-resident&#160;buffers for use&#160;in debugging and&#160;tuning&#160;<br/>programs. The&#160;DS&#160;mechanism can be&#160;used to collect two types of information:&#160;branch&#160;records&#160;and processor&#160;<br/>event-based&#160;sampling (PEBS) records. The availability&#160;of the DS mechanism in a processor is indicated with the DS&#160;<br/>feature&#160;flag (bit 21) returned by the&#160;CPUID&#160;instruction.&#160;<br/><a href="o_fe12b1e2a880e0ce-587.html">See Section 17.4.5, ‚ÄúBranch Trace Store (BTS),‚Äù</a>&#160;<a href="o_fe12b1e2a880e0ce-734.html">and Section&#160;18.15.7, ‚ÄúProcessor Event-Based Sampling (PEBS),‚Äù&#160;<br/></a>for a&#160;description of these facilities. Records&#160;collected with the&#160;DS&#160;mechanism are saved in&#160;the DS&#160;save&#160;area.&#160;See&#160;<br/><a href="o_fe12b1e2a880e0ce-591.html">Section&#160;17.4.9,&#160;‚ÄúBTS&#160;and&#160;DS&#160;Save&#160;Area.‚Äù</a></p>
<p style="position:absolute;top:302px;left:69px;white-space:nowrap" class="ft02">18.15.5&#160;&#160;Programming the Performance Counters&#160;</p>
<p style="position:absolute;top:323px;left:149px;white-space:nowrap" class="ft02">for Non-Retirement Events</p>
<p style="position:absolute;top:354px;left:69px;white-space:nowrap" class="ft08">The basic steps to&#160;program&#160;a performance&#160;counter and&#160;to count events include the&#160;following:<br/>1.&#160;Select&#160;the event or&#160;events to be&#160;counted.<br/>2.&#160;For each&#160;event,&#160;select&#160;an&#160;ESCR that supports the&#160;event using&#160;the&#160;values&#160;in&#160;the ESCR&#160;restrictions row in&#160;<a href="o_fe12b1e2a880e0ce-929.html">Table&#160;</a></p>
<p style="position:absolute;top:418px;left:94px;white-space:nowrap" class="ft03"><a href="o_fe12b1e2a880e0ce-929.html">19-28,</a><a href="˛ˇ">&#160;Chapter&#160;19.</a></p>
<p style="position:absolute;top:442px;left:69px;white-space:nowrap" class="ft03">3.&#160;Match the CCCR Select value&#160;<a href="o_fe12b1e2a880e0ce-929.html">and ESCR name in&#160;Table&#160;19-28</a>&#160;to a value listed&#160;<a href="o_fe12b1e2a880e0ce-718.html">in Table 18-63; se</a>lect a CCCR and&#160;</p>
<p style="position:absolute;top:459px;left:94px;white-space:nowrap" class="ft03">performance counter.</p>
<p style="position:absolute;top:483px;left:69px;white-space:nowrap" class="ft03">4.&#160;Set up&#160;an ESCR&#160;for&#160;the&#160;specific event or&#160;events&#160;to be&#160;counted and&#160;the privilege&#160;levels at&#160;which the&#160;are&#160;to be&#160;</p>
<p style="position:absolute;top:499px;left:94px;white-space:nowrap" class="ft03">counted.</p>
<p style="position:absolute;top:523px;left:69px;white-space:nowrap" class="ft08">5.&#160;Set&#160;up the CCCR for the&#160;performance&#160;counter&#160;by&#160;selecting the&#160;ESCR and&#160;the desired event filters.<br/>6.&#160;Set&#160;up the CCCR for optional&#160;cascading of&#160;event counts, so&#160;that&#160;when&#160;the selected counter overflows&#160;its&#160;</p>
<p style="position:absolute;top:564px;left:94px;white-space:nowrap" class="ft03">alternate counter starts.</p>
<p style="position:absolute;top:588px;left:69px;white-space:nowrap" class="ft03">7.&#160;Set&#160;up the CCCR to&#160;generate an&#160;optional performance&#160;monitor interrupt (PMI) when the&#160;counter&#160;overflows.&#160;If&#160;</p>
<p style="position:absolute;top:604px;left:94px;white-space:nowrap" class="ft06">PMI&#160;generation&#160;is enabled, the&#160;local APIC must be set&#160;up&#160;to deliver&#160;the interrupt to the&#160;processor&#160;and a&#160;handler&#160;<br/>for&#160;the interrupt&#160;must be in&#160;place.</p>
<p style="position:absolute;top:645px;left:69px;white-space:nowrap" class="ft03">8.&#160;Enable&#160;the counter&#160;to begin counting.</p>
<p style="position:absolute;top:689px;left:69px;white-space:nowrap" class="ft04">18.15.5.1&#160;&#160;&#160;Selecting Events to&#160;Count</p>
<p style="position:absolute;top:718px;left:69px;white-space:nowrap" class="ft06"><a href="o_fe12b1e2a880e0ce-947.html">Table 19-29 in Chap</a><a href="˛ˇ">ter 19 lists a se</a>t of at-retirement events for processors based on Intel NetBurst microarchitec-<br/>ture. For each&#160;ev<a href="o_fe12b1e2a880e0ce-947.html">ent listed in&#160;Table 19-29</a>,&#160;setup&#160;information is&#160;provided.&#160;<a href="o_fe12b1e2a880e0ce-725.html">Table&#160;18-64&#160;g</a>ives&#160;an example&#160;of one of&#160;<br/>the events.</p>
<p style="position:absolute;top:781px;left:353px;white-space:nowrap" class="ft05">Table 18-64. &#160;Event&#160;Example&#160;</p>
<p style="position:absolute;top:803px;left:73px;white-space:nowrap" class="ft03">Event&#160;Name</p>
<p style="position:absolute;top:803px;left:167px;white-space:nowrap" class="ft03">Event&#160;Parameters</p>
<p style="position:absolute;top:803px;left:298px;white-space:nowrap" class="ft03">&#160;Parameter Value&#160;Description</p>
<p style="position:absolute;top:825px;left:73px;white-space:nowrap" class="ft03">branch_retired&#160;</p>
<p style="position:absolute;top:825px;left:413px;white-space:nowrap" class="ft03">Counts the retirement&#160;of&#160;a branch. Specify one or&#160;more&#160;mask&#160;bits to&#160;select&#160;</p>
<p style="position:absolute;top:842px;left:413px;white-space:nowrap" class="ft03">any combination of&#160;branch&#160;taken,&#160;not-taken,&#160;predicted&#160;and mispredicted.&#160;</p>
<p style="position:absolute;top:864px;left:167px;white-space:nowrap" class="ft03">ESCR&#160;restrictions</p>
<p style="position:absolute;top:864px;left:298px;white-space:nowrap" class="ft03">MSR_CRU_ESCR2</p>
<p style="position:absolute;top:881px;left:298px;white-space:nowrap" class="ft03">MSR_CRU_ESCR3</p>
<p style="position:absolute;top:864px;left:413px;white-space:nowrap" class="ft03">See Table 15-3 for the addresses of&#160;the&#160;ESCR&#160;MSRs.</p>
<p style="position:absolute;top:903px;left:167px;white-space:nowrap" class="ft03">Counter&#160;numbers per&#160;</p>
<p style="position:absolute;top:920px;left:167px;white-space:nowrap" class="ft03">ESCR</p>
<p style="position:absolute;top:903px;left:298px;white-space:nowrap" class="ft09">ESCR2:&#160;12, 13, 16<br/>ESCR3:&#160;14, 15, 17</p>
<p style="position:absolute;top:903px;left:413px;white-space:nowrap" class="ft03">The counter numbers associated&#160;with each&#160;ESCR&#160;are provided.&#160;The&#160;</p>
<p style="position:absolute;top:920px;left:413px;white-space:nowrap" class="ft03">performance&#160;counters&#160;and corresponding&#160;CCCRs&#160;can&#160;be&#160;obtained&#160;from&#160;</p>
<p style="position:absolute;top:936px;left:413px;white-space:nowrap" class="ft03">Table&#160;15-3.</p>
<p style="position:absolute;top:959px;left:167px;white-space:nowrap" class="ft03">ESCR&#160;Event Select</p>
<p style="position:absolute;top:959px;left:298px;white-space:nowrap" class="ft03">06H</p>
<p style="position:absolute;top:959px;left:413px;white-space:nowrap" class="ft03">ESCR[31:25]</p>
</div>
</body>
</html>
