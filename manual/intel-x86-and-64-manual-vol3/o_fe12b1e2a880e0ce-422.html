<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 422</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page422-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce422.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">11-10&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">MEMORY&#160;CACHE CONTROL</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft07">between the&#160;caches when&#160;instructions are modified. S<a href="o_fe12b1e2a880e0ce-430.html">ee Section 11.6, “Self-Modifying Code,”</a>&#160;for more&#160;information&#160;<br/>on the&#160;implications of caching&#160;instructions.</p>
<p style="position:absolute;top:172px;left:68px;white-space:nowrap" class="ft03">11.5 CACHE&#160;</p>
<p style="position:absolute;top:172px;left:215px;white-space:nowrap" class="ft03">CONTROL</p>
<p style="position:absolute;top:208px;left:68px;white-space:nowrap" class="ft07">The Intel&#160;64&#160;and&#160;IA-32 architectures provide a&#160;variety&#160;of&#160;mechanisms for controlling&#160;the caching&#160;of data&#160;and&#160;<br/>instructions and for controlling&#160;the ordering of reads and writes between the&#160;processor,&#160;the&#160;caches,&#160;and&#160;memory.&#160;<br/>These mechanisms can be&#160;divided into two groups:</p>
<p style="position:absolute;top:263px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:264px;left:93px;white-space:nowrap" class="ft07"><b>Cache control&#160;registers and bits</b>&#160;—&#160;The Intel&#160;64&#160;and IA-32 architectures define several&#160;dedicated&#160;registers&#160;<br/>and various bits within control registers and page- and directory-table&#160;entries that control the&#160;caching system&#160;<br/>memory locations in the L1, L2, and L3&#160;caches.&#160;These&#160;mechanisms&#160;control&#160;the&#160;caching of virtual memory&#160;pages&#160;<br/>and of regions of physical memory.</p>
<p style="position:absolute;top:335px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:336px;left:93px;white-space:nowrap" class="ft07"><b>Cache&#160;control and memory&#160;ordering instructions</b>&#160;— The&#160;Intel&#160;64 and&#160;IA-32&#160;architectures provide several&#160;<br/>instructions that&#160;control&#160;the caching of data, the&#160;ordering&#160;of memory reads and&#160;writes,&#160;and the&#160;prefetching&#160;of&#160;<br/>data. These instructions allow software&#160;to control the&#160;caching of specific data structures, to control&#160;memory&#160;<br/>coherency&#160;for specific locations in&#160;memory, and&#160;to force&#160;strong&#160;memory ordering&#160;at specific locations in&#160;a&#160;<br/>program.</p>
<p style="position:absolute;top:426px;left:68px;white-space:nowrap" class="ft02">The following sections&#160;describe these two groups of cache&#160;control mechanisms.</p>
<p style="position:absolute;top:476px;left:68px;white-space:nowrap" class="ft06">11.5.1&#160;</p>
<p style="position:absolute;top:476px;left:148px;white-space:nowrap" class="ft06">Cache Control Registers and Bits</p>
<p style="position:absolute;top:507px;left:68px;white-space:nowrap" class="ft07"><a href="o_fe12b1e2a880e0ce-423.html">Figure&#160;11-3 depicts&#160;</a>cache-control mechanisms&#160;in IA-32&#160;processors. Other than for the&#160;matter of memory&#160;address&#160;<br/>space,&#160;these work the&#160;same&#160;in Intel 64&#160;processors.<br/>The&#160;Intel 64&#160;and&#160;IA-32&#160;architectures&#160;provide&#160;the following&#160;cache-control&#160;registers and bits&#160;for use&#160;in&#160;enabling or&#160;<br/>restricting caching&#160;to various pages&#160;or regions&#160;in&#160;memory:</p>
<p style="position:absolute;top:586px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:586px;left:93px;white-space:nowrap" class="ft07"><b>CD flag, bit&#160;30 of control&#160;register CR0&#160;</b>— Controls caching&#160;of&#160;system memory&#160;locations (see<a href="o_fe12b1e2a880e0ce-75.html">&#160;Section 2.5,&#160;<br/>“Control Registers”). If&#160;</a>the CD&#160;flag is&#160;clear,&#160;caching&#160;is enabled&#160;for&#160;the whole of system&#160;memory, but&#160;may be&#160;<br/>restricted&#160;for&#160;individual pages&#160;or regions&#160;of memory&#160;by&#160;other cache-control mechanisms. When&#160;the CD&#160;flag is&#160;<br/>set,&#160;caching is&#160;restricted in the&#160;processor’s caches&#160;(cache&#160;hierarchy)&#160;for&#160;the P6 and more recent processor&#160;<br/>families and prevented&#160;for&#160;the&#160;Pentium processor&#160;(see note&#160;below).&#160;With the CD&#160;flag set, however,&#160;the caches&#160;<br/>will still&#160;respond to snoop traffic.&#160;Caches&#160;should be&#160;explicitly flushed&#160;to insure&#160;memory coherency.&#160;For highest&#160;<br/>processor performance, both&#160;the CD&#160;and the&#160;NW&#160;flags in&#160;control&#160;register CR0&#160;should&#160;be&#160;cleared.<a href="o_fe12b1e2a880e0ce-424.html">&#160;Table&#160;11-5</a>&#160;<br/>shows the&#160;interaction of the&#160;CD&#160;and NW&#160;flags.<br/>The effect&#160;of&#160;setting the CD&#160;flag&#160;is&#160;somewhat different&#160;for processor&#160;families&#160;starting&#160;with&#160;P6&#160;family than&#160;the&#160;<br/>Pentium processor&#160;(see<a href="o_fe12b1e2a880e0ce-424.html">&#160;Table&#160;11-5).&#160;</a>To&#160;insure&#160;memory coherency after&#160;the&#160;CD flag&#160;is&#160;set,&#160;the&#160;caches&#160;should&#160;<br/>be explicitly flushed (see&#160;<a href="o_fe12b1e2a880e0ce-428.html">Section&#160;11.5.3,&#160;“Preventing&#160;Caching”</a>).&#160;Setting&#160;the CD flag&#160;for the P6&#160;and&#160;more&#160;<br/>recent processor families modify&#160;cache line&#160;fill and&#160;update&#160;behaviour.&#160;Also,&#160;setting&#160;the CD&#160;flag on&#160;these&#160;<br/>processors do&#160;not force&#160;strict ordering&#160;of memory accesses unless&#160;the MTRRs&#160;are disabled&#160;and/or&#160;all memory&#160;<br/>is&#160;referenced&#160;as&#160;uncached&#160;(see<a href="o_fe12b1e2a880e0ce-271.html">&#160;Section 8.2.5,&#160;“Strengthening or&#160;Weakening&#160;the Memory-Ordering Model”).</a></p>
</div>
</body>
</html>
