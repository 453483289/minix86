<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 439</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:17px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page439-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce439.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:760px;white-space:nowrap" class="ft00">Vol. 3A&#160;11-27</p>
<p style="position:absolute;top:47px;left:686px;white-space:nowrap" class="ft01">MEMORY CACHE CONTROL</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft06">To&#160;map the address range from 400000H to 7FFFFFH (4 MBytes to 8 MBytes), a base&#160;value of 000400H is entered&#160;<br/>in the&#160;PhysBase&#160;field and a&#160;mask&#160;value&#160;of FFFC00H is&#160;entered in&#160;the PhysMask field.</p>
<p style="position:absolute;top:158px;left:69px;white-space:nowrap" class="ft01">Example 11-2. &#160;Setting-Up&#160;Memory for a&#160;System</p>
<p style="position:absolute;top:182px;left:69px;white-space:nowrap" class="ft06">Here&#160;is an&#160;example of&#160;setting&#160;up the&#160;MTRRs for an system. Assume that the&#160;system&#160;has&#160;the following&#160;characteris-<br/>tics:</p>
<p style="position:absolute;top:220px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:221px;left:95px;white-space:nowrap" class="ft02">96&#160;MBytes of system&#160;memory is&#160;mapped as&#160;write-back memory (WB) for&#160;highest system&#160;performance.</p>
<p style="position:absolute;top:243px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:244px;left:95px;white-space:nowrap" class="ft06">A custom 4-MByte&#160;I/O card is&#160;mapped to&#160;uncached&#160;memory (UC)&#160;at a&#160;base&#160;address of 64&#160;MBytes.&#160;This&#160;<br/>restriction forces&#160;the 96 MBytes&#160;of&#160;system memory&#160;to be addressed&#160;from&#160;0 to 64 MBytes&#160;and&#160;from 68 MBytes&#160;<br/>to 100 MBytes, leaving&#160;a 4-MByte hole&#160;for&#160;the I/O&#160;card.&#160;</p>
<p style="position:absolute;top:298px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:299px;left:95px;white-space:nowrap" class="ft02">An&#160;8-MByte graphics&#160;card is&#160;mapped to&#160;write-combining memory&#160;(WC) beginning at&#160;address A0000000H.&#160;</p>
<p style="position:absolute;top:321px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:322px;left:95px;white-space:nowrap" class="ft02">The&#160;BIOS&#160;area from 15&#160;MBytes&#160;to 16&#160;MBytes&#160;is mapped&#160;to UC&#160;memory.</p>
<p style="position:absolute;top:346px;left:69px;white-space:nowrap" class="ft06">The following&#160;settings for the&#160;MTRRs&#160;will yield&#160;the proper&#160;mapping&#160;of&#160;the physical address&#160;space for this&#160;system&#160;<br/>configuration.</p>
<p style="position:absolute;top:392px;left:69px;white-space:nowrap" class="ft07">IA32_MTRR_PHYSBASE0 = &#160;0000&#160;0000 0000&#160;0006H<br/>IA32_MTRR_PHYSMASK0&#160;= &#160;0000&#160;000F FC00&#160;0800H &#160;<br/>Caches&#160;0-64&#160;MByte&#160;as WB cache type.</p>
<p style="position:absolute;top:458px;left:69px;white-space:nowrap" class="ft07">IA32_MTRR_PHYSBASE1 = &#160;0000&#160;0000 0400&#160;0006H<br/>IA32_MTRR_PHYSMASK1&#160;= &#160;0000&#160;000F FE00&#160;0800H &#160;<br/>Caches 64-96 MByte as WB cache type.</p>
<p style="position:absolute;top:524px;left:69px;white-space:nowrap" class="ft07">IA32_MTRR_PHYSBASE2 = &#160;0000&#160;0000 0600&#160;0006H<br/>IA32_MTRR_PHYSMASK2&#160;= &#160;0000&#160;000F FFC0&#160;0800H &#160;<br/>Caches 96-100 MByte as WB cache type.</p>
<p style="position:absolute;top:590px;left:69px;white-space:nowrap" class="ft07">IA32_MTRR_PHYSBASE3 = &#160;0000&#160;0000 0400&#160;0000H<br/>IA32_MTRR_PHYSMASK3&#160;= &#160;0000&#160;000F FFC0&#160;0800H &#160;<br/>Caches&#160;64-68 MByte&#160;as UC cache type.</p>
<p style="position:absolute;top:656px;left:69px;white-space:nowrap" class="ft07">IA32_MTRR_PHYSBASE4 = &#160;0000&#160;0000 00F0&#160;0000H<br/>IA32_MTRR_PHYSMASK4&#160;= &#160;0000&#160;000F FFF0&#160;0800H &#160;<br/>Caches&#160;15-16 MByte&#160;as UC cache type.</p>
<p style="position:absolute;top:722px;left:69px;white-space:nowrap" class="ft06">IA32_MTRR_PHYSBASE5 = &#160;0000&#160;0000 A000&#160;0001H<br/>IA32_MTRR_PHYSMASK5&#160;= &#160;0000&#160;000F FF80&#160;0800H &#160;<br/>Caches A0000000-A0800000&#160;as WC&#160;type.<br/>This MTRR&#160;setup uses the ability to&#160;overlap any two memory&#160;ranges&#160;(as long as the&#160;ranges are&#160;mapped&#160;to WB and&#160;<br/>UC&#160;memory types) to&#160;minimize&#160;the number&#160;of&#160;MTRR registers that&#160;are required&#160;to configure&#160;the memory environ-<br/>ment.&#160;This setup also&#160;fulfills&#160;the requirement that&#160;two register pairs are&#160;left&#160;for&#160;operating system&#160;usage.</p>
<p style="position:absolute;top:859px;left:69px;white-space:nowrap" class="ft04">11.11.3.1&#160;&#160;&#160;Base&#160;and Mask&#160;Calculations&#160;for&#160;Greater-Than 36-bit Physical&#160;Address&#160;Support</p>
<p style="position:absolute;top:888px;left:69px;white-space:nowrap" class="ft06">For Intel&#160;64&#160;and IA-32 processors that support greater than&#160;36 bits of physical address&#160;size,&#160;software&#160;should query&#160;<br/>CPUID.80000008H&#160;to determine&#160;the&#160;maximum physical address.&#160;See&#160;the example.</p>
<p style="position:absolute;top:945px;left:69px;white-space:nowrap" class="ft01">Example 11-3. &#160;Setting-Up&#160;Memory for a&#160;System&#160;with a&#160;40-Bit&#160;Address Size</p>
<p style="position:absolute;top:970px;left:69px;white-space:nowrap" class="ft06">If&#160;a processor&#160;supports&#160;40-bits of physical address&#160;size, then&#160;the PhysMask field&#160;(in&#160;IA32_MTRR_PHYSMASK<i>n</i>&#160;<br/>registers)&#160;is 28 bits instead of 24 bits.&#160;For&#160;this&#160;situ<a href="o_fe12b1e2a880e0ce-439.html">ation, Example 11-2&#160;</a>should be&#160;modified as&#160;follows:</p>
<p style="position:absolute;top:1016px;left:69px;white-space:nowrap" class="ft07">IA32_MTRR_PHYSBASE0 = &#160;0000&#160;0000 0000&#160;0006H<br/>IA32_MTRR_PHYSMASK0&#160;= &#160;0000&#160;00FF FC00&#160;0800H &#160;<br/>Caches&#160;0-64&#160;MByte&#160;as WB cache type.</p>
</div>
</body>
</html>
