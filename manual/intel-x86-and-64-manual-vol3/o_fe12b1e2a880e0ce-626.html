<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 626</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:12px;font-family:Times;color:#0860a8;}
	.ft04{font-size:6px;font-family:Times;color:#000000;}
	.ft05{font-size:7px;font-family:Times;color:#000000;}
	.ft06{font-size:8px;font-family:Times;color:#9a65ff;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:8px;font-family:Times;color:#01ff00;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page626-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce626.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">17-52&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">DEBUG,&#160;BRANCH&#160;PROFILE,&#160;TSC,&#160;AND RESOURCE&#160;MONITORING&#160;FEATURES</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft09">shows various non-overlapped&#160;partitioning&#160;schemes. As&#160;a&#160;matter&#160;of software&#160;policy for extensibility COS0&#160;should&#160;<br/>typically be&#160;considered and&#160;configured&#160;as&#160;the highest priority&#160;COS,&#160;followed by COS1, and so&#160;on, though&#160;there is&#160;<br/>no hardware&#160;restriction&#160;enforcing this mapping.&#160;When the&#160;system boots all&#160;threads&#160;are initialized to&#160;COS0,&#160;which&#160;<br/>has full access to&#160;the&#160;cache&#160;by default.<br/>Though&#160;the representation&#160;of&#160;the CBMs looks similar&#160;to&#160;a way-based mapping they&#160;are independent&#160;of&#160;any specific&#160;<br/>enforcement&#160;implementation&#160;(e.g. way partitioning.)&#160;Rather, this&#160;is a&#160;convenient manner to&#160;represent&#160;capacity,&#160;<br/>overlap&#160;and&#160;isolation of cache&#160;space.&#160;For example,&#160;executing a&#160;POPCNT instruction (population count of set&#160;bits)&#160;on&#160;<br/>the capacity&#160;bitmask can provide the&#160;fraction&#160;of&#160;cache space&#160;that a&#160;class of service&#160;can allocate into.&#160;In&#160;addition&#160;to&#160;<br/>the fraction, the&#160;exact location&#160;of&#160;the bits also&#160;shows&#160;whether&#160;the class&#160;of service&#160;overlaps with other&#160;classes&#160;of&#160;<br/>service or&#160;is entirely&#160;isolated&#160;in&#160;terms of cache&#160;space&#160;used.&#160;</p>
<p style="position:absolute;top:763px;left:68px;white-space:nowrap" class="ft09"><a href="o_fe12b1e2a880e0ce-626.html">Figure&#160;17-28&#160;shows how the&#160;</a>Cache&#160;Capacity&#160;Bitmasks&#160;and&#160;the&#160;per-logical-processor&#160;Class&#160;of Service&#160;are&#160;logically&#160;<br/>used to&#160;enable Cache Allocation&#160;Technology.&#160;All&#160;(and&#160;only) contiguous 1's&#160;in&#160;the CBM are permitted. The length of&#160;<br/>CBM may vary from resource to&#160;resource&#160;or between&#160;processor generations and&#160;can be enumerated&#160;using&#160;CPUID.&#160;<br/>From the&#160;available mask set and&#160;based on the&#160;goals&#160;of&#160;the&#160;OS/VMM&#160;(shared&#160;or&#160;isolated&#160;cache,&#160;etc.) bitmasks&#160;are&#160;<br/>selected&#160;and associated&#160;with different classes&#160;of service.&#160;For the&#160;available&#160;Classes of Service the&#160;associated CBMs&#160;<br/>can be programmed&#160;via&#160;the global&#160;set of&#160;CAT configuration&#160;registers (in the&#160;case&#160;of&#160;L3&#160;CAT,&#160;via the&#160;<br/>IA32_L3_MASK_n&#160;MSRs, where&#160;“n”&#160;is the&#160;Class of Service,&#160;starting from zero). In&#160;all architectural implementations&#160;<br/>supporting&#160;CPUID it&#160;is&#160;possible&#160;to change the&#160;CBMs&#160;dynamically, during&#160;program execution, unless&#160;stated&#160;other-<br/>wise&#160;by&#160;Intel.&#160;<br/>The currently running application's&#160;Class&#160;of Service is&#160;communicated to&#160;the hardware&#160;through the&#160;per-logical-<br/>processor PQR&#160;MSR (IA32_PQR_ASSOC MSR).&#160;When&#160;the OS&#160;schedules an application thread&#160;on a logical processor,&#160;<br/>the application thread is associated with a specific COS (i.e. the corresponding COS in the PQR) and all requests to&#160;<br/>the CAT-capable resource&#160;from that logical processor are&#160;tagged with that&#160;COS&#160;(in other&#160;words, the&#160;application&#160;<br/>thread&#160;is configured to belong&#160;to a specific COS). The&#160;cache&#160;subsystem uses&#160;this tagged request information&#160;to&#160;<br/>enforce QoS.&#160;The&#160;capacity&#160;bitmask may&#160;be&#160;mapped into&#160;a&#160;way&#160;bitmask (or a&#160;similar enforcement&#160;entity based&#160;on&#160;<br/>the implementation)&#160;at the cache&#160;before it&#160;is applied to&#160;the allocation policy.&#160;For example,&#160;the capacity&#160;bitmask&#160;can&#160;<br/>be&#160;an&#160;8-bit&#160;mask&#160;and&#160;the&#160;enforcement may be&#160;accomplished using&#160;a 16-way bitmask&#160;for&#160;a cache&#160;enforcement&#160;<br/>implementation based&#160;on way partitioning.</p>
<p style="position:absolute;top:717px;left:250px;white-space:nowrap" class="ft03">Figure&#160;17-28.&#160;&#160;Class&#160;of&#160;Service&#160;and&#160;Cache&#160;Capacity&#160;Bitmasks</p>
<p style="position:absolute;top:582px;left:510px;white-space:nowrap" class="ft04">Set 1</p>
<p style="position:absolute;top:595px;left:519px;white-space:nowrap" class="ft04">Set&#160;2</p>
<p style="position:absolute;top:608px;left:530px;white-space:nowrap" class="ft04">....</p>
<p style="position:absolute;top:532px;left:296px;white-space:nowrap" class="ft02">Cache Subsystem</p>
<p style="position:absolute;top:465px;left:186px;white-space:nowrap" class="ft05">Config</p>
<p style="position:absolute;top:394px;left:496px;white-space:nowrap" class="ft05">Tag with&#160;Cache</p>
<p style="position:absolute;top:326px;left:492px;white-space:nowrap" class="ft00">Enforcement</p>
<p style="position:absolute;top:621px;left:540px;white-space:nowrap" class="ft04">Set&#160;n</p>
<p style="position:absolute;top:637px;left:540px;white-space:nowrap" class="ft04">way 1</p>
<p style="position:absolute;top:653px;left:540px;white-space:nowrap" class="ft04">......</p>
<p style="position:absolute;top:668px;left:540px;white-space:nowrap" class="ft04">way 16</p>
<p style="position:absolute;top:548px;left:499px;white-space:nowrap" class="ft06">Enforce Mask</p>
<p style="position:absolute;top:660px;left:346px;white-space:nowrap" class="ft04">Capacity bitmask&#160;3</p>
<p style="position:absolute;top:660px;left:297px;white-space:nowrap" class="ft04">COS 3</p>
<p style="position:absolute;top:644px;left:346px;white-space:nowrap" class="ft04">Capacity bitmask&#160;3</p>
<p style="position:absolute;top:644px;left:297px;white-space:nowrap" class="ft04">COS 2</p>
<p style="position:absolute;top:628px;left:346px;white-space:nowrap" class="ft04">Capacity bitmask&#160;3</p>
<p style="position:absolute;top:628px;left:297px;white-space:nowrap" class="ft04">COS 1</p>
<p style="position:absolute;top:613px;left:346px;white-space:nowrap" class="ft04">Capacity bitmask&#160;3</p>
<p style="position:absolute;top:613px;left:297px;white-space:nowrap" class="ft04">COS 0</p>
<p style="position:absolute;top:568px;left:294px;white-space:nowrap" class="ft07">Cache Allocation</p>
<p style="position:absolute;top:503px;left:499px;white-space:nowrap" class="ft08">Transaction</p>
<p style="position:absolute;top:504px;left:348px;white-space:nowrap" class="ft08">COS</p>
<p style="position:absolute;top:464px;left:335px;white-space:nowrap" class="ft05">COS =&#160;2</p>
<p style="position:absolute;top:463px;left:496px;white-space:nowrap" class="ft04">Mem&#160;Request</p>
<p style="position:absolute;top:408px;left:496px;white-space:nowrap" class="ft05">Class of&#160;Service</p>
<p style="position:absolute;top:350px;left:496px;white-space:nowrap" class="ft05">Application</p>
<p style="position:absolute;top:365px;left:496px;white-space:nowrap" class="ft05">Memory&#160;Request</p>
<p style="position:absolute;top:394px;left:327px;white-space:nowrap" class="ft05">Set&#160;Class of&#160;Service</p>
<p style="position:absolute;top:326px;left:323px;white-space:nowrap" class="ft00">Association</p>
<p style="position:absolute;top:408px;left:327px;white-space:nowrap" class="ft05">in IA32_PQR</p>
<p style="position:absolute;top:350px;left:327px;white-space:nowrap" class="ft05">OS Context</p>
<p style="position:absolute;top:365px;left:327px;white-space:nowrap" class="ft05">Switch</p>
<p style="position:absolute;top:394px;left:174px;white-space:nowrap" class="ft05">Configure CBM for&#160;</p>
<p style="position:absolute;top:326px;left:171px;white-space:nowrap" class="ft00">Enum/Confg</p>
<p style="position:absolute;top:408px;left:175px;white-space:nowrap" class="ft05">each Class of&#160;Service</p>
<p style="position:absolute;top:350px;left:175px;white-space:nowrap" class="ft05">Enumerate</p>
<p style="position:absolute;top:365px;left:175px;white-space:nowrap" class="ft05">Enforcement</p>
</div>
</body>
</html>
