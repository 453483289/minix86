<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1085</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1085-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1085.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;25-11</p>
<p style="position:absolute;top:47px;left:673px;white-space:nowrap" class="ft01">VMX&#160;NON-ROOT&#160;OPERATION</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft06">c.&#160;If&#160;CALL&#160;or&#160;JMP accesses a&#160;TSS&#160;descriptor directly in&#160;IA-32e mode,&#160;a general-protection&#160;exception occurs.<br/>d.&#160;If&#160;CALL or JMP&#160;accesses a TSS descriptor directly outside IA-32e&#160;mode, privilege&#160;levels&#160;are&#160;checked on&#160;the&#160;</p>
<p style="position:absolute;top:141px;left:120px;white-space:nowrap" class="ft02">TSS descriptor.</p>
<p style="position:absolute;top:165px;left:95px;white-space:nowrap" class="ft02">e.&#160;If&#160;a&#160;non-maskable interrupt&#160;(NMI), an&#160;exception, or&#160;an&#160;external interrupt&#160;accesses a&#160;task gate&#160;in&#160;the&#160;IDT&#160;in&#160;</p>
<p style="position:absolute;top:181px;left:120px;white-space:nowrap" class="ft02">IA-32e&#160;mode,&#160;a&#160;general-protection&#160;exception occurs.</p>
<p style="position:absolute;top:205px;left:95px;white-space:nowrap" class="ft02">f.</p>
<p style="position:absolute;top:205px;left:120px;white-space:nowrap" class="ft07">If&#160;a non-maskable interrupt (NMI),&#160;an&#160;exception other than&#160;breakpoint exceptions&#160;(#BP)&#160;and overflow&#160;<br/>exceptions&#160;(#OF), or&#160;an external&#160;interrupt accesses&#160;a task gate in&#160;the IDT outside&#160;IA-32e&#160;mode, no&#160;<br/>privilege&#160;checks are&#160;performed.</p>
<p style="position:absolute;top:262px;left:95px;white-space:nowrap" class="ft06">g.&#160;If&#160;IRET is&#160;executed&#160;with RFLAGS.NT&#160;=&#160;1&#160;in IA-32e&#160;mode,&#160;a general-protection exception occurs.<br/>h.&#160;If&#160;IRET is executed&#160;with RFLAGS.NT&#160;=&#160;1 outside IA-32e&#160;mode, a TSS descriptor is accessed directly and no&#160;</p>
<p style="position:absolute;top:303px;left:120px;white-space:nowrap" class="ft02">privilege&#160;checks are&#160;made.</p>
<p style="position:absolute;top:327px;left:69px;white-space:nowrap" class="ft07">2.&#160;Checks&#160;are made on the&#160;new&#160;TSS selector&#160;(for example,&#160;that&#160;is within GDT&#160;limits).<br/>3.&#160;The&#160;new TSS descriptor&#160;is read.&#160;(A&#160;page&#160;fault results&#160;if a relevant GDT&#160;page&#160;is&#160;not&#160;present).<br/>4.&#160;The&#160;TSS descriptor&#160;is checked&#160;for proper&#160;values&#160;of type (depends&#160;on type of task&#160;switch), P&#160;bit, S bit, and limit.<br/>Only&#160;if checks&#160;<a href="o_fe12b1e2a880e0ce-1084.html">1–4 all pass</a>&#160;(do not generate&#160;faults) might&#160;a VM&#160;exit occur.&#160;However,&#160;the ordering&#160;between a VM&#160;exit&#160;<br/>due to&#160;a task switch and&#160;a page&#160;fault&#160;resulting&#160;from&#160;accessing&#160;the old&#160;TSS or&#160;the&#160;new TSS is&#160;implementation-<br/>specific. Some processors&#160;may&#160;generate&#160;a page fault (instead of a VM&#160;exit due to a task&#160;switch) if&#160;accessing either&#160;<br/>TSS would&#160;cause a&#160;page fault.&#160;Other processors may&#160;generate&#160;a&#160;VM&#160;exit&#160;due to&#160;a task switch even&#160;if&#160;accessing&#160;<br/>either TSS would cause a&#160;page&#160;fault.<br/>If&#160;an attempt at&#160;a task switch&#160;through&#160;a task&#160;gate&#160;in the IDT&#160;causes&#160;an exception&#160;(before&#160;generating&#160;a VM&#160;exit due&#160;<br/>to&#160;the task switch) and&#160;that exception&#160;causes a&#160;VM&#160;exit, information about the event whose delivery that&#160;accessed&#160;<br/>the&#160;task gate is&#160;recorded in&#160;the IDT-vectoring&#160;information&#160;fields&#160;and information&#160;about the exception that&#160;caused&#160;<br/>the VM&#160;exit is&#160;recorded&#160;in&#160;the VM-exit&#160;interruption-information fields.&#160;See<a href="o_fe12b1e2a880e0ce-1122.html">&#160;Section 27.2. Th</a>e fact that&#160;a task&#160;gate&#160;<br/>was&#160;being accessed&#160;is not recorded&#160;in the&#160;VMCS.<br/>If an attempt at&#160;a task switch through&#160;a task gate in&#160;the IDT&#160;causes&#160;VM&#160;exit&#160;due to&#160;the task&#160;switch,&#160;information&#160;<br/>about the&#160;event whose delivery&#160;accessed the&#160;task&#160;gate is&#160;recorded&#160;in&#160;the IDT-vectoring&#160;fields&#160;of&#160;the VMCS. Since&#160;<br/>the cause of such a VM&#160;exit is a&#160;task switch and not an&#160;interruption, the&#160;valid bit for the&#160;VM-exit interruption infor-<br/>mation&#160;field&#160;is&#160;0.&#160;Se<a href="o_fe12b1e2a880e0ce-1122.html">e&#160;Section&#160;27.2</a>.</p>
<p style="position:absolute;top:684px;left:69px;white-space:nowrap" class="ft03">25.5&#160;</p>
<p style="position:absolute;top:684px;left:148px;white-space:nowrap" class="ft03">FEATURES SPECIFIC TO&#160;VMX NON-ROOT&#160;OPERATION</p>
<p style="position:absolute;top:720px;left:69px;white-space:nowrap" class="ft07">Some&#160;VM-execution controls support features&#160;that are&#160;specific&#160;to VMX non-root&#160;operation.&#160;These&#160;are the&#160;VMX-<br/>preemp<a href="o_fe12b1e2a880e0ce-1085.html">tion timer (Section&#160;25.5.1) and&#160;</a>the monitor trap flag&#160;<a href="o_fe12b1e2a880e0ce-1086.html">(Section 25.5.2),</a>&#160;translation&#160;of&#160;guest-physical&#160;<br/>addre<a href="o_fe12b1e2a880e0ce-1087.html">sses (Section 25.5.3)</a>, VM&#160;<a href="o_fe12b1e2a880e0ce-1087.html">functions (Section&#160;25.5.5),</a>&#160;and virtualization&#160;exceptio<a href="o_fe12b1e2a880e0ce-1089.html">ns (Section 25.5.6).</a></p>
<p style="position:absolute;top:803px;left:69px;white-space:nowrap" class="ft04">25.5.1 VMX-Preemption&#160;</p>
<p style="position:absolute;top:803px;left:290px;white-space:nowrap" class="ft04">Timer</p>
<p style="position:absolute;top:834px;left:69px;white-space:nowrap" class="ft07">If the&#160;last VM&#160;entry&#160;was performed with the&#160;1-setting of&#160;“activate VMX-preemption&#160;timer”&#160;VM-execution&#160;control,&#160;<br/>the&#160;<b>VMX-preemption timer</b>&#160;counts down (from the&#160;value&#160;loaded by VM&#160;<a href="o_fe12b1e2a880e0ce-1115.html">entry; see Section 26.6.4)&#160;</a>in VMX non-<br/>root operation.&#160;When the&#160;timer counts down to&#160;zero,&#160;it stops&#160;counting&#160;down and&#160;a VM&#160;exit occurs&#160;(see&#160;<a href="o_fe12b1e2a880e0ce-1079.html">Section&#160;<br/>25.2).<br/></a>The VMX-preemption&#160;timer counts&#160;down&#160;at rate proportional&#160;to&#160;that of the&#160;timestamp counter&#160;(TSC). Specifically,&#160;<br/>the timer&#160;counts&#160;down by 1&#160;every&#160;time bit&#160;X&#160;in the&#160;TSC changes due&#160;to&#160;a TSC&#160;increment.&#160;The&#160;value&#160;of X is&#160;in the&#160;<br/>range&#160;0–31 and can be&#160;determined by consulting&#160;the&#160;VMX capability MSR&#160;IA32_VMX_MISC (see<a href="o_fe12b1e2a880e0ce-1947.html">&#160;Appendix A.6).<br/></a>The VMX-preemption timer operates in the C-states&#160;C0,&#160;C1,&#160;and C2; it also operates in the shutdown and wait-for-<br/>SIPI&#160;states. If the&#160;timer counts&#160;down&#160;to zero&#160;in&#160;any state other&#160;than&#160;the wait-for&#160;SIPI&#160;state,&#160;the&#160;logical&#160;processor&#160;<br/>transitions to&#160;the C0&#160;C-state and causes&#160;a VM exit;&#160;the timer does not cause&#160;a VM&#160;exit if it&#160;counts&#160;down to zero&#160;in&#160;<br/>the&#160;wait-for-SIPI state. The timer&#160;is not&#160;decremented&#160;in C-states&#160;deeper&#160;than C2.<br/>Treatment of the&#160;timer in&#160;the case&#160;of system management&#160;interrupts (SMIs) and system-management&#160;mode&#160;<br/>(SMM) depends on whether the&#160;treatment&#160;of&#160;SMIs and&#160;SMM:</p>
</div>
</body>
</html>
