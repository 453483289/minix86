<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 613</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:16px;font-family:Times;color:#0860a8;}
	.ft08{font-size:12px;font-family:Times;color:#0860a8;}
	.ft09{font-size:8px;font-family:Times;color:#000000;}
	.ft010{font-size:7px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft012{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft013{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft014{font-size:9px;line-height:13px;font-family:Times;color:#000000;}
	.ft015{font-size:7px;line-height:9px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page613-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce613.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;17-39</p>
<p style="position:absolute;top:47px;left:425px;white-space:nowrap" class="ft01">DEBUG, BRANCH&#160;PROFILE, TSC, AND RESOURCE MONITORING FEATURES</p>
<p style="position:absolute;top:339px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:340px;left:95px;white-space:nowrap" class="ft011"><b>BTF&#160;(single-step&#160;on&#160;branches)&#160;flag&#160;(bit&#160;1)&#160;—&#160;</b>When set, the processor treats&#160;the TF flag&#160;in the&#160;EFLAGS&#160;<br/>register as&#160;a&#160;“single-step&#160;on branches” flag.&#160;See&#160;<a href="o_fe12b1e2a880e0ce-587.html">Section&#160;17.4.3,&#160;“Single-Stepping&#160;on Branches.”</a></p>
<p style="position:absolute;top:378px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:378px;left:95px;white-space:nowrap" class="ft011"><b>PB<i>i</i></b><b>&#160;(performance monitoring/breakpoint pins)&#160;flags (bits 2 through&#160;5)&#160;—&#160;</b>When these flags&#160;are set,&#160;<br/>the performance&#160;monitoring/breakpoint pins&#160;on the processor (BP0#,&#160;BP1#,&#160;BP2#,&#160;and BP3#)&#160;report&#160;<br/>breakpoint matches in&#160;the corresponding&#160;breakpoint-address&#160;registers&#160;(DR0 through DR3). The processor&#160;<br/>asserts then deasserts&#160;the corresponding&#160;BP<i>i</i># pin&#160;when&#160;a breakpoint match occurs. When&#160;a PB<i>i</i>&#160;flag&#160;is clear,&#160;<br/>the performance monitoring/breakpoint pins report performance events.&#160;Processor execution&#160;is not affected by&#160;<br/>reporting performance&#160;events.</p>
<p style="position:absolute;top:483px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:484px;left:95px;white-space:nowrap" class="ft011"><b>TR&#160;(trace message enable) flag (bit 6)&#160;—&#160;</b>When&#160;set, trace&#160;messages are&#160;enabled&#160;as described in&#160;<a href="o_fe12b1e2a880e0ce-587.html">Section&#160;<br/>17.4.4,&#160;“Branch Trace&#160;Messages.”&#160;S</a>etting&#160;this flag&#160;greatly reduces the&#160;performance&#160;of&#160;the processor.&#160;When&#160;<br/>trace messages&#160;are enabled,&#160;the&#160;values&#160;stored&#160;in&#160;the&#160;LastBranchToIP, LastBranchFromIP,&#160;LastExceptionToIP,&#160;<br/>and LastExceptionFromIP&#160;MSRs are&#160;undefined.</p>
<p style="position:absolute;top:583px;left:69px;white-space:nowrap" class="ft07">17.14.2&#160;&#160;Last&#160;Branch and Last&#160;Exception MSRs</p>
<p style="position:absolute;top:614px;left:69px;white-space:nowrap" class="ft011">The LastBranchToIP and LastBranchFromIP MSRs are&#160;32-bit registers for recording the&#160;instruction pointers for the&#160;<br/>last&#160;branch, interrupt, or&#160;exception that&#160;the processor took&#160;prior to&#160;a debug&#160;exception being&#160;generated.&#160;When a&#160;<br/>branch&#160;occurs,&#160;the&#160;processor loads the&#160;address of&#160;the&#160;branch instruction into&#160;the&#160;LastBranchFromIP MSR&#160;and loads&#160;<br/>the target address&#160;for the&#160;branch into&#160;the LastBranchToIP MSR.&#160;<br/>When an&#160;interrupt or&#160;exception occurs (other&#160;than a debug&#160;exception), the&#160;address of&#160;the instruction that&#160;was&#160;<br/>interrupted by the&#160;exception or&#160;interrupt is&#160;loaded into&#160;the&#160;LastBranchFromIP&#160;MSR and&#160;the address&#160;of the&#160;excep-<br/>tion or interrupt handler&#160;that is&#160;called&#160;is loaded&#160;into the&#160;LastBranchToIP MSR.<br/>The LastExceptionToIP&#160;and&#160;LastExceptionFromIP MSRs (also&#160;32-bit registers)&#160;record&#160;the instruction&#160;pointers for&#160;<br/>the&#160;last branch that&#160;the processor took&#160;prior&#160;to an&#160;exception or&#160;interrupt being&#160;generated.&#160;When&#160;an exception or&#160;<br/>interrupt occurs, the&#160;contents of the LastBranchToIP&#160;and&#160;LastBranchFromIP MSRs&#160;are copied&#160;into these&#160;registers&#160;<br/>before&#160;the&#160;to and&#160;from addresses of&#160;the exception or interrupt are&#160;recorded in the LastBranchToIP&#160;and LastBranch-<br/>FromIP MSRs.<br/>These registers&#160;can be read using&#160;the RDMSR instruction.<br/>Note that&#160;the values&#160;stored&#160;in the LastBranchToIP, LastBranchFromIP,&#160;LastExceptionToIP,&#160;and LastExceptionFromIP&#160;<br/>MSRs are&#160;offsets into the&#160;current code segment,&#160;as opposed&#160;to linear addresses, which are&#160;saved in last&#160;branch&#160;<br/>records&#160;for&#160;the Pentium 4 and&#160;Intel Xeon processors.</p>
<p style="position:absolute;top:942px;left:69px;white-space:nowrap" class="ft07">17.14.3&#160;&#160;Monitoring Branches, Exceptions, and Interrupts</p>
<p style="position:absolute;top:972px;left:69px;white-space:nowrap" class="ft011">When the&#160;LBR&#160;flag&#160;in&#160;the&#160;DEBUGCTLMSR register&#160;is set,&#160;the&#160;processor automatically begins recording&#160;branches&#160;<br/>that&#160;it takes,&#160;exceptions that are generated (except&#160;for&#160;debug exceptions), and interrupts&#160;that are&#160;serviced.&#160;Each&#160;<br/>time a&#160;branch, exception, or interrupt occurs,&#160;the processor records the&#160;to and from&#160;instruction&#160;pointers&#160;in the&#160;<br/>LastBranchToIP&#160;and LastBranchFromIP MSRs.&#160;In&#160;addition,&#160;for interrupts and&#160;exceptions,&#160;the processor copies the&#160;<br/>contents of the LastBranchToIP&#160;and LastBranchFromIP MSRs into the LastExceptionToIP&#160;and LastExceptionFromIP&#160;<br/>MSRs prior&#160;to recording the&#160;to and&#160;from&#160;addresses&#160;of&#160;the interrupt&#160;or exception.</p>
<p style="position:absolute;top:294px;left:245px;white-space:nowrap" class="ft08">Figure&#160;17-18.&#160;&#160;DEBUGCTLMSR&#160;Register (P6&#160;Family Processors)</p>
<p style="position:absolute;top:127px;left:256px;white-space:nowrap" class="ft09">31</p>
<p style="position:absolute;top:203px;left:282px;white-space:nowrap" class="ft014">TR&#160;—&#160;Trace messages enable<br/>PBi&#160;—&#160;Performance monitoring/breakpoint pins<br/>BTF&#160;—&#160;Single-step on branches<br/>LBR&#160;—&#160;Last branch/interrupt/exception</p>
<p style="position:absolute;top:127px;left:565px;white-space:nowrap" class="ft09">7&#160;6&#160;5&#160;4&#160;3&#160;2&#160;1&#160;0</p>
<p style="position:absolute;top:147px;left:603px;white-space:nowrap" class="ft015">P<br/>B<br/>2</p>
<p style="position:absolute;top:147px;left:616px;white-space:nowrap" class="ft015">P<br/>B<br/>1</p>
<p style="position:absolute;top:147px;left:628px;white-space:nowrap" class="ft015">P<br/>B<br/>0</p>
<p style="position:absolute;top:147px;left:640px;white-space:nowrap" class="ft010">B</p>
<p style="position:absolute;top:157px;left:641px;white-space:nowrap" class="ft015">T<br/>F</p>
<p style="position:absolute;top:154px;left:577px;white-space:nowrap" class="ft015">T<br/>R</p>
<p style="position:absolute;top:147px;left:653px;white-space:nowrap" class="ft010">L</p>
<p style="position:absolute;top:157px;left:653px;white-space:nowrap" class="ft015">B<br/>R</p>
<p style="position:absolute;top:147px;left:590px;white-space:nowrap" class="ft015">P<br/>B<br/>3</p>
<p style="position:absolute;top:155px;left:411px;white-space:nowrap" class="ft00">Reserved</p>
</div>
</body>
</html>
