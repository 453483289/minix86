<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 732</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:14px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:17px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:21px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page732-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce732.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">18-96&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft03"><b>Tagging&#160;—&#160;</b>Tagging&#160;is a&#160;means of marking&#160;μops&#160;that&#160;have&#160;encountered&#160;a&#160;particular performance event so&#160;they&#160;</p>
<p style="position:absolute;top:117px;left:93px;white-space:nowrap" class="ft08">can be counted&#160;at retirement. During&#160;the course of execution,&#160;the same&#160;event&#160;can happen&#160;more&#160;than&#160;once&#160;per&#160;<br/>μop and a&#160;direct&#160;count&#160;of&#160;the event would&#160;not&#160;provide an&#160;indication of how many&#160;μops&#160;encountered&#160;that event.&#160;<br/>The&#160;tagging mechanisms allow a&#160;μop&#160;to&#160;be&#160;tagged&#160;once&#160;during&#160;its&#160;lifetime&#160;and&#160;thus&#160;counted&#160;once&#160;at&#160;retirement.&#160;</p>
<p style="position:absolute;top:172px;left:93px;white-space:nowrap" class="ft04">The&#160;retired suffix&#160;is used&#160;for performance&#160;metrics&#160;that&#160;increment a&#160;count&#160;once per&#160;μop, rather than once&#160;per&#160;</p>
<p style="position:absolute;top:189px;left:93px;white-space:nowrap" class="ft04">event. For&#160;example, a&#160;μop&#160;may encounter a&#160;cache miss more&#160;than&#160;once&#160;during&#160;its life time, but&#160;a “Miss Retired”&#160;</p>
<p style="position:absolute;top:205px;left:93px;white-space:nowrap" class="ft04">metric&#160;(that counts the&#160;number of retired&#160;μops that encountered a&#160;cache miss)&#160;will increment&#160;only&#160;once for that&#160;</p>
<p style="position:absolute;top:223px;left:93px;white-space:nowrap" class="ft04">μop. A “Miss&#160;Retired” metric&#160;would be&#160;useful for characterizing&#160;the&#160;performance of the&#160;cache&#160;hierarchy&#160;for&#160;a&#160;</p>
<p style="position:absolute;top:238px;left:93px;white-space:nowrap" class="ft010">particular&#160;instruction sequence. Details of various performance metrics and how these can be constructed using&#160;<br/>the Pentium 4&#160;and&#160;Intel Xeon&#160;processors&#160;performance&#160;events are&#160;provided&#160;in&#160;the&#160;<i>Intel&#160;Pentium 4&#160;Processor&#160;<br/>Optimization Reference Manual</i>&#160;(see<a href="o_fe12b1e2a880e0ce-61.html">&#160;Section 1.4,&#160;“Related&#160;Literature”)</a><i>.</i>&#160;</p>
<p style="position:absolute;top:293px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:294px;left:93px;white-space:nowrap" class="ft09"><b>Replay —&#160;</b>To&#160;maximize&#160;performance&#160;for&#160;the common case,&#160;the Intel&#160;NetBurst microarchitecture&#160;aggressively&#160;<br/>schedules&#160;μops for execution before&#160;all&#160;the&#160;conditions&#160;for&#160;correct&#160;execution&#160;are guaranteed&#160;to be satisfied.&#160;In&#160;</p>
<p style="position:absolute;top:327px;left:93px;white-space:nowrap" class="ft04">the event that all of these conditions are not satisfied,&#160;μops must be reissued. The&#160;mechanism that the Pentium&#160;</p>
<p style="position:absolute;top:343px;left:93px;white-space:nowrap" class="ft04">4 and Intel Xeon processors use&#160;for this&#160;reissuing&#160;of&#160;μops is&#160;called replay. Some examples of&#160;replay causes are&#160;</p>
<p style="position:absolute;top:360px;left:93px;white-space:nowrap" class="ft09">cache&#160;misses, dependence&#160;violations,&#160;and unforeseen&#160;resource constraints. In&#160;normal operation, some number&#160;<br/>of replays&#160;is common and&#160;unavoidable.&#160;An excessive&#160;number of replays&#160;is an&#160;indication&#160;of a&#160;performance&#160;<br/>problem.</p>
<p style="position:absolute;top:415px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:415px;left:93px;white-space:nowrap" class="ft09"><b>Assist —&#160;</b>When&#160;the&#160;hardware needs&#160;the assistance&#160;of microcode&#160;to deal with some&#160;event,&#160;the&#160;machine takes&#160;<br/>an assist. One example of this is&#160;an underflow condition&#160;in&#160;the input operands&#160;of a&#160;floating-point operation. The&#160;<br/>hardware must internally modify&#160;the format of the&#160;operands in&#160;order&#160;to perform the&#160;computation.&#160;Assists&#160;clear&#160;<br/>the entire machine of&#160;μops before&#160;they begin and are&#160;costly.</p>
<p style="position:absolute;top:509px;left:68px;white-space:nowrap" class="ft06">18.15.6.1&#160;&#160;&#160;Using At-Retirement Counting</p>
<p style="position:absolute;top:538px;left:68px;white-space:nowrap" class="ft04">Processors&#160;based on&#160;Intel NetBurst&#160;microarchitecture&#160;allow counting both events and&#160;μops&#160;that encountered&#160;a&#160;</p>
<p style="position:absolute;top:554px;left:68px;white-space:nowrap" class="ft04">specified event.&#160;For a subset of&#160;the&#160;at-retirement events listed&#160;<a href="o_fe12b1e2a880e0ce-947.html">in&#160;Table&#160;19-29,&#160;</a>a&#160;μop&#160;may be&#160;tagged&#160;when&#160;it&#160;</p>
<p style="position:absolute;top:571px;left:68px;white-space:nowrap" class="ft09">encounters that&#160;event. The&#160;tagging&#160;mechanisms&#160;can be&#160;used&#160;in Interrupt-based&#160;event sampling,&#160;and&#160;a&#160;subset&#160;of&#160;<br/>these&#160;mechanisms&#160;can be&#160;used&#160;in PEBS.&#160;There are&#160;four&#160;independent tagging&#160;mechanisms, and&#160;each&#160;mechanism&#160;<br/>uses a&#160;different&#160;event&#160;to count&#160;μops tagged with&#160;that mechanism:&#160;</p>
<p style="position:absolute;top:625px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:626px;left:93px;white-space:nowrap" class="ft03"><b>Front-end tagging —&#160;</b>This mechanism pertains&#160;to the tagging of&#160;μops that encountered front-end events (for&#160;</p>
<p style="position:absolute;top:643px;left:93px;white-space:nowrap" class="ft04">example,&#160;trace cache&#160;and instruction&#160;counts)&#160;and&#160;are counted&#160;with the&#160;Front_end_event&#160;event</p>
<p style="position:absolute;top:664px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:665px;left:93px;white-space:nowrap" class="ft03"><b>Execution tagging&#160;—&#160;</b>This mechanism&#160;pertains to the tagging&#160;of&#160;μops&#160;that encountered&#160;execution&#160;events&#160;(for&#160;</p>
<p style="position:absolute;top:682px;left:93px;white-space:nowrap" class="ft04">example,&#160;instruction types) and&#160;are&#160;counted with the&#160;Execution_Event&#160;event.</p>
<p style="position:absolute;top:703px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:704px;left:93px;white-space:nowrap" class="ft03"><b>Replay tagging —&#160;</b>This mechanism pertains to&#160;tagging of&#160;μops whose retirement is&#160;replayed&#160;(for&#160;example,&#160;a&#160;</p>
<p style="position:absolute;top:721px;left:93px;white-space:nowrap" class="ft09">cache miss)&#160;and are counted&#160;with&#160;the Replay_event&#160;event.&#160;Branch mispredictions&#160;are also&#160;tagged with this&#160;<br/>mechanism.</p>
<p style="position:absolute;top:759px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:760px;left:93px;white-space:nowrap" class="ft03"><b>No tags —&#160;</b>This mechanism does not use tags. It&#160;uses&#160;the Instr_retired&#160;and the&#160;Uops_&#160;retired&#160;events.</p>
<p style="position:absolute;top:784px;left:68px;white-space:nowrap" class="ft04">Each&#160;tagging mechanism&#160;is independent from all others;&#160;that is,&#160;a&#160;μop&#160;that has been tagged using&#160;one&#160;mechanism&#160;</p>
<p style="position:absolute;top:800px;left:68px;white-space:nowrap" class="ft04">will&#160;not be detected with another mechanism’s&#160;tagged-μop detector.&#160;For example,&#160;if&#160;μops&#160;are tagged using&#160;the&#160;</p>
<p style="position:absolute;top:817px;left:68px;white-space:nowrap" class="ft04">front-end tagging mechanisms, the&#160;Replay_event will not count those as tagged&#160;μops&#160;unless they are also tagged&#160;</p>
<p style="position:absolute;top:833px;left:68px;white-space:nowrap" class="ft04">using the&#160;replay tagging&#160;mechanism.&#160;However,&#160;execution tags&#160;allow&#160;up to&#160;four different types&#160;of&#160;μops&#160;to be counted&#160;</p>
<p style="position:absolute;top:850px;left:68px;white-space:nowrap" class="ft011">at retirement through execution&#160;tagging.<br/>The independence of tagging&#160;mechanisms&#160;does&#160;not hold&#160;when&#160;using&#160;PEBS.&#160;When&#160;using PEBS, only&#160;one&#160;tagging&#160;<br/>mechanism&#160;should&#160;be used at&#160;a time.&#160;<br/>Certain kinds of&#160;μops&#160;that&#160;cannot be&#160;tagged, including I/O,&#160;uncacheable&#160;and locked&#160;accesses, returns, and&#160;far&#160;</p>
<p style="position:absolute;top:931px;left:68px;white-space:nowrap" class="ft09">transfers.<br/><a href="o_fe12b1e2a880e0ce-947.html">Table&#160;19-29</a>&#160;lists&#160;the performance&#160;monitoring&#160;events that support at-retirement counting: specifically the&#160;<br/>Front_end_event,&#160;Execution_event, Replay_event, Inst_retired&#160;and&#160;Uops_retired&#160;events.&#160;The following sections&#160;<br/>describe the&#160;tagging mechanisms for using&#160;these&#160;events&#160;to tag&#160;μop&#160;and count tagged&#160;μops.</p>
</div>
</body>
</html>
