<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 608</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:14px;font-family:Times;color:#0860a8;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:12px;font-family:Times;color:#0860a8;}
	.ft08{font-size:9px;font-family:Times;color:#0860a8;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page608-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce608.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">17-34&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">DEBUG,&#160;BRANCH&#160;PROFILE,&#160;TSC,&#160;AND RESOURCE&#160;MONITORING&#160;FEATURES</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft09"><b>BTS (branch trace store)&#160;flag&#160;(bit&#160;3)&#160;—&#160;</b>When set,&#160;enables&#160;the BTS facilities&#160;to log BTMs&#160;to a memory-<br/>resident BTS buffer that&#160;is part of the&#160;DS save&#160;area.&#160;S<a href="o_fe12b1e2a880e0ce-591.html">ee Section 17.4.9,&#160;“BTS and&#160;DS&#160;Save&#160;Area.”</a></p>
<p style="position:absolute;top:139px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:139px;left:93px;white-space:nowrap" class="ft09"><b>BTINT (branch trace&#160;interrupt)&#160;flag&#160;(bits 4)&#160;—&#160;</b>When set, the BTS&#160;facilities generate an interrupt when the&#160;<br/>BTS buffer is&#160;full. When&#160;clear,&#160;BTMs&#160;are logged&#160;to the BTS buffer&#160;in&#160;a circular&#160;fashion. See<a href="o_fe12b1e2a880e0ce-587.html">&#160;Section 17.4.5,&#160;“Branch&#160;<br/>Trace Store (BTS).”</a></p>
<p style="position:absolute;top:194px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:195px;left:93px;white-space:nowrap" class="ft09"><b>BTS_OFF_OS (disable ring&#160;0 branch&#160;trace&#160;store)&#160;flag&#160;(bit&#160;5)&#160;—&#160;</b>When set, enables&#160;the BTS facilities&#160;to&#160;<br/>skip sending/logging CPL_0&#160;BTMs&#160;to the&#160;memory-resident&#160;BTS buffer.&#160;S<a href="o_fe12b1e2a880e0ce-608.html">ee Section 17.11.2,&#160;“LBR Stack&#160;for&#160;<br/>Processors Based on Intel&#160;NetBurst® Microarchitecture.”</a></p>
<p style="position:absolute;top:250px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:250px;left:93px;white-space:nowrap" class="ft09"><b>BTS_OFF_USR (disable&#160;ring 0&#160;branch&#160;trace store) flag&#160;(bit 6) —&#160;</b>When set, enables&#160;the BTS&#160;facilities&#160;to&#160;<br/>skip sending/logging non-CPL_0 BTMs&#160;to the&#160;memory-resident BTS buffer.&#160;S<a href="o_fe12b1e2a880e0ce-608.html">ee Section 17.11.2,&#160;“LBR Stack for&#160;<br/>Processors Based on Intel&#160;NetBurst® Microarchitecture.”</a></p>
<p style="position:absolute;top:318px;left:432px;white-space:nowrap" class="ft05">NOTE</p>
<p style="position:absolute;top:343px;left:120px;white-space:nowrap" class="ft09">The&#160;initial&#160;implementation of BTS_OFF_USR&#160;and BTS_OFF_OS&#160;in MSR_DEBUGCTLA is&#160;shown in&#160;<br/><a href="o_fe12b1e2a880e0ce-607.html">Figure&#160;17-12.</a>&#160;The BTS_OFF_USR&#160;and&#160;BTS_OFF_OS&#160;fields&#160;may be&#160;implemented on&#160;other model-<br/>specific&#160;debug control register&#160;at different&#160;locations.</p>
<p style="position:absolute;top:417px;left:68px;white-space:nowrap" class="ft09">Se<a href="o_fe12b1e2a880e0ce-1281.html">e Chapter&#160;35,&#160;“Model-Specific&#160;Registers&#160;(MSRs),”</a>&#160;for a&#160;detailed description&#160;of&#160;each of the&#160;last&#160;branch recording&#160;<br/>MSRs.</p>
<p style="position:absolute;top:484px;left:68px;white-space:nowrap" class="ft06">17.11.2&#160;&#160;LBR Stack for Processors Based on Intel NetBurst® Microarchitecture</p>
<p style="position:absolute;top:514px;left:68px;white-space:nowrap" class="ft09">The LBR&#160;stack is&#160;made&#160;up of LBR MSRs that&#160;are&#160;treated&#160;by the processor as&#160;a circular stack. The TOS&#160;pointer&#160;<br/>(MSR_LASTBRANCH_TOS MSR) points&#160;to the LBR&#160;MSR&#160;(or LBR MSR pair) that&#160;contains&#160;the most&#160;recent (last)&#160;<br/>branch record placed&#160;on&#160;the stack.&#160;Prior to placing a new&#160;branch record&#160;on&#160;the stack,&#160;the TOS is&#160;incremented&#160;by&#160;1.&#160;<br/>When the&#160;TOS pointer reaches it&#160;maximum value,&#160;it&#160;wraps&#160;around to&#160;0.&#160;Se<a href="o_fe12b1e2a880e0ce-608.html">e Table 17-18&#160;</a>and&#160;<a href="o_fe12b1e2a880e0ce-607.html">Figure&#160;17-12</a>.</p>
<p style="position:absolute;top:597px;left:70px;white-space:nowrap" class="ft07">Table&#160;17-18.&#160;&#160;LBR MSR Stack&#160;Size&#160;and TOS Pointer Range for the Pentium</p>
<p style="position:absolute;top:595px;left:563px;white-space:nowrap" class="ft08">®</p>
<p style="position:absolute;top:597px;left:567px;white-space:nowrap" class="ft07">&#160;4&#160;and the Intel</p>
<p style="position:absolute;top:595px;left:670px;white-space:nowrap" class="ft08">®</p>
<p style="position:absolute;top:597px;left:678px;white-space:nowrap" class="ft07">Xeon</p>
<p style="position:absolute;top:595px;left:713px;white-space:nowrap" class="ft08">®</p>
<p style="position:absolute;top:597px;left:721px;white-space:nowrap" class="ft07">Processor&#160;Family</p>
<p style="position:absolute;top:765px;left:68px;white-space:nowrap" class="ft09">The registers&#160;in&#160;the LBR&#160;MSR stack and&#160;the MSR_LASTBRANCH_TOS MSR&#160;are read-only and&#160;can be read using the&#160;<br/>RDMSR instruction.<br/><a href="o_fe12b1e2a880e0ce-609.html">Figure&#160;17-13 shows the la</a>yout of a branch&#160;record in an LBR MSR (or MSR pair). Each&#160;branch&#160;record&#160;consists&#160;of&#160;two&#160;<br/>linear addresses, which represent&#160;the “from”&#160;and “to” instruction pointers for a&#160;branch,&#160;interrupt,&#160;or&#160;exception.&#160;The&#160;<br/>contents of the&#160;from&#160;and to&#160;addresses&#160;differ, depending on&#160;the&#160;source&#160;of&#160;the branch:</p>
<p style="position:absolute;top:860px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:861px;left:93px;white-space:nowrap" class="ft09"><b>Taken branch</b>&#160;— If the record is for a taken&#160;branch, the “from”&#160;address is the address of the branch instruction&#160;<br/>and&#160;the “to” address&#160;is the&#160;target&#160;instruction of the&#160;branch.&#160;</p>
<p style="position:absolute;top:899px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:900px;left:93px;white-space:nowrap" class="ft09"><b>Interrupt&#160;</b>— If the&#160;record is for an interrupt, the “from” address the&#160;return instruction&#160;pointer (RIP) saved&#160;for&#160;<br/>the interrupt and&#160;the&#160;“to”&#160;address is&#160;the address of the first instruction in&#160;the&#160;interrupt handler routine.&#160;The RIP&#160;<br/>is&#160;the linear&#160;address of&#160;the&#160;next instruction to&#160;be&#160;executed&#160;upon&#160;returning&#160;from&#160;the interrupt handler.</p>
<p style="position:absolute;top:955px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:955px;left:93px;white-space:nowrap" class="ft09"><b>Exception</b>&#160;—&#160;If the&#160;record&#160;is for an exception,&#160;the&#160;“from”&#160;address is&#160;the linear&#160;address of&#160;the instruction that&#160;<br/>caused&#160;the&#160;exception&#160;to be&#160;generated and the “to” address&#160;is the&#160;address of&#160;the first instruction in the exception&#160;<br/>handler&#160;routine.</p>
<p style="position:absolute;top:637px;left:83px;white-space:nowrap" class="ft04">DisplayFamily_DisplayModel</p>
<p style="position:absolute;top:637px;left:544px;white-space:nowrap" class="ft04">Size&#160;of&#160;LBR Stack</p>
<p style="position:absolute;top:637px;left:677px;white-space:nowrap" class="ft04">Range&#160;of&#160;TOS&#160;Pointer</p>
<p style="position:absolute;top:660px;left:83px;white-space:nowrap" class="ft04">Family&#160;0FH,&#160;Models&#160;0H-02H; MSRs at locations 1DBH-1DEH.</p>
<p style="position:absolute;top:660px;left:544px;white-space:nowrap" class="ft04">4</p>
<p style="position:absolute;top:660px;left:677px;white-space:nowrap" class="ft04">0&#160;&#160;to&#160;&#160;3</p>
<p style="position:absolute;top:682px;left:83px;white-space:nowrap" class="ft04">Family&#160;0FH,&#160;Models; MSRs at locations 680H-68FH.</p>
<p style="position:absolute;top:682px;left:544px;white-space:nowrap" class="ft04">16</p>
<p style="position:absolute;top:682px;left:677px;white-space:nowrap" class="ft04">0 to&#160;15</p>
<p style="position:absolute;top:705px;left:83px;white-space:nowrap" class="ft04">Family 0FH,&#160;Model&#160;03H; MSRs&#160;at locations&#160;6C0H-6CFH.</p>
<p style="position:absolute;top:705px;left:544px;white-space:nowrap" class="ft04">16</p>
<p style="position:absolute;top:705px;left:677px;white-space:nowrap" class="ft04">0 to&#160;15</p>
</div>
</body>
</html>
