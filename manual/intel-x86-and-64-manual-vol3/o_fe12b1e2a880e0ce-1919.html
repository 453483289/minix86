<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1919</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:21px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:8px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#0860a8;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:18px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1919-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1919.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:767px;white-space:nowrap" class="ft00">Vol. 3D&#160;42-1</p>
<p style="position:absolute;top:47px;left:438px;white-space:nowrap" class="ft01">INTEL® SGX INTERACTIONS WITH IA32&#160;AND INTEL® 64&#160;ARCHITECTURE</p>
<p style="position:absolute;top:96px;left:699px;white-space:nowrap" class="ft02">CHAPTER 42</p>
<p style="position:absolute;top:120px;left:90px;white-space:nowrap" class="ft02">INTEL® SGX INTERACTIONS WITH&#160;IA32 AND INTEL® 64 ARCHITECTURE</p>
<p style="position:absolute;top:190px;left:69px;white-space:nowrap" class="ft03">Intel</p>
<p style="position:absolute;top:188px;left:100px;white-space:nowrap" class="ft04">®</p>
<p style="position:absolute;top:190px;left:111px;white-space:nowrap" class="ft03">&#160;SGX&#160;provides&#160;Intel</p>
<p style="position:absolute;top:188px;left:241px;white-space:nowrap" class="ft04">®</p>
<p style="position:absolute;top:190px;left:252px;white-space:nowrap" class="ft03">&#160;Architecture with&#160;a collection of&#160;enclave instructions for creating protected&#160;execution&#160;</p>
<p style="position:absolute;top:207px;left:69px;white-space:nowrap" class="ft03">environments on processors supporting IA32&#160;and&#160;Intel</p>
<p style="position:absolute;top:204px;left:437px;white-space:nowrap" class="ft04">®</p>
<p style="position:absolute;top:207px;left:448px;white-space:nowrap" class="ft03">&#160;64&#160;architectures.&#160;These&#160;Intel SGX&#160;instructions&#160;are&#160;</p>
<p style="position:absolute;top:223px;left:69px;white-space:nowrap" class="ft03">designed to&#160;work with legacy&#160;software and&#160;the&#160;various&#160;IA32 and&#160;Intel 64 modes of operation.</p>
<p style="position:absolute;top:279px;left:69px;white-space:nowrap" class="ft05">42.1&#160;</p>
<p style="position:absolute;top:279px;left:148px;white-space:nowrap" class="ft05">INTEL® SGX AVAILABILITY IN VARIOUS PROCESSOR MODES</p>
<p style="position:absolute;top:313px;left:69px;white-space:nowrap" class="ft08">The Intel SGX extensions<a href="o_fe12b1e2a880e0ce-1767.html">&#160;(see Table&#160;37-1) are</a>&#160;available only&#160;when the processor is executing in protected mode&#160;of&#160;<br/>operation. Additionally, the&#160;extensions are&#160;not available&#160;in&#160;System Management Mode&#160;(SMM) of&#160;operation or&#160;in&#160;<br/>Virtual 8086&#160;(VM86) mode of operation.&#160;Finally,&#160;all leaf&#160;functions of ENCLU and&#160;ENCLS&#160;require CR0.PG&#160;enabled.<br/>The exact&#160;details&#160;of exceptions resulting from illegal modes&#160;and their&#160;priority&#160;are&#160;listed in&#160;the reference pages&#160;of&#160;<br/>ENCLS&#160;and&#160;ENCLU.</p>
<p style="position:absolute;top:441px;left:69px;white-space:nowrap" class="ft05">42.2 IA32_FEATURE_CONTROL</p>
<p style="position:absolute;top:475px;left:69px;white-space:nowrap" class="ft08">IA32_FEATURE_CONTROL&#160;MSR provides two new&#160;bits related&#160;to two aspects of&#160;Intel SGX:&#160;using the&#160;instruction&#160;<br/>extensions&#160;and launch&#160;control&#160;configuration.</p>
<p style="position:absolute;top:542px;left:69px;white-space:nowrap" class="ft06">42.2.1&#160;</p>
<p style="position:absolute;top:542px;left:150px;white-space:nowrap" class="ft06">Availability of&#160;Intel SGX&#160;</p>
<p style="position:absolute;top:571px;left:69px;white-space:nowrap" class="ft08">IA32_FEATURE_CONTROL[bit 18] allows BIOS&#160;to control the availability&#160;of Intel&#160;SGX extensions. For Intel&#160;SGX&#160;<br/>extensions to&#160;be&#160;available on&#160;a logical processor,&#160;bit 18&#160;in the&#160;IA32_FEATURE_CONTROL&#160;MSR&#160;on&#160;that logical&#160;<br/>processor must be set, and IA32_FEATURE_CONTROL&#160;MSR on&#160;that logical&#160;processor must be&#160;locked (bit&#160;0&#160;must be&#160;<br/>set).&#160;See<a href="o_fe12b1e2a880e0ce-1768.html">&#160;Section 37.7.1 for ad</a>ditional details. OS is expected to examine the value&#160;of&#160;bit 18&#160;prior to enabling Intel&#160;<br/>SGX&#160;on the&#160;thread, as&#160;the settings of bit 18 is&#160;not&#160;reflected by&#160;CPUID.</p>
<p style="position:absolute;top:688px;left:69px;white-space:nowrap" class="ft06">42.2.2&#160;</p>
<p style="position:absolute;top:688px;left:149px;white-space:nowrap" class="ft06">Intel SGX Launch Control Configuration</p>
<p style="position:absolute;top:717px;left:69px;white-space:nowrap" class="ft08">The&#160;IA32_SGXLEPUBKEYHASHn MSRs used&#160;to&#160;configure&#160;authorized&#160;launch enclaves MRSIGNER&#160;digest&#160;value are&#160;<br/>present&#160;on logical processors that support the&#160;collection of&#160;SGX1 leaf&#160;functions (i.e. CPUID.(EAX=12H,&#160;<br/>ECX=00H):EAX[0] = 1).&#160;IA32_FEATURE_CONTROL[bit 17] allows&#160;to BIOS to enable write access to&#160;these MSRs. If&#160;<br/>IA32_FEATURE_CONTROL.LE_WR&#160;(bit&#160;17)&#160;is set to 1 and IA32_FEATURE_CONTROL&#160;is locked&#160;on&#160;that logical&#160;<br/>processor,&#160;IA32_SGXLEPUBKEYHASH&#160;MSRs&#160;on that logical processor then the&#160;IA32_SGXLEPUBKEYHASHn MSR&#160;are&#160;<br/>writeable.&#160;If this bit 17 is&#160;not set&#160;or IA32_FEATURE_CONTROL&#160;is not locked, IA32_SGXLEPUBKEYHASH&#160;MSRs are&#160;<br/>read only.&#160;S<a href="o_fe12b1e2a880e0ce-1791.html">ee Section 39.1.4&#160;</a>for additional details.</p>
<p style="position:absolute;top:871px;left:69px;white-space:nowrap" class="ft05">42.3 INTERACTIONS&#160;</p>
<p style="position:absolute;top:871px;left:293px;white-space:nowrap" class="ft05">WITH&#160;</p>
<p style="position:absolute;top:871px;left:348px;white-space:nowrap" class="ft05">SEGMENTATION</p>
<p style="position:absolute;top:934px;left:69px;white-space:nowrap" class="ft06">42.3.1&#160;</p>
<p style="position:absolute;top:934px;left:150px;white-space:nowrap" class="ft06">Scope of&#160;Interaction</p>
<p style="position:absolute;top:963px;left:69px;white-space:nowrap" class="ft09">Intel&#160;SGX extensions&#160;are&#160;available&#160;only&#160;when&#160;the processor is&#160;executing&#160;in a&#160;protected mode&#160;operation (see&#160;<br/><a href="o_fe12b1e2a880e0ce-1919.html">Section&#160;42.1 for Intel SGX a</a>vailability in various processor&#160;modes). Enclaves abide by all&#160;the&#160;segmentation policies&#160;<br/>set up&#160;by&#160;the OS, but&#160;they can&#160;be&#160;more restrictive&#160;than the&#160;OS.<br/>Intel&#160;SGX interacts with segmentation&#160;at two levels:&#160;</p>
<p style="position:absolute;top:1040px;left:69px;white-space:nowrap" class="ft07">•</p>
<p style="position:absolute;top:1041px;left:95px;white-space:nowrap" class="ft03">The&#160;Intel&#160;SGX instruction (see&#160;the&#160;enclave<a href="o_fe12b1e2a880e0ce-1767.html">&#160;instruction in Table&#160;37-1).</a></p>
</div>
</body>
</html>
