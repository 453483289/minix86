<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 405</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:8px;font-family:Times;color:#000000;}
	.ft06{font-size:18px;font-family:Times;color:#000000;}
	.ft07{font-size:14px;font-family:Times;color:#0860a8;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page405-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce405.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:760px;white-space:nowrap" class="ft00">Vol. 3A&#160;10-43</p>
<p style="position:absolute;top:47px;left:484px;white-space:nowrap" class="ft01">ADVANCED PROGRAMMABLE&#160;INTERRUPT CONTROLLER&#160;(APIC)</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08"><i>Virtualization Technology for Directed&#160;I/O</i>, Revision 1.3&#160;for&#160;the&#160;routing&#160;of&#160;interrupts from MSI-capable devices to&#160;<br/>local APIC units operating&#160;in x2APIC mode.</p>
<p style="position:absolute;top:167px;left:69px;white-space:nowrap" class="ft04">10.12.7&#160;&#160;Initialization by&#160;System Software</p>
<p style="position:absolute;top:198px;left:69px;white-space:nowrap" class="ft08">Routing of device&#160;interrupts to&#160;local&#160;APIC units&#160;operating&#160;in&#160;x2APIC&#160;mode requires&#160;use of the interrupt-remapping&#160;<br/>architecture specified in the&#160;<i>Intel</i></p>
<p style="position:absolute;top:212px;left:291px;white-space:nowrap" class="ft05"><i>¬Æ</i></p>
<p style="position:absolute;top:214px;left:302px;white-space:nowrap" class="ft02"><i>&#160;Virtualization Technology&#160;for Directed I/O</i>, Revision 1.3. Because of&#160;this,&#160;BIOS&#160;</p>
<p style="position:absolute;top:231px;left:69px;white-space:nowrap" class="ft08">must enumerate support for and&#160;software must&#160;enable&#160;this interrupt&#160;remapping with&#160;Extended Interrupt Mode&#160;<br/>Enabled before it&#160;enabling&#160;x2APIC&#160;mode&#160;in the&#160;local APIC units.<br/>The ACPI interfaces for the x2APIC&#160;are&#160;described&#160;in&#160;Section&#160;5.2, ‚ÄúACPI System Description&#160;Tables,‚Äù&#160;of&#160;the&#160;<i>Advanced&#160;<br/>Configuration and&#160;Power Interface&#160;Specification</i>, Revision 4.0a&#160;(http://www.acpi.info/spec.htm). The&#160;default&#160;<br/>behavior for BIOS&#160;is to&#160;pass&#160;the control to&#160;the operating&#160;system with the&#160;local x2APICs in xAPIC&#160;mode&#160;if&#160;all APIC&#160;<br/>IDs reported&#160;by CPUID.0BH:EDX are&#160;less than 255, and&#160;in&#160;x2APIC mode if there&#160;are any logical processor reporting&#160;<br/>an APIC&#160;ID&#160;of 255 or&#160;greater.</p>
<p style="position:absolute;top:388px;left:69px;white-space:nowrap" class="ft04">10.12.8&#160;&#160;CPUID Extensions And Topology Enumeration</p>
<p style="position:absolute;top:417px;left:69px;white-space:nowrap" class="ft08">For Intel 64&#160;and&#160;IA-32&#160;processors that support x2APIC,&#160;a value of 1&#160;reported&#160;by CPUID.01H:ECX[21] indicates that&#160;<br/>the processor supports x2APIC and&#160;the extended topology&#160;enumeration&#160;leaf&#160;(CPUID.0BH).&#160;<br/>The extended&#160;topology&#160;enumeration&#160;leaf&#160;can&#160;be&#160;accessed by&#160;executing CPUID with&#160;EAX = 0BH.&#160;Processors that&#160;do&#160;<br/>not support&#160;x2APIC&#160;may support CPUID&#160;leaf 0BH.&#160;Software&#160;can&#160;detect the&#160;availability of the&#160;extended topology&#160;<br/>enumeration&#160;leaf&#160;(0BH) by&#160;performing two steps:</p>
<p style="position:absolute;top:511px;left:69px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:511px;left:95px;white-space:nowrap" class="ft08">Check&#160;maximum&#160;input value for basic CPUID&#160;information by&#160;executing CPUID&#160;with EAX= 0.&#160;If CPUID.0H:EAX&#160;is&#160;<br/>greater than&#160;or&#160;equal&#160;or 11 (0BH),&#160;then proceed&#160;to next step</p>
<p style="position:absolute;top:550px;left:69px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:550px;left:95px;white-space:nowrap" class="ft03">Check CPUID.EAX=0BH,&#160;ECX=0H:EBX&#160;is non-zero.&#160;</p>
<p style="position:absolute;top:573px;left:69px;white-space:nowrap" class="ft08">If both of the above conditions are true, extended topology enumeration leaf is&#160;available.&#160;If available,&#160;the extended&#160;<br/>topology&#160;enumeration&#160;leaf is&#160;the preferred mechanism for enumerating topology.&#160;The&#160;presence of CPUID leaf&#160;0BH&#160;<br/>in&#160;a processor does not guarantee&#160;support&#160;for&#160;x2APIC.&#160;If&#160;CPUID.EAX=0BH,&#160;ECX=0H:EBX&#160;returns zero&#160;and&#160;<br/>maximum&#160;input value for&#160;basic CPUID&#160;information is&#160;greater than&#160;0BH,&#160;then&#160;CPUID.0BH&#160;leaf is&#160;not supported&#160;on&#160;<br/>that processor.<br/>The extended&#160;topology&#160;enumeration&#160;leaf&#160;is intended&#160;to assist&#160;software&#160;with enumerating processor topology&#160;on&#160;<br/>systems&#160;that requires&#160;32-bit x2APIC IDs&#160;to address individual logical processors. Details of CPUID&#160;leaf 0BH&#160;can be&#160;<br/>found&#160;in the&#160;reference&#160;<a href="˛ˇ">pages of CPUID in Chapter&#160;3 of&#160;<i>Intel¬Æ 64&#160;and&#160;IA-32&#160;Architectures Software&#160;Developer‚Äôs&#160;<br/>Manual, Volume&#160;2A</i></a>.<br/>Processor&#160;topology enumeration&#160;algorithm for processors&#160;supporting the extended topology enumeration&#160;leaf of&#160;<br/>CPUID and&#160;processors that do&#160;not&#160;support CPUID&#160;leaf 0BH&#160;are<a href="o_fe12b1e2a880e0ce-293.html">&#160;treated in Section 8.9.4,&#160;‚ÄúAlgorithm for Three-Level&#160;<br/>Mappings of&#160;APIC_ID‚Äù.</a></p>
<p style="position:absolute;top:811px;left:69px;white-space:nowrap" class="ft07">10.12.8.1&#160;&#160;&#160;Consistency&#160;of&#160;APIC&#160;IDs&#160;and CPUID</p>
<p style="position:absolute;top:838px;left:69px;white-space:nowrap" class="ft08">The consistency of physical x2APIC&#160;ID&#160;in MSR 802H in&#160;x2APIC mode&#160;and the&#160;32-bit value returned in&#160;<br/>CPUID.0BH:EDX is&#160;facilitated&#160;by processor hardware.&#160;<br/>CPUID.0BH:EDX will report&#160;the&#160;full 32&#160;bit ID, in xAPIC and x2APIC mode. This allows BIOS&#160;to determine&#160;if a system&#160;<br/>has processors with IDs exceeding&#160;the&#160;8-bit&#160;initial APIC ID limit&#160;(CPUID.01H:EBX[31:24]).&#160;Initial APIC ID&#160;<br/>(CPUID.01H:EBX[31:24]) is&#160;always equal to CPUID.0BH:EDX[7:0].&#160;<br/>If&#160;the&#160;values of CPUID.0BH:EDX reported&#160;by all logical processors in&#160;a system are less than 255, BIOS&#160;can transfer&#160;<br/>control&#160;to OS&#160;in&#160;xAPIC mode.<br/>If the&#160;values&#160;of CPUID.0BH:EDX reported&#160;by&#160;some logical processors in&#160;a system are&#160;greater or&#160;equal&#160;than&#160;255,&#160;<br/>BIOS&#160;must&#160;support two options&#160;to hand&#160;off&#160;to OS:</p>
<p style="position:absolute;top:1009px;left:69px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:1010px;left:95px;white-space:nowrap" class="ft08">If BIOS enables logical processors with x2APIC&#160;IDs&#160;greater&#160;than&#160;255,&#160;then it&#160;should enable X2APIC&#160;in Boot&#160;<br/>Strap Processor (BSP) and&#160;all Application&#160;Processors&#160;(AP) before passing control to&#160;the OS. Application&#160;<br/>requiring processor topology&#160;information must use&#160;OS&#160;provided&#160;services&#160;based on&#160;x2APIC IDs or&#160;CPUID.0BH&#160;<br/>leaf.</p>
</div>
</body>
</html>
