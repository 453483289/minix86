<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 258</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page258-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce258.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">8-2&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">MULTIPLE-PROCESSOR&#160;MANAGEMENT</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft07">Cache coherency&#160;protocols that&#160;ensure that&#160;atomic&#160;operations can be&#160;carried&#160;out&#160;on cached data&#160;structures&#160;<br/>(cache&#160;lock); this mechanism is&#160;present in&#160;the&#160;Pentium&#160;4,&#160;Intel Xeon, and P6&#160;family&#160;processors</p>
<p style="position:absolute;top:141px;left:68px;white-space:nowrap" class="ft07">These&#160;mechanisms are interdependent in the&#160;following ways. Certain basic memory transactions&#160;(such as reading&#160;<br/>or&#160;writing&#160;a byte&#160;in system&#160;memory) are&#160;always guaranteed&#160;to&#160;be&#160;handled&#160;atomically. That is, once&#160;started, the&#160;<br/>processor guarantees that the&#160;operation will be&#160;completed before another processor or bus agent is allowed access&#160;<br/>to the memory&#160;location. The&#160;processor also supports bus&#160;locking for performing selected memory operations (such&#160;<br/>as a read-modify-write operation in a shared area of memory) that typically need to be handled atomically, but are&#160;<br/>not automatically&#160;handled this way.&#160;Because frequently used&#160;memory locations are&#160;often cached&#160;in&#160;a processor’s L1&#160;<br/>or L2 caches,&#160;atomic&#160;operations&#160;can often be carried&#160;out&#160;inside&#160;a processor’s&#160;caches without asserting the&#160;bus lock.&#160;<br/>Here the&#160;processor’s cache&#160;coherency protocols ensure&#160;that other processors that&#160;are&#160;caching the&#160;same memory&#160;<br/>locations&#160;are managed properly while&#160;atomic&#160;operations are performed on cached memory locations.</p>
<p style="position:absolute;top:307px;left:432px;white-space:nowrap" class="ft04">NOTE</p>
<p style="position:absolute;top:333px;left:120px;white-space:nowrap" class="ft07">Where&#160;there are contested&#160;lock&#160;accesses, software&#160;may need to implement algorithms that&#160;ensure&#160;<br/>fair access to resources in&#160;order&#160;to prevent lock starvation. The hardware provides&#160;no resource that&#160;<br/>guarantees&#160;fairness&#160;to participating&#160;agents. It&#160;is the&#160;responsibility of software&#160;to manage&#160;the&#160;<br/>fairness of semaphores and&#160;exclusive locking&#160;functions.</p>
<p style="position:absolute;top:406px;left:68px;white-space:nowrap" class="ft07">The mechanisms for&#160;handling locked&#160;atomic operations have&#160;evolved with the&#160;complexity&#160;of IA-32 processors.&#160;More&#160;<br/>recent IA-32 processors&#160;(such as&#160;the Pentium&#160;4, Intel Xeon, and P6 family&#160;processors) and Intel 64 provide a more&#160;<br/>refined&#160;locking mechanism than earlier processors.&#160;These&#160;mechanisms are&#160;described&#160;in the&#160;following&#160;sections.</p>
<p style="position:absolute;top:490px;left:68px;white-space:nowrap" class="ft05">8.1.1 Guaranteed&#160;</p>
<p style="position:absolute;top:490px;left:247px;white-space:nowrap" class="ft05">Atomic&#160;</p>
<p style="position:absolute;top:490px;left:307px;white-space:nowrap" class="ft05">Operations</p>
<p style="position:absolute;top:520px;left:68px;white-space:nowrap" class="ft07">The&#160;Intel486&#160;processor (and&#160;newer processors since)&#160;guarantees&#160;that the&#160;following basic memory operations will&#160;<br/>always&#160;be carried out atomically:</p>
<p style="position:absolute;top:559px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:559px;left:93px;white-space:nowrap" class="ft03">Reading or writing&#160;a byte</p>
<p style="position:absolute;top:581px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:582px;left:93px;white-space:nowrap" class="ft03">Reading or writing&#160;a word aligned&#160;on&#160;a 16-bit&#160;boundary</p>
<p style="position:absolute;top:604px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:604px;left:93px;white-space:nowrap" class="ft03">Reading or writing&#160;a doubleword&#160;aligned on a&#160;32-bit boundary</p>
<p style="position:absolute;top:628px;left:68px;white-space:nowrap" class="ft07">The Pentium processor (and&#160;newer processors since)&#160;guarantees that the following&#160;additional&#160;memory&#160;operations&#160;<br/>will&#160;always be&#160;carried out atomically:</p>
<p style="position:absolute;top:667px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:667px;left:93px;white-space:nowrap" class="ft03">Reading or writing&#160;a quadword&#160;aligned on a&#160;64-bit boundary</p>
<p style="position:absolute;top:689px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:690px;left:93px;white-space:nowrap" class="ft03">16-bit accesses to&#160;uncached memory locations&#160;that&#160;fit within&#160;a 32-bit&#160;data&#160;bus</p>
<p style="position:absolute;top:714px;left:68px;white-space:nowrap" class="ft07">The&#160;P6&#160;family processors (and&#160;newer processors since)&#160;guarantee that&#160;the following&#160;additional memory operation&#160;<br/>will&#160;always be&#160;carried out atomically:</p>
<p style="position:absolute;top:752px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:753px;left:93px;white-space:nowrap" class="ft03">Unaligned&#160;16-, 32-,&#160;and 64-bit&#160;accesses&#160;to cached memory that fit&#160;within&#160;a&#160;cache&#160;line</p>
<p style="position:absolute;top:777px;left:68px;white-space:nowrap" class="ft07">Accesses&#160;to&#160;cacheable memory that are&#160;split across&#160;cache lines&#160;and&#160;page&#160;boundaries are&#160;not&#160;guaranteed&#160;to be&#160;<br/>atomic by the&#160;Intel&#160;Core&#160;2 Duo,&#160;Intel</p>
<p style="position:absolute;top:791px;left:316px;white-space:nowrap" class="ft06">®</p>
<p style="position:absolute;top:793px;left:326px;white-space:nowrap" class="ft03">&#160;Atom™, Intel Core Duo,&#160;Pentium M, Pentium 4,&#160;Intel Xeon,&#160;P6&#160;family,&#160;</p>
<p style="position:absolute;top:810px;left:68px;white-space:nowrap" class="ft07">Pentium,&#160;and Intel486&#160;processors. The Intel&#160;Core 2&#160;Duo,&#160;Intel&#160;Atom, Intel&#160;Core Duo,&#160;Pentium&#160;M, Pentium 4, Intel&#160;<br/>Xeon, and P6 family&#160;processors&#160;provide bus&#160;control&#160;signals&#160;that permit external memory subsystems to&#160;make split&#160;<br/>accesses atomic; however,&#160;nonaligned data&#160;accesses will seriously&#160;impact the&#160;performance of&#160;the&#160;processor and&#160;<br/>should&#160;be avoided.<br/>An&#160;x87 instruction or&#160;an&#160;SSE instructions that&#160;accesses&#160;data larger than&#160;a quadword&#160;may be&#160;implemented&#160;using&#160;<br/>multiple&#160;memory accesses. If such&#160;an instruction stores&#160;to&#160;memory, some&#160;of&#160;the accesses may complete (writing&#160;<br/>to memory) while another causes the operation to fault for&#160;architectural reasons (e.g. due an page-table entry that&#160;<br/>is marked&#160;“not present”). In&#160;this case, the&#160;effects&#160;of&#160;the completed&#160;accesses&#160;may&#160;be&#160;visible&#160;to software&#160;even&#160;<br/>though the&#160;overall&#160;instruction caused&#160;a fault. If TLB invalidation has been&#160;delayed (see<a href="o_fe12b1e2a880e0ce-148.html">&#160;Section 4.10.4.4), such&#160;<br/></a>page faults may occur even&#160;if&#160;all accesses&#160;are to&#160;the same&#160;page.</p>
</div>
</body>
</html>
