<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1927</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:12px;font-family:Times;color:#0860a8;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:19px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1927-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1927.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:767px;white-space:nowrap" class="ft00">Vol. 3D&#160;42-9</p>
<p style="position:absolute;top:47px;left:438px;white-space:nowrap" class="ft01">INTEL¬Æ SGX INTERACTIONS WITH IA32&#160;AND INTEL¬Æ 64&#160;ARCHITECTURE</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08">executing EEXIT.&#160;However,&#160;successful execution&#160;of&#160;the ENCLU[EEXIT] leaf&#160;function restores XCR0 to&#160;the value&#160;it&#160;<br/>held&#160;at the&#160;time of the most recent enclave entry.&#160;</p>
<p style="position:absolute;top:167px;left:69px;white-space:nowrap" class="ft03">42.7.8&#160;</p>
<p style="position:absolute;top:167px;left:149px;white-space:nowrap" class="ft03">Processor Extended States and ENCLU[EREPORT]</p>
<p style="position:absolute;top:201px;left:69px;white-space:nowrap" class="ft09">The ENCLU[EREPORT] leaf function creates the MAC-protected REPORT structure&#160;that&#160;reports&#160;on the&#160;enclave‚Äôs&#160;<br/>identity.&#160;ENCLU[EREPORT]&#160;includes in&#160;the report&#160;the&#160;values of&#160;SECS.ATTRIBUTES.XFRM and SECS.MISCSELECT.</p>
<p style="position:absolute;top:269px;left:69px;white-space:nowrap" class="ft04">42.7.9 Processor&#160;</p>
<p style="position:absolute;top:269px;left:233px;white-space:nowrap" class="ft04">Extended&#160;</p>
<p style="position:absolute;top:269px;left:315px;white-space:nowrap" class="ft04">States and ENCLU[EGETKEY]</p>
<p style="position:absolute;top:298px;left:69px;white-space:nowrap" class="ft08">The&#160;ENCLU[EGETKEY]&#160;leaf function returns a&#160;cryptographic&#160;key&#160;based on&#160;the&#160;information&#160;provided&#160;by the&#160;KEYRE-<br/>QUEST&#160;structure.&#160;Intel&#160;SGX&#160;provides&#160;the means&#160;for isolation between&#160;different operating&#160;conditions&#160;by allowing an&#160;<br/>enclave developer to select&#160;which bits out of XFRM and&#160;MISCSELECT&#160;need to&#160;be&#160;included&#160;in the&#160;derivation&#160;of the&#160;<br/>keys.</p>
<p style="position:absolute;top:403px;left:69px;white-space:nowrap" class="ft05">42.8 INTERACTIONS&#160;</p>
<p style="position:absolute;top:403px;left:293px;white-space:nowrap" class="ft05">WITH&#160;</p>
<p style="position:absolute;top:403px;left:348px;white-space:nowrap" class="ft05">SMM</p>
<p style="position:absolute;top:466px;left:69px;white-space:nowrap" class="ft03">42.8.1&#160;</p>
<p style="position:absolute;top:466px;left:150px;white-space:nowrap" class="ft03">Availability of&#160;Intel¬Æ SGX instructions in SMM</p>
<p style="position:absolute;top:495px;left:69px;white-space:nowrap" class="ft08">Enclave instructions are not available&#160;in SMM, and any&#160;attempt to execute ENCLS or ENCLU instructions inside SMM&#160;<br/>results in&#160;an invalid-opcode&#160;exception (#UD).</p>
<p style="position:absolute;top:562px;left:69px;white-space:nowrap" class="ft03">42.8.2&#160;</p>
<p style="position:absolute;top:562px;left:149px;white-space:nowrap" class="ft03">SMI while Inside&#160;an Enclave</p>
<p style="position:absolute;top:591px;left:69px;white-space:nowrap" class="ft08">If the&#160;logical&#160;processor executing inside an&#160;enclave&#160;receives&#160;an SMI,&#160;the logical processor exits&#160;the enclave asyn-<br/>chronously. The response to&#160;an SMI received while&#160;executing&#160;inside&#160;an enclave depends on whether&#160;the&#160;dual-<br/>monitor treatment&#160;is enabled. For detailed discussion&#160;of&#160;transfer&#160;<a href="˛ˇ">to SMM, see Chapter&#160;34, ‚ÄúSystem&#160;Management&#160;<br/>Mode‚Äù of the&#160;<i>Intel¬Æ&#160;64&#160;and&#160;IA-32&#160;Architectures Software Developer‚Äôs&#160;Manual,&#160;Volume&#160;3C</i></a>.<br/>If the&#160;logical&#160;processor executing inside an&#160;enclave&#160;receives&#160;an&#160;SMI when dual-monitor treatment&#160;is not&#160;enabled,&#160;<br/>the logical processor exits the&#160;enclave&#160;asynchronously, and&#160;transfers the&#160;control to the&#160;SMM handler.&#160;In addition to&#160;<br/>saving&#160;the synthetic architectural state to&#160;the&#160;SMRAM State&#160;Save&#160;Map (SSM),&#160;the logical processor also&#160;sets&#160;the&#160;<br/>‚ÄúEnclave&#160;Interruption‚Äù bit in the&#160;SMRAM SSM (bit&#160;position 1&#160;in SMRAM field&#160;at&#160;offset&#160;7EE0H).&#160;<br/>If the&#160;logical&#160;processor executing inside an&#160;enclave&#160;receives&#160;an&#160;SMI when dual-monitor treatment&#160;is enabled, the&#160;<br/>logical processor exits the&#160;enclave asynchronously, and transfers the&#160;control to&#160;the&#160;SMM monitor&#160;via&#160;SMM VM&#160;exit.&#160;<br/>The SMM&#160;VM exit&#160;sets&#160;the&#160;‚ÄúEnclave Interruption‚Äù bit in&#160;the&#160;Exit&#160;Reason&#160;(see<a href="o_fe12b1e2a880e0ce-1927.html">&#160;Table 42-1</a>)&#160;and in&#160;the Guest Interrupt-<br/><a href="o_fe12b1e2a880e0ce-1929.html">ibility State field (see Table 42-2</a>)&#160;of&#160;the SMM&#160;VMCS.</p>
<p style="position:absolute;top:835px;left:69px;white-space:nowrap" class="ft03">42.8.3&#160;</p>
<p style="position:absolute;top:835px;left:149px;white-space:nowrap" class="ft03">SMRAM Synthetic State of&#160;AEX Triggered by&#160;SMI</p>
<p style="position:absolute;top:864px;left:69px;white-space:nowrap" class="ft08">All&#160;processor&#160;registers saved in&#160;the SMRAM have&#160;the&#160;same&#160;synthetic values&#160;<a href="o_fe12b1e2a880e0ce-1805.html">listed in Section 40.3</a>.&#160;Additional&#160;<br/>SMRAM&#160;fields&#160;that are&#160;treated&#160;specially on SMI&#160;are:</p>
<p style="position:absolute;top:921px;left:226px;white-space:nowrap" class="ft07">Table&#160;42-1.&#160;&#160;SMRAM&#160;Synthetic States&#160;on&#160;Asynchronous&#160;Enclave&#160;Exit</p>
<p style="position:absolute;top:943px;left:141px;white-space:nowrap" class="ft02">Position</p>
<p style="position:absolute;top:943px;left:327px;white-space:nowrap" class="ft02">Field</p>
<p style="position:absolute;top:943px;left:545px;white-space:nowrap" class="ft02">Value</p>
<p style="position:absolute;top:943px;left:745px;white-space:nowrap" class="ft02">Writable</p>
<p style="position:absolute;top:965px;left:74px;white-space:nowrap" class="ft02">SMRAM&#160;Offset&#160;07EE0H.Bit&#160;1</p>
<p style="position:absolute;top:965px;left:267px;white-space:nowrap" class="ft02">ENCLAVE_INTERRUPTION&#160;Set&#160;to&#160;1&#160;if&#160;exit occurred&#160;in&#160;enclave&#160;mode</p>
<p style="position:absolute;top:965px;left:708px;white-space:nowrap" class="ft02">No</p>
</div>
</body>
</html>
