<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 986</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page986-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce986.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">20-10&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">8086&#160;EMULATION</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft06">exception or&#160;hardware interrupt through the protected-mode IDT&#160;(normally through an interrupt&#160;or trap gate)&#160;<br/>and&#160;the&#160;protected-mode&#160;exception-&#160;and&#160;interrupt-handlers. The processor may&#160;handle&#160;the exception&#160;or&#160;<br/>interrupt&#160;within&#160;the context of&#160;the virtual 8086&#160;task and&#160;return&#160;to virtual-8086 mode on a&#160;return from the&#160;<br/>handler&#160;procedure.&#160;The processor&#160;may also&#160;execute&#160;a&#160;task&#160;switch and&#160;handle the&#160;exception or interrupt in the&#160;<br/>context&#160;of another task.</p>
<p style="position:absolute;top:188px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:189px;left:93px;white-space:nowrap" class="ft06">The processor services&#160;a software&#160;interrupt generated&#160;by&#160;code executing in&#160;the virtual-8086 task&#160;(such&#160;as a&#160;<br/>software interrupt&#160;to call&#160;a MS-DOS*&#160;operating system&#160;routine). The processor provides several&#160;methods of&#160;<br/>handling these software&#160;interrupts,&#160;which&#160;are&#160;discussed in&#160;detail&#160;<a href="o_fe12b1e2a880e0ce-992.html">in Section 20.3.3, “Class 3—Software&#160;<br/>Interrupt Handling&#160;in Virtual-8086 Mode”.&#160;</a>Most of them&#160;involve the&#160;processor&#160;entering&#160;protected mode, often&#160;<br/>by means of a general-protection (#GP) exception. In&#160;protected mode, the processor can send&#160;the interrupt to&#160;<br/>the&#160;virtual-8086&#160;monitor&#160;for&#160;handling&#160;and/or redirect the&#160;interrupt&#160;back to&#160;the application program running in&#160;<br/>virtual-8086 mode task for handling.<br/>IA-32 processors that incorporate&#160;the virtual mode&#160;extension (enabled&#160;with&#160;the VME flag&#160;in control register&#160;<br/>CR4) are&#160;capable of redirecting software-generated&#160;interrupts&#160;back to the program’s interrupt handlers without&#160;<br/>leaving virtual-8086 mode.&#160;S<a href="o_fe12b1e2a880e0ce-995.html">ee Section 20.3.3.4,&#160;“Method&#160;5:&#160;Software&#160;Interrupt Handling”</a>,&#160;for&#160;more&#160;<br/>information on this&#160;mechanism.</p>
<p style="position:absolute;top:382px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:382px;left:93px;white-space:nowrap" class="ft06">A hardware reset initiated by asserting the&#160;RESET&#160;or&#160;INIT&#160;pin is&#160;a special&#160;kind of interrupt. When&#160;a RESET or&#160;<br/>INIT&#160;is signaled while the&#160;processor&#160;is in virtual-8086&#160;mode,&#160;the processor leaves virtual-8086 mode&#160;and enters&#160;<br/>real-address mode.</p>
<p style="position:absolute;top:437px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:438px;left:93px;white-space:nowrap" class="ft06">Execution of the&#160;HLT instruction in virtual-8086&#160;mode will cause&#160;a&#160;general-protection (GP#)&#160;fault,&#160;which the&#160;<br/>protected-mode&#160;handler&#160;generally sends to the&#160;virtual-8086&#160;monitor.&#160;The&#160;virtual-8086 monitor then&#160;<br/>determines the correct&#160;execution sequence&#160;after verifying that it&#160;was entered&#160;as a&#160;result&#160;of&#160;a HLT execution.</p>
<p style="position:absolute;top:495px;left:68px;white-space:nowrap" class="ft06">Se<a href="o_fe12b1e2a880e0ce-987.html">e Section 20.3,&#160;“Interrupt and Exception Handling&#160;in Virtual-8086&#160;Mode”,</a>&#160;for&#160;information on leaving&#160;virtual-8086&#160;<br/>mode to&#160;handle an&#160;interrupt or&#160;exception&#160;generated in virtual-8086&#160;mode.</p>
<p style="position:absolute;top:562px;left:68px;white-space:nowrap" class="ft04">20.2.7 Sensitive&#160;</p>
<p style="position:absolute;top:562px;left:227px;white-space:nowrap" class="ft04">Instructions</p>
<p style="position:absolute;top:592px;left:68px;white-space:nowrap" class="ft06">When&#160;an IA-32 processor is&#160;running&#160;in virtual-8086 mode,&#160;the CLI, STI,&#160;PUSHF,&#160;POPF, INT&#160;<i>n</i>, and IRET&#160;instructions&#160;<br/>are sensitive to IOPL. The IN,&#160;INS,&#160;OUT,&#160;and&#160;OUTS&#160;instructions, which are&#160;sensitive&#160;to IOPL in&#160;protected mode, are&#160;<br/>not sensitive in&#160;virtual-8086&#160;mode.<br/>The&#160;CPL is&#160;always 3&#160;while&#160;running in virtual-8086&#160;mode; if&#160;the IOPL is&#160;less&#160;than&#160;3, an attempt to&#160;use the&#160;IOPL-<br/>sensitive&#160;instructions listed above&#160;triggers a&#160;general-protection exception (#GP). These&#160;instructions&#160;are sensitive&#160;<br/>to IOPL to&#160;give the&#160;virtual-8086&#160;monitor&#160;a chance&#160;to emulate&#160;the&#160;facilities they&#160;affect.</p>
<p style="position:absolute;top:733px;left:68px;white-space:nowrap" class="ft04">20.2.8&#160;</p>
<p style="position:absolute;top:733px;left:148px;white-space:nowrap" class="ft04">Virtual-8086 Mode I/O</p>
<p style="position:absolute;top:763px;left:68px;white-space:nowrap" class="ft06">Many&#160;8086 programs written&#160;for non-multitasking systems&#160;directly&#160;access I/O&#160;ports. This practice&#160;may&#160;cause&#160;prob-<br/>lems in&#160;a multitasking environment. If more&#160;than one&#160;program accesses&#160;the same&#160;port, they may interfere&#160;with&#160;<br/>each other.&#160;Most&#160;multitasking systems require application&#160;programs&#160;to access&#160;I/O ports through the&#160;operating&#160;<br/>system. This&#160;results in&#160;simplified, centralized&#160;control.<br/>The processor provides I/O protection for creating I/O&#160;that&#160;is&#160;compatible with the environment&#160;and transparent to&#160;<br/>8086 programs.&#160;Designers&#160;may take any&#160;of several&#160;possible&#160;approaches to&#160;protecting&#160;I/O ports:</p>
<p style="position:absolute;top:875px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:876px;left:93px;white-space:nowrap" class="ft02">Protect the&#160;I/O address&#160;space&#160;and generate exceptions&#160;for&#160;all attempts to&#160;perform I/O directly.</p>
<p style="position:absolute;top:898px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:898px;left:93px;white-space:nowrap" class="ft02">Let&#160;the 8086&#160;program perform I/O&#160;directly.</p>
<p style="position:absolute;top:920px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:921px;left:93px;white-space:nowrap" class="ft02">Generate exceptions&#160;on&#160;attempts&#160;to access specific I/O&#160;ports.</p>
<p style="position:absolute;top:943px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:943px;left:93px;white-space:nowrap" class="ft02">Generate exceptions&#160;on&#160;attempts&#160;to access specific memory-mapped&#160;I/O&#160;ports.</p>
<p style="position:absolute;top:967px;left:68px;white-space:nowrap" class="ft06">The method&#160;of&#160;controlling access to&#160;I/O ports&#160;depends&#160;upon&#160;whether they&#160;are I/O-port&#160;mapped or&#160;memory&#160;<br/>mapped.</p>
</div>
</body>
</html>
