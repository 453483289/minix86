<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1802</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1802-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1802.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">39-14&#160;Vol. 3D</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">ENCLAVE OPERATION</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft05">RDTSC and RDTSCP are legal inside&#160;an&#160;enclave for processors&#160;that support SGX2 (subject&#160;to&#160;the value&#160;of&#160;CR4.TSD).&#160;<br/>For&#160;processors&#160;which support SGX1&#160;but&#160;not SGX2, RDTSC and RDTSCP will cause&#160;#UD.<br/>RDTSC&#160;and RDTSCP&#160;instructions&#160;may cause&#160;a VM&#160;exit when&#160;inside&#160;an enclave.<br/>Software developers must take&#160;into&#160;account that the RDTSC/RDTSCP results are not immune&#160;to influences by other&#160;<br/>software, e.g.&#160;the TSC&#160;can be manipulated by software&#160;outside&#160;the enclave.</p>
<p style="position:absolute;top:213px;left:432px;white-space:nowrap" class="ft03">NOTE</p>
<p style="position:absolute;top:238px;left:120px;white-space:nowrap" class="ft05">Some&#160;early&#160;processor implementation of Intel&#160;SGX will generate&#160;a #UD&#160;when&#160;RDTSC and&#160;RDTSCP&#160;<br/>are&#160;executed&#160;inside&#160;an&#160;enclave.&#160;See&#160;the model-specific processor errata for details of&#160;which&#160;<br/>processors treat execution&#160;of&#160;RDTSC&#160;and RDTSCP inside an&#160;enclave&#160;as illegal.</p>
<p style="position:absolute;top:322px;left:68px;white-space:nowrap" class="ft04">39.6.2&#160;</p>
<p style="position:absolute;top:322px;left:148px;white-space:nowrap" class="ft04">RDRAND and RDSEED Instructions</p>
<p style="position:absolute;top:351px;left:68px;white-space:nowrap" class="ft05">These&#160;instructions may cause a VM&#160;exit if the “RDRAND exiting” VM-execution control is 1. Unlike&#160;other&#160;instructions&#160;<br/>that can cause&#160;VM exits,&#160;these instructions are&#160;legal inside&#160;an enclave.&#160;As&#160;noted in&#160;Section 6.5.5,&#160;any VM&#160;exit orig-<br/>inating&#160;on an instruction boundary&#160;inside&#160;an enclave sets&#160;bit 27&#160;of the exit-reason&#160;field&#160;of&#160;the VMCS. If&#160;a VMM&#160;<br/>receives&#160;a VM&#160;exit due to&#160;an attempt&#160;to&#160;execute either of&#160;these instructions determines&#160;(by that&#160;bit)&#160;that the&#160;execu-<br/>tion was&#160;inside&#160;an enclave,&#160;it can do either&#160;of two things. It&#160;can clear&#160;the “RDRAND exiting”&#160;VM-execution control&#160;<br/>and&#160;execute&#160;VMRESUME;&#160;this will result in the&#160;enclave&#160;executing&#160;RDRAND&#160;or&#160;RDSEED&#160;again,&#160;and&#160;this time&#160;a VM&#160;exit&#160;<br/>will&#160;not occur.&#160;Alternatively,&#160;the VMM&#160;might choose&#160;to discontinue&#160;execution of this&#160;virtual&#160;machine.</p>
<p style="position:absolute;top:484px;left:432px;white-space:nowrap" class="ft03">NOTE</p>
<p style="position:absolute;top:510px;left:120px;white-space:nowrap" class="ft02">It&#160;is expected that VMMs&#160;that virtualize&#160;Intel&#160;SGX will not set “RDRAND exiting”&#160;to&#160;1.</p>
<p style="position:absolute;top:560px;left:68px;white-space:nowrap" class="ft04">39.6.3 PAUSE&#160;</p>
<p style="position:absolute;top:560px;left:206px;white-space:nowrap" class="ft04">Instruction</p>
<p style="position:absolute;top:589px;left:68px;white-space:nowrap" class="ft05">The&#160;PAUSE instruction may cause&#160;a VM&#160;exit&#160;if either&#160;of the “PAUSE&#160;exiting” and&#160;“PAUSE-loop exiting” VM-execution&#160;<br/>controls&#160;is 1. Unlike&#160;other instructions that&#160;can cause&#160;VM&#160;exits,&#160;the&#160;PAUSE&#160;instruction&#160;is legal inside&#160;an&#160;enclave.<br/>If&#160;a VMM receives a&#160;VM&#160;exit due to&#160;the&#160;1-setting of “PAUSE-loop exiting”, it may&#160;take&#160;action&#160;to prevent recurrence&#160;<br/>of the PAUSE&#160;loop (e.g.,&#160;by&#160;scheduling&#160;another virtual CPU&#160;of&#160;this virtual machine) and&#160;then execute&#160;VMRESUME;&#160;<br/>this will result in the enclave executing PAUSE again, but&#160;this&#160;time the PAUSE&#160;loop (and&#160;resulting VM exit) will not&#160;<br/>occur.<br/>If a&#160;VMM&#160;receives&#160;a VM&#160;exit&#160;due&#160;to the&#160;1-setting&#160;of “PAUSE&#160;exiting”,&#160;it can&#160;do either of two things. It&#160;can clear&#160;the&#160;<br/>“PAUSE exiting”&#160;VM-execution control and&#160;execute&#160;VMRESUME;&#160;this will result in the&#160;enclave&#160;executing PAUSE&#160;<br/>again, but&#160;this time&#160;a VM exit&#160;will&#160;not occur.&#160;Alternatively,&#160;the VMM&#160;might choose&#160;to discontinue&#160;execution of this&#160;<br/>virtual machine.</p>
<p style="position:absolute;top:784px;left:432px;white-space:nowrap" class="ft03">NOTE</p>
<p style="position:absolute;top:810px;left:120px;white-space:nowrap" class="ft02">It&#160;is expected that VMMs&#160;that virtualize&#160;Intel&#160;SGX will not set “PAUSE&#160;exiting” to&#160;1.</p>
<p style="position:absolute;top:860px;left:68px;white-space:nowrap" class="ft04">39.6.4&#160;</p>
<p style="position:absolute;top:860px;left:148px;white-space:nowrap" class="ft04">INT 3 Behavior Inside an Enclave</p>
<p style="position:absolute;top:889px;left:68px;white-space:nowrap" class="ft05">INT3&#160;is&#160;legal&#160;inside&#160;an enclave,&#160;however,&#160;the&#160;behavior inside&#160;an enclave is&#160;different from its&#160;behavior outside an&#160;<br/>enclave.&#160;S<a href="o_fe12b1e2a880e0ce-1936.html">ee Section&#160;43.4.1</a>&#160;for details.</p>
<p style="position:absolute;top:956px;left:68px;white-space:nowrap" class="ft04">39.6.5&#160;</p>
<p style="position:absolute;top:956px;left:148px;white-space:nowrap" class="ft04">INVD Handling when&#160;Enclaves Are Enabled</p>
<p style="position:absolute;top:985px;left:68px;white-space:nowrap" class="ft05">Once processor reserved memory protections are activated&#160;(see<a href="o_fe12b1e2a880e0ce-1797.html">&#160;Section 39.5),&#160;</a>any execution of&#160;INVD will&#160;result&#160;in&#160;<br/>a #GP(0).</p>
</div>
</body>
</html>
