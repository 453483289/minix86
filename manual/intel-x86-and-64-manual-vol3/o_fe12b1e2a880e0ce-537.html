<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 537</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page537-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce537.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;15-31</p>
<p style="position:absolute;top:47px;left:650px;white-space:nowrap" class="ft01">MACHINE-CHECK&#160;ARCHITECTURE</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft04">When the&#160;EN&#160;flag&#160;is zero&#160;but the&#160;VAL and&#160;UC flags&#160;are&#160;one&#160;in the&#160;IA32_MCi_STATUS register,&#160;the&#160;reported&#160;<br/>uncorrected error in this bank&#160;is&#160;not&#160;enabled. As uncorrected&#160;errors with&#160;the EN flag = 0 are&#160;not the source of&#160;<br/>machine check&#160;exceptions,&#160;the&#160;MCE handler&#160;should log and&#160;clear non-enabled&#160;errors when the&#160;S bit is&#160;set&#160;and&#160;<br/>should continue searching for enabled&#160;errors from&#160;the other&#160;IA32_MCi_STATUS&#160;registers.&#160;Note&#160;that&#160;when&#160;<br/>IA32_MCG_CAP&#160;[24] is&#160;0,&#160;any&#160;uncorrected&#160;error condition&#160;(VAL&#160;=1 and&#160;UC=1)&#160;including&#160;the&#160;one with the&#160;EN&#160;<br/>flag&#160;cleared are&#160;fatal&#160;and the&#160;handler&#160;must signal the&#160;operating&#160;system&#160;to reset&#160;the&#160;system. For the&#160;errors&#160;that&#160;<br/>do&#160;not generate&#160;machine&#160;check exceptions,&#160;the&#160;EN flag&#160;has&#160;no meaning.</p>
<p style="position:absolute;top:221px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:222px;left:95px;white-space:nowrap" class="ft04">When&#160;the&#160;VAL&#160;flag&#160;is&#160;one,&#160;the UC flag&#160;is one,&#160;the EN flag is&#160;one and&#160;the PCC flag&#160;is zero&#160;in&#160;the&#160;<br/>IA32_MCi_STATUS&#160;register, the&#160;error in&#160;this bank is&#160;an&#160;uncorrected recoverable&#160;(UCR) error.&#160;The&#160;MCE&#160;handler&#160;<br/>needs to&#160;examine the&#160;S&#160;flag and&#160;the AR flag&#160;to find&#160;the type of the UCR&#160;error&#160;for&#160;software recovery and&#160;<br/>determine if&#160;software error&#160;recovery is&#160;possible.&#160;</p>
<p style="position:absolute;top:293px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:294px;left:95px;white-space:nowrap" class="ft04">When both the S and the AR flags are&#160;clear in&#160;the IA32_MCi_STATUS&#160;register for the UCR&#160;error (VAL=1,&#160;UC=1,&#160;<br/>EN=x and&#160;PCC=0),&#160;the error in&#160;this&#160;bank&#160;is&#160;an&#160;uncorrected&#160;no-action&#160;required&#160;error (UCNA). UCNA errors&#160;are&#160;<br/>uncorrected but do not require any OS&#160;recovery action to&#160;continue execution. These errors&#160;indicate&#160;that&#160;some&#160;<br/>data&#160;in the&#160;system&#160;is corrupt, but&#160;that data&#160;has not been consumed&#160;and may&#160;not be consumed.&#160;&#160;&#160;If&#160;that data&#160;is&#160;<br/>consumed a non-UNCA machine check exception will be generated. UCNA errors are&#160;signaled in the&#160;same&#160;way&#160;<br/>as corrected&#160;machine&#160;check errors and&#160;the CMCI and CMC polling handler is&#160;primarily responsible&#160;for&#160;handling&#160;<br/>UCNA errors. Like&#160;corrected errors, the MCA handler can optionally log and&#160;clear UCNA errors as&#160;long as it can&#160;<br/>avoid the&#160;undesired race condition&#160;with the CMCI&#160;or CMC&#160;polling handler.&#160;As UCNA errors&#160;are&#160;not&#160;the&#160;source&#160;of&#160;<br/>machine check&#160;exceptions,&#160;the&#160;MCA handler&#160;should continue searching for uncorrected or&#160;software&#160;recoverable&#160;<br/>errors&#160;in all&#160;other MC banks.&#160;</p>
<p style="position:absolute;top:464px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:465px;left:95px;white-space:nowrap" class="ft04">When the S flag in the IA32_MCi_STATUS register is&#160;set for the UCR error ((VAL=1,&#160;UC=1,&#160;EN=1 and PCC=0),&#160;<br/>the&#160;error in this bank&#160;is&#160;software recoverable and&#160;it was signaled through a&#160;machine-check&#160;exception. &#160;The AR&#160;<br/>flag in&#160;the IA32_MCi_STATUS&#160;register further clarifies&#160;the type of the&#160;software recoverable errors.&#160;</p>
<p style="position:absolute;top:520px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:520px;left:95px;white-space:nowrap" class="ft04">When the&#160;AR&#160;flag&#160;in the IA32_MCi_STATUS&#160;register is&#160;clear for the software&#160;recoverable&#160;error (VAL=1, UC=1,&#160;<br/>EN=1,&#160;PCC=0 and S=1), the&#160;error&#160;in this&#160;bank&#160;is&#160;a software&#160;recoverable&#160;action optional&#160;(SRAO) error.&#160;The MCE&#160;<br/>handler&#160;and the operating&#160;system&#160;can analyze the&#160;IA32_MCi_STATUS&#160;[15:0]&#160;to implement MCA&#160;error code&#160;<br/>specific optional recovery action, but&#160;this&#160;recovery&#160;action is&#160;optional. System&#160;software&#160;can resume the program&#160;<br/>execution from the instruction&#160;pointer&#160;saved on&#160;the stack for the machine&#160;check exception when the RIPV&#160;flag&#160;<br/>in the&#160;IA32_MCG_STATUS&#160;register is&#160;set.&#160;</p>
<p style="position:absolute;top:625px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:625px;left:95px;white-space:nowrap" class="ft04">Even if&#160;the OVER flag&#160;in the IA32_MCi_STATUS register&#160;is set for&#160;the SRAO&#160;error (VAL=1, UC=1,&#160;EN=1, PCC=0,&#160;<br/>S=1&#160;and AR=0), the&#160;MCE handler can take&#160;recovery&#160;action&#160;for&#160;the&#160;SRAO error logged&#160;in the&#160;IA32_MCi_STATUS&#160;<br/>register. Since the&#160;recovery&#160;action for SRAO&#160;errors is&#160;optional, restarting the&#160;program&#160;execution from the&#160;<br/>instruction&#160;pointer saved on&#160;the&#160;stack&#160;for&#160;the machine check exception is still possible for the overflowed&#160;SRAO&#160;<br/>error if the&#160;RIPV flag&#160;in&#160;the&#160;IA32_MCG_STATUS&#160;is set.&#160;</p>
<p style="position:absolute;top:713px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:714px;left:95px;white-space:nowrap" class="ft04">When the&#160;AR&#160;flag in&#160;the IA32_MCi_STATUS register&#160;is&#160;set for the&#160;software recoverable&#160;error (VAL=1,&#160;UC=1,&#160;<br/>EN=1, PCC=0 and S=1), the&#160;error&#160;in this&#160;bank&#160;is a software recoverable action required (SRAR) error.&#160;The MCE&#160;<br/>handler and the operating system&#160;must&#160;take recovery action&#160;in order to continue execution after the&#160;machine-<br/>check exception. The&#160;MCA&#160;handler and the operating system need&#160;to analyze the IA32_MCi_STATUS&#160;[15:0] to&#160;<br/>determine the&#160;MCA&#160;error code specific&#160;recovery action. If no recovery action&#160;can be performed,&#160;the operating&#160;<br/>system must reset&#160;the&#160;system.&#160;</p>
<p style="position:absolute;top:818px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:819px;left:95px;white-space:nowrap" class="ft04">When&#160;the&#160;OVER flag&#160;in the&#160;IA32_MCi_STATUS register&#160;is&#160;set for the&#160;SRAR error&#160;(VAL=1,&#160;UC=1,&#160;EN=1,&#160;PCC=0,&#160;<br/>S=1&#160;and AR=1),&#160;the MCE handler cannot take&#160;recovery action as&#160;the information of the&#160;SRAR error&#160;in the&#160;<br/>IA32_MCi_STATUS&#160;register was&#160;potentially&#160;lost due&#160;to the overflow&#160;condition.&#160;Since&#160;the recovery action for&#160;<br/>SRAR&#160;errors must be taken,&#160;the MCE handler must&#160;signal&#160;the operating system to&#160;reset&#160;the system.&#160;</p>
<p style="position:absolute;top:890px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:891px;left:95px;white-space:nowrap" class="ft04">When the&#160;MCE&#160;handler&#160;cannot&#160;find&#160;any&#160;uncorrected (VAL=1, UC=1&#160;and EN=1) or&#160;any software&#160;recoverable&#160;<br/>errors (VAL=1, UC=1, EN=1,&#160;PCC=0&#160;and S=1)&#160;in any&#160;of the&#160;IA32_MCi&#160;banks of the&#160;processors, this&#160;is an&#160;<br/>unexpected&#160;condition&#160;for&#160;the MCE&#160;handler&#160;and the&#160;handler should&#160;signal the&#160;operating system&#160;to reset the&#160;<br/>system.&#160;</p>
<p style="position:absolute;top:962px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:963px;left:95px;white-space:nowrap" class="ft04">Before returning&#160;from the&#160;machine-check exception handler,&#160;software must clear the&#160;MCIP&#160;flag in the&#160;<br/>IA32_MCG_STATUS&#160;register.&#160;The MCIP&#160;flag&#160;is used&#160;to&#160;detect&#160;recursion. The machine-check architecture does&#160;<br/>not support recursion.&#160;When&#160;the&#160;processor receives a machine&#160;check when MCIP is set, it automatically enters&#160;<br/>the shutdown&#160;state.</p>
<p style="position:absolute;top:1035px;left:69px;white-space:nowrap" class="ft03"><a href="o_fe12b1e2a880e0ce-538.html">Example&#160;15-4&#160;</a>gives pseudocode&#160;for an&#160;MC&#160;exception handler&#160;that supports recovery&#160;of UCR.</p>
</div>
</body>
</html>
