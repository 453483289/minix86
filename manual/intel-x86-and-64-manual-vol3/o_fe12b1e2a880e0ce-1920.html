<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1920</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1920-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1920.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">42-2&#160;Vol. 3D</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">INTEL® SGX INTERACTIONS WITH IA32 AND INTEL® 64&#160;ARCHITECTURE</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft03">While&#160;executing&#160;inside&#160;an enclave (legacy instructions&#160;and enclave&#160;instructions&#160;permitted inside an&#160;enclave).</p>
<p style="position:absolute;top:151px;left:68px;white-space:nowrap" class="ft04">42.3.2&#160;</p>
<p style="position:absolute;top:151px;left:148px;white-space:nowrap" class="ft04">Interactions of&#160;Intel® SGX Instructions with Segment,&#160;Operand,&#160;and&#160;Addressing&#160;</p>
<p style="position:absolute;top:172px;left:148px;white-space:nowrap" class="ft04">Prefixes</p>
<p style="position:absolute;top:201px;left:68px;white-space:nowrap" class="ft06">All the&#160;memory&#160;operands used by the&#160;Intel&#160;SGX instructions&#160;are interpreted as&#160;offsets&#160;within&#160;the data segment&#160;<br/>(DS). The segment-override prefix&#160;on&#160;Intel SGX&#160;instructions&#160;is ignored.<br/>Operand size is&#160;fixed for each enclave instruction.&#160;The operand-size&#160;prefix is reserved, and results in a&#160;#UD&#160;excep-<br/>tion if used.<br/>All&#160;address sizes&#160;are&#160;determined&#160;by the&#160;operating mode&#160;of&#160;the&#160;processor.&#160;The&#160;address-size prefix&#160;is ignored. This&#160;<br/>implies that while operating in 64-bit mode of operation,&#160;the address size&#160;is always 64 bits, and while operating in&#160;<br/>32-bit mode&#160;of operation,&#160;the address&#160;size is&#160;always&#160;32&#160;bits.&#160;Additionally,&#160;when operating&#160;in&#160;16-bit addressing,&#160;<br/>memory&#160;operands&#160;used&#160;by enclave instructions use&#160;32&#160;bit&#160;addressing; the&#160;value of CS.D&#160;is&#160;ignored.</p>
<p style="position:absolute;top:379px;left:68px;white-space:nowrap" class="ft04">42.3.3&#160;</p>
<p style="position:absolute;top:379px;left:148px;white-space:nowrap" class="ft04">Interaction of&#160;Intel® SGX Instructions with Segmentation</p>
<p style="position:absolute;top:408px;left:68px;white-space:nowrap" class="ft06">All&#160;leaf functions of ENCLU and&#160;ENCLS instructions require that&#160;the DS&#160;segment&#160;be&#160;usable, and be an expand-up&#160;<br/>segment. Failing&#160;this check&#160;results in&#160;generation&#160;of a #GP(0)&#160;exception.<br/>The&#160;Intel SGX leaf&#160;functions used for entering&#160;the&#160;enclave (ENCLU[EENTER]&#160;and ENCLU[ERESUME])&#160;operate as&#160;<br/>follows:</p>
<p style="position:absolute;top:485px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:486px;left:93px;white-space:nowrap" class="ft03">All usable&#160;segment registers&#160;except for FS and&#160;GS&#160;have&#160;a zero base.&#160;</p>
<p style="position:absolute;top:508px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:508px;left:93px;white-space:nowrap" class="ft03">The&#160;contents of&#160;the&#160;FS/GS&#160;segment&#160;registers (including the&#160;hidden portion)&#160;is saved in&#160;the processor.</p>
<p style="position:absolute;top:530px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:531px;left:93px;white-space:nowrap" class="ft03">New FS and&#160;GS&#160;values compatible with enclave&#160;security&#160;are&#160;loaded&#160;from the&#160;TCS</p>
<p style="position:absolute;top:553px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:553px;left:93px;white-space:nowrap" class="ft06">The&#160;linear&#160;ranges&#160;and access rights available&#160;under&#160;the&#160;newly-loaded FS and GS must abide&#160;to&#160;OS&#160;policies&#160;by&#160;<br/>ensuring they&#160;are subsets of the&#160;linear-address&#160;range&#160;and access rights available&#160;for&#160;the DS&#160;segment.</p>
<p style="position:absolute;top:592px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:592px;left:93px;white-space:nowrap" class="ft06">The&#160;CS segment mode&#160;(64-bit,&#160;compatible,&#160;or 32&#160;bit modes) must be&#160;consistent with&#160;the&#160;segment mode for&#160;<br/>which&#160;the&#160;enclave was&#160;created,&#160;as indicated by&#160;the SECS.ATTRIBUTES.MODE64&#160;bit,&#160;and that&#160;the CPL of the&#160;<br/>logical processor is&#160;3</p>
<p style="position:absolute;top:648px;left:68px;white-space:nowrap" class="ft06">An exit&#160;from&#160;the enclave either via&#160;ENCLU[EEXIT] or&#160;via an&#160;AEX&#160;restores&#160;the saved&#160;values&#160;of&#160;FS/GS&#160;segment regis-<br/>ters.</p>
<p style="position:absolute;top:715px;left:68px;white-space:nowrap" class="ft04">42.3.4&#160;</p>
<p style="position:absolute;top:715px;left:148px;white-space:nowrap" class="ft04">Interactions of&#160;Enclave Execution with Segmentation</p>
<p style="position:absolute;top:744px;left:68px;white-space:nowrap" class="ft06">During&#160;the course&#160;of execution,&#160;enclave&#160;code&#160;abides&#160;by&#160;all segmentation policies as&#160;dictated&#160;by&#160;IA32&#160;and&#160;Intel 64&#160;<br/>Architectures,&#160;and generates appropriate&#160;exceptions on violations.<br/>Additionally, any&#160;attempt&#160;by&#160;software executing inside an&#160;enclave&#160;to modify&#160;the&#160;processor's segmentation state&#160;<br/>(e.g. via MOV seg register, POP seg register,&#160;LDS,&#160;far&#160;jump,&#160;etc;&#160;excluding WRFSBASE/WRGSBASE) results in the&#160;<br/>generation of a&#160;#UD.&#160;Se<a href="o_fe12b1e2a880e0ce-1801.html">e Section 39.6.1&#160;</a>for&#160;more information.<br/>Upon enclave entry via&#160;the EENTER&#160;leaf&#160;function,&#160;FS&#160;is loaded&#160;from&#160;the&#160;(TCS.OFSBASE&#160;+&#160;SECS.BASEADDR)&#160;and&#160;<br/>TCS.FSLIMIT fields and&#160;GS&#160;is loaded&#160;from&#160;the (TCS.OGSBASE + SECS.BASEADDR)&#160;and TCS.GSLIMIT&#160;fields.&#160;<br/>Execution&#160;of&#160;WRFSBASE&#160;and WRGSBASE from inside&#160;a&#160;64-bit&#160;enclave&#160;is allowed. The processor will save&#160;the&#160;new&#160;<br/>values into the current SSA&#160;frame&#160;on&#160;an asynchronous&#160;exit&#160;(AEX)&#160;and restore them&#160;back on enclave entry&#160;via&#160;<br/>ENCLU[ERESUME] instruction.</p>
<p style="position:absolute;top:966px;left:68px;white-space:nowrap" class="ft05">42.4 INTERACTIONS&#160;</p>
<p style="position:absolute;top:966px;left:291px;white-space:nowrap" class="ft05">WITH&#160;</p>
<p style="position:absolute;top:966px;left:347px;white-space:nowrap" class="ft05">PAGING</p>
<p style="position:absolute;top:1000px;left:68px;white-space:nowrap" class="ft06">Intel SGX&#160;instructions&#160;are available only when the&#160;processor&#160;is executing in a&#160;protected&#160;mode of operation.&#160;Addi-<br/>tionally,&#160;all Intel&#160;SGX leaf&#160;functions&#160;except for EDBGRD and EDBGWR&#160;are available&#160;only if paging&#160;is enabled. Any&#160;<br/>attempt to execute these leaf functions with&#160;paging disabled results&#160;in&#160;an invalid-opcode exception (#UD). As&#160;with&#160;</p>
</div>
</body>
</html>
