<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 420</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page420-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce420.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">11-8&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">MEMORY&#160;CACHE CONTROL</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft05">buffer.&#160;The&#160;WC buffer is&#160;not&#160;snooped and&#160;thus&#160;does not provide&#160;data coherency.&#160;Buffering&#160;of&#160;writes to WC&#160;memory&#160;<br/>is&#160;done&#160;to allow software&#160;a small&#160;window of time to&#160;supply&#160;more&#160;modified data&#160;to the&#160;WC buffer while&#160;remaining as&#160;<br/>non-intrusive&#160;to software&#160;as possible.&#160;The buffering of writes&#160;to WC memory also&#160;causes&#160;data&#160;to be collapsed;&#160;that&#160;<br/>is, multiple writes to&#160;the same&#160;memory location&#160;will&#160;leave&#160;the&#160;last data written in the&#160;location and&#160;the&#160;other&#160;writes&#160;<br/>will&#160;be&#160;lost.<br/>The&#160;size and&#160;structure of the&#160;WC buffer is&#160;not architecturally defined. For&#160;the&#160;Intel Core 2 Duo,&#160;Intel&#160;Atom, Intel&#160;<br/>Core&#160;Duo,&#160;Pentium&#160;M, Pentium 4&#160;and Intel Xeon&#160;processors; the&#160;WC&#160;buffer&#160;is&#160;made&#160;up of&#160;several 64-byte WC&#160;<br/>buffers.&#160;For&#160;the&#160;P6&#160;family&#160;processors, the&#160;WC buffer is&#160;made up of&#160;several&#160;32-byte&#160;WC buffers.&#160;<br/>When software&#160;begins writing to&#160;WC&#160;memory, the&#160;processor&#160;begins&#160;filling the&#160;WC buffers one&#160;at a&#160;time.&#160;When one&#160;<br/>or&#160;more WC buffers&#160;has&#160;been filled,&#160;the processor has the option of evicting&#160;the buffers&#160;to system memory.&#160;The&#160;<br/>protocol for&#160;evicting&#160;the&#160;WC buffers is&#160;implementation&#160;dependent and should&#160;not&#160;be&#160;relied on by&#160;software for&#160;<br/>system&#160;memory coherency.&#160;When&#160;using the&#160;WC&#160;memory&#160;type, software&#160;<b>must</b>&#160;be sensitive&#160;to the&#160;fact&#160;that the&#160;<br/>writing of data to system&#160;memory is&#160;being delayed and&#160;<b>must</b>&#160;deliberately&#160;empty the&#160;WC buffers when system&#160;<br/>memory&#160;coherency&#160;is required.<br/>Once the processor has started to evict data from the WC&#160;buffer&#160;into system memory,&#160;it&#160;will make&#160;a bus-transaction&#160;<br/>style decision based&#160;on&#160;how&#160;much&#160;of&#160;the buffer contains&#160;valid&#160;data. If the&#160;buffer&#160;is&#160;full (for&#160;example,&#160;all bytes&#160;are&#160;<br/>valid),&#160;the processor&#160;will&#160;execute a&#160;burst-write transaction&#160;on&#160;the bus. This results in&#160;all 32&#160;bytes (P6&#160;family&#160;proces-<br/>sors) or 64&#160;bytes&#160;(Pentium&#160;4 and&#160;more&#160;recent&#160;processor)&#160;being transmitted on&#160;the&#160;data&#160;bus in&#160;a&#160;single&#160;burst trans-<br/>action.&#160;If one or&#160;more of the&#160;WC buffer’s&#160;bytes are invalid&#160;(for example,&#160;have&#160;not been&#160;written&#160;by&#160;software),&#160;the&#160;<br/>processor will transmit the data to memory using&#160;“partial&#160;write”&#160;transactions (one&#160;chunk at a time, where a “chunk”&#160;<br/>is 8&#160;bytes).&#160;<br/>This will&#160;result in a&#160;maximum of 4&#160;partial&#160;write&#160;transactions&#160;(for P6&#160;family processors) or 8&#160;partial write transactions&#160;<br/>(for&#160;the Pentium 4 and&#160;more recent processors)&#160;for one&#160;WC&#160;buffer of data sent&#160;to memory.&#160;<br/>The WC memory type is&#160;weakly ordered&#160;by definition. Once&#160;the&#160;eviction of a&#160;WC&#160;buffer has started, the&#160;data is&#160;<br/>subject to&#160;the weak ordering semantics of its&#160;definition.&#160;Ordering&#160;is not maintained between&#160;the successive&#160;alloca-<br/>tion/deallocation of WC buffers&#160;(for&#160;example,&#160;writes&#160;to&#160;WC&#160;buffer 1 followed&#160;by writes to&#160;WC&#160;buffer 2&#160;may&#160;appear&#160;<br/>as buffer&#160;2 followed&#160;by buffer 1 on the&#160;system bus). When a WC buffer&#160;is evicted to memory as partial writes&#160;there&#160;<br/>is no&#160;guaranteed ordering between successive&#160;partial&#160;writes&#160;(for example, a&#160;partial&#160;write for chunk&#160;2&#160;may appear&#160;<br/>on the&#160;bus before&#160;the&#160;partial&#160;write for chunk&#160;1 or&#160;vice versa).&#160;<br/>The only elements of WC propagation&#160;to&#160;the&#160;system&#160;bus&#160;that are guaranteed&#160;are those&#160;provided by transaction&#160;<br/>atomicity.&#160;For example, with a&#160;P6&#160;family&#160;processor,&#160;a completely&#160;full&#160;WC&#160;buffer&#160;will always be propagated&#160;as&#160;a&#160;<br/>single 32-bit burst transaction using any&#160;chunk order.&#160;In a WC&#160;buffer eviction&#160;where data will be evicted as partials,&#160;<br/>all data contained in the&#160;same chunk (0&#160;mod 8&#160;aligned) will be&#160;propagated&#160;simultaneously.&#160;Likewise,&#160;for&#160;more&#160;<br/>recent processors starting&#160;with&#160;those based&#160;on Intel&#160;NetBurst microarchitectures, a&#160;full&#160;WC&#160;buffer will always&#160;be&#160;<br/>propagated as&#160;a single burst&#160;transactions, using&#160;any chunk&#160;order within&#160;a transaction. For partial buffer propaga-<br/>tions,&#160;all data contained&#160;in the&#160;same&#160;chunk will be propagated simultaneously.</p>
<p style="position:absolute;top:773px;left:68px;white-space:nowrap" class="ft04">11.3.2&#160;</p>
<p style="position:absolute;top:773px;left:148px;white-space:nowrap" class="ft04">Choosing a Memory Type</p>
<p style="position:absolute;top:804px;left:68px;white-space:nowrap" class="ft05">The simplest system&#160;memory&#160;model does not use&#160;memory-mapped I/O&#160;with&#160;read&#160;or&#160;write&#160;side effects, does not&#160;<br/>include&#160;a frame&#160;buffer,&#160;and&#160;uses the&#160;write-back memory type&#160;for all&#160;memory.&#160;An&#160;I/O agent can&#160;perform direct&#160;<br/>memory access (DMA)&#160;to write-back&#160;memory and the&#160;cache protocol&#160;maintains&#160;cache&#160;coherency.<br/>A&#160;system can use&#160;strong&#160;uncacheable&#160;memory for other&#160;memory-mapped&#160;I/O,&#160;and should always&#160;use&#160;strong&#160;<br/>uncacheable memory for memory-mapped I/O&#160;with&#160;read side&#160;effects.<br/>Dual-ported memory&#160;can be considered&#160;a write&#160;side&#160;effect, making relatively prompt writes&#160;desirable, because&#160;<br/>those&#160;writes cannot be observed at&#160;the other&#160;port&#160;until&#160;they reach&#160;the memory&#160;agent.&#160;A&#160;system can use&#160;strong&#160;<br/>uncacheable,&#160;uncacheable, write-through,&#160;or write-combining&#160;memory&#160;for&#160;frame buffers or&#160;dual-ported memory&#160;<br/>that contains pixel values displayed on a&#160;screen. Frame&#160;buffer&#160;memory&#160;is typically&#160;large&#160;(a few megabytes)&#160;and is&#160;<br/>usually&#160;written&#160;more than it&#160;is read&#160;by&#160;the processor.&#160;Using&#160;strong uncacheable memory for a&#160;frame buffer&#160;gener-<br/>ates very large amounts of&#160;bus traffic, because&#160;operations&#160;on the entire buffer&#160;are implemented using&#160;partial&#160;writes&#160;<br/>rather than line&#160;writes.&#160;Using&#160;write-through&#160;memory for a frame&#160;buffer&#160;can displace almost all&#160;other useful cached&#160;<br/>lines in&#160;the&#160;processor's L2 and L3 caches&#160;and&#160;L1&#160;data&#160;cache. Therefore,&#160;systems should use&#160;write-combining&#160;<br/>memory for frame&#160;buffers whenever&#160;possible.</p>
</div>
</body>
</html>
