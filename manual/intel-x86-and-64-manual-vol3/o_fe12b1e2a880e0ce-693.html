<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 693</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:20px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:21px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page693-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce693.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;18-57</p>
<p style="position:absolute;top:47px;left:672px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft03">Complete&#160;the PEBS configuration steps.</p>
<p style="position:absolute;top:122px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:123px;left:95px;white-space:nowrap" class="ft07">Program the&#160;MEM_TRANS_RETIRED.PRECISE_STORE&#160;event&#160;in IA32_PERFEVTSEL3.&#160;Only&#160;counter 3&#160;<br/>(IA32_PMC3) supports collection&#160;of precise store&#160;information.&#160;</p>
<p style="position:absolute;top:161px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:162px;left:95px;white-space:nowrap" class="ft07">Set IA32_PEBS_ENABLE[3]&#160;and&#160;IA32_PEBS_ENABLE[63].&#160;This enables IA32_PMC3&#160;as a&#160;PEBS counter&#160;and&#160;<br/>enables the&#160;precise store&#160;facility,&#160;respectively.</p>
<p style="position:absolute;top:202px;left:69px;white-space:nowrap" class="ft07">The precise&#160;store information written into&#160;a PEBS&#160;record&#160;affects entries at&#160;offset 98H, A0H&#160;and&#160;A8<a href="o_fe12b1e2a880e0ce-673.html">H of Table&#160;18-23.</a>&#160;<br/>The specificity of Data Source entry at&#160;offset A0H&#160;has&#160;been&#160;enhanced&#160;to report three&#160;piece&#160;of information.&#160;</p>
<p style="position:absolute;top:496px;left:69px;white-space:nowrap" class="ft04">18.9.4.4 &#160;&#160;Precise Distribution of&#160;Instructions Retired&#160;(PDIR)&#160;</p>
<p style="position:absolute;top:524px;left:69px;white-space:nowrap" class="ft07">Upon&#160;triggering a&#160;PEBS assist, there will be a&#160;finite delay between the&#160;time the&#160;counter overflows&#160;and when the&#160;<br/>microcode starts to carry out&#160;its data&#160;collection&#160;obligations.&#160;INST_RETIRED&#160;is a&#160;very common event that&#160;is used&#160;to&#160;<br/>sample where performance bottleneck happened and to help&#160;identify its location in instruction address space.&#160;Even&#160;<br/>if&#160;the delay&#160;is constant in&#160;core clock&#160;space, it&#160;invariably&#160;manifest&#160;as variable&#160;“skids” in&#160;instruction&#160;address&#160;space.&#160;<br/>This creates&#160;a challenge&#160;for programmers to&#160;profile a&#160;workload&#160;and pinpoint the&#160;location of bottlenecks.<br/>The core&#160;PMU in processors&#160;based on Intel microarchitecture code&#160;name&#160;Sandy Bridge&#160;include a facility referred&#160;to&#160;<br/>as&#160;precise distribution of Instruction Retired (PDIR).&#160;<br/>The PDIR&#160;facility mitigates the “skid”&#160;problem&#160;by providing an&#160;early indication of when&#160;the INST_RETIRED counter&#160;<br/>is&#160;about to&#160;overflow, allowing&#160;the machine to&#160;more precisely trap on&#160;the instruction that&#160;actually&#160;caused&#160;the&#160;<br/>counter overflow thus eliminating skid.<br/>PDIR&#160;applies only to&#160;the INST_RETIRED.ALL precise&#160;event,&#160;and&#160;must&#160;use IA32_PMC1&#160;with PerfEvtSel1&#160;property&#160;<br/>configured&#160;and&#160;bit&#160;1 in&#160;the IA32_PEBS_ENABLE&#160;set to&#160;1.&#160;INST_RETIRED.ALL is&#160;a non-architectural performance&#160;<br/>event,&#160;it&#160;is not supported&#160;in prior&#160;generation microarchitectures. Additionally,&#160;on processors with&#160;CPUID&#160;<br/>DisplayFamily_DisplayModel signatures&#160;of 06_2A&#160;and 06_2D,&#160;the tool&#160;that programs PDIR should quiesce the rest&#160;<br/>of the&#160;programmable counters&#160;in the&#160;core when&#160;PDIR&#160;is active.&#160;</p>
<p style="position:absolute;top:828px;left:69px;white-space:nowrap" class="ft05">18.9.5&#160;</p>
<p style="position:absolute;top:828px;left:150px;white-space:nowrap" class="ft05">Off-core&#160;Response Performance Monitoring&#160;</p>
<p style="position:absolute;top:859px;left:69px;white-space:nowrap" class="ft07">The core PMU in&#160;processors&#160;based on&#160;Intel&#160;microarchitecture code&#160;name Sandy Bridge provides&#160;off-core response&#160;<br/>facility&#160;similar&#160;to&#160;prior generation.&#160;Off-core response can&#160;be&#160;programmed only&#160;with a&#160;specific&#160;pair of event&#160;select&#160;<br/>and counter&#160;MSR,&#160;and with specific event codes and predefine mask bit value&#160;in&#160;a dedicated MSR&#160;to specify attri-<br/>butes of the&#160;off-core transaction. Two&#160;event codes are&#160;dedicated&#160;for&#160;off-core&#160;response&#160;event programming.&#160;Each&#160;<br/>event&#160;code&#160;for off-core&#160;response&#160;monitoring&#160;requires programming an&#160;associated&#160;configuration MSR,&#160;<br/>MSR_OFFCORE_RSP_x.<a href="o_fe12b1e2a880e0ce-694.html">&#160;Table 18-35&#160;</a>lists the&#160;event code,&#160;mask value&#160;and additional off-core&#160;configuration&#160;MSR&#160;<br/>that must be programmed&#160;to count off-core&#160;response&#160;events&#160;using IA32_PMCx.&#160;</p>
<p style="position:absolute;top:260px;left:233px;white-space:nowrap" class="ft06">Table&#160;18-34.&#160;&#160;Layout&#160;of&#160;Precise&#160;Store&#160;Information In&#160;PEBS&#160;Record</p>
<p style="position:absolute;top:285px;left:75px;white-space:nowrap" class="ft03">Field&#160;Offset&#160;</p>
<p style="position:absolute;top:285px;left:225px;white-space:nowrap" class="ft03">Description</p>
<p style="position:absolute;top:308px;left:75px;white-space:nowrap" class="ft03">Store&#160;Data&#160;</p>
<p style="position:absolute;top:325px;left:75px;white-space:nowrap" class="ft03">Linear&#160;Address</p>
<p style="position:absolute;top:308px;left:173px;white-space:nowrap" class="ft03">98H</p>
<p style="position:absolute;top:308px;left:225px;white-space:nowrap" class="ft03">The&#160;linear&#160;address of&#160;the destination&#160;of&#160;the store.</p>
<p style="position:absolute;top:349px;left:75px;white-space:nowrap" class="ft03">Store&#160;Status</p>
<p style="position:absolute;top:349px;left:173px;white-space:nowrap" class="ft03">A0H</p>
<p style="position:absolute;top:349px;left:225px;white-space:nowrap" class="ft03">L1D Hit&#160;(Bit 0): The&#160;store&#160;hit the data&#160;cache closest to&#160;the&#160;core&#160;(lowest latency cache) if this bit is set,&#160;</p>
<p style="position:absolute;top:366px;left:225px;white-space:nowrap" class="ft011">otherwise&#160;the store missed&#160;the data&#160;cache.<br/>STLB&#160;Miss&#160;(bit&#160;4): The store missed the STLB&#160;if&#160;set, otherwise the&#160;store&#160;hit the STLB<br/>Locked&#160;Access&#160;(bit&#160;5): The store was part&#160;of&#160;a locked&#160;access if&#160;set,&#160;otherwise the store was not part&#160;of&#160;a&#160;</p>
<p style="position:absolute;top:424px;left:225px;white-space:nowrap" class="ft03">locked access.</p>
<p style="position:absolute;top:448px;left:75px;white-space:nowrap" class="ft03">Reserved</p>
<p style="position:absolute;top:448px;left:173px;white-space:nowrap" class="ft03">A8H</p>
<p style="position:absolute;top:448px;left:225px;white-space:nowrap" class="ft03">Reserved</p>
</div>
</body>
</html>
