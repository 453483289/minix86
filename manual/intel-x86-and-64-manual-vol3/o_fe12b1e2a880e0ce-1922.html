<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1922</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:18px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1922-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1922.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">42-4&#160;Vol. 3D</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">INTEL¬Æ SGX INTERACTIONS WITH IA32 AND INTEL¬Æ 64&#160;ARCHITECTURE</p>
<p style="position:absolute;top:98px;left:68px;white-space:nowrap" class="ft02">42.5.3&#160;</p>
<p style="position:absolute;top:98px;left:148px;white-space:nowrap" class="ft02">Interactions with APIC Virtualization</p>
<p style="position:absolute;top:127px;left:68px;white-space:nowrap" class="ft07">This section applies&#160;to Intel&#160;SGX in&#160;VMX non-root operation&#160;when&#160;the ‚Äúvirtualize APIC accesses‚Äù VM-execution&#160;<br/>control is&#160;1.<br/>A memory access by an&#160;enclave&#160;instruction&#160;that&#160;implicitly&#160;uses&#160;a cached physical&#160;address is&#160;never checked&#160;for&#160;<br/>overlap&#160;with&#160;the APIC-access page. Such&#160;accesses never cause&#160;APIC-access VM exits&#160;and&#160;are never redirected to&#160;<br/>the virtual-APIC page. Implicit&#160;memory accesses&#160;can only&#160;be&#160;made&#160;to&#160;the SECS, the TCS,&#160;or the SSA&#160;of&#160;an&#160;enclave&#160;<br/><a href="o_fe12b1e2a880e0ce-1773.html">(see Section&#160;38.5.3.2</a>).&#160;<br/>An explicit Enclave&#160;Access (a&#160;linear memory access which is&#160;either from within&#160;an enclave&#160;into&#160;its&#160;ELRANGE,&#160;or an&#160;<br/>access by an&#160;Intel SGX instruction that is&#160;expected&#160;to&#160;be in&#160;the&#160;EPC) that overlaps&#160;with&#160;the APIC-access page&#160;<br/>causes a&#160;#PF&#160;exception (APIC page&#160;is expected&#160;to be outside of EPC).&#160;<br/>Non-Enclave&#160;accesses made&#160;either&#160;by an&#160;Intel SGX&#160;instruction&#160;or&#160;by&#160;a logical processor inside an&#160;enclave&#160;to an&#160;<br/>address&#160;that without&#160;SGX would&#160;have&#160;caused redirection&#160;to&#160;the virtual-APIC page&#160;instead&#160;cause an&#160;APIC-access&#160;<br/>VM&#160;exit.&#160;<br/>Other than implicit accesses made by Intel SGX&#160;instructions, guest-physical&#160;and physical accesses&#160;are not&#160;consid-<br/>ered ‚Äúenclave&#160;accesses‚Äù; consequently, such accesses&#160;result in&#160;undefined behavior&#160;if these&#160;accesses eventually&#160;<br/>reach EPC. This&#160;applies to&#160;any non-enclave&#160;physical&#160;accesses.<br/>While a logical processor is executing inside an enclave,&#160;an attempt to execute an&#160;instruction outside&#160;of ELRANGE&#160;<br/>results in a #GP(0), even if&#160;the&#160;linear address would translate&#160;to a physical address that&#160;overlaps the APIC-access&#160;<br/>page.&#160;</p>
<p style="position:absolute;top:493px;left:68px;white-space:nowrap" class="ft04">42.6&#160;</p>
<p style="position:absolute;top:493px;left:147px;white-space:nowrap" class="ft04">INTEL¬Æ SGX INTERACTIONS WITH ARCHITECTURALLY-VISIBLE EVENTS</p>
<p style="position:absolute;top:528px;left:68px;white-space:nowrap" class="ft07">All&#160;architecturally visible vectored&#160;events (IA32&#160;exceptions,&#160;interrupts, SMI,&#160;NMI, INIT, VM exit)&#160;can be detected&#160;<br/>while&#160;inside an enclave&#160;and will&#160;cause an asynchronous enclave exit if they are&#160;not blocked.&#160;Additionally, INT3,&#160;and&#160;<br/>the&#160;SignalTXTMsg[SENTER]&#160;(i.e.&#160;GETSEC[SENTER]‚Äôs&#160;rendezvous&#160;event message) events&#160;also cause&#160;asynchronous&#160;<br/>enclave exits. Note that SignalTXTMsg[SEXIT] (i.e.&#160;GETSEC[SEXIT]‚Äôs&#160;teardown&#160;message) does not cause an AEX.&#160;<br/>On&#160;an AEX, information about&#160;the event causing&#160;the&#160;AEX is&#160;stored&#160;in&#160;the SSA&#160;(see&#160;<a href="o_fe12b1e2a880e0ce-1806.html">Section 40.4 for de</a>tails&#160;of AEX).&#160;<br/>The&#160;information stored in&#160;the&#160;SSA&#160;only&#160;describes&#160;the first event&#160;that&#160;triggered&#160;the AEX. If parsing/delivery of the&#160;<br/>first event&#160;results in&#160;detection of further events&#160;(e.g.&#160;VM exit,&#160;double fault, etc.), then&#160;the event information in&#160;the&#160;<br/>SSA&#160;is not updated&#160;to reflect these&#160;subsequently&#160;detected&#160;events.&#160;</p>
<p style="position:absolute;top:705px;left:68px;white-space:nowrap" class="ft04">42.7 INTERACTIONS&#160;</p>
<p style="position:absolute;top:705px;left:291px;white-space:nowrap" class="ft04">WITH&#160;</p>
<p style="position:absolute;top:705px;left:347px;white-space:nowrap" class="ft04">THE&#160;</p>
<p style="position:absolute;top:705px;left:390px;white-space:nowrap" class="ft04">PROCESSOR EXTENDED STATE AND&#160;</p>
<p style="position:absolute;top:730px;left:146px;white-space:nowrap" class="ft04">MISCELLANEOUS STATE</p>
<p style="position:absolute;top:793px;left:68px;white-space:nowrap" class="ft02">42.7.1&#160;</p>
<p style="position:absolute;top:793px;left:148px;white-space:nowrap" class="ft02">Requirements and Architecture&#160;Overview</p>
<p style="position:absolute;top:822px;left:68px;white-space:nowrap" class="ft08">Processor&#160;extended states are&#160;the ISA features that are&#160;enabled by the&#160;settings&#160;of CR4.OSXSAVE and&#160;the XCR0&#160;<br/>register. Processor extended&#160;states&#160;are&#160;normally saved/restored&#160;by software&#160;via XSAVE/XRSTOR instructions.&#160;<br/>Details of discovery of processor extended&#160;states&#160;and management of these states&#160;are&#160;described&#160;<a href="˛ˇ">in&#160;CHAPTER 13 of&#160;<br/><i>Intel¬Æ 64&#160;and&#160;IA-32 Architectures Software&#160;Developer‚Äôs&#160;Manual, Volume&#160;3A</i>.&#160;<br/></a>Additionally,&#160;the following requirements apply to Intel SGX:</p>
<p style="position:absolute;top:916px;left:68px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:916px;left:93px;white-space:nowrap" class="ft07">On an&#160;AEX, the Intel SGX architecture&#160;must protect&#160;the processor extended&#160;state and miscellaneous&#160;state&#160;by&#160;<br/>saving them&#160;in the&#160;enclave‚Äôs&#160;state-save area&#160;(SSA),&#160;and clear the&#160;secrets&#160;from&#160;the processor extended&#160;state&#160;<br/>that&#160;is used by an enclave.&#160;</p>
<p style="position:absolute;top:971px;left:68px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:972px;left:93px;white-space:nowrap" class="ft07">Intel SGX architecture must&#160;verify&#160;that the SSA frame size&#160;is&#160;large enough&#160;to contain&#160;all&#160;the processor extended&#160;<br/>states&#160;and&#160;miscelaneous state&#160;used by&#160;the&#160;enclave.</p>
<p style="position:absolute;top:1010px;left:68px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:1011px;left:93px;white-space:nowrap" class="ft07">Intel&#160;SGX architecture&#160;must&#160;ensure that enclaves&#160;can only&#160;use&#160;processor&#160;extended&#160;state that&#160;is&#160;enabled&#160;by&#160;<br/>system software in&#160;XCR0.&#160;</p>
</div>
</body>
</html>
