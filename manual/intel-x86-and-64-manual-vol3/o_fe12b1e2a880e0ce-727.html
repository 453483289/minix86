<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 727</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page727-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce727.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;18-91</p>
<p style="position:absolute;top:47px;left:672px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft04">3.&#160;Select&#160;the number&#160;of&#160;the counter&#160;to be&#160;used&#160;to count the&#160;event&#160;from&#160;the Counter Numbers&#160;Per ESCR field.<br/>4.&#160;Determine&#160;the name of&#160;the counter and the&#160;CCCR&#160;associated with the&#160;counter,&#160;and&#160;determine the&#160;MSR&#160;</p>
<p style="position:absolute;top:141px;left:94px;white-space:nowrap" class="ft02">addresses of&#160;the counter,&#160;CCCR, and ES<a href="o_fe12b1e2a880e0ce-718.html">CR from Table 18-63</a>.</p>
<p style="position:absolute;top:165px;left:69px;white-space:nowrap" class="ft02">5.&#160;Use&#160;the WRMSR&#160;instruction&#160;to write the ESCR Event&#160;Select and ESCR Event&#160;Mask values&#160;into the&#160;appropriate&#160;</p>
<p style="position:absolute;top:181px;left:94px;white-space:nowrap" class="ft02">fields&#160;in&#160;the ESCR. At&#160;the same&#160;time set or&#160;clear&#160;the USR&#160;and&#160;OS flags in the ESCR as&#160;desired.</p>
<p style="position:absolute;top:205px;left:69px;white-space:nowrap" class="ft02">6.&#160;Use&#160;the&#160;WRMSR&#160;instruction&#160;to write the&#160;CCCR Select&#160;value&#160;into&#160;the&#160;appropriate&#160;field&#160;in&#160;the&#160;CCCR.</p>
<p style="position:absolute;top:240px;left:433px;white-space:nowrap" class="ft03">NOTE</p>
<p style="position:absolute;top:265px;left:122px;white-space:nowrap" class="ft05">Typically all&#160;the&#160;fields and&#160;flags of&#160;the&#160;CCCR will&#160;be&#160;written with one&#160;WRMSR instruction; however,&#160;<br/>in this&#160;procedure,&#160;several WRMSR&#160;writes are&#160;used&#160;to more&#160;clearly demonstrate&#160;the&#160;uses&#160;of&#160;the&#160;<br/>various CCCR fields and&#160;flags.</p>
<p style="position:absolute;top:339px;left:69px;white-space:nowrap" class="ft02">This setup procedure&#160;is continued&#160;in the&#160;<a href="o_fe12b1e2a880e0ce-727.html">next section, Section 18.15.5.2, “Filtering Events.”</a></p>
<p style="position:absolute;top:383px;left:69px;white-space:nowrap" class="ft03">18.15.5.2&#160;&#160;&#160;Filtering Events</p>
<p style="position:absolute;top:412px;left:69px;white-space:nowrap" class="ft06">Each&#160;counter&#160;receives up&#160;to 4 input&#160;lines from the&#160;processor&#160;hardware&#160;from&#160;which it&#160;is counting events. The&#160;<br/>counter treats these inputs as binary inputs (input 0 has&#160;a value&#160;of&#160;1, input&#160;1 has a value of 2,&#160;input 3 has a value&#160;<br/>of 4,&#160;and&#160;input 3 has a&#160;value of 8).&#160;When&#160;a counter&#160;is&#160;enabled, it&#160;adds&#160;this&#160;binary&#160;input value&#160;to the&#160;counter&#160;value&#160;<br/>on each&#160;clock&#160;cycle.&#160;For each clock cycle, the&#160;value&#160;added to&#160;the counter can&#160;then range from 0&#160;(no event) to&#160;15.&#160;<br/>For&#160;many&#160;events, only the&#160;0 input&#160;line is active, so the&#160;counter is merely&#160;counting the clock cycles&#160;during which&#160;the&#160;<br/>0 input&#160;is asserted.&#160;However,&#160;for&#160;some events two or&#160;more&#160;input lines are&#160;used. Here, the&#160;counters threshold&#160;<br/>setting can&#160;be&#160;used&#160;to filter&#160;events. The compare, complement, threshold, and edge&#160;fields&#160;control&#160;the filtering of&#160;<br/>counter&#160;increments by input&#160;value.<br/>If the&#160;compare flag is set,&#160;then a&#160;“greater&#160;than”&#160;or a “less than or&#160;equal&#160;to”&#160;comparison of the&#160;input value&#160;vs. a&#160;<br/>threshold value&#160;can be made. The complement flag selects “less&#160;than or&#160;equal&#160;to” (flag set) or&#160;“greater than” (flag&#160;<br/>clear).&#160;The&#160;threshold&#160;field selects a threshold value of from 0 to&#160;15. For example,&#160;if&#160;the complement flag is cleared&#160;<br/>and the threshold field is set to&#160;6, than&#160;any&#160;input value of&#160;7 or greater&#160;on the 4 inputs to&#160;the&#160;counter will&#160;cause&#160;the&#160;<br/>counter&#160;to be incremented by 1,&#160;and any&#160;value&#160;less&#160;than&#160;7&#160;will cause&#160;an increment&#160;of&#160;0&#160;(or no increment)&#160;of&#160;the&#160;<br/>counter.&#160;Conversely, if the&#160;complement flag is set, any&#160;value from&#160;0 to 6&#160;will increment the counter and any value&#160;<br/>from 7&#160;to 15 will not&#160;increment the&#160;counter. Note&#160;that when&#160;a&#160;threshold condition&#160;has been&#160;satisfied,&#160;the input&#160;to&#160;<br/>the&#160;counter is&#160;always&#160;1, not the&#160;input value&#160;that is&#160;presented to&#160;the threshold filter.&#160;<br/>The edge&#160;flag&#160;provides further filtering of&#160;the counter inputs when a&#160;threshold&#160;comparison&#160;is being&#160;made.&#160;The&#160;edge&#160;<br/>flag&#160;is only active&#160;when the&#160;compare flag&#160;is set.&#160;When&#160;the&#160;edge flag&#160;is set, the&#160;resulting output from the&#160;threshold&#160;<br/>filter (a value of 0 or 1)&#160;is used&#160;as an input to the&#160;edge&#160;filter. Each clock cycle,&#160;the&#160;edge&#160;filter examines the&#160;last and&#160;<br/>current input&#160;values&#160;and&#160;sends&#160;a count to&#160;the&#160;counter only when it&#160;detects a&#160;“rising edge”&#160;event;&#160;that is, a&#160;false-<br/>to-true transition<a href="o_fe12b1e2a880e0ce-728.html">. Figure&#160;18-46&#160;illustr</a>ates rising&#160;edge&#160;filtering.<br/>The following&#160;procedure shows how&#160;to configure&#160;a CCCR&#160;to&#160;filter&#160;events using&#160;the&#160;threshold&#160;filter and&#160;the&#160;edge&#160;<br/>filter. This procedure is&#160;a continuation&#160;of&#160;the&#160;setup procedure&#160;introduced<a href="o_fe12b1e2a880e0ce-725.html">&#160;in Section 18.15.5.1,&#160;“Selecting Events to&#160;<br/>Count.”<br/></a>7.&#160;(Optional) To&#160;set up&#160;the&#160;counter for threshold filtering,&#160;use the&#160;WRMSR instruction to write&#160;values&#160;in the CCCR&#160;</p>
<p style="position:absolute;top:862px;left:95px;white-space:nowrap" class="ft04">compare and complement&#160;flags and&#160;the&#160;threshold field:<br/>—&#160;Set&#160;the compare&#160;flag.<br/>—&#160;Set or&#160;clear the&#160;complement&#160;flag for less than&#160;or&#160;equal to or&#160;greater than comparisons, respectively.<br/>—&#160;Enter&#160;a value from 0&#160;to 15&#160;in&#160;the threshold&#160;field.</p>
<p style="position:absolute;top:958px;left:69px;white-space:nowrap" class="ft06">8.&#160;(Optional)&#160;Select rising edge&#160;filtering by&#160;setting&#160;the&#160;CCCR edge&#160;flag.<br/>This setup procedure&#160;is continued&#160;in the&#160;next sect<a href="o_fe12b1e2a880e0ce-728.html">ion, Section 18.15.5.3, “Starting Event&#160;Counting.”</a></p>
</div>
</body>
</html>
