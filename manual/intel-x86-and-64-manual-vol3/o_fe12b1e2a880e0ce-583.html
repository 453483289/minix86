<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 583</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page583-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce583.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:768px;white-space:nowrap" class="ft00">Vol. 3B&#160;17-9</p>
<p style="position:absolute;top:47px;left:425px;white-space:nowrap" class="ft01">DEBUG, BRANCH&#160;PROFILE, TSC, AND RESOURCE MONITORING FEATURES</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft05">is set when the processor returns from the&#160;exception handler,&#160;it&#160;is&#160;copied&#160;into&#160;the&#160;RF&#160;flag&#160;in&#160;the&#160;EFLAGS&#160;register&#160;by&#160;<br/>IRETD/IRETQ&#160;or&#160;a task switch&#160;that&#160;causes the return.&#160;The&#160;processor then&#160;ignores instruction breakpoints for the&#160;<br/>duration of&#160;the next instruction. (Note&#160;that the&#160;POPF, POPFD,&#160;and&#160;IRET instructions do&#160;not transfer&#160;the RF&#160;image&#160;<br/>into&#160;the EFLAGS register.) Setting&#160;the RF flag does not&#160;prevent other types of&#160;debug-exception conditions (such as,&#160;<br/>I/O or&#160;data breakpoints) from being detected,&#160;nor does&#160;it&#160;prevent non-debug&#160;exceptions&#160;from being&#160;generated.<br/>For&#160;the Pentium processor,&#160;when an&#160;instruction&#160;breakpoint coincides&#160;with another&#160;fault-type exception&#160;(such&#160;as a&#160;<br/>page fault),&#160;the processor may generate&#160;one spurious&#160;debug exception&#160;after the&#160;second&#160;exception has been&#160;<br/>handled,&#160;even&#160;though&#160;the debug&#160;exception handler set&#160;the&#160;RF&#160;flag in the EFLAGS&#160;image.&#160;To&#160;prevent a&#160;spurious&#160;<br/>exception with Pentium processors, all fault-class exception handlers should&#160;set the&#160;RF&#160;flag in the EFLAGS&#160;image.</p>
<p style="position:absolute;top:284px;left:69px;white-space:nowrap" class="ft03">17.3.1.2 &#160;&#160;Data Memory and I/O&#160;Breakpoint&#160;Exception Conditions</p>
<p style="position:absolute;top:313px;left:69px;white-space:nowrap" class="ft05">Data memory&#160;and&#160;I/O breakpoints are&#160;reported when the&#160;processor&#160;attempts&#160;to access a&#160;memory or&#160;I/O address&#160;<br/>specified in&#160;a breakpoint-address register&#160;(DR0&#160;through DR3)&#160;that&#160;has been set up&#160;to detect data or&#160;I/O accesses&#160;<br/>(R/W flag&#160;is set&#160;to 1,&#160;2,&#160;or 3).&#160;The&#160;processor generates the exception after it executes&#160;the instruction that made&#160;the&#160;<br/>access, so&#160;these&#160;breakpoint condition&#160;causes&#160;a trap-class exception&#160;to be&#160;generated.&#160;<br/>Because data breakpoints are&#160;traps,&#160;an&#160;instruction that&#160;writes&#160;memory overwrites&#160;the&#160;original data before the&#160;<br/>debug&#160;exception&#160;generated by&#160;a data breakpoint is generated.&#160;If&#160;a debugger&#160;needs to&#160;save&#160;the&#160;contents of a write&#160;<br/>breakpoint location, it should save&#160;the original contents&#160;before setting&#160;the breakpoint. The handler can report the&#160;<br/>saved&#160;value after&#160;the breakpoint is&#160;triggered.&#160;The&#160;address in&#160;the&#160;debug&#160;registers&#160;can&#160;be used to&#160;locate&#160;the new&#160;<br/>value stored by the&#160;instruction&#160;that triggered the&#160;breakpoint.<br/>If a&#160;data breakpoint is&#160;detected&#160;during&#160;an iteration of a&#160;string&#160;instruction&#160;executed&#160;with&#160;fast-string operation (see&#160;<br/><a href="þÿ">Section 7.3.9.3</a>&#160;of&#160;<a href="þÿ"><i>IntelÂ® 64 and&#160;IA-32 Architectures Software&#160;Developerâ€™s&#160;Manual,&#160;Volume 1</i>), de</a>livery of&#160;the&#160;<br/>resulting&#160;debug&#160;exception may be&#160;delayed until completion of the&#160;corresponding&#160;group&#160;of&#160;iterations.<br/>Intel486&#160;and later processors ignore the&#160;GE&#160;and LE flags&#160;in DR7.&#160;In&#160;Intel386&#160;processors,&#160;exact data breakpoint&#160;<br/>matching does&#160;not occur&#160;unless it&#160;is enabled by setting the&#160;LE&#160;and/or the&#160;GE&#160;flags.&#160;<br/>For repeated INS and&#160;OUTS&#160;instructions&#160;that generate&#160;an I/O-breakpoint&#160;debug exception, the&#160;processor&#160;gener-<br/>ates the exception after&#160;the completion&#160;of&#160;the first iteration. Repeated&#160;INS&#160;and OUTS&#160;instructions&#160;generate a&#160;data-<br/>breakpoint debug&#160;exception after&#160;the iteration&#160;in&#160;which&#160;the&#160;memory&#160;address breakpoint location&#160;is accessed.</p>
<p style="position:absolute;top:651px;left:69px;white-space:nowrap" class="ft03">17.3.1.3 &#160;&#160;General-Detect Exception&#160;Condition</p>
<p style="position:absolute;top:679px;left:69px;white-space:nowrap" class="ft05">When the GD flag in DR7&#160;is&#160;set, the&#160;general-detect debug exception occurs when a&#160;program attempts to access&#160;any&#160;<br/>of&#160;the debug registers (DR0 through DR7) at&#160;the same time&#160;they&#160;are being used&#160;by&#160;another&#160;application, such as an&#160;<br/>emulator or debugger.&#160;This protection&#160;feature guarantees&#160;full control over the&#160;debug&#160;registers when required.&#160;The&#160;<br/>debug exception&#160;handler can&#160;detect this&#160;condition by checking&#160;the state&#160;of the&#160;BD flag&#160;in the&#160;DR6 register.&#160;The&#160;<br/>processor&#160;generates&#160;the&#160;exception before it&#160;executes&#160;the&#160;MOV&#160;instruction&#160;that accesses a&#160;debug register, which&#160;<br/>causes a&#160;fault-class exception&#160;to be&#160;generated.&#160;</p>
<p style="position:absolute;top:806px;left:69px;white-space:nowrap" class="ft03">17.3.1.4 &#160;&#160;Single-Step Exception Condition</p>
<p style="position:absolute;top:835px;left:69px;white-space:nowrap" class="ft05">The&#160;processor generates&#160;a single-step debug exception&#160;if&#160;(while&#160;an instruction&#160;is&#160;being executed) it detects that the&#160;<br/>TF flag&#160;in the&#160;EFLAGS register&#160;is set.&#160;The exception&#160;is&#160;a&#160;trap-class exception, because the&#160;exception is&#160;generated&#160;<br/>after the&#160;instruction&#160;is executed. The&#160;processor will not generate&#160;this&#160;exception after the&#160;instruction that sets the&#160;<br/>TF&#160;flag. For example,&#160;if the&#160;POPF&#160;instruction&#160;is used to set the TF flag, a single-step trap&#160;does&#160;not&#160;occur until after&#160;<br/>the instruction that&#160;follows the&#160;POPF instruction.<br/>The&#160;processor&#160;clears the&#160;TF&#160;flag before calling&#160;the&#160;exception&#160;handler.&#160;If the TF&#160;flag was&#160;set&#160;in a&#160;TSS&#160;at the&#160;time of&#160;<br/>a task switch, the&#160;exception&#160;occurs after&#160;the first&#160;instruction&#160;is executed&#160;in&#160;the new task.<br/>The TF&#160;flag&#160;normally is&#160;not cleared by&#160;privilege changes&#160;inside&#160;a task. The&#160;INT&#160;<i>n</i>&#160;and INTO&#160;instructions,&#160;however,&#160;<br/>do clear this&#160;flag. Therefore,&#160;software&#160;debuggers that&#160;single-step code&#160;must recognize and emulate INT&#160;<i>n</i>&#160;or&#160;INTO&#160;<br/>instructions rather than executing them&#160;directly. To&#160;maintain&#160;protection,&#160;the&#160;operating&#160;system&#160;should&#160;check&#160;the&#160;<br/>CPL&#160;after any&#160;single-step trap&#160;to&#160;see&#160;if single stepping&#160;should continue at&#160;the current&#160;privilege&#160;level.<br/>The interrupt&#160;priorities&#160;guarantee that, if an&#160;external&#160;interrupt occurs, single&#160;stepping&#160;stops. When&#160;both an&#160;<br/>external interrupt&#160;and a&#160;single-step interrupt occur together, the&#160;single-step interrupt is processed first.&#160;This oper-</p>
</div>
</body>
</html>
