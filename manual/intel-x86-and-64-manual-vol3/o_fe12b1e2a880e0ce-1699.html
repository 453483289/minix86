<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1699</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:18px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1699-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1699.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;36-15</p>
<p style="position:absolute;top:47px;left:685px;white-space:nowrap" class="ft01">INTELÂ®&#160;PROCESSOR TRACE</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08">In all cases, the error will be logged&#160;by setting IA32_RTIT_STATUS.Error,&#160;thereby disabling tracing when&#160;the&#160;prob-<br/>lematic ToPA&#160;entry is reached (when proc_trace_table_offset points to the entry containing the error). Any packet&#160;<br/>bytes that&#160;are internally&#160;buffered&#160;when&#160;the&#160;error is&#160;detected may&#160;be&#160;lost.&#160;<br/>Note that operational&#160;errors may&#160;also be signaled&#160;due&#160;to attempts&#160;to access restricted&#160;memory. See<a href="o_fe12b1e2a880e0ce-1699.html">&#160;Section&#160;<br/>36.2.6.4&#160;for d</a>etails.<br/>A tracing software&#160;have&#160;a&#160;range of&#160;flexibility&#160;using ToPA&#160;to manage&#160;the interaction of Intel&#160;PT&#160;with&#160;application&#160;<br/>buffer<a href="o_fe12b1e2a880e0ce-1745.html">s, see Section 36.5.</a></p>
<p style="position:absolute;top:256px;left:69px;white-space:nowrap" class="ft03">36.2.6.3 &#160;&#160;Trace Transport Subsystem&#160;</p>
<p style="position:absolute;top:283px;left:69px;white-space:nowrap" class="ft08">When IA32_RTIT_CTL.FabricEn is&#160;set,&#160;the&#160;IA32_RTIT_CTL.ToPA&#160;bit is&#160;ignored,&#160;and trace output&#160;is written&#160;to the&#160;<br/>trace transport subsystem. The endpoints of this&#160;transport&#160;are platform-specific,&#160;and details of&#160;configuration&#160;<br/>options should&#160;refer to&#160;the specific platform&#160;documentation. The FabricEn bit is&#160;available&#160;to be&#160;set&#160;if&#160;<br/>CPUID(EAX=14H,ECX=0):EBX[bit 3] = 1.</p>
<p style="position:absolute;top:376px;left:69px;white-space:nowrap" class="ft03">36.2.6.4 &#160;&#160;Restricted Memory Access</p>
<p style="position:absolute;top:403px;left:69px;white-space:nowrap" class="ft08">Packet output&#160;cannot&#160;be&#160;directed to&#160;any regions of&#160;memory&#160;that are restricted&#160;by&#160;the platform.&#160;In&#160;particular, all&#160;<br/>memory accesses on&#160;behalf of packet&#160;output are&#160;checked&#160;against the SMRR&#160;regions.&#160;If there&#160;is any&#160;overlap with&#160;<br/>these&#160;regions, trace&#160;data collection&#160;will&#160;not function&#160;properly. Exact processor behavior is&#160;implementation-depen-<br/>dent;&#160;<a href="o_fe12b1e2a880e0ce-1699.html">Table&#160;36-5</a>&#160;summarizes&#160;several&#160;scenarios.</p>
<p style="position:absolute;top:667px;left:69px;white-space:nowrap" class="ft010">It should&#160;also be noted that packet&#160;output should&#160;not&#160;be routed to&#160;the 4KB&#160;APIC MMIO region,&#160;as defined by&#160;the&#160;<br/>IA32_APIC_BASE&#160;MSR. For details&#160;<a href="þÿ">about the APIC, refer to&#160;<i>IntelÂ® 64 and IA-32 Architectures&#160;Software&#160;Devel-<br/>operâ€™s&#160;Manual, Volume&#160;3A</i>. No&#160;</a>error is&#160;signaled for this&#160;case.</p>
<p style="position:absolute;top:734px;left:69px;white-space:nowrap" class="ft05">Modifications to&#160;Restricted Memory Regions</p>
<p style="position:absolute;top:759px;left:69px;white-space:nowrap" class="ft08">It is&#160;recommended that&#160;software disable packet&#160;generation&#160;before modifying the SMRRs&#160;to change the scope of&#160;the&#160;<br/>SMRR&#160;regions. This&#160;is because&#160;the processor reserves&#160;the&#160;right to&#160;cache any number of ToPA&#160;table entries inter-<br/>nally,&#160;after&#160;checking&#160;them&#160;against restricted&#160;memory ranges.&#160;Once&#160;cached,&#160;the&#160;entries&#160;will not be checked&#160;again,&#160;<br/>meaning one&#160;could potentially route&#160;packet&#160;output to&#160;a newly restricted region.&#160;Software&#160;can ensure&#160;that&#160;any&#160;<br/>cached entries are&#160;written to memory by clearing IA32_RTIT_CTL.TraceEn.</p>
<p style="position:absolute;top:875px;left:69px;white-space:nowrap" class="ft06">36.2.7&#160;</p>
<p style="position:absolute;top:875px;left:149px;white-space:nowrap" class="ft06">Enabling and Configuration MSRs</p>
<p style="position:absolute;top:926px;left:69px;white-space:nowrap" class="ft03">36.2.7.1 &#160;&#160;General&#160;Considerations</p>
<p style="position:absolute;top:953px;left:69px;white-space:nowrap" class="ft08">Trace packet&#160;generation is&#160;enabled and&#160;configured by&#160;a&#160;collection of model-specific&#160;registers (MSRs), which&#160;are&#160;<br/>detailed&#160;below.&#160;Some notes&#160;on the&#160;configuration MSR behavior:</p>
<p style="position:absolute;top:991px;left:69px;white-space:nowrap" class="ft07">â€¢</p>
<p style="position:absolute;top:992px;left:95px;white-space:nowrap" class="ft08">If Intel Processor Trace&#160;is not supported&#160;by the&#160;pr<a href="o_fe12b1e2a880e0ce-1709.html">ocessor (see Section 36.3.1), RDM</a>SR or&#160;WRMSR of the&#160;<br/>IA32_RTIT_*&#160;MSRs will cause&#160;#GP.&#160;</p>
<p style="position:absolute;top:1030px;left:69px;white-space:nowrap" class="ft07">â€¢</p>
<p style="position:absolute;top:1031px;left:95px;white-space:nowrap" class="ft08">A WRMSR&#160;to any of&#160;these configuration&#160;MSRs that begins&#160;and ends&#160;with IA32_RTIT_CTL.TraceEn set&#160;will&#160;#GP&#160;<br/>fault. Packet&#160;generation&#160;must be disabled&#160;before the&#160;configuration MSRs can&#160;be&#160;changed.</p>
<p style="position:absolute;top:484px;left:282px;white-space:nowrap" class="ft05">Table 36-5.&#160;Behavior&#160;on&#160;Restricted&#160;Memory&#160;Access</p>
<p style="position:absolute;top:508px;left:105px;white-space:nowrap" class="ft02">Scenario</p>
<p style="position:absolute;top:508px;left:480px;white-space:nowrap" class="ft02">Description</p>
<p style="position:absolute;top:532px;left:75px;white-space:nowrap" class="ft02">ToPA&#160;output&#160;region&#160;</p>
<p style="position:absolute;top:549px;left:75px;white-space:nowrap" class="ft02">overlaps&#160;with&#160;</p>
<p style="position:absolute;top:565px;left:75px;white-space:nowrap" class="ft02">SMRR</p>
<p style="position:absolute;top:532px;left:199px;white-space:nowrap" class="ft02">Stores&#160;to&#160;the&#160;restricted&#160;memory region&#160;will be&#160;dropped,&#160;and that&#160;packet&#160;data will be&#160;lost. Any attempt to read&#160;</p>
<p style="position:absolute;top:549px;left:199px;white-space:nowrap" class="ft02">from&#160;that&#160;restricted&#160;region&#160;will return&#160;all&#160;1s.&#160;The processor also may signal&#160;an&#160;erro<a href="o_fe12b1e2a880e0ce-1719.html">r (Section&#160;36.3.9</a>)&#160;and&#160;disable&#160;</p>
<p style="position:absolute;top:565px;left:199px;white-space:nowrap" class="ft02">tracing when the output&#160;pointer reaches&#160;the&#160;restricted&#160;region.&#160;If&#160;packet&#160;generation&#160;remains&#160;enabled,&#160;then&#160;</p>
<p style="position:absolute;top:582px;left:199px;white-space:nowrap" class="ft02">packet&#160;output&#160;may&#160;continue&#160;once stores&#160;are no&#160;longer&#160;directed&#160;to&#160;restricted&#160;memory (on wrap,&#160;or if&#160;the&#160;output&#160;</p>
<p style="position:absolute;top:598px;left:199px;white-space:nowrap" class="ft02">region&#160;is&#160;larger&#160;than&#160;the&#160;restricted&#160;memory&#160;region).</p>
<p style="position:absolute;top:622px;left:75px;white-space:nowrap" class="ft02">ToPA&#160;table&#160;overlaps&#160;</p>
<p style="position:absolute;top:639px;left:75px;white-space:nowrap" class="ft02">with&#160;SMRR</p>
<p style="position:absolute;top:622px;left:199px;white-space:nowrap" class="ft02">The&#160;processor will signal&#160;an&#160;erro<a href="o_fe12b1e2a880e0ce-1719.html">r (Section&#160;36.3.9</a>) and disable&#160;tracing when&#160;the&#160;ToPA&#160;read&#160;pointer&#160;</p>
<p style="position:absolute;top:639px;left:199px;white-space:nowrap" class="ft02">(IA32_RTIT_OUTPUT_BASE + (proc_trace_table_offset&#160;Â« 3))&#160;enters the restricted&#160;region.</p>
</div>
</body>
</html>
