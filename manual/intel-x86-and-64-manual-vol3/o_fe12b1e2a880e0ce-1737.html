<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1737</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:14px;font-family:Times;color:#0860a8;}
	.ft03{font-size:12px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1737-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1737.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;36-53</p>
<p style="position:absolute;top:47px;left:685px;white-space:nowrap" class="ft01">INTEL®&#160;PROCESSOR TRACE</p>
<p style="position:absolute;top:99px;left:69px;white-space:nowrap" class="ft02">36.4.2.15 &#160;&#160;VMCS&#160;Packet</p>
<p style="position:absolute;top:142px;left:334px;white-space:nowrap" class="ft03">Table 36-34. VMCS&#160;Packet&#160;Definition</p>
<p style="position:absolute;top:166px;left:75px;white-space:nowrap" class="ft04">Name</p>
<p style="position:absolute;top:166px;left:178px;white-space:nowrap" class="ft04">VMCS&#160;Packet</p>
<p style="position:absolute;top:190px;left:75px;white-space:nowrap" class="ft04">Packet&#160;Format</p>
<p style="position:absolute;top:404px;left:75px;white-space:nowrap" class="ft04">Dependencies</p>
<p style="position:absolute;top:404px;left:178px;white-space:nowrap" class="ft04">TriggerEn &amp;&amp; ContextEn;</p>
<p style="position:absolute;top:420px;left:178px;white-space:nowrap" class="ft04">Also&#160;in&#160;VMX operation.</p>
<p style="position:absolute;top:404px;left:336px;white-space:nowrap" class="ft04">Generation&#160;Scenario&#160;Generated&#160;on&#160;successful&#160;VMPTRLD, and&#160;optionally on&#160;SMM VM&#160;</p>
<p style="position:absolute;top:420px;left:466px;white-space:nowrap" class="ft04">exits and&#160;VM&#160;entries that&#160;return&#160;from&#160;SMM&#160;(see<a href="o_fe12b1e2a880e0ce-1745.html">&#160;Section&#160;36.5).</a></p>
<p style="position:absolute;top:444px;left:75px;white-space:nowrap" class="ft04">Description</p>
<p style="position:absolute;top:444px;left:178px;white-space:nowrap" class="ft04">The&#160;VMCS&#160;packet&#160;provides&#160;an&#160;address related to&#160;a&#160;VMCS&#160;pointer for a decoder to&#160;determine&#160;the&#160;transition&#160;of&#160;code&#160;</p>
<p style="position:absolute;top:461px;left:178px;white-space:nowrap" class="ft04">contexts:</p>
<p style="position:absolute;top:483px;left:178px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:483px;left:203px;white-space:nowrap" class="ft04">On a successful&#160;VMPTRLD (i.e.,&#160;a&#160;VMPTRLD that&#160;doesn’t fault,&#160;fail,&#160;or&#160;VM exit),&#160;the&#160;VMCS packet&#160;contains&#160;the&#160;</p>
<p style="position:absolute;top:500px;left:203px;white-space:nowrap" class="ft04">address of&#160;the current working VMCS&#160;pointer&#160;of&#160;the&#160;logical processor that&#160;will execute&#160;a&#160;VM&#160;guest context.&#160;</p>
<p style="position:absolute;top:522px;left:178px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:522px;left:203px;white-space:nowrap" class="ft04">On&#160;SMM VM&#160;exits, the VMCS&#160;packet&#160;provides the&#160;STM VMCS&#160;base&#160;address&#160;(SMM&#160;Transfer&#160;VMCS&#160;pointer), if&#160;VMCS-</p>
<p style="position:absolute;top:539px;left:203px;white-space:nowrap" class="ft04">based&#160;controls are&#160;clear (see<a href="o_fe12b1e2a880e0ce-1746.html">&#160;Section&#160;36.5.1</a>).&#160;See<a href="o_fe12b1e2a880e0ce-1749.html">&#160;Section&#160;36.6</a>&#160;on&#160;tracing&#160;inside&#160;and outside&#160;STM.</p>
<p style="position:absolute;top:561px;left:178px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:561px;left:203px;white-space:nowrap" class="ft04">On&#160;VM&#160;entries&#160;that&#160;return&#160;from&#160;SMM,&#160;the&#160;VMCS&#160;packet&#160;provides&#160;the current&#160;working&#160;VMCS&#160;pointer of&#160;the guest&#160;</p>
<p style="position:absolute;top:578px;left:203px;white-space:nowrap" class="ft04">VM&#160;(see<a href="o_fe12b1e2a880e0ce-1749.html">&#160;Section 36.6), i</a>f&#160;VMCS-based&#160;controls are clear&#160;(see<a href="o_fe12b1e2a880e0ce-1746.html">&#160;Section&#160;36.5.1).</a>&#160;Root&#160;versus&#160;Non-Root&#160;operation can&#160;</p>
<p style="position:absolute;top:594px;left:203px;white-space:nowrap" class="ft04">be&#160;distinguished from&#160;the PIP.NR&#160;bit.</p>
<p style="position:absolute;top:611px;left:178px;white-space:nowrap" class="ft04">If&#160;a VMCS packet&#160;is generated before&#160;a VMCS&#160;has been&#160;loaded,&#160;or&#160;after it&#160;has been cleared, the base address value&#160;</p>
<p style="position:absolute;top:627px;left:178px;white-space:nowrap" class="ft04">will be all 1s.</p>
<p style="position:absolute;top:644px;left:178px;white-space:nowrap" class="ft04">VMCS&#160;packets will not be&#160;seen on processors with IA32_VMX_MISC[bit 14]=0, as these processors do&#160;not allow&#160;</p>
<p style="position:absolute;top:660px;left:178px;white-space:nowrap" class="ft04">TraceEn to be&#160;set in&#160;VMX operation.</p>
<p style="position:absolute;top:684px;left:75px;white-space:nowrap" class="ft04">Application</p>
<p style="position:absolute;top:684px;left:178px;white-space:nowrap" class="ft04">The&#160;purpose of&#160;the VMCS&#160;packet&#160;is to&#160;help&#160;the decoder uniquely identify changes in&#160;the&#160;executing&#160;software&#160;context&#160;</p>
<p style="position:absolute;top:701px;left:178px;white-space:nowrap" class="ft04">in situations that&#160;CR3&#160;may not be&#160;unique.&#160;</p>
<p style="position:absolute;top:717px;left:178px;white-space:nowrap" class="ft04">When&#160;a VMCS&#160;is&#160;encountered,&#160;a&#160;decoder should do the following:</p>
<p style="position:absolute;top:734px;left:178px;white-space:nowrap" class="ft04">•&#160;If&#160;there was a&#160;prior unbound FUP (that&#160;is, a&#160;FUP&#160;not preceded&#160;by&#160;a packet&#160;such as&#160;MODE.TSX&#160;that&#160;consumes&#160;it,&#160;and&#160;</p>
<p style="position:absolute;top:749px;left:194px;white-space:nowrap" class="ft04">it hence&#160;pairs with&#160;a&#160;TIP that&#160;has not yet&#160;been seen),&#160;then&#160;this&#160;VMCS&#160;is&#160;part&#160;of&#160;a&#160;compound&#160;packet&#160;event&#160;(<a href="o_fe12b1e2a880e0ce-1719.html">Section&#160;</a></p>
<p style="position:absolute;top:764px;left:194px;white-space:nowrap" class="ft04"><a href="o_fe12b1e2a880e0ce-1719.html">36.4.1</a></p>
<p style="position:absolute;top:764px;left:238px;white-space:nowrap" class="ft04"><a href="o_fe12b1e2a880e0ce-1719.html">).</a>&#160;Find the ending&#160;TIP and apply the new VMCS&#160;base&#160;pointer value to&#160;the TIP payload&#160;IP.&#160;</p>
<p style="position:absolute;top:779px;left:178px;white-space:nowrap" class="ft04">•&#160;Otherwise, look for the&#160;next VMPTRLD, VMRESUME, or&#160;VMLAUNCH&#160;in&#160;the&#160;disassembly,&#160;and&#160;apply the&#160;new&#160;VMCS&#160;</p>
<p style="position:absolute;top:794px;left:194px;white-space:nowrap" class="ft04">base&#160;pointer&#160;on&#160;the next&#160;VM&#160;entry.</p>
<p style="position:absolute;top:809px;left:178px;white-space:nowrap" class="ft04">For&#160;examples&#160;of&#160;the&#160;packets&#160;generated&#160;by these&#160;flows,&#160;see<a href="o_fe12b1e2a880e0ce-1749.html">&#160;Section&#160;36.7</a>.</p>
<p style="position:absolute;top:213px;left:264px;white-space:nowrap" class="ft04">7</p>
<p style="position:absolute;top:213px;left:333px;white-space:nowrap" class="ft04">6</p>
<p style="position:absolute;top:213px;left:401px;white-space:nowrap" class="ft04">5</p>
<p style="position:absolute;top:213px;left:471px;white-space:nowrap" class="ft04">4</p>
<p style="position:absolute;top:213px;left:539px;white-space:nowrap" class="ft04">3</p>
<p style="position:absolute;top:213px;left:608px;white-space:nowrap" class="ft04">2</p>
<p style="position:absolute;top:213px;left:677px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:213px;left:746px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:201px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:264px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:333px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:401px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:471px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:539px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:608px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:234px;left:677px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:234px;left:746px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:255px;left:201px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:255px;left:264px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:255px;left:333px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:255px;left:401px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:255px;left:471px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:255px;left:539px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:255px;left:608px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:255px;left:677px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:255px;left:746px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:276px;left:201px;white-space:nowrap" class="ft04">2</p>
<p style="position:absolute;top:276px;left:264px;white-space:nowrap" class="ft04">VMCS Base&#160;Address [19:12]</p>
<p style="position:absolute;top:297px;left:201px;white-space:nowrap" class="ft04">3</p>
<p style="position:absolute;top:297px;left:264px;white-space:nowrap" class="ft04">VMCS Base&#160;Address [27:20]</p>
<p style="position:absolute;top:318px;left:201px;white-space:nowrap" class="ft04">4</p>
<p style="position:absolute;top:318px;left:264px;white-space:nowrap" class="ft04">VMCS Base&#160;Address [35:28]</p>
<p style="position:absolute;top:339px;left:201px;white-space:nowrap" class="ft04">5</p>
<p style="position:absolute;top:339px;left:264px;white-space:nowrap" class="ft04">VMCS Base&#160;Address [43:36]</p>
<p style="position:absolute;top:360px;left:201px;white-space:nowrap" class="ft04">6</p>
<p style="position:absolute;top:360px;left:264px;white-space:nowrap" class="ft04">VMCS Base&#160;Address [51:44]</p>
</div>
</body>
</html>
