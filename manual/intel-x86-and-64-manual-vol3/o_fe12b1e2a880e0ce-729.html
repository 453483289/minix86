<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 729</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:14px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page729-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce729.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3B&#160;18-93</p>
<p style="position:absolute;top:47px;left:672px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:99px;left:69px;white-space:nowrap" class="ft02">18.15.5.6&#160;&#160;&#160;Cascading Counters</p>
<p style="position:absolute;top:127px;left:69px;white-space:nowrap" class="ft04">As describ<a href="o_fe12b1e2a880e0ce-722.html">ed in&#160;Section&#160;18.15.2,&#160;“Performance&#160;Counters,”</a>&#160;eighteen performance&#160;counters are&#160;implemented in&#160;<br/>pairs. Nine&#160;pairs&#160;of&#160;counters and&#160;associated CCCRs are&#160;further organized as&#160;four blocks:&#160;BPU,&#160;MS, FLAME,&#160;and IQ&#160;<br/>(see&#160;Tabl<a href="o_fe12b1e2a880e0ce-718.html">e 18-63</a>). The&#160;first three&#160;blocks contain two pairs&#160;each.&#160;The IQ&#160;block contains three&#160;pairs of counters (12&#160;<br/>through&#160;17)&#160;with&#160;associated CCCRs (MSR_IQ_CCCR0&#160;through MSR_IQ_CCCR5).<br/>The first&#160;8&#160;counter pairs (0 through 15) can&#160;be programmed&#160;using ESCRs to&#160;detect performance monitoring&#160;events.&#160;<br/>Pairs of ESCRs in&#160;each of&#160;the four blocks&#160;allow&#160;many&#160;different types of&#160;events&#160;to be counted. The cascade&#160;flag in&#160;<br/>the&#160;CCCR&#160;MSR allows nested monitoring of events to&#160;be&#160;performed by cascading one counter&#160;to a second&#160;counter&#160;<br/>located&#160;in another&#160;pair in&#160;the same&#160;block (see<a href="o_fe12b1e2a880e0ce-724.html">&#160;Figure&#160;18-45</a>&#160;for the&#160;location of the&#160;flag).<br/>Counters 0 and 1 form&#160;the first pair&#160;in the BPU block. Either counter 0&#160;or 1 can&#160;be programmed&#160;to detect an event&#160;<br/>via MSR_MO B_ESCR0. Counters 0 and 2&#160;can be cascaded in any order,&#160;as can counters 1 and 3.&#160;It’s&#160;possible to set&#160;<br/>up 4&#160;counters in the&#160;same block&#160;to cascade&#160;on two pairs&#160;of&#160;independent events. The&#160;pairing described also&#160;applies&#160;<br/>to subsequent blocks.&#160;Since&#160;the IQ&#160;PUB has two extra counters,&#160;cascading&#160;operates somewhat differently&#160;if 16 and&#160;<br/>17&#160;are&#160;involved.&#160;In the&#160;IQ block,&#160;counter&#160;16&#160;can only&#160;be&#160;cascaded from&#160;counter 14 (not&#160;from 12); counter&#160;14&#160;<br/>cannot be cascaded from counter&#160;16&#160;using the CCCR cascade&#160;bit mechanism. Similar restrictions apply to counter&#160;<br/>17.</p>
<p style="position:absolute;top:414px;left:69px;white-space:nowrap" class="ft01">Example 18-1. &#160;Counting Events</p>
<p style="position:absolute;top:439px;left:69px;white-space:nowrap" class="ft04">Assume a&#160;scenario where&#160;counter X is&#160;set&#160;up to&#160;count 200 occurrences of event&#160;A;&#160;then&#160;counter Y is&#160;set up to&#160;count&#160;<br/>400&#160;occurrences&#160;of&#160;event B.&#160;Each counter&#160;is set&#160;up&#160;to count&#160;a specific event and&#160;overflow&#160;to&#160;the&#160;next counter.&#160;In&#160;<br/>the above&#160;example,&#160;counter X is preset for a count of -200&#160;and counter Y for a count of -400; this setup&#160;causes the&#160;<br/>counters&#160;to overflow on&#160;the&#160;200th&#160;and&#160;400th counts respectively.<br/>Continuing this&#160;scenario,&#160;counter X is&#160;set up&#160;to count indefinitely and wraparound&#160;on&#160;overflow. This&#160;is described in&#160;<br/>the basic performance&#160;counter setup procedure&#160;that&#160;begins&#160;<a href="o_fe12b1e2a880e0ce-725.html">in Section 18.15.5.1,&#160;“Selecting&#160;Events to&#160;Count.”&#160;<br/></a>Counter Y&#160;is set up&#160;with&#160;the cascade flag&#160;in its&#160;associated&#160;CCCR&#160;MSR set&#160;to 1 and&#160;its enable flag set&#160;to 0.<br/>To&#160;begin&#160;the nested counting, the&#160;enable bit&#160;for the&#160;counter X is&#160;set. Once&#160;enabled,&#160;counter X counts until&#160;it over-<br/>flows. At&#160;this&#160;point, counter Y&#160;is automatically enabled and begins counting. Thus&#160;counter&#160;X&#160;overflows after&#160;200&#160;<br/>occurrences of&#160;event&#160;A. Counter Y&#160;then starts, counting&#160;400 occurrences&#160;of&#160;event B before overflowing.&#160;When&#160;<br/>performance counters are cascaded, the&#160;counter Y would typically be set up&#160;to&#160;generate an&#160;interrupt on&#160;overflow.&#160;<br/>This is&#160;de<a href="o_fe12b1e2a880e0ce-731.html">scribed in Section 18.15.5.8,&#160;“Generating an&#160;Interrupt on&#160;Overflow.”&#160;<br/></a>The cascading counters&#160;mechanism can&#160;be used to count a single event. The counting&#160;begins&#160;on&#160;one counter then&#160;<br/>continues on the&#160;second&#160;counter after&#160;the&#160;first counter&#160;overflows.&#160;This&#160;technique&#160;doubles the&#160;number&#160;of event&#160;<br/>counts that&#160;can be recorded, since&#160;the&#160;contents&#160;of the&#160;two&#160;counters&#160;can&#160;be added together.</p>
</div>
</body>
</html>
