<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1688</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1688-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1688.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">36-4&#160;Vol. 3C</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">INTEL¬Æ PROCESSOR TRACE</p>
<p style="position:absolute;top:100px;left:119px;white-space:nowrap" class="ft07">as the&#160;CALL with&#160;matching&#160;stack depth), and&#160;the RET&#160;target&#160;is the&#160;instruction&#160;after that CALL, the&#160;RET&#160;<br/>target&#160;may be ‚Äúcompressed‚Äù. In&#160;this case,&#160;only a&#160;single&#160;TNT&#160;bit of&#160;‚Äútaken‚Äù&#160;is generated instead of&#160;a&#160;Target&#160;<br/>IP&#160;Packet. To&#160;ensure that&#160;the decoder&#160;will not be confused&#160;in cases of&#160;RET&#160;compression, only RETs&#160;that&#160;<br/>correspond to CALLs&#160;which&#160;have&#160;been seen&#160;since&#160;the&#160;last PSB packet may be compressed&#160;in a given logical&#160;<br/>processor.&#160;For details,&#160;see&#160;<a href="o_fe12b1e2a880e0ce-1723.html">‚ÄúIndirect&#160;Transfer&#160;Compression for Returns (RET)‚Äù in&#160;</a><a href="o_fe12b1e2a880e0ce-1722.html">Section&#160;36.4.2.2.</a></p>
<p style="position:absolute;top:211px;left:68px;white-space:nowrap" class="ft03">36.2.1.3 &#160;&#160;Far Transfer COFI</p>
<p style="position:absolute;top:238px;left:68px;white-space:nowrap" class="ft07">All operations&#160;that&#160;change&#160;the instruction pointer and&#160;are&#160;not near&#160;jumps&#160;are ‚Äúfar transfers‚Äù.&#160;This includes&#160;excep-<br/>tions, interrupts,&#160;traps, TSX aborts, and&#160;instructions that do far transfers.<br/>All&#160;far transfers&#160;will&#160;produce&#160;a Target&#160;IP (TIP) packet, which&#160;provides&#160;the destination IP address. For&#160;those far&#160;<br/>transfers&#160;that cannot be&#160;inferred from&#160;the&#160;binary source&#160;(e.g.,&#160;asynchronous events such&#160;as exceptions&#160;and inter-<br/>rupts),&#160;the TIP will&#160;be&#160;preceded by&#160;a Flow Update&#160;packet&#160;(FUP), which provides the&#160;source&#160;IP address at&#160;which&#160;the&#160;<br/>event was&#160;take<a href="o_fe12b1e2a880e0ce-1728.html">n.&#160;Table&#160;36-23&#160;indicates e</a>xactly&#160;which IP will be included&#160;in&#160;the FUP generated by a&#160;far&#160;transfer.</p>
<p style="position:absolute;top:377px;left:68px;white-space:nowrap" class="ft04">36.2.2&#160;</p>
<p style="position:absolute;top:377px;left:148px;white-space:nowrap" class="ft04">Software&#160;Trace Instrumentation with PTWRITE</p>
<p style="position:absolute;top:406px;left:68px;white-space:nowrap" class="ft07">PTWRITE&#160;provides&#160;a mechanism by which software&#160;can&#160;instrument the Intel&#160;PT&#160;trace. PTWRITE&#160;is a&#160;ring3-acces-<br/>sible&#160;instruction that&#160;can be&#160;passed&#160;a register&#160;or memory&#160;variable, se<a href="˛ˇ">e&#160;‚ÄúPTWRITE&#160;- Write&#160;Data&#160;to a&#160;Processor Trace&#160;<br/>Packet‚Äù</a>&#160;in<a href="˛ˇ">&#160;<i>Intel¬Æ 64 and&#160;IA-32 Architectures Software&#160;Developer‚Äôs Manual, Volume&#160;2B</i></a>&#160;for details. The&#160;contents of&#160;<br/>that variable will&#160;be used as the payload for the&#160;PTW pack<a href="o_fe12b1e2a880e0ce-1741.html">et (see Table&#160;36-40&#160;‚ÄúPTW&#160;Packet Definition‚Äù), inserte</a>d&#160;at&#160;<br/>the time of PTWRITE retirement,&#160;assuming&#160;PTWRITE is&#160;enabled&#160;and all&#160;other filtering&#160;conditions are&#160;met. Decode&#160;<br/>and analysis&#160;software&#160;will then&#160;be&#160;able&#160;to determine the&#160;meaning&#160;of&#160;the PTWRITE&#160;packet&#160;based on&#160;the&#160;IP of the&#160;<br/>associated PTWRITE instruction.<br/>PTWRITE is&#160;enabled&#160;via IA32_RTIT_CTL.PTWEn[12]&#160;(see&#160;<a href="o_fe12b1e2a880e0ce-1700.html">Table 36-6).</a>&#160;Optionally,&#160;the&#160;user can&#160;use&#160;<br/>IA32_RTIT_CTL.FUPonPTW[5] to&#160;enable&#160;PTW packets&#160;to be&#160;followed by FUP packets containing&#160;the IP of the&#160;asso-<br/>ciated PTWRITE instruction.</p>
<p style="position:absolute;top:611px;left:68px;white-space:nowrap" class="ft04">36.2.3&#160;</p>
<p style="position:absolute;top:611px;left:148px;white-space:nowrap" class="ft04">Power Event Tracing</p>
<p style="position:absolute;top:640px;left:68px;white-space:nowrap" class="ft07">Power&#160;Event Trace&#160;is&#160;a capability that&#160;exposes&#160;core- and thread-level&#160;sleep state&#160;and&#160;power down transition&#160;infor-<br/>mation. When&#160;this capability&#160;is enabled, the&#160;trace&#160;will&#160;expose&#160;information&#160;about:</p>
<p style="position:absolute;top:680px;left:93px;white-space:nowrap" class="ft02">‚Äî&#160;Scenarios where software&#160;execution&#160;stops.</p>
<p style="position:absolute;top:705px;left:119px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:704px;left:144px;white-space:nowrap" class="ft02">Due to&#160;sleep state entry,&#160;frequency change,&#160;or&#160;other powerdown.</p>
<p style="position:absolute;top:729px;left:119px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:728px;left:144px;white-space:nowrap" class="ft02">Includes the&#160;IP, when in&#160;the tracing context.</p>
<p style="position:absolute;top:752px;left:93px;white-space:nowrap" class="ft02">‚Äî&#160;The requested and&#160;resolved hardware thread C-state.</p>
<p style="position:absolute;top:777px;left:119px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:776px;left:144px;white-space:nowrap" class="ft02">Including&#160;indication of hardware&#160;autonomous&#160;C-state&#160;entry.</p>
<p style="position:absolute;top:800px;left:93px;white-space:nowrap" class="ft09">‚Äî&#160;The&#160;last and deepest core&#160;C-state&#160;achieved during&#160;a sleep&#160;session.<br/>‚Äî&#160;The&#160;reason&#160;for&#160;C-state wake.</p>
<p style="position:absolute;top:847px;left:68px;white-space:nowrap" class="ft08">This information is&#160;in addition to the&#160;bus ratio (CBR) information provided by default&#160;after any powerdown, and&#160;the&#160;<br/>timing information&#160;(TSC, TMA,&#160;MTC,&#160;CYC) provided during or after&#160;a powerdown state.<br/>Power&#160;Event Trace&#160;is&#160;enabled&#160;via IA32_RTIT_CTL.PwrEvtEn[4].</p>
<p style="position:absolute;top:936px;left:68px;white-space:nowrap" class="ft04">36.2.4 Trace&#160;</p>
<p style="position:absolute;top:936px;left:196px;white-space:nowrap" class="ft04">Filtering</p>
<p style="position:absolute;top:965px;left:68px;white-space:nowrap" class="ft02">Intel&#160;Processor&#160;Trace&#160;provides&#160;filtering&#160;capabilities, by which the&#160;debug/profile tool&#160;can control what code is&#160;traced.&#160;</p>
<p style="position:absolute;top:1009px;left:68px;white-space:nowrap" class="ft03">36.2.4.1 &#160;&#160;Filtering by&#160;Current Privilege Level (CPL)</p>
<p style="position:absolute;top:1036px;left:68px;white-space:nowrap" class="ft07">Intel&#160;PT&#160;provides&#160;the&#160;ability to configure&#160;a logical processor&#160;to generate&#160;trace&#160;packets only when CPL&#160;=&#160;0, when&#160;<br/>CPL&#160;&gt;&#160;0, or regardless of CPL.&#160;</p>
</div>
</body>
</html>
