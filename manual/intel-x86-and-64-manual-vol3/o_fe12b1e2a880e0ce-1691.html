<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1691</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1691-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1691.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:769px;white-space:nowrap" class="ft00">Vol. 3C&#160;36-7</p>
<p style="position:absolute;top:47px;left:685px;white-space:nowrap" class="ft01">INTELÂ®&#160;PROCESSOR TRACE</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08">response to&#160;software configurable enable&#160;controls, PacketEn&#160;is not visible to&#160;software directly.&#160;The&#160;relationship of&#160;<br/>PacketEn to the&#160;software-visible&#160;controls in&#160;the&#160;configuration MSRs&#160;is described&#160;in&#160;this&#160;section.</p>
<p style="position:absolute;top:161px;left:69px;white-space:nowrap" class="ft03">36.2.5.1 &#160;&#160;Packet&#160;Enable (PacketEn)</p>
<p style="position:absolute;top:188px;left:69px;white-space:nowrap" class="ft08">When PacketEn is set,&#160;the processor is&#160;in&#160;the&#160;mode&#160;that&#160;Intel PT&#160;is monitoring&#160;and all packets can be&#160;generated to&#160;<br/>log&#160;what is&#160;being executed. PacketEn is&#160;composed&#160;of other&#160;states according to&#160;this relationship:</p>
<p style="position:absolute;top:234px;left:95px;white-space:nowrap" class="ft02">PacketEn&#160;</p>
<p style="position:absolute;top:230px;left:167px;white-space:nowrap" class="ft02">ïƒŸ</p>
<p style="position:absolute;top:228px;left:181px;white-space:nowrap" class="ft02">&#160;TriggerEn AND ContextEn AND&#160;FilterEn AND BranchEn</p>
<p style="position:absolute;top:251px;left:69px;white-space:nowrap" class="ft08">These&#160;constituent controls are detailed in the&#160;following&#160;subsections.<br/>PacketEn ultimately determines when the&#160;processor&#160;is tracing. When&#160;PacketEn&#160;is set,&#160;all control flow packets are&#160;<br/>enabled.&#160;When PacketEn&#160;is clear,&#160;no control&#160;flow packets&#160;are generated, though other&#160;packets (timing&#160;and book-<br/>keeping packets)&#160;may&#160;still be sent. See&#160;<a href="o_fe12b1e2a880e0ce-1692.html">Section 36.2.6&#160;</a>for&#160;details&#160;of PacketEn and&#160;packet&#160;generation.<br/>Note that,&#160;on processors that do not support IP filtering&#160;(i.e.,&#160;CPUID.(EAX=14H,&#160;<br/>ECX=0):EBX.IPFILT_WRSTPRSV[bit 2]&#160;= 0), FilterEn&#160;is treated&#160;as always set.</p>
<p style="position:absolute;top:390px;left:69px;white-space:nowrap" class="ft03">36.2.5.2 &#160;&#160;Trigger Enable (TriggerEn)</p>
<p style="position:absolute;top:417px;left:69px;white-space:nowrap" class="ft08">Trigger Enable&#160;(<b>TriggerEn</b>)&#160;is&#160;the primary indicator&#160;that trace packet&#160;generation is&#160;active. TriggerEn&#160;is set when&#160;<br/>IA32_RTIT_CTL.TraceEn is&#160;set,&#160;and&#160;cleared&#160;by&#160;any of the&#160;following&#160;conditions:</p>
<p style="position:absolute;top:455px;left:69px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:456px;left:95px;white-space:nowrap" class="ft02">TraceEn is&#160;cleared&#160;by software.&#160;</p>
<p style="position:absolute;top:478px;left:69px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:478px;left:95px;white-space:nowrap" class="ft02">A&#160;TraceStop condition&#160;is encountered&#160;and&#160;IA32_RTIT_STATUS.Stopped&#160;is&#160;set.</p>
<p style="position:absolute;top:500px;left:69px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:501px;left:95px;white-space:nowrap" class="ft02">IA32_RTIT_STATUS.Error&#160;is set&#160;due&#160;to an operational&#160;<a href="o_fe12b1e2a880e0ce-1719.html">error (see Section 36.3.9).</a></p>
<p style="position:absolute;top:523px;left:69px;white-space:nowrap" class="ft08">Software&#160;can discover the&#160;current TriggerEn&#160;value&#160;by reading the&#160;IA32_RTIT_STATUS.TriggerEn bit.&#160;When Trig-<br/>gerEn&#160;is clear,&#160;tracing is&#160;inactive and&#160;no&#160;packets are&#160;generated.</p>
<p style="position:absolute;top:584px;left:69px;white-space:nowrap" class="ft03">36.2.5.3 &#160;&#160;Context Enable&#160;(ContextEn)</p>
<p style="position:absolute;top:611px;left:69px;white-space:nowrap" class="ft08">Context Enable&#160;(<b>ContextEn</b>)&#160;indicates whether the&#160;processor&#160;is in&#160;the&#160;state&#160;or mode&#160;that software&#160;configured&#160;<br/>hardware to&#160;trace. For example,&#160;if&#160;execution&#160;with&#160;CPL&#160;=&#160;0 code&#160;is not&#160;being&#160;traced&#160;(IA32_RTIT_CTL.OS&#160;=&#160;0),&#160;then&#160;<br/>ContextEn will be&#160;0&#160;when&#160;the processor is&#160;in CPL0.<br/>Software can discover the&#160;current&#160;ContextEn&#160;value by reading the IA32_RTIT_STATUS.ContextEn bit. ContextEn is&#160;<br/>defined as&#160;follows:</p>
<p style="position:absolute;top:712px;left:95px;white-space:nowrap" class="ft02">ContextEn = !((IA32_RTIT_CTL.OS&#160;= 0 AND&#160;CPL = 0)&#160;OR</p>
<p style="position:absolute;top:729px;left:95px;white-space:nowrap" class="ft02">(IA32_RTIT_CTL.USER = 0 AND&#160;CPL &gt; 0) OR (IS_IN_A_PRODUCTION_ENCLAVE</p>
<p style="position:absolute;top:725px;left:639px;white-space:nowrap" class="ft06">1</p>
<p style="position:absolute;top:729px;left:646px;white-space:nowrap" class="ft02">) OR</p>
<p style="position:absolute;top:745px;left:94px;white-space:nowrap" class="ft02">(IA32_RTIT_CTL.CR3Filter = 1 AND IA32_RTIT_CR3_MATCH does not match CR3)</p>
<p style="position:absolute;top:763px;left:69px;white-space:nowrap" class="ft09">If the&#160;clearing of&#160;ContextEn&#160;causes PacketEn&#160;to be&#160;cleared,&#160;a Packet&#160;Generation Disable&#160;(TIP.PGD) packet&#160;is gener-<br/>ated, but its&#160;IP payload is&#160;suppressed. If the&#160;setting&#160;of ContextEn&#160;causes PacketEn&#160;to be set, a&#160;Packet&#160;Generation&#160;<br/>Enable (TIP.PGE) packet&#160;is generated.<br/>When ContextEn is&#160;0,&#160;control&#160;flow packets (TNT, FUP,&#160;TIP.*,&#160;MODE.*)&#160;are not generated,&#160;and no&#160;Linear&#160;Instruction&#160;<br/>Pointers (LIPs) are&#160;exposed. However,&#160;some&#160;packets,&#160;such&#160;as MTC&#160;and PS<a href="o_fe12b1e2a880e0ce-1738.html">B (see Section 36.4.2.16 and&#160;Section&#160;<br/>36.4.2.17</a>), may&#160;still be generated while&#160;ContextEn&#160;is 0.&#160;For details of which packets&#160;are generated only when&#160;<br/>ContextEn is&#160;set,&#160;see<a href="o_fe12b1e2a880e0ce-1719.html">&#160;Section 36.4.1.<br/></a>The processor does not update&#160;ContextEn&#160;when&#160;TriggerEn = 0.<br/>The&#160;value&#160;of ContextEn will toggle only when TriggerEn&#160;=&#160;1.</p>
<p style="position:absolute;top:957px;left:69px;white-space:nowrap" class="ft03">36.2.5.4 &#160;&#160;Branch Enable (BranchEn)</p>
<p style="position:absolute;top:984px;left:69px;white-space:nowrap" class="ft08">This value&#160;is based&#160;purely on the&#160;IA32_RTIT_CTL.BranchEn&#160;value.&#160;If&#160;<b>BranchEn</b>&#160;is not set,&#160;then relevant&#160;COFI&#160;<br/>packets (TNT, TIP*, FUP,&#160;MODE.*)&#160;are suppressed.&#160;Other packets related&#160;to timing (TSC,&#160;TMA, MTC, CYC),&#160;as well&#160;</p>
<p style="position:absolute;top:1043px;left:69px;white-space:nowrap" class="ft02">1.&#160;Trace&#160;packets&#160;generation is&#160;disabled&#160;in&#160;a production enclave,<a href="o_fe12b1e2a880e0ce-1708.html">&#160;see Section 36.2.8.3. Se</a>e<a href="þÿ">&#160;<i>IntelÂ®&#160;Software&#160;Guard&#160;</i></a></p>
<p style="position:absolute;top:1055px;left:91px;white-space:nowrap" class="ft07"><a href="þÿ"><i>Extensions Programming Reference</i>&#160;about differences be</a>tween&#160;a production enclave&#160;and&#160;a debug enclave.</p>
</div>
</body>
</html>
