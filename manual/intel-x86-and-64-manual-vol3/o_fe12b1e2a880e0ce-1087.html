<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1087</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:14px;font-family:Times;color:#0860a8;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1087-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1087.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;25-13</p>
<p style="position:absolute;top:47px;left:673px;white-space:nowrap" class="ft01">VMX&#160;NON-ROOT&#160;OPERATION</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft08">No MTF VM&#160;exit&#160;occurs if&#160;the&#160;processor is in either the shutdown activity&#160;state or wait-for-SIPI activity state. If&#160;<br/>a non-maskable interrupt subsequently&#160;takes&#160;the&#160;logical&#160;processor&#160;out&#160;of&#160;the shutdown activity state without&#160;<br/>causing&#160;a VM&#160;exit,&#160;an MTF VM&#160;exit is&#160;pending after delivery&#160;of that interrupt.</p>
<p style="position:absolute;top:157px;left:69px;white-space:nowrap" class="ft08">Special treatment may&#160;apply&#160;to Intel&#160;SGX instructions or&#160;if the&#160;logical processor is&#160;in enclave mode.&#160;See<a href="o_fe12b1e2a880e0ce-1933.html">&#160;Section&#160;<br/>43.2 for details.</a></p>
<p style="position:absolute;top:224px;left:69px;white-space:nowrap" class="ft04">25.5.3&#160;</p>
<p style="position:absolute;top:224px;left:149px;white-space:nowrap" class="ft04">Translation of&#160;Guest-Physical Addresses Using EPT</p>
<p style="position:absolute;top:255px;left:69px;white-space:nowrap" class="ft09">The&#160;extended&#160;page-table&#160;mechanism (EPT)&#160;is a&#160;feature that can&#160;be&#160;used&#160;to support the&#160;virtualization of&#160;physical&#160;<br/>memory.&#160;When&#160;EPT&#160;is in use, certain physical&#160;addresses&#160;are&#160;treated as guest-physical addresses and are not used&#160;<br/>to access memory&#160;directly. Instead,&#160;guest-physical addresses are&#160;translated by traversing&#160;a set of EPT&#160;paging&#160;<br/>structures&#160;to produce physical addresses that are used&#160;to&#160;access memory.<br/>Details&#160;of&#160;the EPT mechanism are&#160;give<a href="o_fe12b1e2a880e0ce-1149.html">n in Section&#160;28.2.</a></p>
<p style="position:absolute;top:379px;left:69px;white-space:nowrap" class="ft04">25.5.4 APIC&#160;</p>
<p style="position:absolute;top:379px;left:191px;white-space:nowrap" class="ft04">Virtualization</p>
<p style="position:absolute;top:409px;left:69px;white-space:nowrap" class="ft09">APIC&#160;virtualization is&#160;a collection&#160;of features&#160;that&#160;can be&#160;used&#160;to support the&#160;virtualization of interrupts and&#160;the&#160;<br/>Advanced&#160;Programmable Interrupt Controller (APIC). When&#160;APIC virtualization is enabled, the processor&#160;emulates&#160;<br/>many&#160;accesses to&#160;the APIC,&#160;tracks the&#160;state&#160;of&#160;the virtual APIC,&#160;and delivers virtual interrupts&#160;— all&#160;in VMX&#160;non-<br/>root operation without&#160;a VM&#160;exit.<br/>Details of the&#160;APIC&#160;virtualization are&#160;given in&#160;<a href="o_fe12b1e2a880e0ce-1167.html">Chapter 29</a>.</p>
<p style="position:absolute;top:533px;left:69px;white-space:nowrap" class="ft04">25.5.5 VM&#160;Functions</p>
<p style="position:absolute;top:564px;left:69px;white-space:nowrap" class="ft08">A&#160;<b>VM&#160;function</b>&#160;is an operation provided&#160;by&#160;the processor that can&#160;be&#160;invoked&#160;from&#160;VMX&#160;non-root operation&#160;<br/>without a&#160;VM&#160;exit. VM&#160;functions&#160;are enabled&#160;and configured&#160;by&#160;the settings&#160;of&#160;different fields in&#160;the VMCS. Soft-<br/>ware in VMX non-root&#160;operation invokes a VM&#160;function with&#160;the&#160;<b>VMFUNC</b>&#160;instruction;&#160;the value of EAX selects the&#160;<br/>specific VM&#160;function being&#160;invoked.<br/><a href="o_fe12b1e2a880e0ce-1087.html">Section 25.5.5.1&#160;</a>explains how VM&#160;functions are enabled.&#160;<a href="o_fe12b1e2a880e0ce-1087.html">Section&#160;25.5.5.2 s</a>pecifies&#160;the behavior of the VMFUNC&#160;<br/>instruct<a href="o_fe12b1e2a880e0ce-1088.html">ion. Section 25.5.5.3&#160;</a>describes&#160;a specific VM&#160;function called&#160;<b>EPTP&#160;switching</b>.</p>
<p style="position:absolute;top:698px;left:69px;white-space:nowrap" class="ft06">25.5.5.1 &#160;&#160;Enabling&#160;VM&#160;Functions</p>
<p style="position:absolute;top:727px;left:69px;white-space:nowrap" class="ft08">Software enables VM&#160;functions&#160;generally&#160;by setting the&#160;“enable VM&#160;functions” VM-execution control. A specific&#160;<br/>VM&#160;function&#160;is enabled by setting&#160;the&#160;corresponding VM-function control.<br/>Suppose,&#160;for example,&#160;that&#160;software&#160;wants&#160;to enable&#160;EPTP switching (VM&#160;function&#160;0; se<a href="o_fe12b1e2a880e0ce-1062.html">e Section 24.6.14).T</a>o do&#160;<br/>so, it&#160;must set&#160;the “activate&#160;secondary controls” VM-execution&#160;control&#160;(bit&#160;31&#160;of the&#160;primary&#160;processor-based VM-<br/>execution controls),&#160;the “enable VM&#160;functions” VM-execution control (bit&#160;13&#160;of the secondary processor-based&#160;VM-<br/>execution controls)&#160;and the&#160;“EPTP&#160;switching”&#160;VM-function control (bit&#160;0 of the&#160;VM-function controls).</p>
<p style="position:absolute;top:861px;left:69px;white-space:nowrap" class="ft06">25.5.5.2 &#160;&#160;General&#160;Operation of&#160;the&#160;VMFUNC&#160;Instruction</p>
<p style="position:absolute;top:889px;left:69px;white-space:nowrap" class="ft08">The&#160;VMFUNC instruction causes&#160;an invalid-opcode&#160;exception (#UD)&#160;if&#160;the “enable VM&#160;functions” VM-execution&#160;<br/>controls&#160;is&#160;0</p>
<p style="position:absolute;top:903px;left:151px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:906px;left:157px;white-space:nowrap" class="ft03">&#160;or the&#160;value of EAX&#160;is greater than&#160;63&#160;(only&#160;VM&#160;functions 0–63&#160;can be&#160;enable).&#160;Otherwise,&#160;the&#160;</p>
<p style="position:absolute;top:922px;left:69px;white-space:nowrap" class="ft08">instruction causes a&#160;VM&#160;exit if&#160;the bit at&#160;position&#160;EAX is&#160;0&#160;in the&#160;VM-function controls&#160;(the selected VM&#160;function is&#160;<br/>not&#160;enabled).&#160;If such&#160;a VM&#160;exit occurs, the&#160;basic exit&#160;reason used is 59 (3BH),&#160;indicating “VMFUNC”, and the&#160;length&#160;<br/>of the&#160;VMFUNC&#160;instruction&#160;is saved into&#160;the VM-exit instruction-length&#160;field. If the instruction causes&#160;neither&#160;an&#160;<br/>invalid-opcode exception nor&#160;a VM&#160;exit due&#160;to a&#160;disabled&#160;VM&#160;function,&#160;it performs&#160;the functionality of the&#160;<br/>VM&#160;function specified&#160;by the&#160;value in EAX.</p>
<p style="position:absolute;top:1038px;left:69px;white-space:nowrap" class="ft03">1.&#160;“Enable&#160;VM&#160;functions”&#160;is&#160;a&#160;secondary&#160;processor-based&#160;VM-execution&#160;control.&#160;If&#160;bit&#160;31&#160;of&#160;the&#160;primary processor-based VM-execution&#160;</p>
<p style="position:absolute;top:1054px;left:91px;white-space:nowrap" class="ft03">controls&#160;is 0, VMX non-root&#160;operation functions as if the&#160;“enable VM&#160;functions” VM-execution&#160;control were&#160;0.&#160;See<a href="o_fe12b1e2a880e0ce-1055.html">&#160;Section&#160;24.6.2.</a></p>
</div>
</body>
</html>
