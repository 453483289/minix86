<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1279</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:8px;font-family:Times;color:#000000;}
	.ft06{font-size:18px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;font-family:Times;color:#000000;}
	.ft08{font-size:18px;font-family:Times;color:#0860a8;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1279-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1279.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;34-29</p>
<p style="position:absolute;top:47px;left:666px;white-space:nowrap" class="ft01">SYSTEM&#160;MANAGEMENT&#160;MODE</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft09">sary for&#160;changes&#160;that would&#160;not affect paging&#160;due&#160;to&#160;the settings of&#160;other bits (for&#160;example, changes to&#160;CR4.PSE if&#160;<br/>IA32_EFER.LMA&#160;was 1&#160;before&#160;and after&#160;the transition).</p>
<p style="position:absolute;top:161px;left:69px;white-space:nowrap" class="ft03">34.15.6.7&#160;&#160;&#160;Loading&#160;MSRs</p>
<p style="position:absolute;top:190px;left:69px;white-space:nowrap" class="ft09">The VM-exit MSR-load&#160;area is&#160;not used by SMM&#160;VM&#160;exits&#160;that activate&#160;the dual-monitor treatment.&#160;No&#160;MSRs are&#160;<br/>loaded from that area.</p>
<p style="position:absolute;top:257px;left:69px;white-space:nowrap" class="ft04">34.15.7&#160;&#160;Deactivating the Dual-Monitor Treatment</p>
<p style="position:absolute;top:287px;left:69px;white-space:nowrap" class="ft09">The&#160;SMM-transfer monitor may&#160;deactivate the&#160;dual-monitor&#160;treatment and return the&#160;processor&#160;to default treat-<br/>ment&#160;of&#160;SMIs&#160;and&#160;SMM&#160;(see<a href="o_fe12b1e2a880e0ce-1266.html">&#160;Section&#160;34.14)</a>.&#160;It&#160;does&#160;this&#160;by executing a VM&#160;entry with the ‚Äúdeactivate dual-monitor&#160;<br/>treatment‚Äù&#160;VM-entry control set to&#160;1.<br/>As note<a href="o_fe12b1e2a880e0ce-1097.html">d in Section 26.2.1.3&#160;</a><a href="o_fe12b1e2a880e0ce-1272.html">and Section&#160;34.15.4.1,</a>&#160;an&#160;attempt&#160;to deactivate&#160;the dual-monitor treatment&#160;fails in&#160;<br/>the following situations: (1)&#160;the&#160;processor is&#160;not&#160;in SMM;&#160;(2)&#160;the&#160;‚Äúentry&#160;to SMM‚Äù&#160;VM-entry&#160;control&#160;is 1;&#160;or (3)&#160;the&#160;<br/>executive-VMCS&#160;pointer does not contain&#160;the VMXON pointer (the&#160;VM&#160;entry is&#160;to VMX non-root&#160;operation).<br/>As note<a href="o_fe12b1e2a880e0ce-1274.html">d in Section 34.15.4.9</a>,&#160;VM&#160;entries&#160;that deactivate&#160;the dual-monitor treatment&#160;ignore&#160;the&#160;SMI bit&#160;in the&#160;<br/>interruptibility-state field of&#160;the guest-state area. Instead,&#160;the&#160;blocking&#160;of SMIs&#160;following such&#160;a VM&#160;entry&#160;depends&#160;<br/>on whether the&#160;logical&#160;processor&#160;is in SMX operation:</p>
<p style="position:absolute;top:431px;left:428px;white-space:nowrap" class="ft05">1</p>
<p style="position:absolute;top:456px;left:69px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:457px;left:95px;white-space:nowrap" class="ft011">If the&#160;logical&#160;processor&#160;is in&#160;SMX operation, SMIs are&#160;blocked&#160;after VM&#160;entry.&#160;SMIs&#160;may later be unblocked&#160;by&#160;<br/>the VMXOFF instruction&#160;(see<a href="o_fe12b1e2a880e0ce-1268.html">&#160;Section&#160;34.14.4</a>)&#160;or&#160;by&#160;certain leaf&#160;functions of the GETSEC&#160;instruction (see&#160;<br/><a href="˛ˇ">Chapter 6, ‚ÄúSafer&#160;Mode Extensions Reference,‚Äù&#160;in&#160;<i>Intel¬Æ 64 and&#160;IA-32 Architectures&#160;Software&#160;Developer‚Äôs&#160;<br/>Manual, Volume&#160;2D</i>).</a></p>
<p style="position:absolute;top:528px;left:69px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:529px;left:95px;white-space:nowrap" class="ft02">If&#160;the logical processor is&#160;outside&#160;SMX&#160;operation, SMIs&#160;are unblocked after&#160;VM&#160;entry.</p>
<p style="position:absolute;top:584px;left:69px;white-space:nowrap" class="ft08">34.16&#160;&#160;SMI AND PROCESSOR EXTENDED STATE MANAGEMENT</p>
<p style="position:absolute;top:620px;left:69px;white-space:nowrap" class="ft011">On&#160;processors&#160;that support processor extended&#160;states&#160;using XSAVE/XRST<a href="˛ˇ">OR (see Chapter&#160;13, ‚ÄúManaging State&#160;<br/>Using&#160;the XSAVE&#160;Feature Set‚Äù</a>&#160;of the&#160;<a href="˛ˇ"><i>Intel¬Æ&#160;64&#160;and&#160;IA-32 Architectures Software Developer‚Äôs Manual, Volume 1</i>),&#160;<br/></a>the processor does not save any XSAVE/XRSTOR related state&#160;on an SMI.&#160;It&#160;is the&#160;responsibility of&#160;the&#160;SMI handler&#160;<br/>code to properly preserve&#160;the state&#160;information (including CR4.OSXSAVE, XCR0, and possibly processor extended&#160;<br/>states using&#160;XSAVE/XRSTOR). Therefore,&#160;the SMI&#160;handler&#160;must&#160;follow the&#160;rules desc<a href="˛ˇ">ribed in&#160;Chapter 13,&#160;<br/>‚ÄúManaging&#160;State&#160;Using the&#160;XSAVE Feature Set‚Äù</a>&#160;of the&#160;<a href="˛ˇ"><i>Intel¬Æ 64&#160;and&#160;IA-32&#160;Architectures Software&#160;Developer‚Äôs&#160;<br/>Manual, Volume&#160;1</i></a>.</p>
<p style="position:absolute;top:775px;left:69px;white-space:nowrap" class="ft08">34.17&#160;&#160;MODEL-SPECIFIC SYSTEM MANAGEMENT&#160;ENHANCEMENT</p>
<p style="position:absolute;top:811px;left:69px;white-space:nowrap" class="ft09">This section describes&#160;enhancement of system&#160;management&#160;features&#160;that apply only to the&#160;4th generation&#160;Intel&#160;<br/>Core&#160;processors. These features&#160;are&#160;model-specific.&#160;BIOS and SMM&#160;handler must use&#160;CPUID&#160;to enumerate&#160;<br/>DisplayFamily_DisplayModel&#160;signature when programming with these&#160;interfaces.</p>
<p style="position:absolute;top:894px;left:69px;white-space:nowrap" class="ft04">34.17.1&#160;&#160;SMM Handler Code Access Control</p>
<p style="position:absolute;top:925px;left:69px;white-space:nowrap" class="ft09">The&#160;BIOS&#160;may choose&#160;to restrict the&#160;address&#160;ranges&#160;of code that&#160;SMM handler executes.&#160;When&#160;SMM handler code&#160;<br/>execution check is enabled, an&#160;attempt by&#160;the&#160;SMM&#160;handler to execute outside the ranges specified by SMRR&#160;(see&#160;<br/><a href="o_fe12b1e2a880e0ce-1259.html">Section&#160;34.4.2.1</a>)&#160;will cause&#160;the&#160;assertion of an&#160;unrecoverable machine&#160;check exception (MCE).&#160;</p>
<p style="position:absolute;top:1005px;left:69px;white-space:nowrap" class="ft02">1.&#160;A logical processor is&#160;in&#160;SMX operation&#160;if&#160;GETSEC[SEXIT] has not been&#160;executed&#160;since the&#160;last&#160;execution of&#160;GETSEC[SENTER].&#160;A&#160;logi-</p>
<p style="position:absolute;top:1021px;left:91px;white-space:nowrap" class="ft02">cal processor is&#160;outside&#160;SMX operation if&#160;GETSEC[SENTER] has not been&#160;executed&#160;or&#160;if&#160;GETSEC[SEXIT] was executed&#160;after the last&#160;</p>
<p style="position:absolute;top:1038px;left:91px;white-space:nowrap" class="ft02">execution of&#160;GETSEC[SENTER]. See&#160;Chapter 6,&#160;‚ÄúSafer&#160;Mode&#160;Extensions&#160;Reference,‚Äù in<a href="˛ˇ">&#160;<i>Intel¬Æ 64&#160;and IA-32 Architectures Software&#160;</i></a></p>
<p style="position:absolute;top:1054px;left:91px;white-space:nowrap" class="ft07"><a href="˛ˇ"><i>Developer‚Äôs Manual, Volume 2B</i></a>.</p>
</div>
</body>
</html>
