<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1707</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:14px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:18px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;font-family:Times;color:#000000;}
	.ft08{font-size:12px;font-family:Times;color:#0860a8;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft012{font-size:11px;line-height:20px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1707-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1707.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:761px;white-space:nowrap" class="ft00">Vol. 3C&#160;36-23</p>
<p style="position:absolute;top:47px;left:685px;white-space:nowrap" class="ft01">INTELÂ®&#160;PROCESSOR TRACE</p>
<p style="position:absolute;top:377px;left:69px;white-space:nowrap" class="ft02">36.2.8&#160;</p>
<p style="position:absolute;top:377px;left:149px;white-space:nowrap" class="ft02">Interaction of&#160;IntelÂ® Processor Trace and Other Processor Features</p>
<p style="position:absolute;top:428px;left:69px;white-space:nowrap" class="ft03">36.2.8.1 &#160;&#160;IntelÂ® Transactional Synchronization Extensions (IntelÂ® TSX)&#160;</p>
<p style="position:absolute;top:455px;left:69px;white-space:nowrap" class="ft011">The operation of Intel&#160;TSX&#160;is described&#160;in&#160;<a href="þÿ">Chapter 14 of the&#160;<i>IntelÂ®&#160;64 and IA-32 Architectures&#160;Software&#160;Devel-<br/>operâ€™s&#160;Manual, Volume&#160;1</i></a>.&#160;For&#160;tracing&#160;purpose,&#160;packet&#160;generation does&#160;not distinguish between hardware&#160;lock&#160;<br/>elision (HLE) and restricted transactional&#160;memory&#160;(RTM),&#160;but speculative execution does have impacts on the trace&#160;<br/>output.&#160;Specifically,&#160;packets are&#160;generated as&#160;instructions&#160;complete, even&#160;for&#160;instructions in a transactional&#160;region&#160;<br/>that is&#160;later aborted. For this&#160;reason,&#160;debugging&#160;software&#160;will need&#160;indication of the&#160;beginning&#160;and&#160;end of&#160;a trans-<br/>actional region; this will&#160;allow&#160;software&#160;to understand when instructions are&#160;part&#160;of&#160;a transactional region&#160;and&#160;<br/>whether that region has been&#160;committed.<br/>To&#160;enable this, TSX&#160;information&#160;is included in&#160;a&#160;MODE&#160;packet&#160;leaf.&#160;The&#160;mode&#160;bits&#160;in the&#160;leaf&#160;are:</p>
<p style="position:absolute;top:598px;left:69px;white-space:nowrap" class="ft06">â€¢</p>
<p style="position:absolute;top:599px;left:95px;white-space:nowrap" class="ft07"><b>InTX</b>:&#160;Set&#160;to 1&#160;on an TSX transaction&#160;begin,&#160;and cleared&#160;on&#160;transaction commit or&#160;abort.</p>
<p style="position:absolute;top:621px;left:69px;white-space:nowrap" class="ft06">â€¢</p>
<p style="position:absolute;top:622px;left:95px;white-space:nowrap" class="ft07"><b>TXAbort</b>:&#160;Set to 1 only when InTX transitions&#160;from&#160;1 to&#160;0 on&#160;an&#160;abort. Cleared otherwise.</p>
<p style="position:absolute;top:644px;left:69px;white-space:nowrap" class="ft010">If BranchEn=1, this MODE packet&#160;will&#160;be&#160;sent each time the&#160;transaction status&#160;changes.&#160;<a href="o_fe12b1e2a880e0ce-1707.html">See Table&#160;36-10 for&#160;<br/></a>details.</p>
<p style="position:absolute;top:971px;left:69px;white-space:nowrap" class="ft011">The&#160;CurrentIP&#160;listed&#160;above is&#160;the&#160;IP of the&#160;associated&#160;instruction. The TargetIP is&#160;the&#160;IP&#160;of the next instruction to&#160;<br/>be&#160;executed; for HLE,&#160;this is&#160;the XACQUIRE&#160;lock; for RTM, this&#160;is the&#160;fallback handler.<br/>Intel PT&#160;stores are non-transactional,&#160;and thus packet&#160;writes are&#160;not rolled back&#160;on&#160;TSX&#160;abort.</p>
<p style="position:absolute;top:148px;left:83px;white-space:nowrap" class="ft04">63:32</p>
<p style="position:absolute;top:148px;left:138px;white-space:nowrap" class="ft04">OutputOffset</p>
<p style="position:absolute;top:148px;left:233px;white-space:nowrap" class="ft04">0</p>
<p style="position:absolute;top:148px;left:299px;white-space:nowrap" class="ft012">The&#160;use of&#160;this field depends on the value&#160;of&#160;IA32_RTIT_CTL.ToPA:<br/>0:&#160;This is bits 31:0&#160;of&#160;the offset&#160;pointer into&#160;the single,&#160;contiguous physical&#160;output region.&#160;</p>
<p style="position:absolute;top:186px;left:299px;white-space:nowrap" class="ft04">This&#160;value will&#160;be&#160;added to&#160;the&#160;IA32_RTIT_OUTPUT_BASE&#160;value to&#160;form&#160;the&#160;physical address&#160;</p>
<p style="position:absolute;top:202px;left:299px;white-space:nowrap" class="ft04">at&#160;which&#160;the&#160;next&#160;byte&#160;of&#160;packet&#160;output&#160;data&#160;will&#160;be&#160;written.&#160;This&#160;value&#160;must&#160;be&#160;less&#160;than&#160;or&#160;</p>
<p style="position:absolute;top:218px;left:299px;white-space:nowrap" class="ft04">equal to&#160;the MaskOrTableOffset&#160;field,&#160;otherwise an&#160;operational error&#160;<a href="o_fe12b1e2a880e0ce-1719.html">(Section&#160;36.3.9) wi</a>ll&#160;be&#160;</p>
<p style="position:absolute;top:235px;left:299px;white-space:nowrap" class="ft012">signaled&#160;when&#160;TraceEn&#160;is set.<br/>1:&#160;This field holds bits 31:0 of&#160;the offset&#160;pointer into&#160;the current ToPA&#160;output region.&#160;This&#160;</p>
<p style="position:absolute;top:272px;left:299px;white-space:nowrap" class="ft04">value will&#160;be&#160;added&#160;to&#160;the&#160;output&#160;region&#160;base&#160;field, found in&#160;the&#160;current ToPA&#160;table&#160;entry,&#160;to&#160;</p>
<p style="position:absolute;top:289px;left:299px;white-space:nowrap" class="ft012">form&#160;the&#160;physical address at&#160;which the&#160;next&#160;byte of&#160;trace output&#160;data will&#160;be written.<br/>This value must&#160;be&#160;less than&#160;the&#160;ToPA&#160;entry size, otherwise an&#160;operational erro<a href="o_fe12b1e2a880e0ce-1719.html">r (Section&#160;</a></p>
<p style="position:absolute;top:326px;left:299px;white-space:nowrap" class="ft04"><a href="o_fe12b1e2a880e0ce-1719.html">36.3.9</a>) will&#160;be&#160;signaled&#160;when TraceEn is set.&#160;</p>
<p style="position:absolute;top:702px;left:336px;white-space:nowrap" class="ft08">Table 36-10. TSX&#160;Packet&#160;Scenarios</p>
<p style="position:absolute;top:726px;left:98px;white-space:nowrap" class="ft04">TSX Event</p>
<p style="position:absolute;top:726px;left:331px;white-space:nowrap" class="ft04">Instruction</p>
<p style="position:absolute;top:726px;left:664px;white-space:nowrap" class="ft04">Packets</p>
<p style="position:absolute;top:750px;left:78px;white-space:nowrap" class="ft04">Transaction Begin&#160;Either&#160;XBEGIN&#160;or&#160;XACQUIRE&#160;lock&#160;(the&#160;latter&#160;if&#160;executed&#160;</p>
<p style="position:absolute;top:767px;left:195px;white-space:nowrap" class="ft04">transactionally)</p>
<p style="position:absolute;top:750px;left:544px;white-space:nowrap" class="ft04">MODE(TXAbort=0, InTX=1),&#160;FUP(CurrentIP)</p>
<p style="position:absolute;top:791px;left:96px;white-space:nowrap" class="ft04">Transaction&#160;</p>
<p style="position:absolute;top:807px;left:107px;white-space:nowrap" class="ft04">Commit</p>
<p style="position:absolute;top:791px;left:195px;white-space:nowrap" class="ft04">Either&#160;XEND&#160;or&#160;XRELEASE&#160;lock,&#160;if transactional execution&#160;</p>
<p style="position:absolute;top:807px;left:195px;white-space:nowrap" class="ft04">ends.&#160;This&#160;happens only on&#160;the outermost commit</p>
<p style="position:absolute;top:791px;left:544px;white-space:nowrap" class="ft04">MODE(TXAbort=0, InTX=0),&#160;FUP(CurrentIP)</p>
<p style="position:absolute;top:831px;left:78px;white-space:nowrap" class="ft04">Transaction Abort&#160;XABORT&#160;or&#160;other transactional&#160;abort</p>
<p style="position:absolute;top:831px;left:544px;white-space:nowrap" class="ft04">MODE(TXAbort=1, InTX=0),&#160;FUP(CurrentIP),&#160;</p>
<p style="position:absolute;top:848px;left:544px;white-space:nowrap" class="ft04">TIP(TargetIP)</p>
<p style="position:absolute;top:872px;left:112px;white-space:nowrap" class="ft04">Other</p>
<p style="position:absolute;top:872px;left:195px;white-space:nowrap" class="ft04">One&#160;of&#160;the&#160;following:</p>
<p style="position:absolute;top:888px;left:195px;white-space:nowrap" class="ft04">â€¢&#160;Nested XBEGIN or XACQUIRE lock</p>
<p style="position:absolute;top:903px;left:195px;white-space:nowrap" class="ft04">â€¢&#160;An&#160;outer&#160;XACQUIRE&#160;lock&#160;that&#160;doesnâ€™t begin a&#160;transaction&#160;</p>
<p style="position:absolute;top:918px;left:210px;white-space:nowrap" class="ft04">(InTX not&#160;set)</p>
<p style="position:absolute;top:933px;left:195px;white-space:nowrap" class="ft04">â€¢&#160;Non-outermost&#160;XEND&#160;or&#160;XRELEASE lock</p>
<p style="position:absolute;top:872px;left:544px;white-space:nowrap" class="ft04">None. No&#160;change to&#160;TSX mode&#160;bits for these&#160;</p>
<p style="position:absolute;top:888px;left:544px;white-space:nowrap" class="ft04">cases.</p>
<p style="position:absolute;top:100px;left:253px;white-space:nowrap" class="ft08">Table 36-9.&#160;IA32_RTIT_OUTPUT_MASK_PTRS&#160;MSR (Contd.)</p>
<p style="position:absolute;top:124px;left:76px;white-space:nowrap" class="ft04">Position</p>
<p style="position:absolute;top:124px;left:152px;white-space:nowrap" class="ft04">Bit Name</p>
<p style="position:absolute;top:124px;left:234px;white-space:nowrap" class="ft04">At&#160;Reset</p>
<p style="position:absolute;top:124px;left:517px;white-space:nowrap" class="ft04">Bit&#160;Description</p>
</div>
</body>
</html>
