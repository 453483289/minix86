<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1805</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1805-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1805.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:767px;white-space:nowrap" class="ft00">Vol. 3D&#160;40-3</p>
<p style="position:absolute;top:47px;left:685px;white-space:nowrap" class="ft01">ENCLAVE EXITING EVENTS</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft06">tion from&#160;within the enclave. A&#160;subsequent&#160;ERESUME restores&#160;the processor state&#160;from&#160;the&#160;current SSA&#160;frame&#160;and&#160;<br/>frees&#160;the&#160;SSA&#160;frame.<br/>The&#160;format of&#160;the&#160;XSAVE section of SSA&#160;is identical&#160;to&#160;the&#160;format used by the XSAVE/XRSTOR instructions.&#160;On&#160;<br/>EENTER, CSSA&#160;must be&#160;less&#160;than&#160;NSSA, ensuring that&#160;there is&#160;at least&#160;one State Save Area slot&#160;available for exits.&#160;<br/>If there&#160;is no&#160;free&#160;SSA&#160;frame when executing EENTER,&#160;the entry&#160;will&#160;fail.</p>
<p style="position:absolute;top:228px;left:69px;white-space:nowrap" class="ft03">40.3&#160;</p>
<p style="position:absolute;top:228px;left:148px;white-space:nowrap" class="ft03">SYNTHETIC STATE ON ASYNCHRONOUS ENCLAVE EXIT</p>
<p style="position:absolute;top:290px;left:69px;white-space:nowrap" class="ft04">40.3.1&#160;</p>
<p style="position:absolute;top:290px;left:149px;white-space:nowrap" class="ft04">Processor Synthetic State on Asynchronous Enclave Exit</p>
<p style="position:absolute;top:319px;left:69px;white-space:nowrap" class="ft06"><a href="o_fe12b1e2a880e0ce-1805.html">Table 40-1 shows&#160;</a>the&#160;synthetic&#160;state loaded&#160;on AEX. The&#160;values shown are the lower 32 bits when&#160;the&#160;processor is&#160;<br/>in 32&#160;bit&#160;mode&#160;and 64&#160;bits when the&#160;processor&#160;is in&#160;64&#160;bit mode.</p>
<p style="position:absolute;top:890px;left:69px;white-space:nowrap" class="ft04">40.3.2&#160;</p>
<p style="position:absolute;top:890px;left:150px;white-space:nowrap" class="ft04">Synthetic State for Extended Features</p>
<p style="position:absolute;top:919px;left:69px;white-space:nowrap" class="ft06">When CR4.OSXSAVE = 1,&#160;extended&#160;features&#160;(those&#160;controlled by XCR0[63:2]) are set&#160;to their&#160;respective&#160;INIT&#160;<br/>states&#160;when&#160;this&#160;corresponding&#160;bit of SECS.XFRM&#160;is set.&#160;The INIT state&#160;is the state&#160;that would be loaded&#160;by&#160;the&#160;<br/>XRSTOR instruction had&#160;the instruction mask and&#160;the&#160;XSTATE_BV&#160;field of&#160;the&#160;XSAVE header&#160;each contained&#160;the&#160;<br/>value XFRM. (When&#160;the AEX&#160;occurs in 32-bit mode, those features that&#160;do not exist in 32-bit mode are unchanged.)</p>
<p style="position:absolute;top:377px;left:220px;white-space:nowrap" class="ft05">Table&#160;40-1. &#160;GPR,&#160;x87&#160;Synthetic States&#160;on&#160;Asynchronous&#160;Enclave&#160;Exit</p>
<p style="position:absolute;top:399px;left:129px;white-space:nowrap" class="ft02">Register</p>
<p style="position:absolute;top:399px;left:520px;white-space:nowrap" class="ft02">Value</p>
<p style="position:absolute;top:421px;left:74px;white-space:nowrap" class="ft02">RAX</p>
<p style="position:absolute;top:421px;left:243px;white-space:nowrap" class="ft02">3 (ENCLU[3] is ERESUME).</p>
<p style="position:absolute;top:444px;left:74px;white-space:nowrap" class="ft02">RBX</p>
<p style="position:absolute;top:444px;left:243px;white-space:nowrap" class="ft02">Pointer to&#160;TCS of&#160;interrupted enclave thread.</p>
<p style="position:absolute;top:466px;left:74px;white-space:nowrap" class="ft02">RCX</p>
<p style="position:absolute;top:466px;left:243px;white-space:nowrap" class="ft02">AEP&#160;of&#160;interrupted&#160;enclave&#160;thread.</p>
<p style="position:absolute;top:489px;left:74px;white-space:nowrap" class="ft02">RDX,&#160;RSI, RDI</p>
<p style="position:absolute;top:489px;left:243px;white-space:nowrap" class="ft02">0.</p>
<p style="position:absolute;top:511px;left:74px;white-space:nowrap" class="ft02">RSP</p>
<p style="position:absolute;top:511px;left:243px;white-space:nowrap" class="ft02">Restored&#160;from&#160;SSA.uRSP.</p>
<p style="position:absolute;top:534px;left:74px;white-space:nowrap" class="ft02">RBP</p>
<p style="position:absolute;top:534px;left:243px;white-space:nowrap" class="ft02">Restored&#160;from&#160;SSA.uRBP.</p>
<p style="position:absolute;top:556px;left:74px;white-space:nowrap" class="ft02">R8-R15</p>
<p style="position:absolute;top:556px;left:243px;white-space:nowrap" class="ft02">0 in&#160;64-bit&#160;mode; unchanged&#160;in 32-bit&#160;mode.</p>
<p style="position:absolute;top:579px;left:74px;white-space:nowrap" class="ft02">RIP</p>
<p style="position:absolute;top:579px;left:243px;white-space:nowrap" class="ft02">AEP&#160;of&#160;interrupted&#160;enclave&#160;thread.</p>
<p style="position:absolute;top:601px;left:74px;white-space:nowrap" class="ft02">RFLAGS</p>
<p style="position:absolute;top:601px;left:243px;white-space:nowrap" class="ft02">CF,&#160;PF, AF, ZF,&#160;SF, OF,&#160;RF bits are&#160;cleared.&#160;All other bits are left&#160;unchanged.</p>
<p style="position:absolute;top:624px;left:74px;white-space:nowrap" class="ft02">x87/SSE State</p>
<p style="position:absolute;top:624px;left:243px;white-space:nowrap" class="ft02">Unless otherwise&#160;listed&#160;here, all x87&#160;and SSE&#160;state are&#160;set&#160;to&#160;the&#160;INIT state.&#160;The INIT state is&#160;the&#160;state&#160;</p>
<p style="position:absolute;top:640px;left:243px;white-space:nowrap" class="ft02">that&#160;would&#160;be&#160;loaded&#160;by&#160;the&#160;XRSTOR&#160;instruction&#160;with&#160;bits 1:0&#160;both&#160;set&#160;in&#160;the&#160;requested&#160;feature bitmask&#160;</p>
<p style="position:absolute;top:657px;left:243px;white-space:nowrap" class="ft02">(RFBM), and both clear in XSTATE_BV the XSAVE header.</p>
<p style="position:absolute;top:679px;left:74px;white-space:nowrap" class="ft02">FCW</p>
<p style="position:absolute;top:679px;left:243px;white-space:nowrap" class="ft02">On #MF exception:&#160;set to 037EH.&#160;On&#160;all other exits:&#160;set to 037FH.</p>
<p style="position:absolute;top:702px;left:74px;white-space:nowrap" class="ft02">FSW</p>
<p style="position:absolute;top:702px;left:243px;white-space:nowrap" class="ft02">On&#160;#MF&#160;exception:&#160;set to&#160;8081H. On&#160;all other exits:&#160;set to&#160;0H.</p>
<p style="position:absolute;top:724px;left:74px;white-space:nowrap" class="ft02">MXCSR</p>
<p style="position:absolute;top:724px;left:243px;white-space:nowrap" class="ft02">On&#160;#XM exception: set to&#160;1F01H. On&#160;all other exits: set to&#160;1FB0H.</p>
<p style="position:absolute;top:747px;left:74px;white-space:nowrap" class="ft02">CR2</p>
<p style="position:absolute;top:747px;left:243px;white-space:nowrap" class="ft02">If the event that&#160;caused the AEX is a #PF,&#160;and the&#160;#PF does not directly cause a VM exit, then the low&#160;</p>
<p style="position:absolute;top:763px;left:243px;white-space:nowrap" class="ft02">12&#160;bits&#160;are&#160;cleared.&#160;</p>
<p style="position:absolute;top:780px;left:243px;white-space:nowrap" class="ft02">If the #PF leads directly to&#160;a VM exit, CR2 is not updated&#160;(usual IA&#160;behavior).</p>
<p style="position:absolute;top:796px;left:243px;white-space:nowrap" class="ft02">Note:&#160;The low 12 bits&#160;are&#160;not cleared if&#160;a&#160;#PF is encountered&#160;during&#160;the&#160;delivery&#160;of&#160;the&#160;EEE&#160;that&#160;caused&#160;</p>
<p style="position:absolute;top:813px;left:243px;white-space:nowrap" class="ft02">the AEX. This is because&#160;the #PF was not the EEE.&#160;</p>
<p style="position:absolute;top:835px;left:74px;white-space:nowrap" class="ft02">FS, GS</p>
<p style="position:absolute;top:835px;left:243px;white-space:nowrap" class="ft02">Restored to&#160;values as of&#160;most&#160;recent&#160;EENTER/ERESUME.</p>
</div>
</body>
</html>
