<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 393</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:14px;font-family:Times;color:#0860a8;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:8px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page393-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce393.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:760px;white-space:nowrap" class="ft00">Vol. 3A&#160;10-31</p>
<p style="position:absolute;top:47px;left:484px;white-space:nowrap" class="ft01">ADVANCED PROGRAMMABLE&#160;INTERRUPT CONTROLLER&#160;(APIC)</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08">Bit&#160;12&#160;of&#160;the Spurious Interrupt&#160;Vector&#160;Register&#160;is reserved&#160;to&#160;0 if the&#160;processor&#160;does&#160;not support suppression of&#160;<br/>EOI broadcasts. Support&#160;for&#160;EOI-broadcast suppression is reported in&#160;bit 24&#160;in&#160;the&#160;Local APIC Version Register&#160;(see&#160;<br/><a href="o_fe12b1e2a880e0ce-373.html">Section&#160;10.4.8); the</a>&#160;feature&#160;is supported&#160;if&#160;that bit is&#160;set to&#160;1. When&#160;supported,&#160;the&#160;feature&#160;is available&#160;in both&#160;<br/>xAPIC mode&#160;and&#160;x2APIC&#160;mode.<br/>System&#160;software desiring&#160;to&#160;perform&#160;directed EOIs for level-triggered interrupts&#160;should set bit 12 of&#160;the&#160;Spurious&#160;<br/>Interrupt Vector&#160;Register&#160;and follow each&#160;the EOI to&#160;the local&#160;xAPIC for&#160;a&#160;level triggered interrupt with&#160;a directed&#160;<br/>EOI&#160;to the&#160;I/O APIC generating&#160;the interrupt (this is&#160;done&#160;by writing to&#160;the&#160;I/O&#160;APIC’s&#160;EOI&#160;register).&#160;System soft-<br/>ware&#160;performing&#160;directed&#160;EOIs&#160;must retain&#160;a mapping associating level-triggered interrupts with the&#160;I/O APICs in&#160;<br/>the system.</p>
<p style="position:absolute;top:290px;left:69px;white-space:nowrap" class="ft03">10.8.6&#160;</p>
<p style="position:absolute;top:290px;left:149px;white-space:nowrap" class="ft03">Task Priority in IA-32e Mode</p>
<p style="position:absolute;top:321px;left:69px;white-space:nowrap" class="ft08">In IA-32e&#160;mode,&#160;operating systems can&#160;manage the&#160;16&#160;interrupt-priority&#160;classes&#160;(see<a href="o_fe12b1e2a880e0ce-390.html">&#160;Section 10.8.3, “Interrupt,&#160;<br/>Task, and&#160;Processor&#160;Priority”) e</a>xplicitly using the&#160;task priority&#160;register (TPR). Operating systems&#160;can use&#160;the TPR&#160;<br/>to&#160;temporarily block&#160;specific (low-priority) interrupts from&#160;interrupting a high-priority task. This is&#160;done by loading&#160;<br/>TPR with&#160;a&#160;value in&#160;which the&#160;task-priority&#160;class&#160;corresponds&#160;to the&#160;highest interrupt-priority class&#160;that is&#160;to be&#160;<br/>blocked. For example:&#160;</p>
<p style="position:absolute;top:409px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:409px;left:95px;white-space:nowrap" class="ft08">Loading the&#160;TPR&#160;with a task-priority class&#160;of&#160;8 (01000B) blocks&#160;all interrupts&#160;with an interrupt-priority class of&#160;<br/>8&#160;or less while allowing all interrupts&#160;with&#160;an interrupt-priority class of&#160;9&#160;or more&#160;to be recognized.</p>
<p style="position:absolute;top:448px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:448px;left:95px;white-space:nowrap" class="ft02">Loading the TPR with a&#160;task-priority&#160;class of 0&#160;enables all external&#160;interrupts.&#160;</p>
<p style="position:absolute;top:470px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:471px;left:95px;white-space:nowrap" class="ft02">Loading the&#160;TPR with a&#160;task-priority&#160;class of&#160;0FH&#160;(01111B) disables&#160;all&#160;external interrupts.&#160;</p>
<p style="position:absolute;top:495px;left:69px;white-space:nowrap" class="ft08">The TPR (shown&#160;<a href="o_fe12b1e2a880e0ce-390.html">in Figure&#160;10-18) is&#160;</a>cleared to 0 on reset. In&#160;64-bit mode, software&#160;can read and&#160;write the&#160;TPR&#160;<br/>using&#160;an alternate interface, MOV CR8&#160;instruction. The&#160;new task-priority class&#160;is&#160;established when the&#160;MOV&#160;CR8&#160;<br/>instruction&#160;completes&#160;execution. Software&#160;does&#160;not need&#160;to&#160;force&#160;serialization&#160;after loading the&#160;TPR&#160;using MOV&#160;<br/>CR8.&#160;<br/>Use&#160;of the&#160;MOV CRn&#160;instruction&#160;requires&#160;a&#160;privilege&#160;level of&#160;0. Programs running&#160;at&#160;privilege level&#160;greater than&#160;0&#160;<br/>cannot read or&#160;write the&#160;TPR. An attempt&#160;to&#160;do so&#160;causes&#160;a general-protection exception.&#160;The&#160;TPR&#160;is&#160;abstracted&#160;<br/>from&#160;the interrupt&#160;controller (IC), which prioritizes and&#160;manages external&#160;interrupt&#160;delivery to&#160;the processor.&#160;The&#160;<br/>IC can&#160;be&#160;an external&#160;device, such as&#160;an&#160;APIC or&#160;8259.&#160;Typically,&#160;the&#160;IC provides&#160;a&#160;priority&#160;mechanism similar&#160;or&#160;<br/>identical&#160;to the TPR. The IC, however,&#160;is considered implementation-dependent with the under-lying&#160;priority mech-<br/>anisms&#160;subject to&#160;change. CR8, by contrast, is&#160;part&#160;of&#160;the Intel 64&#160;architecture.&#160;Software can&#160;depend on&#160;this defi-<br/>nition&#160;remaining&#160;unchanged.&#160;<br/><a href="o_fe12b1e2a880e0ce-393.html">Figure&#160;10-22&#160;</a>shows the&#160;layout of&#160;CR8;&#160;only&#160;the low four&#160;bits are&#160;used.&#160;The&#160;remaining&#160;60&#160;bits&#160;are reserved&#160;and&#160;<br/>must be written&#160;with zeros. Failure&#160;to do&#160;this causes a&#160;general-protection exception.</p>
<p style="position:absolute;top:891px;left:69px;white-space:nowrap" class="ft05">10.8.6.1 &#160;&#160;Interaction of&#160;Task&#160;Priorities between CR8 and APIC</p>
<p style="position:absolute;top:919px;left:69px;white-space:nowrap" class="ft09">The first implementation&#160;of Intel&#160;64&#160;architecture&#160;includes&#160;a local&#160;advanced&#160;programmable interrupt controller&#160;<br/>(APIC) that&#160;is similar&#160;to&#160;the APIC used with previous&#160;IA-32&#160;processors. Some&#160;aspects of the&#160;local APIC affect&#160;the&#160;<br/>operation of&#160;the architecturally&#160;defined task&#160;priority register&#160;and&#160;the programming interface using&#160;CR8.<br/>Notable CR8&#160;and APIC interactions are:</p>
<p style="position:absolute;top:998px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:999px;left:95px;white-space:nowrap" class="ft02">The&#160;processor&#160;powers up&#160;with&#160;the local APIC&#160;enabled.</p>
<p style="position:absolute;top:1021px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:1021px;left:95px;white-space:nowrap" class="ft08">The&#160;APIC&#160;must&#160;be&#160;enabled&#160;for CR8&#160;to function&#160;as&#160;the&#160;TPR.&#160;Writes to CR8&#160;are&#160;reflected into the APIC Task Priority&#160;<br/>Register.</p>
<p style="position:absolute;top:847px;left:360px;white-space:nowrap" class="ft06">Figure&#160;10-22. &#160;CR8&#160;Register</p>
<p style="position:absolute;top:765px;left:250px;white-space:nowrap" class="ft07">63</p>
<p style="position:absolute;top:765px;left:649px;white-space:nowrap" class="ft07">0</p>
<p style="position:absolute;top:818px;left:251px;white-space:nowrap" class="ft00">Value after reset: 0H</p>
<p style="position:absolute;top:766px;left:618px;white-space:nowrap" class="ft07">3</p>
<p style="position:absolute;top:766px;left:606px;white-space:nowrap" class="ft07">4</p>
<p style="position:absolute;top:789px;left:391px;white-space:nowrap" class="ft07">Reserved</p>
</div>
</body>
</html>
