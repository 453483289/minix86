<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1045</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:14px;font-family:Times;color:#0860a8;}
	.ft08{font-size:8px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1045-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1045.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:769px;white-space:nowrap" class="ft00">Vol. 3C&#160;23-3</p>
<p style="position:absolute;top:47px;left:541px;white-space:nowrap" class="ft01">INTRODUCTION TO&#160;VIRTUAL MACHINE&#160;EXTENSIONS</p>
<p style="position:absolute;top:97px;left:69px;white-space:nowrap" class="ft02">23.7&#160;</p>
<p style="position:absolute;top:97px;left:148px;white-space:nowrap" class="ft02">ENABLING AND ENTERING VMX OPERATION</p>
<p style="position:absolute;top:133px;left:69px;white-space:nowrap" class="ft09">Before&#160;system&#160;software&#160;can&#160;enter&#160;VMX&#160;operation,&#160;it&#160;enables VMX by setting&#160;CR4.VMXE[bit&#160;13]&#160;=&#160;1.&#160;VMX&#160;operation&#160;<br/>is then entered by executing the VMXON instruction. VMXON causes&#160;an&#160;invalid-opcode exception (#UD) if executed&#160;<br/>with CR4.VMXE&#160;=&#160;0.&#160;Once in&#160;VMX&#160;operation, it&#160;is not possible&#160;to clear CR4.VM<a href="o_fe12b1e2a880e0ce-1045.html">XE (see Section 23.8).</a>&#160;System&#160;soft-<br/>ware leaves&#160;VMX operation by executing the VMXOFF instruction.&#160;CR4.VMXE can&#160;be cleared&#160;outside of VMX&#160;opera-<br/>tion after&#160;executing of&#160;VMXOFF.<br/>VMXON is&#160;also controlled by the&#160;IA32_FEATURE_CONTROL MSR (MSR address&#160;3AH). This&#160;MSR&#160;is&#160;cleared to zero&#160;<br/>when&#160;a logical processor is&#160;reset. The&#160;relevant&#160;bits of&#160;the&#160;MSR are:</p>
<p style="position:absolute;top:262px;left:69px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:262px;left:95px;white-space:nowrap" class="ft09"><b>Bit&#160;0&#160;is the lock&#160;bit.</b>&#160;If this&#160;bit is&#160;clear,&#160;VMXON causes&#160;a general-protection exception. If the&#160;lock bit&#160;is set,&#160;<br/>WRMSR&#160;to this MSR causes a general-protection exception; the MSR cannot be modified&#160;until a power-up reset&#160;<br/>condition. System&#160;BIOS can&#160;use this bit to&#160;provide&#160;a setup option&#160;for&#160;BIOS&#160;to&#160;disable support for VMX.&#160;To&#160;<br/>enable VMX support in a&#160;platform,&#160;BIOS&#160;must&#160;set&#160;bit&#160;1, bit&#160;2, or&#160;both (see below), as&#160;well as&#160;the lock&#160;bit.</p>
<p style="position:absolute;top:334px;left:69px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:334px;left:95px;white-space:nowrap" class="ft011"><b>Bit&#160;1&#160;enables VMXON in&#160;SMX operation.</b>&#160;If&#160;this bit is&#160;clear,&#160;execution of VMXON in&#160;SMX operation causes&#160;a&#160;<br/>general-protection exception.&#160;Attempts&#160;to set&#160;this bit on logical processors that&#160;do not&#160;support both VMX&#160;<br/>operation&#160;(see<a href="o_fe12b1e2a880e0ce-1044.html">&#160;Section&#160;23.6)&#160;</a>and&#160;SMX operation (see&#160;<a href="˛ˇ">Chapter 6, ‚ÄúSafer Mode Extensions Reference,‚Äù&#160;in&#160;<i>Intel¬Æ&#160;<br/>64&#160;and IA-32&#160;Architectures&#160;Software Developer‚Äôs Manual, Volume&#160;2D</i>) cause gener</a>al-protection&#160;exceptions.</p>
<p style="position:absolute;top:406px;left:69px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:406px;left:95px;white-space:nowrap" class="ft09"><b>Bit&#160;2&#160;enables VMXON outside&#160;SMX&#160;operation.</b>&#160;If&#160;this&#160;bit&#160;is clear,&#160;execution&#160;of VMXON outside&#160;SMX&#160;<br/>operation causes&#160;a general-protection exception. Attempts to set this&#160;bit on&#160;logical&#160;processors&#160;that&#160;do&#160;not&#160;<br/>support VMX&#160;operation&#160;(see<a href="o_fe12b1e2a880e0ce-1044.html">&#160;Section 23.6)&#160;</a>cause general-protection exceptions.</p>
<p style="position:absolute;top:474px;left:433px;white-space:nowrap" class="ft07">NOTE</p>
<p style="position:absolute;top:499px;left:122px;white-space:nowrap" class="ft011">A&#160;logical&#160;processor&#160;is&#160;in&#160;SMX operation if GETSEC[SEXIT]&#160;has&#160;not&#160;been executed&#160;since the&#160;last&#160;<br/>execution of GETSEC[SENTER]. A logical processor&#160;is outside&#160;SMX&#160;operation if GETSEC[SENTER]&#160;<br/>has&#160;not been&#160;executed&#160;or if GETSEC[SEXIT]&#160;was executed&#160;after the&#160;last execution&#160;of&#160;<br/>GETSEC[SENTER]. See&#160;<a href="˛ˇ">Chapter 6, ‚ÄúSafer Mode Extensions Reference,‚Äù&#160;</a>in&#160;<a href="˛ˇ"><i>Intel¬Æ 64&#160;and IA-32&#160;<br/>Architectures&#160;Software Developer‚Äôs Manual, Volume&#160;2D</i></a>.</p>
<p style="position:absolute;top:610px;left:69px;white-space:nowrap" class="ft09">Before&#160;executing VMXON,&#160;software&#160;should&#160;allocate a&#160;naturally&#160;aligned&#160;4-KByte region of&#160;memory&#160;that a&#160;logical&#160;<br/>processor may use&#160;to support VMX&#160;operation.</p>
<p style="position:absolute;top:624px;left:371px;white-space:nowrap" class="ft08">1</p>
<p style="position:absolute;top:627px;left:378px;white-space:nowrap" class="ft03">&#160;This region is&#160;called the&#160;<b>VMXON region</b>. The address of the&#160;VMXON&#160;</p>
<p style="position:absolute;top:643px;left:69px;white-space:nowrap" class="ft09">region&#160;(the&#160;VMXON pointer) is&#160;provided&#160;in an operand&#160;to VM<a href="o_fe12b1e2a880e0ce-1073.html">XON.&#160;Section&#160;24.11.5,&#160;‚ÄúVMXON&#160;Region,‚Äù</a>&#160;details how&#160;<br/>software should&#160;initialize and&#160;access&#160;the VMXON region.</p>
<p style="position:absolute;top:715px;left:69px;white-space:nowrap" class="ft02">23.8&#160;</p>
<p style="position:absolute;top:715px;left:148px;white-space:nowrap" class="ft02">RESTRICTIONS ON VMX OPERATION</p>
<p style="position:absolute;top:751px;left:69px;white-space:nowrap" class="ft03">VMX operation places restrictions on&#160;processor operation.&#160;These are&#160;detailed&#160;below:</p>
<p style="position:absolute;top:773px;left:69px;white-space:nowrap" class="ft04">‚Ä¢</p>
<p style="position:absolute;top:774px;left:95px;white-space:nowrap" class="ft09">In VMX operation,&#160;processors&#160;may&#160;fix&#160;certain bits in CR0&#160;and CR4&#160;to specific values&#160;and&#160;not support other&#160;<br/>values.&#160;VMXON&#160;fails if any of these bits contains&#160;an&#160;unsupported value&#160;(see<a href="o_fe12b1e2a880e0ce-1207.html">&#160;‚ÄúVMXON‚ÄîEnter VMX Operation‚Äù in&#160;<br/></a><a href="˛ˇ">Chapter 30).&#160;</a>Any&#160;attempt to&#160;set&#160;one of these bits&#160;to&#160;an&#160;unsupported&#160;value&#160;while&#160;in VMX&#160;operation (including&#160;<br/>VMX&#160;root operation) using&#160;any of the CLTS,&#160;LMSW,&#160;or MOV CR instructions&#160;causes a&#160;general-protection&#160;<br/>exception.&#160;VM&#160;entry or&#160;VM&#160;exit cannot&#160;set any&#160;of these&#160;bits&#160;to an unsupported&#160;value. Software should&#160;consult&#160;<br/>the VMX capability MSRs&#160;IA32_VMX_CR0_FIXED0&#160;and&#160;IA32_VMX_CR0_FIXED1&#160;to&#160;determine&#160;how bits in&#160;CR0&#160;<br/>are fixed (see Appendix&#160;A.7). For&#160;CR4,&#160;software&#160;should&#160;consult the&#160;VMX&#160;capability MSRs&#160;<br/>IA32_VMX_CR4_FIXED0&#160;and&#160;IA32_VMX_CR4_FIXED1 (see&#160;Appendix A.8).</p>
<p style="position:absolute;top:924px;left:428px;white-space:nowrap" class="ft07">NOTES</p>
<p style="position:absolute;top:949px;left:122px;white-space:nowrap" class="ft09">The&#160;first processors to support VMX operation require&#160;that&#160;the&#160;following bits be 1 in VMX operation:&#160;<br/>CR0.PE, CR0.NE, CR0.PG, and&#160;CR4.VMXE. The restrictions on CR0.PE and&#160;CR0.PG&#160;imply&#160;that&#160;VMX&#160;<br/>operation is&#160;supported&#160;only in paged protected&#160;mode&#160;(including&#160;IA-32e&#160;mode).&#160;Therefore,&#160;guest&#160;<br/>software cannot be run in&#160;unpaged&#160;protected&#160;mode or&#160;in real-address mode.&#160;S<a href="o_fe12b1e2a880e0ce-1211.html">ee Section 31.2,</a>&#160;</p>
<p style="position:absolute;top:1038px;left:69px;white-space:nowrap" class="ft03">1.&#160;Future&#160;processors&#160;may require&#160;that&#160;a&#160;different&#160;amount&#160;of&#160;memory&#160;be reserved. If so, this fact is&#160;reported to&#160;software&#160;using the&#160;</p>
<p style="position:absolute;top:1054px;left:91px;white-space:nowrap" class="ft03">VMX capability-reporting&#160;mechanism.</p>
</div>
</body>
</html>
