<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 302</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:18px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page302-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce302.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">8-46&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">MULTIPLE-PROCESSOR&#160;MANAGEMENT</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft08">The&#160;algorithm shown&#160;above&#160;can be adapted to&#160;work with earlier generations of single-core&#160;IA-32&#160;processors&#160;that&#160;<br/>support&#160;Intel Hyper-Threading&#160;Technology&#160;and&#160;in situations&#160;that&#160;the deterministic cache parameter&#160;leaf&#160;is&#160;not&#160;<br/>supported&#160;(provided&#160;CPUID supports initial&#160;APIC ID).&#160;A&#160;reference&#160;code&#160;example&#160;is available&#160;(see<a href="˛ˇ">&#160;<i>Intel¬Æ 64 Archi-<br/>tecture Processor Topology&#160;Enumeration</i></a>).</p>
<p style="position:absolute;top:205px;left:68px;white-space:nowrap" class="ft04">8.10 MANAGEMENT&#160;</p>
<p style="position:absolute;top:205px;left:288px;white-space:nowrap" class="ft04">OF&#160;</p>
<p style="position:absolute;top:205px;left:319px;white-space:nowrap" class="ft04">IDLE&#160;AND BLOCKED CONDITIONS</p>
<p style="position:absolute;top:241px;left:68px;white-space:nowrap" class="ft07">When a&#160;logical&#160;processor&#160;in an MP system&#160;(including multi-core&#160;processor&#160;or processors supporting&#160;Intel&#160;Hyper-<br/>Threading&#160;Technology) is&#160;idle (no work&#160;to do) or&#160;blocked&#160;(on&#160;a lock&#160;or&#160;semaphore), additional management of the&#160;<br/>core&#160;execution engine&#160;resource&#160;can be accomplished by&#160;using the&#160;HLT&#160;(halt),&#160;PAUSE, or the&#160;MONITOR/MWAIT&#160;<br/>instructions.</p>
<p style="position:absolute;top:341px;left:68px;white-space:nowrap" class="ft05">8.10.1 HLT&#160;</p>
<p style="position:absolute;top:341px;left:183px;white-space:nowrap" class="ft05">Instruction</p>
<p style="position:absolute;top:372px;left:68px;white-space:nowrap" class="ft07">The HLT instruction&#160;stops the&#160;execution&#160;of&#160;the logical&#160;processor on&#160;which it&#160;is executed&#160;and places&#160;it in a&#160;halted&#160;<br/>state until further&#160;notice (see the&#160;description&#160;of&#160;the&#160;HLT instruction in&#160;<a href="o_fe12b1e2a880e0ce-89.html">Chapter 3&#160;</a>of the&#160;<a href="˛ˇ"><i>Intel¬Æ 64&#160;and&#160;IA-32&#160;Archi-<br/>tectures&#160;Software Developer‚Äôs Manual, Volume&#160;2A</i></a>).&#160;When&#160;a logical processor is&#160;halted, active&#160;logical&#160;processors&#160;<br/>continue&#160;to have&#160;full access to the&#160;shared&#160;resources within&#160;the physical package. Here shared resources&#160;that were&#160;<br/>being used by the halted&#160;logical&#160;processor become available to active&#160;logical processors, allowing them to execute&#160;<br/>at greater&#160;efficiency.&#160;When&#160;the halted&#160;logical processor resumes&#160;execution, shared resources&#160;are&#160;again shared&#160;<br/>among&#160;all active&#160;logical processors.&#160;(S<a href="o_fe12b1e2a880e0ce-306.html">ee Section 8.10.6.3,&#160;‚ÄúHalt Idle Logical&#160;Processors,‚Äù</a>&#160;for&#160;more&#160;information&#160;<br/>about&#160;using the HLT instruction with processors&#160;supporting Intel&#160;Hyper-Threading&#160;Technology.)</p>
<p style="position:absolute;top:538px;left:68px;white-space:nowrap" class="ft05">8.10.2 PAUSE&#160;</p>
<p style="position:absolute;top:538px;left:206px;white-space:nowrap" class="ft05">Instruction</p>
<p style="position:absolute;top:568px;left:68px;white-space:nowrap" class="ft07">The PAUSE&#160;instruction&#160;can improves the&#160;performance of&#160;processors supporting&#160;Intel&#160;Hyper-Threading Technology&#160;<br/>when executing&#160;‚Äúspin-wait loops‚Äù&#160;and other routines where one thread is accessing a shared lock&#160;or semaphore&#160;in&#160;<br/>a tight&#160;polling loop.&#160;When&#160;executing&#160;a spin-wait loop, the&#160;processor can suffer&#160;a severe performance penalty when&#160;<br/>exiting the loop&#160;because it detects a&#160;possible memory order&#160;violation&#160;and&#160;flushes the core processor‚Äôs&#160;pipeline. The&#160;<br/>PAUSE&#160;instruction&#160;provides&#160;a hint to&#160;the&#160;processor that the&#160;code&#160;sequence is&#160;a spin-wait&#160;loop. The processor uses&#160;<br/>this hint&#160;to avoid the memory order violation and prevent&#160;the pipeline flush.&#160;In addition,&#160;the&#160;PAUSE instruction de-<br/>pipelines&#160;the spin-wait loop to prevent&#160;it from consuming execution&#160;resources&#160;excessively and consume&#160;power&#160;<br/>needlessly.&#160;(See<a href="o_fe12b1e2a880e0ce-305.html">&#160;Section 8.10.6.1,&#160;‚ÄúUse the&#160;PAUSE&#160;Instruction&#160;in Spin-Wait Loops,‚Äù for more&#160;</a>information about&#160;<br/>using&#160;the PAUSE instruction with IA-32&#160;processors&#160;supporting&#160;Intel Hyper-Threading&#160;Technology.)</p>
<p style="position:absolute;top:751px;left:68px;white-space:nowrap" class="ft05">8.10.3&#160;</p>
<p style="position:absolute;top:751px;left:148px;white-space:nowrap" class="ft05">Detecting Support MONITOR/MWAIT Instruction</p>
<p style="position:absolute;top:781px;left:68px;white-space:nowrap" class="ft07">Streaming SIMD&#160;Extensions&#160;3 introduced&#160;two instructions&#160;(MONITOR and&#160;MWAIT)&#160;to help multithreaded software&#160;<br/>improve thread synchronization.&#160;In the&#160;initial implementation, MONITOR&#160;and&#160;MWAIT&#160;are available to&#160;software&#160;at&#160;<br/>ring&#160;0.&#160;The instructions are&#160;conditionally available&#160;at levels greater&#160;than&#160;0. Use the following&#160;steps to detect&#160;the&#160;<br/>availability of MONITOR&#160;and&#160;MWAIT:</p>
<p style="position:absolute;top:853px;left:68px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:853px;left:93px;white-space:nowrap" class="ft02">Use CPUID&#160;to query&#160;the MONITOR&#160;bit (CPUID.1.ECX[3]&#160;=&#160;1).</p>
<p style="position:absolute;top:875px;left:68px;white-space:nowrap" class="ft06">‚Ä¢</p>
<p style="position:absolute;top:876px;left:93px;white-space:nowrap" class="ft07">If CPUID indicates support,&#160;execute&#160;MONITOR&#160;inside&#160;a TRY/EXCEPT exception&#160;handler and trap for an&#160;<br/>exception. If an&#160;exception occurs,&#160;MONITOR and&#160;MWAIT are not supported&#160;at a&#160;privilege level&#160;greater than 0.&#160;<br/>S<a href="o_fe12b1e2a880e0ce-303.html">ee Example 8-23.</a></p>
</div>
</body>
</html>
