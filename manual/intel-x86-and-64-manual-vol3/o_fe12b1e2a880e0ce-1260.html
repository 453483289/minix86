<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1260</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#0860a8;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1260-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce1260.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">34-10&#160;Vol. 3C</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">SYSTEM&#160;MANAGEMENT&#160;MODE</p>
<p style="position:absolute;top:278px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:279px;left:93px;white-space:nowrap" class="ft07">Near&#160;jumps&#160;and&#160;calls&#160;can&#160;be&#160;made&#160;to&#160;anywhere&#160;in&#160;the&#160;4-GByte address&#160;space if a 32-bit operand-size&#160;override&#160;<br/>prefix&#160;is used. Due to the real-address-mode style of&#160;base-address&#160;formation, a far&#160;call&#160;or jump&#160;cannot transfer&#160;<br/>control to&#160;a segment with a&#160;base&#160;address of more&#160;than&#160;20&#160;bits&#160;(1 MByte).&#160;However,&#160;since&#160;the&#160;segment limit in&#160;<br/>SMM is&#160;4 GBytes, offsets&#160;into&#160;a segment that&#160;go beyond&#160;the 1-MByte limit are&#160;allowed when using&#160;32-bit&#160;<br/>operand-size override prefixes.&#160;Any&#160;program control transfer that&#160;does not have&#160;a 32-bit&#160;operand-size override&#160;<br/>prefix&#160;truncates&#160;the EIP&#160;value to&#160;the 16 low-order&#160;bits.</p>
<p style="position:absolute;top:383px;left:68px;white-space:nowrap" class="ft02">‚Ä¢</p>
<p style="position:absolute;top:384px;left:93px;white-space:nowrap" class="ft07">Data and the stack can be located anywhere in the 4-GByte&#160;address&#160;space, but can&#160;be accessed only&#160;with&#160;a 32-<br/>bit address-size&#160;override&#160;if they&#160;are located above&#160;1 MByte. As with the&#160;code&#160;segment, the&#160;base&#160;address&#160;for&#160;a&#160;<br/>data or stack&#160;segment&#160;cannot&#160;be&#160;more than 20 bits.</p>
<p style="position:absolute;top:441px;left:68px;white-space:nowrap" class="ft07">The value in segment register CS is automatically&#160;set to&#160;the default of 30000H for the SMBASE shifted 4 bits&#160;to the&#160;<br/>right;&#160;that is, 3000H.&#160;The&#160;EIP register&#160;is set to 8000H.&#160;When&#160;the&#160;EIP value is&#160;added&#160;to shifted&#160;CS value&#160;(the&#160;<br/>SMBASE),&#160;the resulting linear&#160;address points&#160;to the&#160;first instruction of&#160;the&#160;SMI&#160;handler.<br/>The other segment&#160;registers (DS,&#160;SS,&#160;ES,&#160;FS, and GS) are cleared&#160;to&#160;0&#160;and&#160;their segment limits are set&#160;to 4&#160;GBytes.&#160;<br/>In&#160;this state, the SMRAM address&#160;space&#160;may be&#160;treated&#160;as&#160;a single flat&#160;4-GByte linear&#160;address space.&#160;If a&#160;segment&#160;<br/>register is&#160;loaded with a 16-bit&#160;value,&#160;that value is&#160;then&#160;shifted left&#160;by&#160;4 bits and&#160;loaded into&#160;the segment base&#160;<br/>(hidden&#160;part&#160;of&#160;the segment register).&#160;The&#160;limits&#160;and&#160;attributes&#160;are&#160;not modified.<br/>Maskable hardware&#160;interrupts, exceptions, NMI&#160;interrupts,&#160;SMI interrupts, A20M interrupts, single-step&#160;traps,&#160;<br/>breakpoint traps, and INIT operations&#160;are&#160;inhibited when&#160;the processor enters&#160;SMM.&#160;Maskable hardware interrupts,&#160;<br/>exceptions, single-step&#160;traps,&#160;and breakpoint traps can be&#160;enabled&#160;in SMM&#160;if&#160;the SMM&#160;execution environment&#160;<br/>provides&#160;and initializes an interrupt table and&#160;the necessary interrupt&#160;and exception&#160;hand<a href="o_fe12b1e2a880e0ce-1260.html">lers (see Section 34.6).</a></p>
<p style="position:absolute;top:671px;left:68px;white-space:nowrap" class="ft04">34.5.2&#160;</p>
<p style="position:absolute;top:671px;left:148px;white-space:nowrap" class="ft04">SMI Handler Operating Mode Switching</p>
<p style="position:absolute;top:702px;left:68px;white-space:nowrap" class="ft07">Within&#160;SMM,&#160;an SMI&#160;handler may change the&#160;processor's operating&#160;mode&#160;(e.g.,&#160;to&#160;enable&#160;PAE paging,&#160;enter 64-bit&#160;<br/>mode,&#160;etc.)&#160;after it&#160;has made proper preparation&#160;and initialization to do so.&#160;For example,&#160;if switching to&#160;32-bit&#160;<br/>protected mode, the SMI handler should&#160;follow&#160;the guidelines provided&#160;<a href="˛ˇ">in Chapter&#160;9, ‚ÄúProcessor&#160;Management&#160;and&#160;<br/>Initialization‚Äù. If the</a>&#160;SMI handler does&#160;wish&#160;to change&#160;operating mode, it&#160;is responsible&#160;for executing&#160;the&#160;appro-<br/>priate&#160;mode-transition code after&#160;each SMI.<br/>It is&#160;recommended that&#160;the&#160;SMI handler make&#160;use of&#160;all means&#160;available to&#160;protect&#160;the integrity of its critical&#160;code&#160;<br/>and data. In particular, it should use&#160;the system-management&#160;range&#160;register&#160;(SMRR) interface if it is&#160;available (see&#160;<br/>Section&#160;11.11.2.4).&#160;The&#160;SMRR&#160;interface&#160;can protect only&#160;the&#160;first 4 GBytes&#160;of the physical address space.&#160;The SMI&#160;<br/>handler should take that fact into account if it uses operating&#160;modes that allow access to physical addresses&#160;beyond&#160;<br/>that 4-GByte&#160;limit (e.g. PAE&#160;paging&#160;or 64-bit&#160;mode).<br/>Execution of the&#160;RSM instruction restores the&#160;pre-SMI processor state from&#160;the SMRAM&#160;state-state&#160;map (see&#160;<br/><a href="o_fe12b1e2a880e0ce-1254.html">Section&#160;34.4.1) into which&#160;</a>it was stored&#160;when the processor entered SMM.&#160;(The&#160;SMBASE field&#160;in the&#160;SMRAM state-<br/>save&#160;map does&#160;not determine&#160;the&#160;state following RSM&#160;but rather&#160;the&#160;initial environment following the next entry to&#160;<br/>SMM.) Any required&#160;change&#160;to&#160;operating mode is&#160;performed&#160;by the&#160;RSM&#160;instruction; there&#160;is&#160;no&#160;need&#160;for the&#160;SMI&#160;<br/>handler to&#160;change modes explicitly prior&#160;to executing RSM.</p>
<p style="position:absolute;top:1003px;left:68px;white-space:nowrap" class="ft05">34.6&#160;</p>
<p style="position:absolute;top:1003px;left:147px;white-space:nowrap" class="ft05">EXCEPTIONS AND&#160;INTERRUPTS WITHIN SMM</p>
<p style="position:absolute;top:1039px;left:68px;white-space:nowrap" class="ft03">When&#160;the processor enters SMM, all&#160;hardware&#160;interrupts&#160;are disabled in the&#160;following&#160;manner:</p>
<p style="position:absolute;top:128px;left:75px;white-space:nowrap" class="ft03">DS, ES,&#160;FS, GS,&#160;SS Bases</p>
<p style="position:absolute;top:128px;left:374px;white-space:nowrap" class="ft03">000000000H</p>
<p style="position:absolute;top:152px;left:75px;white-space:nowrap" class="ft03">DS, ES,&#160;FS, GS,&#160;SS Limits</p>
<p style="position:absolute;top:152px;left:375px;white-space:nowrap" class="ft03">0FFFFFFFFH</p>
<p style="position:absolute;top:176px;left:75px;white-space:nowrap" class="ft03">CR0</p>
<p style="position:absolute;top:176px;left:374px;white-space:nowrap" class="ft03">PE, EM, TS,&#160;and PG&#160;flags set&#160;to 0; others&#160;unmodified</p>
<p style="position:absolute;top:200px;left:75px;white-space:nowrap" class="ft03">CR4</p>
<p style="position:absolute;top:200px;left:374px;white-space:nowrap" class="ft03">Cleared&#160;to&#160;zero</p>
<p style="position:absolute;top:224px;left:75px;white-space:nowrap" class="ft03">DR6</p>
<p style="position:absolute;top:224px;left:374px;white-space:nowrap" class="ft03">Undefined</p>
<p style="position:absolute;top:248px;left:75px;white-space:nowrap" class="ft03">DR7</p>
<p style="position:absolute;top:248px;left:374px;white-space:nowrap" class="ft03">00000400H</p>
<p style="position:absolute;top:100px;left:277px;white-space:nowrap" class="ft06">Table&#160;34-4.&#160;&#160;Processor&#160;Register Initialization&#160;in SMM</p>
</div>
</body>
</html>
