<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 464</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page464-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce464.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">13-10&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">SYSTEM PROGRAMMING&#160;FOR INSTRUCTION SET EXTENSIONS&#160;AND PROCESSOR&#160;EXTENDED STATES</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft06">For&#160;instance,&#160;the OS can&#160;supply instructions in&#160;the&#160;XSAVE feature set&#160;with&#160;a bit vector in EDX:EAX&#160;with the two&#160;<br/>least&#160;significant bits&#160;(corresponding&#160;to x87&#160;FPU and SSE state) equal to&#160;0.&#160;Then,&#160;the&#160;XSAVE instruction will&#160;not&#160;<br/>write&#160;the processorâ€™s x87 FPU and SSE state&#160;into&#160;memory. Similarly,&#160;the XRSTOR instruction executed&#160;with a value&#160;<br/>in&#160;EDX:EAX&#160;with&#160;the least two significant&#160;bit equal to&#160;0&#160;will not restore nor initialize&#160;the&#160;processorâ€™s x87&#160;FPU and&#160;<br/>SSE&#160;state.<br/>The&#160;processorâ€™s action as&#160;a result of executing XRSTOR&#160;is given in&#160;<a href="þÿ">Section&#160;13.8 of&#160;</a>the<a href="þÿ">&#160;<i>IntelÂ® 64 and&#160;IA-32 Archi-<br/>tectures&#160;Software Developerâ€™s Manual, Volume&#160;1</i></a>. The&#160;instruction may&#160;be&#160;used&#160;to&#160;initialize&#160;x87 FPU&#160;or XMM&#160;regis-<br/>ters. When the MXCSR register is updated&#160;from memory, reserved&#160;bit checking&#160;is enforced.&#160;The&#160;saving/restoring&#160;of&#160;<br/>MXCSR&#160;is bound&#160;to the&#160;SSE state,&#160;independent of the x87&#160;FPU state.&#160;The action&#160;of&#160;XSAVE is&#160;give<a href="þÿ">n in Section 13.7&#160;<br/>of the&#160;<i>IntelÂ® 64&#160;and&#160;IA-32&#160;Architectures Software&#160;Developerâ€™s&#160;Manual,&#160;Volume 1</i>.</a></p>
<p style="position:absolute;top:312px;left:68px;white-space:nowrap" class="ft04">13.7&#160;</p>
<p style="position:absolute;top:312px;left:147px;white-space:nowrap" class="ft04">THE XSAVE FEATURE SET AND PROCESSOR SUPERVISOR STATE&#160;</p>
<p style="position:absolute;top:337px;left:146px;white-space:nowrap" class="ft04">MANAGEMENT&#160;</p>
<p style="position:absolute;top:373px;left:68px;white-space:nowrap" class="ft06">Supervisor state is&#160;a processor state&#160;that is&#160;only&#160;accessible in&#160;ring 0.&#160;An&#160;extension&#160;to XSAVE&#160;feature&#160;set, enumer-<br/>ated by&#160;CPUID.(EAX=0DH, ECX=1).EAX[bit 3]&#160;allows the&#160;management of the&#160;supervisor&#160;states using XSAVE&#160;<br/>feature&#160;set. See&#160;<a href="þÿ">Chapter 13 of&#160;<i>IntelÂ®&#160;64&#160;and IA-32&#160;Architectures&#160;Software Developerâ€™s Manual, Volume 1</i>&#160;for the&#160;<br/></a>details of the&#160;supervisor state&#160;XSAVE feature&#160;set&#160;extension. The supervisor&#160;state extension&#160;includes&#160;the following:</p>
<p style="position:absolute;top:445px;left:68px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:445px;left:93px;white-space:nowrap" class="ft06">CPUID enhancements to enumerate the set of supervisor&#160;states and their sizes that can be managed by XSAVE&#160;<br/>feature set.&#160;</p>
<p style="position:absolute;top:484px;left:68px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:484px;left:93px;white-space:nowrap" class="ft02">A&#160;new MSR IA32_XSS&#160;to&#160;enable&#160;XSAVE feature&#160;set to&#160;manage&#160;one&#160;or more&#160;enumerated&#160;supervisor&#160;states.&#160;</p>
<p style="position:absolute;top:506px;left:68px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:507px;left:93px;white-space:nowrap" class="ft06">A new pair of privileged&#160;save/restore instructions,&#160;XSAVES&#160;and XRSTORS,&#160;to save/restore&#160;supervisor states&#160;<br/>along&#160;with&#160;other XSAVE managed feature&#160;states.</p>
<p style="position:absolute;top:547px;left:68px;white-space:nowrap" class="ft06">The guidelines&#160;to enable XSAVE&#160;feature set&#160;to manage&#160;supervisor&#160;state are very&#160;similar to&#160;the steps outlines&#160;in&#160;<br/>Section 13.6 with the differences outline below.&#160;The&#160;set of&#160;supervisor states that can be&#160;managed by XSAVE feature&#160;<br/>set is&#160;enumerated&#160;in&#160;(EAX=0DH,&#160;ECX=1).EDX:ECX.&#160;XSAVE&#160;managed&#160;supervisor states&#160;are&#160;enabled in&#160;IA32_XSS&#160;<br/>MSR instead of XCR0&#160;control&#160;register. There are&#160;semantic&#160;differences between user&#160;states&#160;enabled in XCR0&#160;and&#160;<br/>supervisor state&#160;enabled&#160;in IA32_XSS&#160;MSR.&#160;A&#160;supervisor state&#160;enabled in&#160;IA32_XSS&#160;MSR:</p>
<p style="position:absolute;top:635px;left:68px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:636px;left:93px;white-space:nowrap" class="ft06">May be accessed via other mechanisms such as RDMSR/WRMSR even&#160;when they&#160;are&#160;not enabled in IA32_XSS&#160;<br/>MSR. Enabling&#160;a supervisor&#160;state in&#160;the IA32_XSS&#160;MSR merely&#160;indicates that&#160;the state can&#160;be&#160;saved/restored&#160;<br/>using XSAVES/XRSTORS instructions.&#160;</p>
<p style="position:absolute;top:691px;left:68px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:691px;left:93px;white-space:nowrap" class="ft06">May have&#160;side effects&#160;when&#160;saving/restoring the&#160;state&#160;such as disabling/enabling&#160;feature&#160;associated&#160;with the&#160;<br/>state.&#160;This behavior&#160;is feature&#160;specific&#160;and will be documented&#160;along with the&#160;feature&#160;description.&#160;</p>
<p style="position:absolute;top:730px;left:68px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:730px;left:93px;white-space:nowrap" class="ft06">May generate&#160;faults when saving/restoring&#160;the state.&#160;XSAVES/XRSTORS will follow&#160;the&#160;faulting behavior&#160;of&#160;<br/>RDMSR/WRMSR respectively if the&#160;corresponding&#160;state is&#160;also&#160;accessible using&#160;RDMSR/WRMSR.&#160;</p>
<p style="position:absolute;top:769px;left:68px;white-space:nowrap" class="ft05">â€¢</p>
<p style="position:absolute;top:769px;left:93px;white-space:nowrap" class="ft06">XRSTORS&#160;may fault when restoring the&#160;state for&#160;supervisor features&#160;that are&#160;already&#160;enabled via feature&#160;<br/>specific mechanisms.&#160;This behavior&#160;is feature&#160;specific and will be documented along&#160;with&#160;the feature&#160;<br/>description.</p>
<p style="position:absolute;top:826px;left:68px;white-space:nowrap" class="ft06">When a&#160;supervisor&#160;state&#160;is disabled via a&#160;feature&#160;specific&#160;mechanism,&#160;the state does not&#160;automatically&#160;get&#160;marked&#160;<br/>as INIT.&#160;Hence&#160;XSAVES/XRSTORS will continue to&#160;save/restore&#160;the&#160;state&#160;subject to available optimizations.&#160;If the&#160;<br/>software does not&#160;intend to&#160;preserve&#160;the state when it&#160;disables&#160;the&#160;feature,&#160;it should&#160;initialize it&#160;to hardware&#160;INIT&#160;<br/>value&#160;with XRSTORS&#160;instruction&#160;so that&#160;XSAVES/XRSTORS&#160;perform optimally for that&#160;state.</p>
<p style="position:absolute;top:931px;left:68px;white-space:nowrap" class="ft04">13.8&#160;</p>
<p style="position:absolute;top:931px;left:147px;white-space:nowrap" class="ft04">SYSTEM PROGRAMMING FOR XSAVE MANAGED FEATURES</p>
<p style="position:absolute;top:967px;left:68px;white-space:nowrap" class="ft06">This section describes&#160;system programming&#160;requirement for each&#160;XSAVE managed&#160;features&#160;that are&#160;feature&#160;<br/>specific such&#160;as exception handling.</p>
</div>
</body>
</html>
