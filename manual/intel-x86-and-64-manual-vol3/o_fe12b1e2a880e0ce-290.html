<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 290</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft09{font-size:9px;line-height:19px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page290-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce290.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">8-34&#160;Vol. 3A</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">MULTIPLE-PROCESSOR&#160;MANAGEMENT</p>
<p style="position:absolute;top:315px;left:68px;white-space:nowrap" class="ft07">If&#160;the processor supports CPUID&#160;leaf 0BH,&#160;the 32-bit&#160;APIC&#160;ID can represent&#160;cluster plus several&#160;levels of topology&#160;<br/>within&#160;the physical processor package.&#160;The&#160;exact&#160;number&#160;of&#160;hierarchical levels&#160;within&#160;a physical processor&#160;package&#160;<br/>must&#160;be&#160;enumerated&#160;through CPUID leaf&#160;0BH. Common processor families&#160;may employ&#160;topology similar&#160;to that&#160;<br/>represented by 8-bit Initial&#160;APIC ID.&#160;In general,&#160;CPUID&#160;leaf 0BH can support&#160;topology enumeration algorithm&#160;that&#160;<br/>decompose&#160;a 32-bit&#160;APIC ID into&#160;more than four sub-<a href="o_fe12b1e2a880e0ce-290.html">fields (see Figure&#160;8-6</a>).&#160;<br/>The&#160;width&#160;of&#160;each sub-field&#160;depends on&#160;hardware&#160;and&#160;software&#160;configurations.&#160;Field&#160;widths&#160;can&#160;be&#160;determined&#160;at&#160;<br/>runtime&#160;using&#160;the&#160;algorithm discussed&#160;belo<a href="o_fe12b1e2a880e0ce-291.html">w (Example&#160;8-16&#160;through Examp</a><a href="o_fe12b1e2a880e0ce-296.html">le 8-20).</a>&#160;<br/>Figure 7-6&#160;depicts the relationships of&#160;three&#160;of the hierarchical sub-fields in a&#160;hypothetical MP system. The value&#160;of&#160;<br/>valid&#160;APIC_IDs&#160;need&#160;not be contiguous&#160;across&#160;package boundary&#160;or&#160;core boundaries.</p>
<p style="position:absolute;top:735px;left:68px;white-space:nowrap" class="ft03">8.9.2&#160;</p>
<p style="position:absolute;top:735px;left:148px;white-space:nowrap" class="ft03">Hierarchical Mapping of&#160;CPUID Extended Topology Leaf&#160;</p>
<p style="position:absolute;top:765px;left:68px;white-space:nowrap" class="ft07">CPUID&#160;leaf 0BH provides&#160;enumeration&#160;parameters for software to&#160;identify each hierarchy of&#160;the&#160;processor topology&#160;<br/>in&#160;a deterministic&#160;manner.&#160;Each hierarchical level&#160;of the&#160;topology&#160;starting from the SMT&#160;level is&#160;represented numer-<br/>ically by a&#160;sub-leaf index&#160;within the&#160;CPUID 0BH leaf. Each level&#160;of&#160;the topology&#160;is mapped&#160;to a sub-field in&#160;the&#160;APIC&#160;<br/>ID, following the&#160;general relationship depict<a href="o_fe12b1e2a880e0ce-290.html">ed in Figure&#160;8-6</a>.&#160;This mechanism allows&#160;software&#160;to query&#160;the&#160;exact&#160;<br/>number of levels&#160;within a&#160;physical processor package and the bit-width of each sub-field&#160;of x2APIC&#160;ID&#160;directly.&#160;For&#160;<br/>example,</p>
<p style="position:absolute;top:869px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:870px;left:93px;white-space:nowrap" class="ft07">Starting from sub-leaf&#160;index 0 and&#160;incrementing ECX until&#160;CPUID.(EAX=0BH, ECX=N):ECX[15:8] returns&#160;an&#160;<br/>invalid “level type” encoding.&#160;The number&#160;of levels within&#160;the physical processor package is&#160;“N”&#160;(excluding&#160;<br/>PACKAGE). Using&#160;<a href="o_fe12b1e2a880e0ce-290.html">Figure&#160;8-6</a>&#160;as&#160;an example,&#160;CPUID.(EAX=0BH, ECX=3):ECX[15:8] will&#160;report&#160;00H, indicating&#160;<br/>sub leaf&#160;03H is&#160;invalid. This is&#160;also&#160;depicted by a&#160;pseudo&#160;code&#160;example:</p>
<p style="position:absolute;top:269px;left:240px;white-space:nowrap" class="ft05">Figure&#160;8-5. &#160;Generalized Four&#160;level&#160;Interpretation of&#160;the APIC ID</p>
<p style="position:absolute;top:691px;left:201px;white-space:nowrap" class="ft05">Figure&#160;8-6.&#160;&#160;Conceptual&#160;Five-level&#160;Topology&#160;and&#160;32-bit&#160;APIC&#160;ID&#160;Composition</p>
<p style="position:absolute;top:129px;left:593px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:202px;left:349px;white-space:nowrap" class="ft00">Package&#160;ID</p>
<p style="position:absolute;top:238px;left:349px;white-space:nowrap" class="ft00">SMT ID</p>
<p style="position:absolute;top:129px;left:358px;white-space:nowrap" class="ft06">X</p>
<p style="position:absolute;top:184px;left:349px;white-space:nowrap" class="ft00">Cluster ID</p>
<p style="position:absolute;top:150px;left:361px;white-space:nowrap" class="ft00">Reserved</p>
<p style="position:absolute;top:220px;left:349px;white-space:nowrap" class="ft00">Core&#160;ID</p>
<p style="position:absolute;top:132px;left:200px;white-space:nowrap" class="ft09">X=31 if x2APIC is supported<br/>Otherwise X=&#160;7</p>
<p style="position:absolute;top:516px;left:682px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:589px;left:438px;white-space:nowrap" class="ft00">Package&#160;ID</p>
<p style="position:absolute;top:625px;left:437px;white-space:nowrap" class="ft00">R ID</p>
<p style="position:absolute;top:516px;left:447px;white-space:nowrap" class="ft06">31</p>
<p style="position:absolute;top:571px;left:438px;white-space:nowrap" class="ft00">Cluster ID</p>
<p style="position:absolute;top:537px;left:449px;white-space:nowrap" class="ft00">Reserved</p>
<p style="position:absolute;top:607px;left:438px;white-space:nowrap" class="ft00">Q ID</p>
<p style="position:absolute;top:641px;left:437px;white-space:nowrap" class="ft00">SMT&#160;ID</p>
<p style="position:absolute;top:569px;left:323px;white-space:nowrap" class="ft00">R</p>
<p style="position:absolute;top:573px;left:283px;white-space:nowrap" class="ft00">SMT</p>
<p style="position:absolute;top:613px;left:302px;white-space:nowrap" class="ft00">Q</p>
<p style="position:absolute;top:528px;left:288px;white-space:nowrap" class="ft00">Package</p>
<p style="position:absolute;top:659px;left:260px;white-space:nowrap" class="ft00">Physical Processor Topology</p>
<p style="position:absolute;top:660px;left:556px;white-space:nowrap" class="ft00">32-bit APIC ID Composition</p>
</div>
</body>
</html>
