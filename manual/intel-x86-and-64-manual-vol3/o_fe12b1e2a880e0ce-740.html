<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 740</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:16px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page740-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_fe12b1e2a880e0ce740.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">18-104&#160;Vol. 3B</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PERFORMANCE MONITORING</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft07">The first two methods&#160;use&#160;performance counters&#160;and can&#160;be&#160;set up&#160;to cause an&#160;interrupt upon&#160;overflow&#160;(for&#160;<br/>sampling).&#160;They&#160;may also&#160;be&#160;useful where&#160;it is&#160;easier&#160;for&#160;a tool&#160;to read a&#160;performance counter than&#160;to use&#160;a time&#160;<br/>stamp counter&#160;(the timestamp counter is&#160;accessed&#160;using the&#160;RDTSC instruction).&#160;<br/>For applications&#160;with a&#160;significant amount&#160;of I/O,&#160;there&#160;are two ratios of&#160;interest:</p>
<p style="position:absolute;top:179px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:180px;left:93px;white-space:nowrap" class="ft06"><b>Non-halted CPI</b>&#160;<b>—&#160;</b>Non-halted&#160;clockticks/instructions&#160;retired&#160;measures&#160;the CPI&#160;for&#160;phases&#160;where&#160;the CPU was&#160;<br/>being&#160;used. This&#160;ratio&#160;can be&#160;measured&#160;on&#160;a logical-processor basis when&#160;Intel Hyper-Threading&#160;Technology&#160;is&#160;<br/>enabled.</p>
<p style="position:absolute;top:235px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:235px;left:93px;white-space:nowrap" class="ft06"><b>Nominal CPI</b>&#160;<b>—&#160;</b>Time-stamp counter ticks/instructions retired measures&#160;the CPI&#160;over&#160;the duration of a&#160;<br/>program,&#160;including those&#160;periods when the&#160;machine&#160;halts&#160;while&#160;waiting for&#160;I/O.</p>
<p style="position:absolute;top:302px;left:68px;white-space:nowrap" class="ft05">18.17.1 Non-Halted&#160;</p>
<p style="position:absolute;top:302px;left:245px;white-space:nowrap" class="ft05">Clockticks</p>
<p style="position:absolute;top:333px;left:68px;white-space:nowrap" class="ft07">Use&#160;the&#160;following&#160;procedure to program ESCRs&#160;and CCCRs to&#160;obtain&#160;non-halted clockticks on&#160;processors based&#160;on&#160;<br/>Intel NetBurst microarchitecture:&#160;<br/>1.&#160;Select&#160;an ESCR for the&#160;global_power_events and&#160;specify&#160;the&#160;RUNNING&#160;sub-event mask and&#160;the&#160;desired&#160;</p>
<p style="position:absolute;top:390px;left:93px;white-space:nowrap" class="ft02">T0_OS/T0_USR/T1_OS/T1_USR&#160;bits&#160;for the&#160;targeted&#160;processor.</p>
<p style="position:absolute;top:414px;left:68px;white-space:nowrap" class="ft07">2.&#160;Select an&#160;appropriate counter.<br/>3.&#160;Enable&#160;counting in the CCCR for that&#160;counter by setting&#160;the&#160;enable&#160;bit.</p>
<p style="position:absolute;top:488px;left:68px;white-space:nowrap" class="ft05">18.17.2 Non-Sleep&#160;</p>
<p style="position:absolute;top:488px;left:236px;white-space:nowrap" class="ft05">Clockticks</p>
<p style="position:absolute;top:519px;left:68px;white-space:nowrap" class="ft07">Performance monitoring counters&#160;can be configured&#160;to&#160;count clockticks whenever the&#160;performance monitoring&#160;<br/>hardware&#160;is not&#160;powered-down.&#160;To&#160;count Non-sleep&#160;Clockticks with a&#160;performance-monitoring&#160;counter,&#160;do the&#160;<br/>following:<br/>1.&#160;Select one&#160;of&#160;the 18 counters.<br/>2.&#160;Select&#160;any of the&#160;ESCRs whose events&#160;the&#160;selected&#160;counter can&#160;count. Set its&#160;event select to&#160;anything&#160;other&#160;</p>
<p style="position:absolute;top:616px;left:93px;white-space:nowrap" class="ft02">than no_event. This&#160;may not&#160;seem necessary,&#160;but the&#160;counter may&#160;be&#160;disabled&#160;if this is&#160;not done.</p>
<p style="position:absolute;top:640px;left:68px;white-space:nowrap" class="ft07">3.&#160;Turn&#160;threshold&#160;comparison&#160;on in the CCCR by setting the&#160;compare&#160;bit&#160;to 1.<br/>4.&#160;Set the threshold&#160;to 15 and&#160;the complement&#160;to 1 in the&#160;CCCR.&#160;Since&#160;no event can&#160;exceed&#160;this&#160;threshold,&#160;the&#160;</p>
<p style="position:absolute;top:681px;left:93px;white-space:nowrap" class="ft06">threshold&#160;condition is&#160;met every cycle&#160;and the&#160;counter counts every cycle.&#160;Note&#160;that&#160;this overrides&#160;any qualifi-<br/>cation (e.g. by CPL) specified&#160;in&#160;the&#160;ESCR.</p>
<p style="position:absolute;top:721px;left:68px;white-space:nowrap" class="ft06">5.&#160;Enable&#160;counting in the CCCR for the&#160;counter by setting the&#160;enable bit.<br/>In most cases,&#160;the&#160;counts&#160;produced by the&#160;non-halted&#160;and&#160;non-sleep&#160;metrics&#160;are equivalent if the physical package&#160;<br/>supports&#160;one logical processor and&#160;is not&#160;placed in a&#160;power-saving state. Operating&#160;systems may&#160;execute&#160;an HLT&#160;<br/>instruction&#160;and place&#160;a physical processor in a&#160;power-saving&#160;state.<br/>On processors that support Intel&#160;Hyper-Threading&#160;Technology&#160;(Intel HT&#160;Technology),&#160;each&#160;physical package can&#160;<br/>support&#160;two&#160;or more&#160;logical&#160;processors. Current implementation of Intel&#160;HT Technology provides&#160;two logical proces-<br/>sors for each physical processor.&#160;While both&#160;logical processors can execute two&#160;threads simultaneously, one&#160;logical&#160;<br/>processor&#160;may&#160;halt&#160;to allow the&#160;other logical processor to&#160;execute&#160;without sharing&#160;execution resources between&#160;<br/>two logical processors.&#160;<br/>Non-halted&#160;Clockticks can be set up&#160;to count the number&#160;of&#160;processor&#160;clock&#160;cycles&#160;for each&#160;logical processor when-<br/>ever&#160;the&#160;logical&#160;processor&#160;is not halted&#160;(the&#160;count may&#160;include&#160;some&#160;portion of&#160;the&#160;clock cycles&#160;for&#160;that logical&#160;<br/>processor&#160;to complete a&#160;transition to&#160;a halted state).&#160;Physical processors that support Intel&#160;HT Technology&#160;enter&#160;<br/>into a&#160;power-saving state&#160;if all&#160;logical&#160;processors&#160;halt.<br/>The&#160;Non-sleep&#160;Clockticks mechanism uses&#160;a&#160;filtering mechanism in&#160;CCCRs.&#160;The mechanism will continue&#160;to incre-<br/>ment as&#160;long&#160;as one logical&#160;processor is not halted or&#160;in&#160;a power-saving state. Applications may cause a&#160;processor&#160;<br/>to enter into a&#160;power-saving&#160;state by&#160;using an OS service&#160;that&#160;transfers control&#160;to an OS’s&#160;idle&#160;loop. The idle loop&#160;<br/>then may place the&#160;processor&#160;into&#160;a power-saving&#160;state after an&#160;implementation-dependent&#160;period if there is&#160;no&#160;<br/>work for the processor.</p>
</div>
</body>
</html>
