<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 424</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#0860a8;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page424-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a424.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">D-2&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">GUIDELINES&#160;FOR WRITING X87 FPU EXCEPTION HANDLERS</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft05">The&#160;Intel 286 processor created the&#160;“native mode”&#160;for&#160;handling&#160;floating-point exceptions&#160;by&#160;providing a&#160;dedicated&#160;<br/>input pin (ERROR#)&#160;for receiving floating-point exception signals and a dedicated interrupt vector,&#160;16.&#160;Interrupt 16&#160;<br/>was&#160;used&#160;to&#160;signal&#160;floating-point&#160;errors&#160;(also&#160;called&#160;math&#160;faults). It was intended that&#160;the&#160;ERROR# pin on the Intel&#160;<br/>286&#160;be&#160;connected to&#160;a corresponding ERROR# pin&#160;on the Intel&#160;287 numeric coprocessor.&#160;When&#160;the&#160;Intel 287&#160;<br/>signals a&#160;floating-point exception&#160;using this mechanism,&#160;the Intel&#160;286 generates&#160;an interrupt&#160;16, to&#160;invoke the&#160;<br/>floating-point exception&#160;handler.&#160;<br/>To&#160;maintain compatibility with existing&#160;PC software, the native floating-point&#160;exception&#160;handling mode&#160;of the&#160;Intel&#160;<br/>286&#160;and 287&#160;was not used in&#160;the IBM&#160;PC AT&#160;system&#160;design.&#160;Instead,&#160;the&#160;ERROR# pin&#160;on&#160;the Intel 286 was&#160;tied&#160;<br/>permanently high,&#160;and&#160;the&#160;ERROR# pin from&#160;the Intel&#160;287&#160;was routed to a&#160;second&#160;(cascaded) PIC. The&#160;resulting&#160;<br/>output of this&#160;PIC was&#160;routed through&#160;an&#160;exception handler and&#160;eventually caused an&#160;interrupt 2 (NMI interrupt).&#160;<br/>Here the&#160;NMI&#160;interrupt was&#160;shared&#160;with IBM PC AT’s&#160;new&#160;parity&#160;checking feature. Interrupt&#160;16&#160;remained assigned&#160;<br/>to the BIOS video interrupt&#160;handler.&#160;The external&#160;hardware for the&#160;MS-DOS&#160;compatibility&#160;mode must&#160;prevent the&#160;<br/>Intel 286&#160;processor from executing past the&#160;next x87 FPU instruction when an unmasked exception has been gener-<br/>ated. To&#160;do this,&#160;it&#160;asserts&#160;the BUSY#&#160;signal into&#160;the Intel&#160;286&#160;when&#160;the&#160;ERROR# signal&#160;is asserted by&#160;the Intel 287.<br/>The Intel386&#160;processor&#160;and its companion Intel&#160;387&#160;numeric&#160;coprocessor provided&#160;the&#160;same hardware&#160;mechanism&#160;<br/>for signaling and&#160;handling&#160;floating-point exceptions&#160;as&#160;the&#160;Intel&#160;286&#160;and&#160;287&#160;processors. And again, to&#160;maintain&#160;<br/>compatibility&#160;with&#160;existing MS-DOS software, basically&#160;the&#160;same MS-DOS&#160;compatibility floating-point&#160;exception&#160;<br/>handling mechanism that was&#160;used&#160;in the&#160;IBM PC&#160;AT&#160;was used in PCs&#160;based on the&#160;Intel386&#160;processor.</p>
<p style="position:absolute;top:451px;left:68px;white-space:nowrap" class="ft03">D.2&#160;</p>
<p style="position:absolute;top:451px;left:147px;white-space:nowrap" class="ft03">IMPLEMENTATION OF&#160;THE MS-DOS* COMPATIBILITY SUB-MODE IN THE&#160;</p>
<p style="position:absolute;top:477px;left:146px;white-space:nowrap" class="ft03">INTEL486™, PENTIUM®, AND P6 PROCESSOR FAMILY, AND PENTIUM®&#160;4&#160;</p>
<p style="position:absolute;top:502px;left:146px;white-space:nowrap" class="ft03">PROCESSORS</p>
<p style="position:absolute;top:538px;left:68px;white-space:nowrap" class="ft05">Beginning with&#160;the&#160;Intel486™ processor,&#160;the IA-32 architecture provided&#160;a dedicated mechanism for enabling the&#160;<br/>MS-DOS compatibility mode for x87&#160;FPU exceptions&#160;and&#160;for generating&#160;external x87&#160;FPU-exception signals while&#160;<br/>operating in&#160;this&#160;mode. The&#160;following sections&#160;describe&#160;the&#160;implementation&#160;of&#160;the MS-DOS&#160;compatibility mode&#160;in&#160;<br/>the Intel486&#160;and&#160;Pentium processors and&#160;in the&#160;P6&#160;family&#160;and&#160;Pentium&#160;4&#160;processors. Also described is&#160;the recom-<br/>mended&#160;external hardware to&#160;support this&#160;mode of&#160;operation.&#160;</p>
<p style="position:absolute;top:655px;left:68px;white-space:nowrap" class="ft04">D.2.1 &#160;</p>
<p style="position:absolute;top:655px;left:148px;white-space:nowrap" class="ft04">MS-DOS* Compatibility Sub-mode in the Intel486™&#160;and Pentium® Processors</p>
<p style="position:absolute;top:685px;left:68px;white-space:nowrap" class="ft05">In the Intel486 processor,&#160;several things were done to&#160;enhance and speed up the&#160;numeric coprocessor,&#160;now&#160;called&#160;<br/>the floating-point unit (x87 FPU). The most important enhancement was that&#160;the x87 FPU was included in the same&#160;<br/>chip as&#160;the processor,&#160;for&#160;increased&#160;speed in&#160;x87 FPU&#160;computations&#160;and reduced&#160;latency for x87&#160;FPU exception&#160;<br/>handling. Also, for the&#160;first time, the&#160;MS-DOS&#160;compatibility&#160;mode&#160;was built&#160;into the&#160;chip design, with the&#160;addition&#160;<br/>of the NE bit in&#160;control&#160;register&#160;CR0 and&#160;the&#160;addition&#160;of the&#160;FERR#&#160;(Floating-point ERRor)&#160;and IGNNE# (IGNore&#160;<br/>Numeric Error) pins.&#160;<br/>The&#160;NE&#160;bit selects the&#160;native&#160;x87 FPU&#160;exception handling&#160;mode (NE = 1)&#160;or the MS-DOS compatibility mode&#160;(NE =&#160;<br/>0).&#160;When native&#160;mode&#160;is selected,&#160;all signaling of floating-point exceptions&#160;is handled internally&#160;in&#160;the Intel486&#160;<br/>chip, resulting in the generation of an&#160;interrupt 16.<br/>When MS-DOS&#160;compatibility mode&#160;is&#160;selected, the&#160;FERRR#&#160;and&#160;IGNNE#&#160;pins are used&#160;to&#160;signal floating-point&#160;<br/>exceptions. The FERR#&#160;output pin, which replaces the ERROR#&#160;pin from&#160;the&#160;previous&#160;generations of IA-32 numeric&#160;<br/>coprocessors,&#160;is connected to&#160;a PIC. A new input&#160;signal, IGNNE#,&#160;is provided&#160;to allow the&#160;x87 FPU exception&#160;<br/>handler to execute&#160;x87 FPU instructions,&#160;if&#160;desired, without first clearing the&#160;error condition and without triggering&#160;<br/>the interrupt a&#160;second&#160;time.&#160;This IGNNE# feature&#160;is needed&#160;to replicate&#160;the capability&#160;that was&#160;provided&#160;on MS-<br/>DOS&#160;compatible Intel 286 and Intel 287 and Intel386&#160;and&#160;Intel 387 systems by turning off&#160;the&#160;BUSY# signal,&#160;when&#160;<br/>inside&#160;the x87 FPU&#160;exception handler,&#160;before clearing the&#160;error condition.<br/>Note that Intel,&#160;in&#160;order&#160;to provide Intel486&#160;processors&#160;for market&#160;segments&#160;that had&#160;no need for an&#160;x87 FPU,&#160;<br/>created&#160;the&#160;“SX”&#160;versions.&#160;These&#160;Intel486&#160;SX&#160;processors&#160;did&#160;not&#160;contain the floating-point&#160;unit. Intel also produced&#160;<br/>Intel 487&#160;SX processors for end&#160;users who later&#160;decided&#160;to&#160;upgrade to&#160;a system&#160;with an x87&#160;FPU.&#160;These&#160;Intel 487&#160;<br/>SX processors are&#160;similar to&#160;standard&#160;Intel486&#160;processors with a&#160;working x87&#160;FPU&#160;on&#160;board.&#160;<br/>Thus, the external&#160;circuitry necessary to support the MS-DOS compatibility mode for Intel 487 SX processors is the&#160;<br/>same as&#160;for standard Intel486&#160;DX&#160;processors.</p>
</div>
</body>
</html>
