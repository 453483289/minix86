<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 319</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page319-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a319.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:768px;white-space:nowrap" class="ft00">Vol. 1&#160;13-13</p>
<p style="position:absolute;top:47px;left:544px;white-space:nowrap" class="ft01">MANAGING&#160;STATE&#160;USING&#160;THE XSAVE&#160;FEATURE SET</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08">recent&#160;execution of XRSTOR&#160;or XRSTORS,&#160;it may avoid&#160;writing data&#160;for any&#160;state component&#160;whose&#160;configuration&#160;<br/>is&#160;known not to&#160;have&#160;been&#160;modified since then&#160;(the&#160;<b>modified&#160;optimization</b>).&#160;(XSAVE does not&#160;use these&#160;optimi-<br/>zations,&#160;and XSAVEC does not&#160;use the&#160;modified&#160;optimization.) The&#160;operation&#160;of&#160;XSAVEOPT, XSAVEC,&#160;and XSAVES&#160;<br/>are described in more&#160;detail&#160;in<a href="o_7281d5ea06a5b67a-322.html">&#160;Section 13.9 throug</a><a href="o_7281d5ea06a5b67a-325.html">h Section 13.11.<br/></a>A processor can support the init and modified optimizations&#160;with special hardware&#160;that tracks the state components&#160;<br/>that might&#160;benefit from those&#160;optimizations.&#160;Other&#160;implementations&#160;might not include&#160;such hardware; such a&#160;<br/>processor would always consider&#160;each such state&#160;component as not in its initial&#160;configuration&#160;and as modified since&#160;<br/>the&#160;last execution of XRSTOR&#160;or&#160;XRSTORS.<br/>The following&#160;notation describes&#160;the state&#160;of&#160;the init&#160;and modified optimizations:</p>
<p style="position:absolute;top:269px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:270px;left:95px;white-space:nowrap" class="ft06">XINUSE&#160;denotes&#160;the state-component bitmap corresponding to&#160;the init&#160;optimization. If&#160;XINUSE[<i>i</i>]&#160;=&#160;&#160;0,&#160;&#160;state&#160;<br/>component&#160;<i>i</i>&#160;is&#160;known&#160;to be&#160;in&#160;its&#160;initial configuration;&#160;otherwise&#160;XINUSE[<i>i</i>]&#160;=&#160;1.&#160;It is possible&#160;for&#160;XINUSE[<i>i</i>] to&#160;<br/>be&#160;1&#160;even when&#160;state&#160;component&#160;<i>i</i>&#160;is in its&#160;initial configuration. On a&#160;processor&#160;that does not support the&#160;init&#160;<br/>optimization, XINUSE[<i>i</i>]&#160;is always 1&#160;for every value of&#160;<i>i</i>.<br/>Executing XGETBV with&#160;ECX&#160;=&#160;1 returns&#160;in&#160;EDX:EAX the&#160;logical-AND of XCR0 and the&#160;current&#160;value of the&#160;<br/>XINUSE&#160;state-component bitmap. Such&#160;an execution&#160;of&#160;XGETBV&#160;always&#160;sets EAX[1]&#160;to 1 if XCR0[1]&#160;=&#160;1&#160;and&#160;<br/>MXCSR does&#160;not have&#160;its RESET value&#160;of 1F80H.<a href="o_7281d5ea06a5b67a-308.html">&#160;Section 13.2 explains how</a>&#160;software can&#160;determine whether&#160;a&#160;<br/>processor supports&#160;this use of XGETBV.</p>
<p style="position:absolute;top:413px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:414px;left:95px;white-space:nowrap" class="ft06">XMODIFIED denotes the state-component&#160;bitmap&#160;corresponding to the&#160;modified&#160;optimization. If&#160;<br/>XMODIFIED[<i>i</i>]&#160;=&#160;0, state component&#160;<i>i</i>&#160;is known not&#160;to have&#160;been&#160;modified&#160;since the most recent execution&#160;of&#160;<br/>XRSTOR&#160;or XRSTORS; otherwise XMODIFIED[<i>i</i>]&#160;=&#160;1.&#160;It is&#160;possible&#160;for XMODIFIED[<i>i</i>] to be&#160;1 even&#160;when state&#160;<br/>component&#160;<i>i</i>&#160;has&#160;not&#160;been&#160;modified&#160;since&#160;the&#160;most recent execution&#160;of&#160;XRSTOR or&#160;XRSTORS.&#160;On a&#160;processor&#160;<br/>that does not&#160;support&#160;the modified optimization,&#160;XMODIFIED[<i>i</i>]&#160;is&#160;always&#160;1 for every value&#160;of&#160;<i>i</i>.</p>
<p style="position:absolute;top:504px;left:69px;white-space:nowrap" class="ft06">A processor that&#160;implements the&#160;modified&#160;optimization&#160;saves information&#160;about the&#160;most recent execution&#160;of&#160;<br/>XRSTOR or XRSTORS in&#160;a quantity&#160;called&#160;<b>XRSTOR_INFO</b>, a&#160;4-tuple containing the&#160;following:&#160;(1)&#160;the CPL;&#160;<br/>(2)&#160;whether&#160;the&#160;logical processor was&#160;in VMX non-root operation; (3)&#160;the&#160;linear address&#160;of&#160;the XSAVE&#160;area; and&#160;<br/>(4)&#160;the XCOMP_BV&#160;field&#160;in&#160;the XSAVE area. An&#160;execution of XSAVEOPT&#160;or XSAVES&#160;uses the&#160;modified&#160;optimization&#160;<br/>only if that&#160;execution corresponds&#160;to&#160;XRSTOR_INFO on these&#160;four parameters.<br/>This&#160;mechanism implies that,&#160;depending on&#160;details&#160;of&#160;the&#160;operating&#160;system,&#160;the processor might&#160;determine that an&#160;<br/>execution of XSAVEOPT&#160;by one user&#160;application&#160;corresponds&#160;to an earlier execution of XRSTOR&#160;by&#160;a different appli-<br/>cation. For this reason,&#160;Intel recommends&#160;the application software not&#160;use the&#160;XSAVEOPT&#160;instruction.<br/>The following items specify the initial&#160;configuration&#160;each state&#160;component&#160;(for the purposes&#160;of&#160;defining the&#160;XINUSE&#160;<br/>bitmap):</p>
<p style="position:absolute;top:689px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:690px;left:95px;white-space:nowrap" class="ft06"><b>x87 state.</b>&#160;x87&#160;state&#160;is in its&#160;initial configuration if the following all hold:&#160;FCW is 037FH; FSW is 0000H; FTW is&#160;<br/>FFFFH; FCS&#160;and FDS&#160;are&#160;each 0000H; FIP and&#160;FDP&#160;are&#160;each 00000000_00000000H;&#160;each of ST0–ST7&#160;is&#160;<br/>0000_00000000_00000000H.</p>
<p style="position:absolute;top:745px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:745px;left:95px;white-space:nowrap" class="ft06"><b>SSE state.</b>&#160;In&#160;64-bit mode, SSE state&#160;is in&#160;its initial configuration if each of XMM0–XMM15&#160;is 0. Outside&#160;64-bit&#160;<br/>mode, SSE state is in its initial configuration if each of&#160;XMM0–XMM7 is 0.&#160;XINUSE[1] pertains only to the state&#160;<br/>of the&#160;XMM registers&#160;and not&#160;to MXCSR.&#160;An execution&#160;of&#160;XRSTOR&#160;or XRSTORS outside 64-bit&#160;mode&#160;does not&#160;<br/>update XMM8–XMM15.&#160;(See<a href="o_7281d5ea06a5b67a-327.html">&#160;Section 13.13.</a>)</p>
<p style="position:absolute;top:817px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:817px;left:95px;white-space:nowrap" class="ft06"><b>AVX state.</b>&#160;In&#160;64-bit mode, AVX state&#160;is in&#160;its initial&#160;configuration if each&#160;of YMM0_H–YMM15_H is&#160;0.&#160;Outside&#160;<br/>64-bit mode, AVX&#160;state is&#160;in&#160;its initial configuration if&#160;each&#160;of YMM0_H–YMM7_H is 0.&#160;An&#160;execution of XRSTOR&#160;<br/>or XRSTORS&#160;outside&#160;64-bit&#160;mode&#160;does not&#160;update&#160;YMM8_H–YMM15_H.&#160;(See<a href="o_7281d5ea06a5b67a-327.html">&#160;Section 13.13.</a>)</p>
<p style="position:absolute;top:872px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:873px;left:95px;white-space:nowrap" class="ft03"><b>BNDREG state.</b>&#160;BNDREG state is&#160;in&#160;its initial&#160;configuration if the value of each of&#160;BND0–BND3 is&#160;0.</p>
<p style="position:absolute;top:895px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:895px;left:95px;white-space:nowrap" class="ft03"><b>BNDCSR state.</b>&#160;BNDCSR state is&#160;in its&#160;initial configuration if BNDCFGU and BNDCSR&#160;each&#160;has&#160;value&#160;0.</p>
<p style="position:absolute;top:917px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:918px;left:95px;white-space:nowrap" class="ft03"><b>Opmask state.</b>&#160;Opmask state is&#160;in its&#160;initial configuration&#160;if&#160;each of the&#160;opmask registers&#160;k0–k7 is&#160;0.</p>
<p style="position:absolute;top:940px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:940px;left:95px;white-space:nowrap" class="ft06"><b>ZMM_Hi256 state.</b>&#160;In 64-bit&#160;mode, ZMM_Hi256 state&#160;is&#160;in its&#160;initial configuration if&#160;each of ZMM0_H–<br/>ZMM15_H is&#160;0.&#160;Outside&#160;64-bit mode,&#160;ZMM_Hi256&#160;state&#160;is&#160;in its&#160;initial configuration&#160;if each of ZMM0_H–ZMM7_H&#160;<br/>is 0. An execution&#160;of&#160;XRSTOR or&#160;XRSTORS outside&#160;64-bit mode&#160;does&#160;not update ZMM8_H–ZMM15_H. (See&#160;<br/><a href="o_7281d5ea06a5b67a-327.html">Section 13.13.)</a></p>
<p style="position:absolute;top:1012px;left:69px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:1012px;left:95px;white-space:nowrap" class="ft06"><b>Hi16_ZMM state.</b>&#160;In 64-bit&#160;mode,&#160;Hi16_ZMM&#160;state&#160;is&#160;in its&#160;initial&#160;configuration if each of ZMM16–ZMM31&#160;is 0.&#160;<br/>Outside&#160;64-bit mode,&#160;Hi16_ZMM&#160;state is&#160;always in its&#160;initial configuration.&#160;An&#160;execution of XRSTOR&#160;or&#160;<br/>XRSTORS&#160;outside&#160;64-bit mode&#160;does&#160;not update ZMM31–ZMM31.&#160;(See&#160;<a href="o_7281d5ea06a5b67a-327.html">Section&#160;13.13.)</a></p>
</div>
</body>
</html>
