<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 234</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page234-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a234.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">9-10&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROGRAMMING WITH INTEL® MMX™&#160;TECHNOLOGY</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft05">When&#160;an application using&#160;MMX instructions calls&#160;a&#160;x87 FPU&#160;floating-point library/DLL (use&#160;the&#160;EMMS&#160;<br/>instruction before&#160;calling the&#160;x87&#160;FPU&#160;code).</p>
<p style="position:absolute;top:139px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:139px;left:93px;white-space:nowrap" class="ft05">When&#160;a switch is&#160;made&#160;between&#160;MMX code&#160;in a&#160;task&#160;or&#160;thread and other&#160;tasks&#160;or threads in cooperative&#160;<br/>operating systems,&#160;unless&#160;it is&#160;certain that&#160;more&#160;MMX&#160;instructions will be executed&#160;before&#160;any x87&#160;FPU code.</p>
<p style="position:absolute;top:180px;left:68px;white-space:nowrap" class="ft05">EMMS is&#160;not&#160;required when mixing MMX&#160;technology instructions with SSE/SSE2/SSE3&#160;instructions (see<a href="o_7281d5ea06a5b67a-275.html">&#160;Section&#160;<br/>11.6.7,&#160;“Interaction&#160;of&#160;SSE/SSE2 Instructions with x87&#160;FPU and&#160;MMX&#160;Instructions”).</a></p>
<p style="position:absolute;top:247px;left:68px;white-space:nowrap" class="ft04">9.6.4&#160;</p>
<p style="position:absolute;top:247px;left:148px;white-space:nowrap" class="ft04">Mixing MMX and x87 FPU Instructions</p>
<p style="position:absolute;top:277px;left:68px;white-space:nowrap" class="ft05">An&#160;application&#160;can contain both&#160;x87 FPU floating-point&#160;and&#160;MMX instructions.&#160;However,&#160;frequent transitions&#160;<br/>between&#160;MMX and&#160;x87&#160;FPU instructions are&#160;not recommended,&#160;because they&#160;can&#160;degrade&#160;performance&#160;in some&#160;<br/>processor implementations.&#160;When mixing MMX&#160;code&#160;with&#160;x87 FPU&#160;code, follow these guidelines:</p>
<p style="position:absolute;top:332px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:333px;left:93px;white-space:nowrap" class="ft03">Keep&#160;the&#160;code&#160;in separate&#160;modules,&#160;procedures,&#160;or routines.</p>
<p style="position:absolute;top:355px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:355px;left:93px;white-space:nowrap" class="ft03">Do not rely&#160;on&#160;register contents&#160;across transitions&#160;between&#160;x87 FPU and&#160;MMX code modules.</p>
<p style="position:absolute;top:377px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:378px;left:93px;white-space:nowrap" class="ft05">When&#160;transitioning between MMX code&#160;and&#160;x87 FPU&#160;code, save&#160;the&#160;MMX register&#160;state (if&#160;it will be needed&#160;in&#160;<br/>the&#160;future)&#160;and execute&#160;an&#160;EMMS instruction to empty the&#160;MMX state.</p>
<p style="position:absolute;top:416px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:417px;left:93px;white-space:nowrap" class="ft05">When&#160;transitioning between x87&#160;FPU&#160;code&#160;and MMX&#160;code,&#160;save the&#160;x87&#160;FPU state&#160;if it&#160;will&#160;be&#160;needed&#160;in the&#160;<br/>future.</p>
<p style="position:absolute;top:484px;left:68px;white-space:nowrap" class="ft04">9.6.5&#160;</p>
<p style="position:absolute;top:484px;left:148px;white-space:nowrap" class="ft04">Interfacing with MMX Code</p>
<p style="position:absolute;top:514px;left:68px;white-space:nowrap" class="ft07">MMX technology&#160;enables direct access to&#160;all the&#160;MMX registers.&#160;This means&#160;that all&#160;existing interface conventions&#160;<br/>that apply to the use&#160;of&#160;the processor’s&#160;general-purpose&#160;registers (EAX, EBX, etc.) also&#160;apply&#160;to the&#160;use of MMX&#160;<br/>registers.<br/>An&#160;efficient interface&#160;to MMX&#160;routines might pass parameters&#160;and return&#160;values through the&#160;MMX registers&#160;or&#160;<br/>through a combination&#160;of&#160;memory locations (via&#160;the&#160;stack) and MMX registers. Do not use the EMMS instruction or&#160;<br/>mix&#160;MMX and&#160;x87&#160;FPU code&#160;when using&#160;to&#160;the&#160;MMX registers&#160;to pass&#160;parameters.<br/>If a&#160;high-level language that does&#160;not&#160;support&#160;the MMX&#160;data types directly is&#160;used, the&#160;MMX data types can&#160;be&#160;<br/>defined as&#160;a 64-bit structure&#160;containing&#160;packed&#160;data&#160;types.<br/>When implementing MMX&#160;instructions in high-level&#160;languages,&#160;other&#160;approaches&#160;can be taken, such&#160;as:&#160;</p>
<p style="position:absolute;top:691px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:691px;left:93px;white-space:nowrap" class="ft03">Passing parameters&#160;to an&#160;MMX&#160;routine by passing&#160;a&#160;pointer&#160;to a&#160;structure via the&#160;stack.</p>
<p style="position:absolute;top:713px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:714px;left:93px;white-space:nowrap" class="ft03">Returning a&#160;value from&#160;a function by returning&#160;a pointer to a&#160;structure.</p>
<p style="position:absolute;top:764px;left:68px;white-space:nowrap" class="ft04">9.6.6&#160;</p>
<p style="position:absolute;top:764px;left:148px;white-space:nowrap" class="ft04">Using MMX Code&#160;in a Multitasking Operating System Environment</p>
<p style="position:absolute;top:795px;left:68px;white-space:nowrap" class="ft07">An application needs to&#160;identify&#160;the nature&#160;of the&#160;multitasking&#160;operating system&#160;on which it&#160;runs. Each task&#160;retains&#160;<br/>its own state&#160;which&#160;must&#160;be&#160;saved when&#160;a&#160;task&#160;switch&#160;occurs.&#160;The processor state&#160;(context) consists&#160;of the&#160;<br/>general-purpose&#160;registers and&#160;the&#160;floating-point and&#160;MMX registers.<br/>Operating systems&#160;can be&#160;classified into two types:</p>
<p style="position:absolute;top:874px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:874px;left:93px;white-space:nowrap" class="ft03">Cooperative multitasking operating&#160;system</p>
<p style="position:absolute;top:896px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:897px;left:93px;white-space:nowrap" class="ft03">Preemptive multitasking operating&#160;system</p>
<p style="position:absolute;top:921px;left:68px;white-space:nowrap" class="ft05">Cooperative multitasking operating systems do not save&#160;the&#160;FPU&#160;or MMX state when performing&#160;a&#160;context switch.&#160;<br/>Therefore,&#160;the&#160;application needs to&#160;save&#160;the&#160;relevant&#160;state before relinquishing&#160;direct&#160;or indirect control&#160;to&#160;the&#160;<br/>operating system.<br/>Preemptive&#160;multitasking operating systems&#160;are responsible&#160;for saving&#160;and&#160;restoring&#160;the FPU&#160;and MMX state&#160;when&#160;<br/>performing a&#160;context switch.&#160;Therefore,&#160;the&#160;application&#160;does&#160;not have&#160;to save&#160;or restore the FPU&#160;and MMX&#160;state.</p>
</div>
</body>
</html>
