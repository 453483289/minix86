<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 159</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:17px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page159-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a159.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:775px;white-space:nowrap" class="ft00">Vol. 1&#160;6-15</p>
<p style="position:absolute;top:47px;left:541px;white-space:nowrap" class="ft01">PROCEDURE CALLS, INTERRUPTS, AND EXCEPTIONS</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft03">procedure.&#160;The nesting level&#160;is the&#160;depth of a&#160;procedure in&#160;a hierarchy of procedure&#160;calls. The lexical&#160;level is&#160;unre-<br/>lated&#160;to either the&#160;protection&#160;privilege level or&#160;to the&#160;I/O&#160;privilege level&#160;of&#160;the currently running program or&#160;task.<br/>ENTER,&#160;in the&#160;following&#160;example,&#160;allocates 2&#160;Kbytes of dynamic&#160;storage on the stack and&#160;sets&#160;up pointers to&#160;two&#160;<br/>previous stack&#160;frames in the stack frame&#160;for&#160;this procedure:</p>
<p style="position:absolute;top:187px;left:89px;white-space:nowrap" class="ft02">ENTER 2048,3</p>
<p style="position:absolute;top:211px;left:69px;white-space:nowrap" class="ft03">The&#160;lexical nesting&#160;level determines the&#160;number&#160;of stack frame&#160;pointers to&#160;copy&#160;into the new stack&#160;frame from&#160;the&#160;<br/>preceding frame. A stack frame&#160;pointer&#160;is a&#160;doubleword&#160;used to access the&#160;variables&#160;of a procedure. The&#160;set of&#160;<br/>stack frame&#160;pointers used by a procedure to access the variables of other procedures is called the display.&#160;The first&#160;<br/>doubleword&#160;in the&#160;display is&#160;a pointer to&#160;the&#160;previous&#160;stack frame. This&#160;pointer is&#160;used&#160;by a&#160;LEAVE instruction to&#160;<br/>undo the&#160;effect of an&#160;ENTER&#160;instruction&#160;by discarding the&#160;current stack&#160;frame.<br/>After the&#160;ENTER&#160;instruction creates the&#160;display for&#160;a procedure, it&#160;allocates&#160;the dynamic&#160;local variables&#160;for the&#160;<br/>procedure&#160;by decrementing the contents of the ESP&#160;register&#160;by the number of&#160;bytes specified in the first parameter.&#160;<br/>This&#160;new value in&#160;the ESP register&#160;serves&#160;as the&#160;initial&#160;top-of-stack&#160;for&#160;all PUSH&#160;and POP operations within the&#160;<br/>procedure.<br/>To&#160;allow a&#160;procedure to&#160;address its&#160;display,&#160;the&#160;ENTER&#160;instruction&#160;leaves the&#160;EBP&#160;register pointing to the first&#160;<br/>doubleword in&#160;the display.&#160;Because stacks&#160;grow&#160;down, this&#160;is&#160;actually&#160;the doubleword with the&#160;highest&#160;address in&#160;<br/>the&#160;display.&#160;Data manipulation instructions that&#160;specify&#160;the EBP register&#160;as a&#160;base&#160;register automatically address&#160;<br/>locations within&#160;the stack&#160;segment instead of the&#160;data&#160;segment.<br/>The ENTER instruction&#160;can&#160;be&#160;used&#160;in two&#160;ways: nested and non-nested.&#160;If&#160;the lexical level&#160;is 0, the&#160;non-nested&#160;<br/>form is used. The non-nested form&#160;pushes&#160;the&#160;contents of&#160;the&#160;EBP register on&#160;the&#160;stack,&#160;copies the contents of the&#160;<br/>ESP register into&#160;the&#160;EBP register, and subtracts&#160;the&#160;first operand from&#160;the contents of the ESP&#160;register to allocate&#160;<br/>dynamic storage. The non-nested&#160;form&#160;differs from&#160;the&#160;nested form in&#160;that&#160;no stack frame&#160;pointers&#160;are copied. The&#160;<br/>nested&#160;form of the ENTER instruction occurs&#160;when&#160;the second&#160;parameter (lexical&#160;level) is&#160;not zero.<br/>The following&#160;pseudo code&#160;shows the&#160;formal definition of&#160;the&#160;ENTER&#160;instruction. STORAGE is&#160;the number of bytes&#160;<br/>of dynamic&#160;storage&#160;to allocate for local&#160;variables,&#160;and LEVEL is&#160;the&#160;lexical nesting level.</p>
<p style="position:absolute;top:585px;left:69px;white-space:nowrap" class="ft05">PUSH&#160;EBP;<br/>FRAME_PTR&#160;←&#160;ESP;</p>
<p style="position:absolute;top:621px;left:69px;white-space:nowrap" class="ft02">IF&#160;LEVEL &gt;&#160;0&#160;</p>
<p style="position:absolute;top:639px;left:89px;white-space:nowrap" class="ft02">THEN</p>
<p style="position:absolute;top:657px;left:116px;white-space:nowrap" class="ft02">DO&#160;(LEVEL&#160;−&#160;1)&#160;times</p>
<p style="position:absolute;top:674px;left:143px;white-space:nowrap" class="ft02">EBP&#160;←&#160;EBP&#160;−&#160;4;</p>
<p style="position:absolute;top:692px;left:143px;white-space:nowrap" class="ft02">PUSH&#160;Pointer(EBP); (* doubleword&#160;pointed to by&#160;EBP *)</p>
<p style="position:absolute;top:710px;left:116px;white-space:nowrap" class="ft02">OD;</p>
<p style="position:absolute;top:728px;left:89px;white-space:nowrap" class="ft02">PUSH FRAME_PTR;</p>
<p style="position:absolute;top:746px;left:69px;white-space:nowrap" class="ft05">FI;<br/>EBP&#160;←&#160;FRAME_PTR;</p>
<p style="position:absolute;top:782px;left:69px;white-space:nowrap" class="ft03">ESP&#160;←&#160;ESP&#160;−&#160;STORAGE;<br/>The&#160;main&#160;procedure&#160;(in which all&#160;other procedures&#160;are nested)&#160;operates&#160;at&#160;the highest lexical&#160;level,&#160;level 1. The&#160;<br/>first&#160;procedure it calls operates&#160;at the&#160;next deeper&#160;lexical level, level 2.&#160;A level 2 procedure can access the variables&#160;<br/>of the&#160;main program,&#160;which&#160;are at&#160;fixed locations&#160;specified by the&#160;compiler. In the&#160;case&#160;of&#160;level 1,&#160;the ENTER&#160;<br/>instruction&#160;allocates only the requested dynamic&#160;storage&#160;on the stack because there&#160;is no previous display to copy.<br/>A procedure&#160;that&#160;calls another procedure at&#160;a lower lexical level&#160;gives the called procedure access to the&#160;variables&#160;<br/>of&#160;the&#160;caller.&#160;The ENTER instruction provides&#160;this access&#160;by placing&#160;a pointer to&#160;the&#160;calling procedure's stack frame&#160;<br/>in the&#160;display.<br/>A&#160;procedure&#160;that calls another procedure&#160;at the&#160;same lexical level should&#160;not give&#160;access to&#160;its variables.&#160;In this&#160;<br/>case, the&#160;ENTER&#160;instruction copies&#160;only that part of the display from&#160;the&#160;calling procedure&#160;which refers to&#160;previ-<br/>ously&#160;nested procedures operating&#160;at higher&#160;lexical&#160;levels. The new stack frame&#160;does&#160;not include&#160;the&#160;pointer for&#160;<br/>addressing the&#160;calling&#160;procedure’s stack&#160;frame.<br/>The ENTER instruction&#160;treats a re-entrant procedure as a&#160;call&#160;to&#160;a procedure&#160;at the same&#160;lexical level. In&#160;this case,&#160;<br/>each&#160;succeeding iteration of the&#160;re-entrant&#160;procedure can&#160;address only its&#160;own&#160;variables and&#160;the variables of the&#160;<br/>procedures&#160;within&#160;which&#160;it is&#160;nested. A re-entrant procedure always can&#160;address its&#160;own&#160;variables; it&#160;does&#160;not&#160;<br/>require pointers to&#160;the stack&#160;frames of previous&#160;iterations.</p>
</div>
</body>
</html>
