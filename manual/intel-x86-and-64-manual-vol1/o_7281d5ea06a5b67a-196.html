<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 196</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:14px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:7px;font-family:Times;color:#000000;}
	.ft07{font-size:9px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft011{font-size:9px;line-height:14px;font-family:Times;color:#000000;}
	.ft012{font-size:9px;line-height:13px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page196-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a196.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">8-6&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROGRAMMING WITH THE X87 FPU</p>
<p style="position:absolute;top:250px;left:68px;white-space:nowrap" class="ft02">8.1.3.4&#160;&#160;</p>
<p style="position:absolute;top:250px;left:152px;white-space:nowrap" class="ft02">Stack Fault Flag</p>
<p style="position:absolute;top:278px;left:68px;white-space:nowrap" class="ft010">The&#160;stack&#160;fault&#160;flag&#160;(bit&#160;6 of the&#160;x87 FPU status word) indicates that&#160;stack&#160;overflow&#160;or stack underflow has occurred&#160;<br/>with data in&#160;the&#160;x87&#160;FPU data&#160;register stack. The&#160;x87&#160;FPU explicitly sets the&#160;SF&#160;flag when&#160;it&#160;detects&#160;a stack&#160;overflow&#160;<br/>or&#160;underflow&#160;condition,&#160;but it does not&#160;explicitly clear the&#160;flag when&#160;it detects&#160;an invalid-arithmetic-operand condi-<br/>tion.&#160;<br/>When this&#160;flag is&#160;set, the condition&#160;code flag C1 indicates the nature&#160;of&#160;the fault: overflow (C1 = 1) and under-<br/>flow (C1 = 0). The SF flag is a&#160;“sticky” flag, meaning that after it&#160;is set, the processor&#160;does&#160;not&#160;clear&#160;it&#160;until&#160;it&#160;is&#160;<br/>explicitly instructed&#160;to do&#160;so (for&#160;example,&#160;by&#160;an&#160;FINIT/FNINIT, FCLEX/FNCLEX, or&#160;FSAVE/FNSAVE&#160;instruction).&#160;<br/>Se<a href="o_7281d5ea06a5b67a-198.html">e Section 8.1.7,&#160;“x87&#160;FPU Tag&#160;Word,”</a>&#160;for more&#160;information on x87&#160;FPU&#160;stack&#160;faults.</p>
<p style="position:absolute;top:459px;left:68px;white-space:nowrap" class="ft04">8.1.4&#160;</p>
<p style="position:absolute;top:459px;left:148px;white-space:nowrap" class="ft04">Branching and Conditional Moves on Condition Codes</p>
<p style="position:absolute;top:490px;left:68px;white-space:nowrap" class="ft010">The x87&#160;FPU (beginning&#160;with&#160;the P6 family&#160;processors)&#160;supports two mechanisms for branching and performing&#160;<br/>conditional moves according to comparisons&#160;of&#160;two floating-point values. These mechanism&#160;are referred to here as&#160;<br/>the&#160;“old mechanism” and&#160;the “new mechanism.”&#160;<br/>The&#160;old mechanism is&#160;available&#160;in x87&#160;FPU’s&#160;prior to&#160;the&#160;P6&#160;family processors and&#160;in P6&#160;family&#160;processors. This&#160;<br/>mechanism uses the&#160;floating-point compare&#160;instructions&#160;(FCOM, FCOMP,&#160;FCOMPP, FTST, FUCOMPP,&#160;FICOM,&#160;and&#160;<br/>FICOMP) to&#160;compare two floating-point&#160;values and&#160;set&#160;the&#160;condition code&#160;flags&#160;(C0&#160;through C3) according to&#160;the&#160;<br/>results. The&#160;contents&#160;of the condition&#160;code flags are then&#160;copied into the&#160;status&#160;flags of the&#160;EFLAGS register using&#160;<br/>a two step&#160;process (s<a href="o_7281d5ea06a5b67a-196.html">ee&#160;Figure&#160;8-5):<br/></a>1.&#160;The&#160;FSTSW&#160;AX&#160;instruction&#160;moves the&#160;x87&#160;FPU&#160;status word into&#160;the AX&#160;register.<br/>2.&#160;The&#160;SAHF instruction copies the upper 8 bits of the&#160;AX&#160;register, which&#160;includes&#160;the condition code flags, into&#160;the&#160;</p>
<p style="position:absolute;top:677px;left:93px;white-space:nowrap" class="ft03">lower 8 bits&#160;of the&#160;EFLAGS register.</p>
<p style="position:absolute;top:701px;left:68px;white-space:nowrap" class="ft08">When the condition&#160;code flags have been&#160;loaded&#160;into&#160;the&#160;EFLAGS&#160;register,&#160;conditional jumps&#160;or conditional moves&#160;<br/>can be&#160;performed based&#160;on&#160;the&#160;new&#160;settings&#160;of&#160;the&#160;status flags&#160;in the&#160;EFLAGS register.</p>
<p style="position:absolute;top:124px;left:74px;white-space:nowrap" class="ft03">FLDENV,&#160;FRSTOR</p>
<p style="position:absolute;top:124px;left:507px;white-space:nowrap" class="ft03">Each&#160;bit loaded&#160;from&#160;memory</p>
<p style="position:absolute;top:148px;left:74px;white-space:nowrap" class="ft03">FFREE,&#160;FLDCW,&#160;FCLEX/FNCLEX,&#160;FNOP,&#160;</p>
<p style="position:absolute;top:164px;left:74px;white-space:nowrap" class="ft03">FSTCW/FNSTCW,&#160;FSTENV/FNSTENV,&#160;</p>
<p style="position:absolute;top:181px;left:74px;white-space:nowrap" class="ft03">FSTSW/FNSTSW,&#160;</p>
<p style="position:absolute;top:164px;left:561px;white-space:nowrap" class="ft03">Undefined</p>
<p style="position:absolute;top:205px;left:74px;white-space:nowrap" class="ft03">FINIT/FNINIT, FSAVE/FNSAVE</p>
<p style="position:absolute;top:205px;left:402px;white-space:nowrap" class="ft03">0</p>
<p style="position:absolute;top:205px;left:527px;white-space:nowrap" class="ft03">0</p>
<p style="position:absolute;top:205px;left:649px;white-space:nowrap" class="ft03">0</p>
<p style="position:absolute;top:205px;left:769px;white-space:nowrap" class="ft03">0</p>
<p style="position:absolute;top:1044px;left:238px;white-space:nowrap" class="ft05">Figure&#160;8-5. &#160;Moving&#160;the Condition&#160;Codes to&#160;the&#160;EFLAGS Register</p>
<p style="position:absolute;top:100px;left:286px;white-space:nowrap" class="ft05">Table 8-1. &#160;Condition Code&#160;Interpretation&#160;(Contd.)</p>
<p style="position:absolute;top:986px;left:659px;white-space:nowrap" class="ft00">0</p>
<p style="position:absolute;top:789px;left:248px;white-space:nowrap" class="ft00">Condition</p>
<p style="position:absolute;top:800px;left:260px;white-space:nowrap" class="ft00">Code</p>
<p style="position:absolute;top:789px;left:311px;white-space:nowrap" class="ft00">Status</p>
<p style="position:absolute;top:800px;left:316px;white-space:nowrap" class="ft00">Flag</p>
<p style="position:absolute;top:822px;left:266px;white-space:nowrap" class="ft012">C0<br/>C1<br/>C2<br/>C3</p>
<p style="position:absolute;top:822px;left:320px;white-space:nowrap" class="ft00">CF</p>
<p style="position:absolute;top:836px;left:311px;white-space:nowrap" class="ft00">(none)</p>
<p style="position:absolute;top:850px;left:320px;white-space:nowrap" class="ft012">PF<br/>ZF</p>
<p style="position:absolute;top:1007px;left:653px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:1016px;left:653px;white-space:nowrap" class="ft06">F</p>
<p style="position:absolute;top:1012px;left:642px;white-space:nowrap" class="ft06">1</p>
<p style="position:absolute;top:1007px;left:629px;white-space:nowrap" class="ft06">P</p>
<p style="position:absolute;top:1016px;left:629px;white-space:nowrap" class="ft06">F</p>
<p style="position:absolute;top:1007px;left:572px;white-space:nowrap" class="ft06">Z</p>
<p style="position:absolute;top:1016px;left:573px;white-space:nowrap" class="ft06">F</p>
<p style="position:absolute;top:986px;left:560px;white-space:nowrap" class="ft00">7</p>
<p style="position:absolute;top:986px;left:241px;white-space:nowrap" class="ft00">31</p>
<p style="position:absolute;top:986px;left:363px;white-space:nowrap" class="ft07"><b>EFLAGS Register</b></p>
<p style="position:absolute;top:865px;left:659px;white-space:nowrap" class="ft00">0</p>
<p style="position:absolute;top:886px;left:525px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:895px;left:526px;white-space:nowrap" class="ft06">2</p>
<p style="position:absolute;top:885px;left:538px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:895px;left:539px;white-space:nowrap" class="ft06">1</p>
<p style="position:absolute;top:885px;left:470px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:895px;left:471px;white-space:nowrap" class="ft06">3</p>
<p style="position:absolute;top:864px;left:528px;white-space:nowrap" class="ft07"><b>AX Register</b></p>
<p style="position:absolute;top:895px;left:552px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:885px;left:551px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:865px;left:448px;white-space:nowrap" class="ft00">15</p>
<p style="position:absolute;top:777px;left:659px;white-space:nowrap" class="ft00">0</p>
<p style="position:absolute;top:798px;left:526px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:807px;left:526px;white-space:nowrap" class="ft06">2</p>
<p style="position:absolute;top:798px;left:539px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:807px;left:540px;white-space:nowrap" class="ft06">1</p>
<p style="position:absolute;top:798px;left:471px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:807px;left:472px;white-space:nowrap" class="ft06">3</p>
<p style="position:absolute;top:777px;left:503px;white-space:nowrap" class="ft07"><b>x87&#160;FPU Status Word</b></p>
<p style="position:absolute;top:807px;left:552px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:798px;left:551px;white-space:nowrap" class="ft06">C</p>
<p style="position:absolute;top:777px;left:448px;white-space:nowrap" class="ft00">15</p>
<p style="position:absolute;top:847px;left:407px;white-space:nowrap" class="ft00">FSTSW&#160;AX Instruction</p>
<p style="position:absolute;top:950px;left:407px;white-space:nowrap" class="ft00">SAHF&#160;Instruction</p>
</div>
</body>
</html>
