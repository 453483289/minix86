<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 220</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:8px;font-family:Times;color:#000000;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page220-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a220.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">8-30&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROGRAMMING WITH THE X87 FPU</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft07">the exception handler has the option either of&#160;re-executing the store instruction&#160;after proper adjustment&#160;of the&#160;<br/>operand or of rounding the significand on the stack&#160;to&#160;the destination's&#160;precision as the&#160;standard requires. The&#160;<br/>exception handler&#160;should ultimately store a&#160;value&#160;into the destination location in&#160;memory&#160;if&#160;the program is&#160;to&#160;<br/>continue.</p>
<p style="position:absolute;top:172px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:172px;left:93px;white-space:nowrap" class="ft07"><b>Destination&#160;is the register stack&#160;—</b>&#160;The&#160;significand of the result&#160;is rounded according to current settings of&#160;<br/>the precision and&#160;rounding control&#160;bits in&#160;the x87&#160;FPU&#160;control word and&#160;the&#160;exponent of the&#160;result&#160;is adjusted&#160;<br/>by&#160;dividing&#160;it&#160;by&#160;2</p>
<p style="position:absolute;top:203px;left:213px;white-space:nowrap" class="ft05">24576</p>
<p style="position:absolute;top:205px;left:248px;white-space:nowrap" class="ft02">. (For instructions not affected&#160;by the&#160;precision field, the&#160;significand&#160;is rounded to&#160;</p>
<p style="position:absolute;top:222px;left:93px;white-space:nowrap" class="ft07">double-extended&#160;precision.) The resulting&#160;value is&#160;stored&#160;in&#160;the destination operand. Condition code&#160;bit&#160;C1&#160;in&#160;<br/>the x87&#160;FPU status word (called in this situation the “round-up bit”) is set if the significand was rounded upward&#160;<br/>and&#160;cleared if the result&#160;was rounded toward&#160;0. After the result&#160;is stored,&#160;the OE flag&#160;is&#160;set and&#160;a software&#160;<br/>exception handler is invoked.&#160;The&#160;scaling&#160;bias value 24,576&#160;is&#160;equal to&#160;3&#160;∗&#160;2</p>
<p style="position:absolute;top:269px;left:597px;white-space:nowrap" class="ft05">13</p>
<p style="position:absolute;top:271px;left:611px;white-space:nowrap" class="ft02">.&#160;Biasing the exponent by&#160;24,576&#160;</p>
<p style="position:absolute;top:288px;left:93px;white-space:nowrap" class="ft07">normally translates the number&#160;as&#160;nearly as&#160;possible to&#160;the middle of&#160;the double extended-precision&#160;floating-<br/>point exponent range so that, if desired,&#160;it can be used&#160;in subsequent scaled operations with less risk of causing&#160;<br/>further exceptions.<br/>When&#160;using the&#160;FSCALE instruction,&#160;massive overflow&#160;can occur,&#160;where&#160;the result&#160;is&#160;too&#160;large&#160;to be repre-<br/>sented,&#160;even&#160;with&#160;a bias-adjusted&#160;exponent.&#160;Here,&#160;if overflow occurs&#160;again, after the result has been&#160;biased, a&#160;<br/>properly signed&#160;∞&#160;is stored in&#160;the&#160;destination operand.</p>
<p style="position:absolute;top:427px;left:68px;white-space:nowrap" class="ft06">8.5.5&#160;</p>
<p style="position:absolute;top:427px;left:148px;white-space:nowrap" class="ft06">Numeric Underflow Exception (#U)</p>
<p style="position:absolute;top:457px;left:68px;white-space:nowrap" class="ft07">The x87&#160;FPU&#160;detects&#160;a potential floating-point&#160;numeric underflow&#160;condition whenever the&#160;result of an&#160;arithmetic&#160;<br/>instruction&#160;is non-zero and tiny; that is, the magnitude of&#160;the rounded result with unbounded exponent&#160;is non-zero&#160;<br/>and less than&#160;the smallest possible&#160;normalized,&#160;finite value&#160;that will fit&#160;into the floating-point&#160;format&#160;of the&#160;destina-<br/>tion operand.&#160;(See&#160;<a href="o_7281d5ea06a5b67a-105.html">Section&#160;4.9.1.5,&#160;“Numeric Underflow&#160;Exception&#160;(#U),”</a>&#160;for additional&#160;information about&#160;the&#160;<br/>numeric underflow&#160;exception.)<br/>Like&#160;numeric overflow, numeric underflow can occur&#160;on&#160;arithmetic operations where&#160;the result&#160;is&#160;stored&#160;in&#160;an x87&#160;<br/>FPU data register. It can also occur on&#160;store floating-point operations (with the FST and FSTP instructions), where&#160;<br/>a&#160;within-range value&#160;in&#160;a data register&#160;is stored in&#160;memory in&#160;the smaller&#160;single-precision&#160;or&#160;double-precision&#160;<br/>floating-point formats.&#160;A&#160;numeric&#160;underflow&#160;exception cannot occur&#160;when storing values in&#160;an integer or&#160;BCD&#160;<br/>integer format, because&#160;a value with magnitude&#160;less than 1&#160;is&#160;always&#160;rounded&#160;to&#160;an integral&#160;value&#160;of&#160;0&#160;or 1,&#160;<br/>depending on&#160;the rounding&#160;mode in&#160;effect.<br/>The flag&#160;(UE) for the numeric-underflow exception is bit 4&#160;of the x87 FPU status word,&#160;and the mask bit (UM) is bit&#160;<br/>4 of the&#160;x87 FPU&#160;control word.<br/>When a&#160;numeric-underflow condition occurs&#160;and the&#160;exception is&#160;masked,&#160;the&#160;x87&#160;FPU performs&#160;the operation&#160;<br/>descri<a href="o_7281d5ea06a5b67a-105.html">bed in&#160;Section&#160;4.9.1.5, “Numeric&#160;Underflow Exception (#U).”<br/></a>When&#160;the exception&#160;is not&#160;masked, the&#160;action of the&#160;x87 FPU depends&#160;on whether the&#160;instruction&#160;is supposed&#160;to&#160;<br/>store&#160;the&#160;result&#160;in a&#160;memory location&#160;or on the&#160;x87 FPU resister&#160;stack.</p>
<p style="position:absolute;top:773px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:774px;left:93px;white-space:nowrap" class="ft07"><b>Destination&#160;is&#160;a memory&#160;location&#160;—</b>&#160;(Can occur only with a&#160;store instruction.)&#160;The&#160;UE&#160;flag is&#160;set&#160;and a&#160;<br/>software&#160;exception handler&#160;is invoked (see<a href="o_7281d5ea06a5b67a-222.html">&#160;Section 8.7,&#160;“Handling x87&#160;FPU&#160;Exceptions in&#160;Software”).&#160;</a>The top-<br/>of-stack&#160;pointer (TOP)&#160;and source&#160;and&#160;destination operands&#160;remain unchanged, and no result&#160;is stored&#160;in&#160;<br/>memory.&#160;<br/>Because&#160;the data in&#160;the&#160;stack is&#160;in double&#160;extended-precision format,&#160;the exception&#160;handler&#160;has&#160;the option&#160;<br/>either&#160;of re-exchanges&#160;the store&#160;instruction after proper adjustment of the&#160;operand or&#160;of&#160;rounding the&#160;<br/>significand&#160;on the&#160;stack to the&#160;destination's precision&#160;as the&#160;standard&#160;requires. The exception&#160;handler should&#160;<br/>ultimately&#160;store&#160;a value into&#160;the destination location&#160;in memory if the&#160;program&#160;is to&#160;continue.</p>
<p style="position:absolute;top:911px;left:68px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:912px;left:93px;white-space:nowrap" class="ft07"><b>Destination&#160;is the register stack&#160;—</b>&#160;The&#160;significand of the result&#160;is rounded according to current settings of&#160;<br/>the precision and&#160;rounding control&#160;bits in&#160;the x87&#160;FPU&#160;control word and&#160;the&#160;exponent of the&#160;result&#160;is adjusted&#160;<br/>by multiplying&#160;it by 2</p>
<p style="position:absolute;top:942px;left:236px;white-space:nowrap" class="ft05">24576</p>
<p style="position:absolute;top:945px;left:270px;white-space:nowrap" class="ft02">. (For&#160;instructions not affected by the&#160;precision&#160;field, the&#160;significand&#160;is rounded&#160;to&#160;</p>
<p style="position:absolute;top:961px;left:93px;white-space:nowrap" class="ft07">double extended&#160;precision.) The&#160;resulting&#160;value is&#160;stored&#160;in the&#160;destination&#160;operand. Condition code bit C1&#160;in&#160;<br/>the&#160;x87 FPU status register&#160;(acting&#160;here as&#160;a “round-up&#160;bit”)&#160;is set if the&#160;significand&#160;was rounded upward and&#160;<br/>cleared if the&#160;result was rounded toward&#160;0.&#160;After the&#160;result&#160;is stored,&#160;the UE&#160;flag is set and a software&#160;exception&#160;<br/>handler&#160;is invoked. The&#160;scaling bias value 24,576&#160;is&#160;the&#160;same as&#160;is used&#160;for the&#160;overflow exception and has the&#160;<br/>same effect, which is to translate the result as nearly as&#160;possible to the middle of the double&#160;extended-precision&#160;<br/>floating-point exponent&#160;range.</p>
</div>
</body>
</html>
