<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 161</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:12px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page161-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a161.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:775px;white-space:nowrap" class="ft00">Vol. 1&#160;6-17</p>
<p style="position:absolute;top:47px;left:541px;white-space:nowrap" class="ft01">PROCEDURE CALLS, INTERRUPTS, AND EXCEPTIONS</p>
<p style="position:absolute;top:731px;left:69px;white-space:nowrap" class="ft04">When&#160;procedure A calls&#160;procedure B,&#160;the&#160;ENTER instruction&#160;creates&#160;a new display (see<a href="o_7281d5ea06a5b67a-162.html">&#160;Figure&#160;6-9).</a>&#160;The&#160;first&#160;<br/>doubleword holds&#160;a copy of&#160;the last&#160;value in procedure&#160;A’s&#160;EBP&#160;register. The&#160;second and&#160;third doublewords are&#160;<br/>copies&#160;of the&#160;two&#160;stack&#160;frame pointers in procedure&#160;A’s display.&#160;Procedure&#160;B can access variables in&#160;procedure&#160;A&#160;<br/>and&#160;MAIN by using&#160;the&#160;stack&#160;frame pointers in its&#160;display.<br/>When&#160;procedure B calls procedure C,&#160;the&#160;ENTER&#160;instruction creates a&#160;new display&#160;for&#160;procedure&#160;C (see&#160;<br/><a href="o_7281d5ea06a5b67a-163.html">Figure&#160;6-10). The&#160;</a>first doubleword holds a copy&#160;of the last&#160;value in procedure&#160;B’s&#160;EBP register. This is used&#160;by&#160;the&#160;<br/>LEAVE instruction to&#160;restore procedure&#160;B’s stack&#160;frame.&#160;The second and&#160;third&#160;doublewords&#160;are copies of&#160;the two&#160;<br/>stack frame&#160;pointers in&#160;procedure&#160;A’s display.&#160;If procedure C were&#160;at the&#160;next deeper&#160;lexical&#160;level from procedure&#160;<br/>B,&#160;a&#160;fourth doubleword would be&#160;copied, which would be&#160;the&#160;stack frame&#160;pointer to&#160;procedure B’s&#160;local variables.&#160;<br/>Note that procedure B and&#160;procedure C are at the same&#160;level, so procedure C is not intended to&#160;access procedure&#160;<br/>B’s variables.&#160;This&#160;does not mean&#160;that procedure C is completely isolated&#160;from procedure B; procedure C is called&#160;<br/>by procedure&#160;B, so&#160;the pointer&#160;to the&#160;returning stack&#160;frame is&#160;a pointer to procedure&#160;B’s stack&#160;frame.&#160;In&#160;addition,&#160;<br/>procedure&#160;B can pass parameters to&#160;procedure&#160;C either&#160;on&#160;the stack or through variables global to&#160;both procedures&#160;<br/>(that is, variables in the&#160;scope&#160;of both&#160;procedures).</p>
<p style="position:absolute;top:340px;left:253px;white-space:nowrap" class="ft03">Figure&#160;6-7.&#160; Stack Frame&#160;After&#160;Entering&#160;the MAIN&#160;Procedure</p>
<p style="position:absolute;top:685px;left:279px;white-space:nowrap" class="ft03">Figure&#160;6-8.&#160;&#160;Stack Frame After&#160;Entering&#160;Procedure A</p>
<p style="position:absolute;top:181px;left:551px;white-space:nowrap" class="ft00">EBP</p>
<p style="position:absolute;top:194px;left:340px;white-space:nowrap" class="ft00">Display</p>
<p style="position:absolute;top:181px;left:437px;white-space:nowrap" class="ft00">Old EBP</p>
<p style="position:absolute;top:270px;left:550px;white-space:nowrap" class="ft00">ESP</p>
<p style="position:absolute;top:204px;left:430px;white-space:nowrap" class="ft00">Main’s&#160;EBP</p>
<p style="position:absolute;top:248px;left:333px;white-space:nowrap" class="ft00">Dynamic</p>
<p style="position:absolute;top:260px;left:338px;white-space:nowrap" class="ft00">Storage</p>
<p style="position:absolute;top:547px;left:563px;white-space:nowrap" class="ft00">EBP</p>
<p style="position:absolute;top:555px;left:327px;white-space:nowrap" class="ft00">Display</p>
<p style="position:absolute;top:461px;left:435px;white-space:nowrap" class="ft00">Old EBP</p>
<p style="position:absolute;top:633px;left:563px;white-space:nowrap" class="ft00">ESP</p>
<p style="position:absolute;top:478px;left:428px;white-space:nowrap" class="ft00">Main’s&#160;EBP</p>
<p style="position:absolute;top:601px;left:320px;white-space:nowrap" class="ft00">Dynamic</p>
<p style="position:absolute;top:613px;left:325px;white-space:nowrap" class="ft00">Storage</p>
<p style="position:absolute;top:582px;left:407px;white-space:nowrap" class="ft00">Procedure A’s EBP</p>
<p style="position:absolute;top:547px;left:428px;white-space:nowrap" class="ft00">Main’s&#160;EBP</p>
<p style="position:absolute;top:565px;left:427px;white-space:nowrap" class="ft00">Main’s&#160;EBP</p>
</div>
</body>
</html>
