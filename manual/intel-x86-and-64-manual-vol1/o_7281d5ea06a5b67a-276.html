<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 276</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page276-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a276.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">11-22&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROGRAMMING WITH INTEL® STREAMING&#160;SIMD&#160;EXTENSIONS&#160;2 (INTEL® SSE2)</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:93px;white-space:nowrap" class="ft05">Those&#160;SSE and SSE2&#160;instructions&#160;that operate&#160;only&#160;on&#160;XMM registers&#160;(such as&#160;the&#160;packed&#160;and scalar floating-<br/>point instructions&#160;and&#160;the&#160;128-bit SIMD&#160;integer instructions) in&#160;the same&#160;instruction&#160;stream with 64-bit&#160;SIMD&#160;<br/>integer&#160;or x87 FPU&#160;instructions&#160;without any restrictions. For example, an&#160;application can&#160;perform the majority&#160;<br/>of its floating-point computations in the XMM registers, using the packed and scalar floating-point&#160;instructions,&#160;<br/>and at the same time&#160;use the&#160;x87 FPU to&#160;perform trigonometric and other&#160;transcendental computations.&#160;<br/>Likewise, an&#160;application&#160;can&#160;perform&#160;packed&#160;64-bit&#160;and&#160;128-bit SIMD integer operations&#160;together without&#160;<br/>restrictions.</p>
<p style="position:absolute;top:221px;left:68px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:222px;left:93px;white-space:nowrap" class="ft06">Those&#160;SSE&#160;and SSE2 instructions&#160;that operate on&#160;MMX&#160;registers (such&#160;as the CVTPS2PI,&#160;CVTTPS2PI,&#160;CVTPI2PS,&#160;<br/>CVTPD2PI, CVTTPD2PI, CVTPI2PD,&#160;MOVDQ2Q,&#160;MOVQ2DQ,&#160;PADDQ,&#160;and&#160;PSUBQ instructions) can&#160;also be&#160;<br/>executed in the&#160;same instruction stream as 64-bit&#160;SIMD&#160;integer or x87 FPU instructions, however,&#160;here they are&#160;<br/>subject to&#160;the restrictions on the simultaneous&#160;use of&#160;MMX technology and&#160;x87 FPU&#160;instructions, which include:<br/>—&#160;Transition from x87&#160;FPU to MMX technology instructions&#160;or to&#160;SSE or SSE2&#160;instructions&#160;that&#160;operate on MMX&#160;</p>
<p style="position:absolute;top:312px;left:119px;white-space:nowrap" class="ft03">registers&#160;should be&#160;preceded&#160;by&#160;saving&#160;the&#160;state of&#160;the&#160;x87&#160;FPU.</p>
<p style="position:absolute;top:336px;left:93px;white-space:nowrap" class="ft03">—&#160;Transition&#160;from MMX technology instructions or&#160;from&#160;SSE or SSE2&#160;instructions that operate&#160;on MMX&#160;</p>
<p style="position:absolute;top:352px;left:119px;white-space:nowrap" class="ft03">registers&#160;to x87&#160;FPU&#160;instructions&#160;should be&#160;preceded&#160;by&#160;execution of the&#160;EMMS&#160;instruction.</p>
<p style="position:absolute;top:403px;left:68px;white-space:nowrap" class="ft04">11.6.8&#160;</p>
<p style="position:absolute;top:403px;left:148px;white-space:nowrap" class="ft04">Compatibility of&#160;SIMD and x87&#160;FPU&#160;Floating-Point&#160;Data&#160;Types</p>
<p style="position:absolute;top:433px;left:68px;white-space:nowrap" class="ft05">SSE and SSE2&#160;extensions operate on the&#160;same&#160;single-precision and&#160;double-precision floating-point data types&#160;that&#160;<br/>the x87 FPU&#160;operates&#160;on. However,&#160;when&#160;operating on these data types,&#160;the&#160;SSE and SSE2&#160;extensions operate on&#160;<br/>them in their native&#160;format&#160;(single-precision or&#160;double-precision),&#160;in&#160;contrast to&#160;the x87 FPU&#160;which&#160;extends them&#160;<br/>to double extended-precision floating-point&#160;format to&#160;perform computations and&#160;then&#160;rounds&#160;the result&#160;back to&#160;a&#160;<br/>single-precision or&#160;double-precision format before&#160;writing results to memory.&#160;Because&#160;the&#160;x87&#160;FPU operates&#160;on a&#160;<br/>higher&#160;precision format and&#160;then rounds&#160;the result&#160;to a&#160;lower precision format, it&#160;may&#160;return&#160;a&#160;slightly different&#160;<br/>result when performing&#160;the same operation&#160;on&#160;the same single-precision&#160;or double-precision floating-point&#160;values&#160;<br/>than&#160;is returned&#160;by the&#160;SSE and&#160;SSE2 extensions. The difference occurs only in&#160;the least-significant bits&#160;of the&#160;<br/>significand.</p>
<p style="position:absolute;top:616px;left:68px;white-space:nowrap" class="ft04">11.6.9&#160;</p>
<p style="position:absolute;top:616px;left:148px;white-space:nowrap" class="ft04">Mixing Packed and Scalar Floating-Point&#160;and 128-Bit SIMD Integer Instructions and&#160;</p>
<p style="position:absolute;top:637px;left:148px;white-space:nowrap" class="ft04">Data</p>
<p style="position:absolute;top:667px;left:68px;white-space:nowrap" class="ft06">SSE and&#160;SSE2&#160;extensions&#160;define&#160;typed&#160;operations on&#160;packed&#160;and scalar&#160;floating-point data types and&#160;on 128-bit&#160;<br/>SIMD&#160;integer data types,&#160;but IA-32 processors do&#160;not enforce&#160;this&#160;typing&#160;at the&#160;architectural level. They&#160;only&#160;<br/>enforce&#160;it at&#160;the microarchitectural level.&#160;Therefore,&#160;when&#160;a Pentium 4 or Intel Xeon&#160;processor&#160;loads&#160;a packed&#160;or&#160;<br/>scalar floating-point operand or&#160;a 128-bit&#160;packed&#160;integer&#160;operand&#160;from&#160;memory&#160;into&#160;an&#160;XMM&#160;register,&#160;it&#160;does&#160;not&#160;<br/>check that&#160;the actual&#160;data being&#160;loaded matches the data&#160;type specified&#160;in the&#160;instruction. Likewise, when the&#160;<br/>processor&#160;performs an&#160;arithmetic&#160;operation on the&#160;data&#160;in an XMM register,&#160;it does not check&#160;that the&#160;data being&#160;<br/>operated on matches&#160;the&#160;data type specified&#160;in the&#160;instruction.<br/>As a&#160;general rule, because&#160;data&#160;typing of&#160;SIMD floating-point and&#160;integer data&#160;types is&#160;not&#160;enforced&#160;at the&#160;archi-<br/>tectural level, it&#160;is the&#160;responsibility of the&#160;programmer,&#160;assembler,&#160;or compiler&#160;to insure&#160;that code enforces&#160;data&#160;<br/>typing. Failure&#160;to enforce&#160;correct data typing can lead&#160;to&#160;computations that&#160;return&#160;unexpected results.<br/>For&#160;example, in the&#160;following&#160;code&#160;sample, two packed&#160;single-precision floating-point&#160;operands are moved from&#160;<br/>memory&#160;into&#160;XMM registers&#160;(using&#160;MOVAPS instructions); then&#160;a double-precision&#160;packed add operation&#160;(using&#160;the&#160;<br/>ADDPD&#160;instruction)&#160;is performed on the&#160;operands:<br/>movaps</p>
<p style="position:absolute;top:904px;left:169px;white-space:nowrap" class="ft03">xmm0,&#160;[eax]&#160;&#160;; EAX&#160;register&#160;contains&#160;pointer&#160;to&#160;packed&#160;</p>
<p style="position:absolute;top:928px;left:256px;white-space:nowrap" class="ft03">; single-precision floating-point&#160;operand</p>
<p style="position:absolute;top:952px;left:68px;white-space:nowrap" class="ft03">movaps</p>
<p style="position:absolute;top:952px;left:169px;white-space:nowrap" class="ft03">xmm1,&#160;[ebx]</p>
<p style="position:absolute;top:976px;left:68px;white-space:nowrap" class="ft03">addpd</p>
<p style="position:absolute;top:976px;left:169px;white-space:nowrap" class="ft03">xmm0, xmm1</p>
<p style="position:absolute;top:1000px;left:68px;white-space:nowrap" class="ft05">Pentium 4&#160;and&#160;Intel Xeon processors execute these instructions&#160;without generating&#160;an invalid-operand exception&#160;<br/>(#UD) and will&#160;produce&#160;the&#160;expected&#160;results in&#160;register&#160;XMM0&#160;(that is, the&#160;high and&#160;low 64-bits&#160;of&#160;each register&#160;will&#160;<br/>be treated as a double-precision floating-point value and the processor will operate on&#160;them&#160;accordingly). Because&#160;<br/>the data types&#160;operated on&#160;and the data&#160;type expected&#160;by&#160;the&#160;ADDPD instruction&#160;were&#160;inconsistent, the&#160;instruction&#160;</p>
</div>
</body>
</html>
