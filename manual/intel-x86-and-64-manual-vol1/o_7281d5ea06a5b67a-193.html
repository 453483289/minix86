<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 193</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:15px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page193-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a193.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:782px;white-space:nowrap" class="ft00">Vol. 1&#160;8-3</p>
<p style="position:absolute;top:47px;left:634px;white-space:nowrap" class="ft01">PROGRAMMING&#160;WITH&#160;THE X87&#160;FPU</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft07">register&#160;addressing modes, using&#160;the expression&#160;ST(0), or&#160;simply ST, to&#160;represent the&#160;current stack&#160;top&#160;and ST(i)&#160;<br/>to specify the&#160;<i>i</i>th&#160;register from&#160;TOP in the stack (0&#160;≤&#160;<i>i</i>&#160;≤&#160;7). For example,&#160;if&#160;TOP&#160;contains 011B (register 3 is&#160;the top&#160;</p>
<p style="position:absolute;top:133px;left:69px;white-space:nowrap" class="ft02">of&#160;the&#160;stack),&#160;the following instruction would add the contents&#160;of two registers in&#160;the stack&#160;(registers 3&#160;and 5):</p>
<p style="position:absolute;top:154px;left:89px;white-space:nowrap" class="ft02">FADD&#160;ST,&#160;ST(2);</p>
<p style="position:absolute;top:178px;left:69px;white-space:nowrap" class="ft08"><a href="o_7281d5ea06a5b67a-193.html">Figure&#160;8-3</a>&#160;shows an&#160;example&#160;of how the stack structure of&#160;the x87 FPU registers and instructions are typically used&#160;<br/>to perform&#160;a series of computations. Here, a&#160;two-dimensional&#160;dot product is&#160;computed, as&#160;follows:<br/>1.&#160;The&#160;first instruction (FLD&#160;value1) decrements&#160;the&#160;stack register&#160;pointer&#160;(TOP) and&#160;loads the&#160;value 5.6&#160;from&#160;</p>
<p style="position:absolute;top:235px;left:95px;white-space:nowrap" class="ft02">memory&#160;into ST(0). The&#160;result&#160;of&#160;this&#160;operation is&#160;shown in&#160;snap-shot (a).&#160;</p>
<p style="position:absolute;top:259px;left:69px;white-space:nowrap" class="ft02">2.&#160;The&#160;second instruction multiplies the&#160;value in ST(0)&#160;by&#160;the value&#160;2.4 from&#160;memory&#160;and stores&#160;the&#160;result&#160;in&#160;</p>
<p style="position:absolute;top:276px;left:95px;white-space:nowrap" class="ft02">ST(0), shown&#160;in snap-shot&#160;(b).</p>
<p style="position:absolute;top:300px;left:69px;white-space:nowrap" class="ft09">3.&#160;The&#160;third instruction decrements TOP&#160;and loads the&#160;value 3.8&#160;in&#160;ST(0).<br/>4.&#160;The&#160;fourth instruction multiplies the&#160;value in&#160;ST(0) by the&#160;value 10.3&#160;from&#160;memory&#160;and&#160;stores&#160;the result&#160;in&#160;</p>
<p style="position:absolute;top:340px;left:95px;white-space:nowrap" class="ft02">ST(0), shown&#160;in snap-shot&#160;(c).</p>
<p style="position:absolute;top:364px;left:69px;white-space:nowrap" class="ft02">5.&#160;The&#160;fifth instruction adds the value&#160;and the&#160;value in&#160;ST(1) and&#160;stores&#160;the&#160;result in&#160;ST(0),&#160;shown in snap-shot&#160;</p>
<p style="position:absolute;top:381px;left:94px;white-space:nowrap" class="ft02">(d).</p>
<p style="position:absolute;top:838px;left:69px;white-space:nowrap" class="ft07">The style of programming demonstrated in&#160;this example is supported by the floating-point instruction&#160;set. In cases&#160;<br/>where&#160;the&#160;stack structure causes&#160;computation bottlenecks,&#160;the FXCH&#160;(exchange&#160;x87&#160;FPU register&#160;contents)&#160;<br/>instruction&#160;can be&#160;used to&#160;streamline&#160;a computation.</p>
<p style="position:absolute;top:915px;left:69px;white-space:nowrap" class="ft04">8.1.2.1&#160;&#160;</p>
<p style="position:absolute;top:915px;left:153px;white-space:nowrap" class="ft04">Parameter&#160;Passing With&#160;the x87 FPU&#160;Register&#160;Stack</p>
<p style="position:absolute;top:943px;left:69px;white-space:nowrap" class="ft07">Like&#160;the general-purpose registers,&#160;the contents&#160;of the&#160;x87 FPU&#160;data registers are&#160;unaffected&#160;by procedure calls, or&#160;<br/>in other&#160;words, the&#160;values&#160;are&#160;maintained&#160;across procedure boundaries. A calling&#160;procedure&#160;can thus&#160;use the&#160;x87&#160;<br/>FPU data registers&#160;(as well&#160;as the&#160;procedure&#160;stack) for&#160;passing&#160;parameter between procedures. The called proce-<br/>dure&#160;can reference parameters&#160;passed through the&#160;register&#160;stack using&#160;the current&#160;stack register pointer (TOP)&#160;<br/>and the ST(0) and ST(i) nomenclature. It is&#160;also common practice for a called procedure to leave a return value or&#160;<br/>result in&#160;register&#160;ST(0)&#160;when returning execution&#160;to the&#160;calling procedure&#160;or program.</p>
<p style="position:absolute;top:792px;left:266px;white-space:nowrap" class="ft05">Figure&#160;8-3. &#160;Example x87 FPU Dot&#160;Product&#160;Computation</p>
<p style="position:absolute;top:583px;left:195px;white-space:nowrap" class="ft02">(a)</p>
<p style="position:absolute;top:606px;left:180px;white-space:nowrap" class="ft02">R7</p>
<p style="position:absolute;top:628px;left:180px;white-space:nowrap" class="ft02">R6</p>
<p style="position:absolute;top:650px;left:180px;white-space:nowrap" class="ft02">R5</p>
<p style="position:absolute;top:671px;left:180px;white-space:nowrap" class="ft02">R4</p>
<p style="position:absolute;top:693px;left:180px;white-space:nowrap" class="ft02">R3</p>
<p style="position:absolute;top:715px;left:180px;white-space:nowrap" class="ft02">R2</p>
<p style="position:absolute;top:738px;left:180px;white-space:nowrap" class="ft02">R1</p>
<p style="position:absolute;top:760px;left:180px;white-space:nowrap" class="ft02">R0</p>
<p style="position:absolute;top:431px;left:327px;white-space:nowrap" class="ft06"><b>Computation</b></p>
<p style="position:absolute;top:672px;left:275px;white-space:nowrap" class="ft02">ST(0)</p>
<p style="position:absolute;top:672px;left:227px;white-space:nowrap" class="ft02">5.6</p>
<p style="position:absolute;top:584px;left:336px;white-space:nowrap" class="ft02">(b)</p>
<p style="position:absolute;top:606px;left:321px;white-space:nowrap" class="ft02">R7</p>
<p style="position:absolute;top:628px;left:320px;white-space:nowrap" class="ft02">R6</p>
<p style="position:absolute;top:650px;left:320px;white-space:nowrap" class="ft02">R5</p>
<p style="position:absolute;top:672px;left:320px;white-space:nowrap" class="ft02">R4</p>
<p style="position:absolute;top:694px;left:320px;white-space:nowrap" class="ft02">R3</p>
<p style="position:absolute;top:715px;left:321px;white-space:nowrap" class="ft02">R2</p>
<p style="position:absolute;top:738px;left:321px;white-space:nowrap" class="ft02">R1</p>
<p style="position:absolute;top:760px;left:320px;white-space:nowrap" class="ft02">R0</p>
<p style="position:absolute;top:672px;left:416px;white-space:nowrap" class="ft02">ST(0)</p>
<p style="position:absolute;top:672px;left:361px;white-space:nowrap" class="ft02">13.44</p>
<p style="position:absolute;top:584px;left:474px;white-space:nowrap" class="ft02">(c)</p>
<p style="position:absolute;top:606px;left:460px;white-space:nowrap" class="ft02">R7</p>
<p style="position:absolute;top:628px;left:459px;white-space:nowrap" class="ft02">R6</p>
<p style="position:absolute;top:650px;left:459px;white-space:nowrap" class="ft02">R5</p>
<p style="position:absolute;top:672px;left:459px;white-space:nowrap" class="ft02">R4</p>
<p style="position:absolute;top:694px;left:459px;white-space:nowrap" class="ft02">R3</p>
<p style="position:absolute;top:715px;left:459px;white-space:nowrap" class="ft02">R2</p>
<p style="position:absolute;top:738px;left:460px;white-space:nowrap" class="ft02">R1</p>
<p style="position:absolute;top:760px;left:459px;white-space:nowrap" class="ft02">R0</p>
<p style="position:absolute;top:672px;left:555px;white-space:nowrap" class="ft02">ST(1)</p>
<p style="position:absolute;top:694px;left:555px;white-space:nowrap" class="ft02">ST(0)</p>
<p style="position:absolute;top:672px;left:499px;white-space:nowrap" class="ft02">13.44</p>
<p style="position:absolute;top:584px;left:616px;white-space:nowrap" class="ft02">(d)</p>
<p style="position:absolute;top:607px;left:601px;white-space:nowrap" class="ft02">R7</p>
<p style="position:absolute;top:628px;left:601px;white-space:nowrap" class="ft02">R6</p>
<p style="position:absolute;top:650px;left:601px;white-space:nowrap" class="ft02">R5</p>
<p style="position:absolute;top:672px;left:601px;white-space:nowrap" class="ft02">R4</p>
<p style="position:absolute;top:694px;left:601px;white-space:nowrap" class="ft02">R3</p>
<p style="position:absolute;top:716px;left:601px;white-space:nowrap" class="ft02">R2</p>
<p style="position:absolute;top:738px;left:601px;white-space:nowrap" class="ft02">R1</p>
<p style="position:absolute;top:760px;left:601px;white-space:nowrap" class="ft02">R0</p>
<p style="position:absolute;top:672px;left:696px;white-space:nowrap" class="ft02">ST(1)</p>
<p style="position:absolute;top:694px;left:697px;white-space:nowrap" class="ft02">ST(0)</p>
<p style="position:absolute;top:694px;left:500px;white-space:nowrap" class="ft02">39.14</p>
<p style="position:absolute;top:672px;left:642px;white-space:nowrap" class="ft02">13.44</p>
<p style="position:absolute;top:694px;left:643px;white-space:nowrap" class="ft02">52.58</p>
<p style="position:absolute;top:446px;left:327px;white-space:nowrap" class="ft02">Dot Product = (5.6&#160;x&#160;2.4)&#160;+ (3.8&#160;x&#160;10.3)</p>
<p style="position:absolute;top:475px;left:327px;white-space:nowrap" class="ft011"><b>Code:<br/></b>FLD&#160; value1&#160;;(a)&#160;value1&#160;=&#160;5.6<br/>FMUL&#160;value2&#160;;(b)&#160;value2&#160;=&#160;2.4<br/>FLD&#160; value3&#160;;&#160;value3&#160;=&#160;3.8<br/>FMUL&#160;value4&#160;;(c)value4&#160;= 10.3<br/>FADD&#160;ST(1)&#160;&#160;;(d)</p>
</div>
</body>
</html>
