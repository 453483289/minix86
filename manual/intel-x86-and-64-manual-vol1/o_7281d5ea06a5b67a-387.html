<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 387</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:14px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page387-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a387.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:775px;white-space:nowrap" class="ft00">Vol. 1&#160;16-7</p>
<p style="position:absolute;top:47px;left:380px;white-space:nowrap" class="ft01">PROGRAMMING WITH&#160;INTEL®&#160;TRANSACTIONAL SYNCHRONIZATION EXTENSIONS</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft03">Update&#160;to&#160;non-status&#160;portion of EFLAGS:&#160;CLI,&#160;STI,&#160;POPFD,&#160;POPFQ.</p>
<p style="position:absolute;top:122px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:123px;left:95px;white-space:nowrap" class="ft05">Instructions&#160;that update segment registers, debug&#160;registers and/or&#160;control&#160;registers: MOV to&#160;<br/>DS/ES/FS/GS/SS,&#160;POP&#160;DS/ES/FS/GS/SS,&#160;LDS,&#160;LES,&#160;LFS,&#160;LGS,&#160;LSS,&#160;SWAPGS,&#160;WRFSBASE,&#160;WRGSBASE,&#160;LGDT,&#160;<br/>SGDT,&#160;LIDT,&#160;SIDT,&#160;LLDT,&#160;SLDT,&#160;LTR,&#160;STR,&#160;Far&#160;CALL,&#160;Far&#160;JMP,&#160;Far&#160;RET,&#160;IRET,&#160;MOV&#160;to&#160;DRx,&#160;MOV&#160;to&#160;<br/>CR0/CR2/CR3/CR4/CR8, CLTS and&#160;LMSW.</p>
<p style="position:absolute;top:194px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:195px;left:95px;white-space:nowrap" class="ft03">Ring&#160;transitions: SYSENTER,&#160;SYSCALL,&#160;SYSEXIT,&#160;and&#160;SYSRET.</p>
<p style="position:absolute;top:217px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:217px;left:95px;white-space:nowrap" class="ft05">TLB and Cacheability&#160;control:&#160;CLFLUSH, CLFLUSHOPT,&#160;INVD, WBINVD,&#160;INVLPG, INVPCID,&#160;and memory instruc-<br/>tions&#160;with&#160;a non-temporal&#160;hint (V/MOVNTDQA,&#160;V/MOVNTDQ,&#160;V/MOVNTI, V/MOVNTPD,&#160;V/MOVNTPS,&#160;<br/>V/MOVNTQ,&#160;V/MASKMOVQ,&#160;and&#160;V/MASKMOVDQU).</p>
<p style="position:absolute;top:272px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:273px;left:95px;white-space:nowrap" class="ft03">Processor&#160;state save: XSAVE, XSAVEOPT, and&#160;XRSTOR.</p>
<p style="position:absolute;top:295px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:295px;left:95px;white-space:nowrap" class="ft03">Interrupts: INTn,&#160;INTO.</p>
<p style="position:absolute;top:317px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:318px;left:95px;white-space:nowrap" class="ft03">IO: IN, INS,&#160;REP&#160;INS,&#160;OUT,&#160;OUTS, REP&#160;OUTS&#160;and their&#160;variants.</p>
<p style="position:absolute;top:340px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:340px;left:95px;white-space:nowrap" class="ft05">VMX: VMPTRLD,&#160;VMPTRST,&#160;VMCLEAR,&#160;VMREAD,&#160;VMWRITE,&#160;VMCALL,&#160;VMLAUNCH, VMRESUME,&#160;VMXOFF,&#160;<br/>VMXON,&#160;INVEPT,&#160;INVVPID,&#160;and&#160;VMFUNC.</p>
<p style="position:absolute;top:379px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:379px;left:95px;white-space:nowrap" class="ft03">SMX: GETSEC.</p>
<p style="position:absolute;top:401px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:402px;left:95px;white-space:nowrap" class="ft05">UD2,&#160;RSM,&#160;RDMSR, WRMSR, HLT,&#160;MONITOR,&#160;MWAIT,&#160;XSETBV, VZEROUPPER,&#160;MASKMOVQ, and&#160;<br/>V/MASKMOVDQU.</p>
<p style="position:absolute;top:463px;left:69px;white-space:nowrap" class="ft04">16.3.8.2 &#160;&#160;Runtime Considerations</p>
<p style="position:absolute;top:490px;left:69px;white-space:nowrap" class="ft05">In addition to&#160;the&#160;instruction-based considerations,&#160;runtime events&#160;may cause transactional&#160;execution to&#160;abort.&#160;<br/>These may be due to&#160;data access patterns or&#160;micro-architectural&#160;implementation&#160;causes.&#160;Keep&#160;in&#160;mind that&#160;the&#160;<br/>following&#160;list is&#160;not a comprehensive&#160;discussion of&#160;all abort&#160;causes.&#160;<br/>Any fault or&#160;trap&#160;in a&#160;transactional region&#160;that must&#160;be&#160;exposed to&#160;software&#160;will be suppressed.&#160;Transactional&#160;<br/>execution will abort and execution will transition to&#160;a non-transactional&#160;execution, as&#160;if&#160;the fault or trap had never&#160;<br/>occurred. If any&#160;exception is&#160;not masked,&#160;that&#160;will result&#160;in a transactional abort&#160;and it&#160;will be&#160;as&#160;if&#160;the exception&#160;<br/>had never&#160;occurred.<br/>When executed&#160;in VMX non-root operation,&#160;certain instructions may result in a VM exit. When such instructions are&#160;<br/>executed inside&#160;a transactional region, then instead of causing a VM exit, they will&#160;cause a transactional abort and&#160;<br/>the execution&#160;will appear as&#160;if instruction that&#160;would have&#160;caused&#160;a VM&#160;exit never executed.<br/>Synchronous exception&#160;events&#160;(#DE,&#160;#OF,&#160;#NP,&#160;#SS,&#160;#GP,&#160;#BR, #UD,&#160;#AC,&#160;#XM, #PF,&#160;#NM, #TS,&#160;#MF,&#160;#DB,&#160;<br/>#BP/INT3) that occur&#160;during transactional&#160;execution&#160;may&#160;cause&#160;an execution&#160;not to&#160;commit transactionally, and&#160;<br/>require&#160;a non-transactional execution.&#160;These events are&#160;suppressed&#160;as if they had&#160;never&#160;occurred. With HLE,&#160;since&#160;<br/>the&#160;non-transactional code path&#160;is identical to&#160;the transactional&#160;code&#160;path, these events will typically&#160;re-appear&#160;<br/>when the&#160;instruction that caused the exception is re-executed&#160;non-transactionally, causing the associated&#160;synchro-<br/>nous events&#160;to&#160;be&#160;delivered appropriately&#160;in the&#160;non-transactional execution.&#160;The same&#160;behavior also&#160;applies to&#160;<br/>synchronous events (EPT violations,&#160;EPT misconfigurations, and&#160;accesses&#160;to the&#160;APIC-access page)&#160;that&#160;occur in&#160;<br/>VMX non-root&#160;operation.<br/>Asynchronous events (NMI,&#160;SMI,&#160;INTR,&#160;IPI, PMI, etc.)&#160;occurring during transactional&#160;execution may&#160;cause&#160;the&#160;<br/>transactional execution&#160;to abort and&#160;transition to&#160;a non-transactional execution. The&#160;asynchronous&#160;events&#160;will&#160;be&#160;<br/>pended and&#160;handled&#160;after the&#160;transactional abort is&#160;processed. The same&#160;behavior also&#160;applies to&#160;asynchronous&#160;<br/>events&#160;(VMX-preemption&#160;timer expiry, virtual-interrupt&#160;delivery,&#160;and&#160;interrupt-window exiting)&#160;that occur in&#160;VMX&#160;<br/>non-root operation.<br/>Transactional execution only&#160;supports&#160;write-back cacheable&#160;memory type operations. A&#160;transactional&#160;region may&#160;<br/>always abort if it&#160;includes&#160;operations&#160;on any&#160;other memory&#160;type. This includes&#160;instruction fetches to UC memory&#160;<br/>type.<br/>Memory accesses within a transactional region may require the processor to set the&#160;Accessed and Dirty flags of the&#160;<br/>referenced&#160;page table entry.&#160;The&#160;behavior of how the&#160;processor handles&#160;this is&#160;implementation specific. Some&#160;<br/>implementations may allow the updates&#160;to&#160;these&#160;flags to become externally&#160;visible even if&#160;the&#160;transactional&#160;region&#160;<br/>subsequently&#160;aborts. Some&#160;Intel&#160;TSX implementations may&#160;choose to&#160;abort the transactional&#160;execution if these&#160;<br/>flags need to be updated.&#160;Further,&#160;a processor's page-table walk may generate accesses to its own transactionally&#160;<br/>written&#160;but uncommitted state.&#160;Some&#160;Intel TSX implementations&#160;may&#160;choose&#160;to&#160;abort the&#160;execution of a&#160;transac-<br/>tional region&#160;in such situations. Regardless, the&#160;architecture ensures that, if the&#160;transactional region aborts, then&#160;</p>
</div>
</body>
</html>
