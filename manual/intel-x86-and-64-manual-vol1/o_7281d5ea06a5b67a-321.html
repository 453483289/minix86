<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 321</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:18px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:8px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:16px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:21px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page321-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a321.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:768px;white-space:nowrap" class="ft00">Vol. 1&#160;13-15</p>
<p style="position:absolute;top:47px;left:544px;white-space:nowrap" class="ft01">MANAGING&#160;STATE&#160;USING&#160;THE XSAVE&#160;FEATURE SET</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:100px;left:95px;white-space:nowrap" class="ft03">If&#160;CR0.TS[bit&#160;3] is&#160;1,&#160;a device-not-available exception (#NM)&#160;occurs.</p>
<p style="position:absolute;top:122px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:123px;left:95px;white-space:nowrap" class="ft03">If the&#160;address of&#160;the XSAVE area is&#160;not&#160;64-byte&#160;aligned,&#160;a general-protection exception (#GP)&#160;occurs.</p>
<p style="position:absolute;top:120px;left:781px;white-space:nowrap" class="ft04">1</p>
<p style="position:absolute;top:147px;left:69px;white-space:nowrap" class="ft08">After&#160;checking&#160;for these faults,&#160;the XRSTOR&#160;instruction&#160;reads&#160;the XCOMP_BV&#160;field&#160;in the&#160;XSAVE area’s&#160;XSAVE&#160;<br/>header&#160;(see<a href="o_7281d5ea06a5b67a-313.html">&#160;Section 13.4.2</a>).&#160;If XCOMP_BV[63]&#160;= 0,&#160;the&#160;<b>standard form&#160;of XRSTOR</b>&#160;is&#160;executed&#160;(see<a href="o_7281d5ea06a5b67a-321.html">&#160;Section&#160;<br/>13.8.1); otherwise,</a>&#160;the&#160;<b>compacted form of XRSTOR</b>&#160;is&#160;executed&#160;(see<a href="o_7281d5ea06a5b67a-321.html">&#160;Section 13.8.2).</a></p>
<p style="position:absolute;top:177px;left:665px;white-space:nowrap" class="ft04">2</p>
<p style="position:absolute;top:204px;left:69px;white-space:nowrap" class="ft03">Se<a href="o_7281d5ea06a5b67a-308.html">e Section 13.2&#160;for de</a>tails of&#160;how to&#160;determine&#160;whether&#160;the compacted form of XRSTOR&#160;is supported.</p>
<p style="position:absolute;top:254px;left:69px;white-space:nowrap" class="ft06">13.8.1&#160;</p>
<p style="position:absolute;top:254px;left:150px;white-space:nowrap" class="ft06">Standard&#160;Form of&#160;XRSTOR</p>
<p style="position:absolute;top:285px;left:69px;white-space:nowrap" class="ft08">The standard from&#160;of XRSTOR performs&#160;additional&#160;fault&#160;checking. Either&#160;of&#160;the following&#160;conditions&#160;causes a&#160;<br/>general-protection exception&#160;(#GP):</p>
<p style="position:absolute;top:323px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:324px;left:95px;white-space:nowrap" class="ft03">The XSTATE_BV field&#160;of the&#160;XSAVE&#160;header sets&#160;a bit that is&#160;not set in XCR0.</p>
<p style="position:absolute;top:346px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:346px;left:95px;white-space:nowrap" class="ft03">Bytes&#160;23:8 of&#160;the XSAVE header&#160;are not&#160;all 0&#160;(this implies that&#160;all bits&#160;in XCOMP_BV are&#160;0).</p>
<p style="position:absolute;top:344px;left:711px;white-space:nowrap" class="ft04">3</p>
<p style="position:absolute;top:370px;left:69px;white-space:nowrap" class="ft08">If none of these conditions&#160;cause a&#160;fault,&#160;the&#160;processor updates each state&#160;component&#160;<i>i</i>&#160;for which&#160;RFBM[<i>i</i>]&#160;=&#160;&#160;1.&#160;<br/>XRSTOR updates state component&#160;<i>i</i>&#160;based on the&#160;value of bit&#160;<i>i</i>&#160;in the&#160;XSTATE_BV&#160;field&#160;of the&#160;XSAVE&#160;header:</p>
<p style="position:absolute;top:409px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:409px;left:95px;white-space:nowrap" class="ft08">If XSTATE_BV[<i>i</i>]&#160;=&#160;0, the&#160;state component&#160;is set to&#160;its initial&#160;configur<a href="o_7281d5ea06a5b67a-318.html">ation. Section 13.6</a>&#160;specifies the&#160;initial&#160;<br/>configuration of&#160;each state&#160;component.<br/>The&#160;initial configuration of&#160;state&#160;component&#160;1&#160;pertains only to the XMM registers&#160;and&#160;not to MXCSR.&#160;See below&#160;<br/>for the&#160;treatment of&#160;MXCSR</p>
<p style="position:absolute;top:487px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:487px;left:95px;white-space:nowrap" class="ft08">If XSTATE_BV[<i>i</i>]&#160;=&#160;1,&#160;the state&#160;component is&#160;loaded with data from the&#160;XSAVE area.&#160;S<a href="o_7281d5ea06a5b67a-314.html">ee&#160;Section&#160;13.5&#160;</a>for&#160;<br/>specifics for each state&#160;component and for details regarding&#160;mode-specific&#160;operation&#160;and operation determined&#160;<br/>by instruction prefixes.&#160;Se<a href="o_7281d5ea06a5b67a-327.html">e Section 13.13 for deta</a>ils&#160;regarding faults caused&#160;by&#160;memory accesses.<br/>State components 0&#160;and&#160;1 are&#160;located&#160;in the legacy&#160;region of the XSAVE area&#160;<a href="o_7281d5ea06a5b67a-312.html">(see Section 13.4.1).</a>&#160;Each state&#160;<br/>component&#160;<i>i</i>, 2&#160;≤&#160;<i>i</i>&#160;≤&#160;62,&#160;is located in&#160;the extended&#160;region;&#160;the&#160;standard form&#160;of XRSTOR uses the&#160;standard&#160;</p>
<p style="position:absolute;top:576px;left:94px;white-space:nowrap" class="ft03">format&#160;for the&#160;extended&#160;region&#160;(see<a href="o_7281d5ea06a5b67a-314.html">&#160;Section 13.4.3).</a></p>
<p style="position:absolute;top:600px;left:69px;white-space:nowrap" class="ft08">The&#160;MXCSR register&#160;is part of state&#160;component 1,&#160;SSE state&#160;<a href="o_7281d5ea06a5b67a-315.html">(see&#160;Section 13.5.2).</a>&#160;However,&#160;the&#160;standard&#160;form of&#160;<br/>XRSTOR loads the MXCSR register from memory whenever&#160;the&#160;RFBM[1] (SSE) or RFBM[2] (AVX) is set, regardless&#160;<br/>of the&#160;values of XSTATE_BV[1]&#160;and&#160;XSTATE_BV[2]. The standard form&#160;of&#160;XRSTOR causes a&#160;general-protection&#160;<br/>exception (#GP)&#160;if&#160;it would load MXCSR&#160;with&#160;an illegal value.</p>
<p style="position:absolute;top:700px;left:69px;white-space:nowrap" class="ft06">13.8.2&#160;</p>
<p style="position:absolute;top:700px;left:149px;white-space:nowrap" class="ft06">Compacted Form of&#160;XRSTOR</p>
<p style="position:absolute;top:730px;left:69px;white-space:nowrap" class="ft03">The compacted from&#160;of XRSTOR&#160;performs&#160;additional fault checking. Any of the&#160;following&#160;conditions causes&#160;a #GP:</p>
<p style="position:absolute;top:752px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:753px;left:95px;white-space:nowrap" class="ft03">The&#160;XCOMP_BV field of the&#160;XSAVE header sets a&#160;bit&#160;in&#160;the range&#160;62:0 that is&#160;not set&#160;in&#160;XCR0.</p>
<p style="position:absolute;top:775px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:775px;left:95px;white-space:nowrap" class="ft03">The XSTATE_BV field&#160;of the&#160;XSAVE&#160;header sets&#160;a bit (including&#160;bit&#160;63) that is&#160;not set&#160;in XCOMP_BV.</p>
<p style="position:absolute;top:797px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:798px;left:95px;white-space:nowrap" class="ft03">Bytes&#160;63:16&#160;of the&#160;XSAVE header are&#160;not all&#160;0.</p>
<p style="position:absolute;top:822px;left:69px;white-space:nowrap" class="ft08">If none of these conditions&#160;cause a&#160;fault,&#160;the&#160;processor updates each state&#160;component&#160;<i>i</i>&#160;for which&#160;RFBM[<i>i</i>]&#160;=&#160;&#160;1.&#160;<br/>XRSTOR updates state component&#160;<i>i</i>&#160;based on the&#160;value of bit&#160;<i>i</i>&#160;in the&#160;XSTATE_BV&#160;field&#160;of the&#160;XSAVE&#160;header:</p>
<p style="position:absolute;top:860px;left:69px;white-space:nowrap" class="ft02">•</p>
<p style="position:absolute;top:861px;left:95px;white-space:nowrap" class="ft08">If XSTATE_BV[<i>i</i>]&#160;=&#160;0, the&#160;state component&#160;is set to&#160;its initial&#160;configur<a href="o_7281d5ea06a5b67a-318.html">ation. Section 13.6</a>&#160;specifies the&#160;initial&#160;<br/>configuration of&#160;each state&#160;component.</p>
<p style="position:absolute;top:946px;left:69px;white-space:nowrap" class="ft010">1.&#160;If&#160;CR0.AM&#160;= 1, CPL&#160;=&#160;3,&#160;and&#160;EFLAGS.AC&#160;=1, an&#160;alignment-check exception&#160;(#AC) may occur instead&#160;of&#160;#GP.<br/>2.&#160;If the processor does&#160;not&#160;support the compacted&#160;form&#160;of&#160;XRSTOR, it&#160;may execute the&#160;standard&#160;form&#160;of&#160;XRSTOR without&#160;first read-</p>
<p style="position:absolute;top:984px;left:91px;white-space:nowrap" class="ft03">ing the&#160;XCOMP_BV&#160;field.&#160;A processor&#160;supports the compacted&#160;form&#160;of&#160;XRSTOR&#160;only if&#160;it&#160;enumerates&#160;</p>
<p style="position:absolute;top:1000px;left:91px;white-space:nowrap" class="ft03">CPUID.(EAX=0DH,ECX=1):EAX[1] as&#160;1.</p>
<p style="position:absolute;top:1021px;left:69px;white-space:nowrap" class="ft03">3.&#160;Bytes&#160;63:24&#160;of&#160;the XSAVE header&#160;are also&#160;reserved.&#160;Software&#160;should&#160;ensure&#160;that&#160;bytes&#160;63:16&#160;of&#160;the&#160;XSAVE header&#160;are&#160;all&#160;0&#160;in&#160;any&#160;</p>
<p style="position:absolute;top:1038px;left:91px;white-space:nowrap" class="ft03">XSAVE&#160;area. (Bytes&#160;15:8 should also be&#160;0 if&#160;the XSAVE&#160;area&#160;is&#160;to&#160;be used on a processor that&#160;does not support&#160;the compaction&#160;</p>
<p style="position:absolute;top:1054px;left:91px;white-space:nowrap" class="ft03">extensions to&#160;the XSAVE feature set.)</p>
</div>
</body>
</html>
