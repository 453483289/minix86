<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 350</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page350-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a350.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">14-22&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROGRAMMING WITH AVX, FMA&#160;AND&#160;AVX2</p>
<p style="position:absolute;top:257px;left:68px;white-space:nowrap" class="ft02">14.5.1 FMA&#160;</p>
<p style="position:absolute;top:257px;left:188px;white-space:nowrap" class="ft02">Instruction&#160;</p>
<p style="position:absolute;top:257px;left:280px;white-space:nowrap" class="ft02">Operand&#160;</p>
<p style="position:absolute;top:257px;left:353px;white-space:nowrap" class="ft02">Order and Arithmetic Behavior</p>
<p style="position:absolute;top:286px;left:68px;white-space:nowrap" class="ft06">FMA instruction mnemonics are&#160;defined explicitly&#160;with&#160;an&#160;ordered three digits,&#160;e.g.&#160;VFMADD132PD.&#160;The value&#160;of&#160;<br/>each digit&#160;refers to&#160;the ordering of&#160;the three source&#160;operand as&#160;defined by instruction encoding specification:</p>
<p style="position:absolute;top:325px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:325px;left:93px;white-space:nowrap" class="ft03">‘1’: The&#160;first source&#160;operand (also&#160;the destination&#160;operand)&#160;in the&#160;syntactical order listed in this&#160;specification.</p>
<p style="position:absolute;top:347px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:348px;left:93px;white-space:nowrap" class="ft03">‘2’: The second&#160;source&#160;operand&#160;in the&#160;syntactical&#160;order.&#160;This&#160;is a YMM/XMM&#160;register, encoded&#160;using VEX prefix.</p>
<p style="position:absolute;top:370px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:370px;left:93px;white-space:nowrap" class="ft06">‘3’: The&#160;third source operand&#160;in the syntactical order.&#160;The&#160;first&#160;and&#160;third operand are&#160;encoded following&#160;ModR/M&#160;<br/>encoding&#160;rules.&#160;</p>
<p style="position:absolute;top:409px;left:68px;white-space:nowrap" class="ft06">The&#160;ordering&#160;of&#160;each&#160;digit within the&#160;mnemonic refers to&#160;the floating-point data listed on&#160;the right-hand side&#160;of the&#160;<br/>arithmetic&#160;equation of each&#160;FMA operation (see<a href="o_7281d5ea06a5b67a-352.html">&#160;Table&#160;14-17</a>):</p>
<p style="position:absolute;top:448px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:448px;left:93px;white-space:nowrap" class="ft06">The first position&#160;in the&#160;three&#160;digits&#160;of&#160;a FMA&#160;mnemonic&#160;refers to&#160;the operand&#160;position of the first FP data&#160;<br/>expressed in&#160;the arithmetic&#160;equation&#160;of FMA operation, the&#160;multiplicand.</p>
<p style="position:absolute;top:487px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:487px;left:93px;white-space:nowrap" class="ft06">The second&#160;position in the&#160;three digits of a&#160;FMA&#160;mnemonic&#160;refers to the&#160;operand position of the&#160;second FP&#160;data&#160;<br/>expressed in&#160;the arithmetic&#160;equation&#160;of FMA operation, the&#160;multiplier.</p>
<p style="position:absolute;top:526px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:526px;left:93px;white-space:nowrap" class="ft06">The third&#160;position in&#160;the three digits of a&#160;FMA mnemonic&#160;refers&#160;to the&#160;operand position&#160;of&#160;the FP&#160;data being&#160;<br/>added/subtracted to the&#160;multiplication&#160;result.&#160;</p>
<p style="position:absolute;top:565px;left:68px;white-space:nowrap" class="ft06">Note&#160;the non-numerical&#160;result&#160;of&#160;an FMA operation does&#160;not resemble&#160;the mathematically-defined commutative&#160;<br/>property&#160;between the&#160;multiplicand and&#160;the multiplier values&#160;(see<a href="o_7281d5ea06a5b67a-352.html">&#160;Table&#160;14-17</a>).&#160;Consequently, software tools&#160;(such&#160;<br/>as an&#160;assembler)&#160;may&#160;support a&#160;complementary set of&#160;FMA mnemonics for each&#160;FMA&#160;instruction for ease of&#160;<br/>programming&#160;to take&#160;advantage of the&#160;mathematical property&#160;of&#160;commutative&#160;multiplications. For example,&#160;an&#160;<br/>assembler may&#160;optionally support&#160;the&#160;complementary&#160;mnemonic&#160;“VFMADD312PD”&#160;in addition to the true&#160;<br/>mnemonic&#160;“VFMADD132PD“. The assembler will generate&#160;the&#160;same instruction&#160;opcode&#160;sequence corresponding to&#160;<br/>VFMADD132PD.&#160;The&#160;processor executes&#160;VFMADD132PD and&#160;report any&#160;NAN&#160;conditions based on&#160;the definition&#160;of&#160;<br/>VFMADD132PD.&#160;Similarly,&#160;if the complementary mnemonic&#160;VFMADD123PD is supported by an assembler at&#160;source&#160;<br/>level,&#160;it must generate&#160;the&#160;opcode&#160;sequence corresponding&#160;to VFMADD213PD; the complementary mnemonic&#160;<br/>VFMADD321PD&#160;must produce the&#160;opcode&#160;sequence&#160;defined&#160;by VFMADD231PD.&#160;In&#160;the absence&#160;of&#160;FMA&#160;operations&#160;<br/>reporting a NAN result,&#160;the&#160;numerical results of using&#160;either mnemonic&#160;with&#160;an assembler supporting both&#160;<br/>mnemonics will match&#160;the behavior&#160;defined&#160;<a href="o_7281d5ea06a5b67a-352.html">in Table&#160;14-17.&#160;</a>Support for the&#160;complementary FMA mnemonics by&#160;<br/>software tools&#160;is optional.&#160;</p>
<p style="position:absolute;top:814px;left:68px;white-space:nowrap" class="ft02">14.5.2&#160;</p>
<p style="position:absolute;top:814px;left:148px;white-space:nowrap" class="ft02">Fused-Multiply-ADD (FMA) Numeric Behavior</p>
<p style="position:absolute;top:843px;left:68px;white-space:nowrap" class="ft06">FMA instructions can&#160;perform fused-multiply-add&#160;operations (including&#160;fused-multiply-subtract, and other&#160;vari-<br/>eties)&#160;on packed&#160;and scalar data&#160;elements&#160;in the&#160;instruction&#160;operands.&#160;Separate&#160;FMA instructions are&#160;provided&#160;to&#160;<br/>handle&#160;different types of arithmetic&#160;operations on the&#160;three&#160;source&#160;operands.<br/>FMA instruction syntax&#160;is defined using three&#160;source&#160;operands and&#160;the first source&#160;operand is&#160;updated based&#160;on&#160;the&#160;<br/>result of the arithmetic operations of&#160;the data elements of 128-bit or 256-bit&#160;operands, i.e. The&#160;first source operand&#160;<br/>is also&#160;the destination operand.<br/>The&#160;arithmetic FMA operation&#160;performed&#160;in&#160;an&#160;FMA instruction takes one&#160;of&#160;several forms,&#160;r=(x*y)+z, r=(x*y)-z,&#160;<br/>r=-(x*y)+z, or r=-(x*y)-z. Packed&#160;FMA&#160;instructions&#160;can perform eight single-precision&#160;FMA operations or&#160;four&#160;<br/>double-precision FMA operations&#160;with&#160;256-bit vectors.&#160;<br/>Scalar&#160;FMA instructions only perform&#160;one&#160;arithmetic&#160;operation&#160;on&#160;the low order data element.&#160;The content&#160;of&#160;the&#160;<br/>rest&#160;of&#160;the data elements in the lower 128-bits&#160;of the&#160;destination&#160;operand is&#160;preserved.&#160;the upper 128bits of the&#160;<br/>destination operand&#160;are filled with zero.&#160;</p>
<p style="position:absolute;top:150px;left:74px;white-space:nowrap" class="ft03">VFNMSUB132SD/VFNMSUB213SD/VFNMSUB231SD</p>
<p style="position:absolute;top:166px;left:74px;white-space:nowrap" class="ft03">xmm0, xmm1, xmm2/m64</p>
<p style="position:absolute;top:150px;left:474px;white-space:nowrap" class="ft03">Fused Negative&#160;Multiply-Subtract of&#160;Scalar Double-Precision&#160;</p>
<p style="position:absolute;top:166px;left:474px;white-space:nowrap" class="ft03">Floating-Point&#160;Values</p>
<p style="position:absolute;top:190px;left:74px;white-space:nowrap" class="ft03">VFNMSUB132SS/VFNMSUB213SS/VFNMSUB231SS</p>
<p style="position:absolute;top:207px;left:74px;white-space:nowrap" class="ft03">xmm0, xmm1, xmm2/m32</p>
<p style="position:absolute;top:190px;left:474px;white-space:nowrap" class="ft03">Fused Negative&#160;Multiply-Subtract of&#160;Scalar&#160;Single-Precision&#160;</p>
<p style="position:absolute;top:207px;left:474px;white-space:nowrap" class="ft03">Floating-Point&#160;Values</p>
<p style="position:absolute;top:100px;left:349px;white-space:nowrap" class="ft05">Table 14-15. &#160;FMA Instructions</p>
<p style="position:absolute;top:124px;left:74px;white-space:nowrap" class="ft03">Instruction</p>
<p style="position:absolute;top:124px;left:474px;white-space:nowrap" class="ft03">Description</p>
</div>
</body>
</html>
