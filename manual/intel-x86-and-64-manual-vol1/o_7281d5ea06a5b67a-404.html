<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 404</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:12px;font-family:Times;color:#0860a8;}
	.ft05{font-size:10px;font-family:Times;color:#000000;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:7px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft011{font-size:9px;line-height:15px;font-family:Times;color:#000000;}
	.ft012{font-size:9px;line-height:14px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page404-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a404.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">18-4&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">INPUT/OUTPUT</p>
<p style="position:absolute;top:100px;left:68px;white-space:nowrap" class="ft08">The I/O&#160;permission bit map&#160;in the&#160;TSS&#160;can be used&#160;to modify the&#160;effect of the&#160;IOPL&#160;on&#160;I/O&#160;sensitive&#160;instructions,&#160;<br/>allowing access&#160;to some&#160;I/O ports by less&#160;privileged&#160;programs or&#160;tasks&#160;(s<a href="o_7281d5ea06a5b67a-404.html">ee Section 18.5.2,&#160;“I/O&#160;Permission&#160;Bit&#160;<br/>Map”).<br/></a>A program&#160;or task&#160;can&#160;change its IOPL&#160;only with the POPF and IRET instructions; however,&#160;such changes are privi-<br/>leged.&#160;No procedure may change the current&#160;IOPL unless it&#160;is&#160;running&#160;at&#160;privilege level 0. An&#160;attempt&#160;by a less priv-<br/>ileged procedure&#160;to&#160;change&#160;the IOPL does not&#160;result&#160;in an exception;&#160;the IOPL&#160;simply&#160;remains unchanged.<br/>The&#160;POPF&#160;instruction&#160;also may be&#160;used to change&#160;the&#160;state&#160;of&#160;the IF&#160;flag&#160;(as can the&#160;CLI&#160;and STI instructions);&#160;<br/>however,&#160;the&#160;POPF instruction in this&#160;case is&#160;also I/O sensitive. A procedure may use the&#160;POPF&#160;instruction&#160;to change&#160;<br/>the setting of&#160;the IF&#160;flag only if the CPL&#160;is less than or&#160;equal to&#160;the current&#160;IOPL. An&#160;attempt&#160;by a&#160;less privileged&#160;<br/>procedure to&#160;change&#160;the IF&#160;flag does&#160;not result&#160;in&#160;an exception;&#160;the IF&#160;flag simply&#160;remains unchanged.</p>
<p style="position:absolute;top:314px;left:68px;white-space:nowrap" class="ft03">18.5.2&#160;</p>
<p style="position:absolute;top:314px;left:148px;white-space:nowrap" class="ft03">I/O Permission Bit Map</p>
<p style="position:absolute;top:345px;left:68px;white-space:nowrap" class="ft08">The&#160;I/O permission&#160;bit&#160;map is&#160;a device for permitting limited&#160;access&#160;to I/O&#160;ports by&#160;less privileged programs or&#160;<br/>tasks and&#160;for&#160;tasks operating&#160;in&#160;virtual-8086&#160;mode. The&#160;I/O&#160;permission bit map&#160;is located in&#160;the&#160;TSS (see&#160;<br/><a href="o_7281d5ea06a5b67a-404.html">Figure&#160;18-2) for the&#160;</a>currently&#160;running&#160;task or program.&#160;The&#160;address&#160;of the first&#160;byte of&#160;the&#160;I/O permission&#160;bit map&#160;<br/>is given in the&#160;I/O map base address field of the TSS.&#160;The&#160;size of&#160;the I/O permission bit map&#160;and&#160;its location in&#160;the&#160;<br/>TSS are variable.&#160;</p>
<p style="position:absolute;top:776px;left:68px;white-space:nowrap" class="ft08">Because&#160;each task has&#160;its own TSS,&#160;each&#160;task has its&#160;own&#160;I/O permission&#160;bit&#160;map.&#160;Access&#160;to individual&#160;I/O ports&#160;<br/>can thus be&#160;granted&#160;to individual tasks.<br/>If in protected mode&#160;and the&#160;CPL&#160;is less than or&#160;equal&#160;to&#160;the&#160;current&#160;IOPL,&#160;the&#160;processor allows all&#160;I/O operations&#160;<br/>to proceed. If the CPL is greater than the&#160;IOPL or if the processor is operating in virtual-8086&#160;mode, the processor&#160;<br/>checks&#160;the I/O&#160;permission&#160;bit map&#160;to determine if&#160;access&#160;to&#160;a&#160;particular&#160;I/O port&#160;is allowed.&#160;Each&#160;bit in&#160;the map&#160;<br/>corresponds&#160;to an&#160;I/O port&#160;byte&#160;address.&#160;For example,&#160;the&#160;control bit for I/O&#160;port address&#160;29H in&#160;the&#160;I/O&#160;address&#160;<br/>space&#160;is&#160;found&#160;at bit position&#160;1 of the&#160;sixth byte&#160;in&#160;the bit map.&#160;Before&#160;granting I/O&#160;access, the&#160;processor&#160;tests&#160;all&#160;<br/>the bits&#160;corresponding&#160;to the I/O port&#160;being&#160;addressed.&#160;For a&#160;doubleword access, for example,&#160;the&#160;processors tests&#160;<br/>the four bits corresponding to&#160;the four adjacent&#160;8-bit port&#160;addresses. If any&#160;tested bit&#160;is&#160;set,&#160;a general-protection&#160;<br/>exception (#GP)&#160;is signaled. If all&#160;tested&#160;bits are&#160;clear,&#160;the&#160;I/O operation is&#160;allowed to&#160;proceed.<br/>Because&#160;I/O port&#160;addresses are&#160;not necessarily aligned to&#160;word&#160;and doubleword boundaries,&#160;the processor reads&#160;<br/>two&#160;bytes from the&#160;I/O permission&#160;bit&#160;map for every&#160;access&#160;to an&#160;I/O port. To&#160;prevent&#160;exceptions&#160;from&#160;being gener-<br/>ated when the ports with the highest&#160;addresses are accessed,&#160;an extra byte needs to be included in&#160;the&#160;TSS imme-<br/>diately after&#160;the table.&#160;This&#160;byte must have&#160;all of&#160;its&#160;bits set,&#160;and it&#160;must be within&#160;the segment limit.<br/>It is not necessary for&#160;the&#160;I/O permission&#160;bit map to represent&#160;all the I/O addresses. I/O&#160;addresses not spanned by&#160;<br/>the&#160;map&#160;are treated&#160;as if they&#160;had set bits&#160;in the&#160;map.&#160;For&#160;example,&#160;if the&#160;TSS&#160;segment limit is&#160;10&#160;bytes past the&#160;</p>
<p style="position:absolute;top:731px;left:331px;white-space:nowrap" class="ft04">Figure&#160;18-2. &#160;I/O&#160;Permission&#160;Bit&#160;Map</p>
<p style="position:absolute;top:635px;left:357px;white-space:nowrap" class="ft05">I/O Map Base</p>
<p style="position:absolute;top:476px;left:424px;white-space:nowrap" class="ft05">Task State Segment (TSS)</p>
<p style="position:absolute;top:636px;left:700px;white-space:nowrap" class="ft06">64H</p>
<p style="position:absolute;top:492px;left:296px;white-space:nowrap" class="ft07">31</p>
<p style="position:absolute;top:492px;left:383px;white-space:nowrap" class="ft07">24&#160;23</p>
<p style="position:absolute;top:492px;left:689px;white-space:nowrap" class="ft07">0</p>
<p style="position:absolute;top:507px;left:298px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:508px;left:386px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:508px;left:373px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:508px;left:360px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:508px;left:348px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:508px;left:336px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:508px;left:323px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:508px;left:311px;white-space:nowrap" class="ft07">1</p>
<p style="position:absolute;top:552px;left:433px;white-space:nowrap" class="ft05">I/O Permission Bit Map</p>
<p style="position:absolute;top:706px;left:700px;white-space:nowrap" class="ft06">0</p>
<p style="position:absolute;top:635px;left:179px;white-space:nowrap" class="ft011">I/O map base&#160;<br/>must&#160;not&#160;<br/>exceed&#160;DFFFH.</p>
<p style="position:absolute;top:496px;left:179px;white-space:nowrap" class="ft012">Last byte&#160;of&#160;<br/>bitmap must be&#160;<br/>followed by a&#160;<br/>byte&#160;with&#160;all&#160;<br/>bits&#160;set.</p>
</div>
</body>
</html>
