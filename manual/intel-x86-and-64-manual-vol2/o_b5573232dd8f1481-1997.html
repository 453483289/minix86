<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1997</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:8px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1997-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_b5573232dd8f14811997.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">GETSEC[SENTER]—Enter a Measured Environment</p>
<p style="position:absolute;top:47px;left:615px;white-space:nowrap" class="ft01">SAFER&#160;MODE&#160;EXTENSIONS&#160;REFERENCE</p>
<p style="position:absolute;top:1103px;left:770px;white-space:nowrap" class="ft00">Vol. 2D&#160;6-23</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft05">To&#160;prevent other (logical) processors from interfering with&#160;the ILP operating in authenticated&#160;code execution mode,&#160;<br/>memory (excluding implicit write-back transactions)&#160;and I/O activities originating from other processor agents are&#160;<br/>blocked. This protection&#160;starts when&#160;the ILP enters into&#160;authenticated code execution mode.&#160;Only memory and I/O&#160;<br/>transactions initiated from the&#160;ILP are&#160;allowed to&#160;proceed.&#160;Exiting authenticated code&#160;execution&#160;mode is&#160;done&#160;by&#160;<br/>executing&#160;GETSEC[EXITAC].&#160;The&#160;protection of memory&#160;and&#160;I/O activities&#160;remains in effect&#160;until the&#160;ILP&#160;executes&#160;<br/>GETSEC[EXITAC].<br/>Once&#160;the authenticated code module&#160;has been&#160;loaded&#160;into&#160;the authenticated code execution&#160;area, it&#160;is protected&#160;<br/>against further modification&#160;from external&#160;bus snoops. There&#160;is also a requirement that&#160;the memory type&#160;for the&#160;<br/>authenticated&#160;code&#160;module address&#160;range&#160;be&#160;WB (via&#160;initialization of the&#160;MTRRs prior&#160;to execution&#160;of&#160;this instruc-<br/>tion).&#160;If&#160;this condition&#160;is not satisfied,&#160;it is&#160;a violation of&#160;security&#160;and&#160;the processor will force&#160;a TXT system reset&#160;<br/>(after writing an&#160;error code to the&#160;chipset&#160;LT.ERRORCODE register). This&#160;action&#160;is&#160;referred to&#160;as a Intel®&#160;TXT reset&#160;<br/>condition. It&#160;is performed when it&#160;is considered&#160;unreliable&#160;to signal an&#160;error&#160;through the&#160;conventional&#160;exception&#160;<br/>reporting mechanism.&#160;<br/>To&#160;conform to the minimum granularity of MTRR&#160;MSRs&#160;for&#160;specifying&#160;the memory&#160;type, authenticated code RAM&#160;<br/>(ACRAM) is allocated to the processor&#160;in&#160;4096&#160;byte&#160;granular blocks.&#160;If an&#160;AC module&#160;size as specified in ECX is not&#160;<br/>a multiple of 4096 then the processor will&#160;allocate&#160;up&#160;to the next 4096&#160;byte boundary for mapping&#160;as&#160;ACRAM with&#160;<br/>indeterminate data. This pad area&#160;will not be visible to the&#160;authenticated code&#160;module as external memory nor can&#160;<br/>it depend on the&#160;value&#160;of the&#160;data&#160;used&#160;to fill the&#160;pad area.<br/>Once&#160;successful authentication&#160;has&#160;been&#160;completed by the&#160;ILP,&#160;the&#160;computed hash is&#160;stored&#160;in a&#160;trusted storage&#160;<br/>facility in the&#160;platform.&#160;The&#160;following trusted storage&#160;facility are&#160;supported:&#160;</p>
<p style="position:absolute;top:458px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:459px;left:95px;white-space:nowrap" class="ft05">If the&#160;platform register&#160;FTM_INTERFACE_ID.[bits 3:0]&#160;=&#160;0,&#160;the computed hash is&#160;stored&#160;to the&#160;platform’s&#160;TPM&#160;<br/>at PCR17 after&#160;this&#160;register is&#160;implicitly reset.&#160;PCR17&#160;is&#160;a dedicated&#160;register&#160;for holding&#160;the computed&#160;hash of&#160;<br/>the authenticated code module&#160;loaded and&#160;subsequently&#160;executed&#160;by&#160;the&#160;GETSEC[SENTER]. As&#160;part of this&#160;<br/>process,&#160;the dynamic PCRs&#160;18-22&#160;are&#160;reset&#160;so they can&#160;be&#160;utilized by subsequently software&#160;for&#160;registration&#160;of&#160;<br/>code&#160;and data modules.&#160;</p>
<p style="position:absolute;top:547px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:547px;left:95px;white-space:nowrap" class="ft05">If the&#160;platform&#160;register FTM_INTERFACE_ID.[bits&#160;3:0] =&#160;1,&#160;the&#160;computed&#160;hash is stored in a&#160;firmware trusted&#160;<br/>module&#160;(FTM) using&#160;a modified&#160;protocol&#160;similar to&#160;the&#160;protocol&#160;used&#160;to&#160;write&#160;to TPM’s&#160;PCR17.&#160;</p>
<p style="position:absolute;top:588px;left:69px;white-space:nowrap" class="ft06">After successful&#160;execution of SENTER,&#160;either PCR17 (if&#160;FTM&#160;is&#160;not enabled)&#160;or the&#160;FTM (if enabled)&#160;contains the&#160;<br/>measurement&#160;of&#160;AC&#160;code and the&#160;SENTER launching&#160;parameters.&#160;<br/>After authentication&#160;is completed&#160;successfully, the private configuration&#160;space&#160;of&#160;the&#160;Intel</p>
<p style="position:absolute;top:626px;left:669px;white-space:nowrap" class="ft04">®</p>
<p style="position:absolute;top:628px;left:680px;white-space:nowrap" class="ft02">&#160;TXT-capable&#160;chipset is&#160;</p>
<p style="position:absolute;top:645px;left:69px;white-space:nowrap" class="ft05">unlocked&#160;so that the authenticated code module&#160;and measured environment&#160;software&#160;can gain access&#160;to this&#160;<br/>normally restricted&#160;chipset&#160;state. The&#160;Intel®&#160;TXT-capable chipset private&#160;configuration space&#160;can be&#160;locked&#160;later&#160;<br/>by software&#160;writing to&#160;the chipset LT.CMD.CLOSE-PRIVATE&#160;register or unconditionally using&#160;the GETSEC[SEXIT]&#160;<br/>instruction.<br/>The SENTER&#160;leaf function also&#160;initializes some&#160;processor&#160;architecture state for the&#160;ILP from&#160;contents held in&#160;the&#160;<br/>header&#160;of&#160;the authenticated code module. Since the&#160;authenticated code module&#160;is&#160;relocatable,&#160;all address&#160;refer-<br/>ences&#160;are relative&#160;to the&#160;base&#160;address passed&#160;in via EBX. The ILP&#160;GDTR base&#160;value&#160;is initialized&#160;to&#160;EBX + [GDTBa-<br/>sePtr] and GDTR&#160;limit set&#160;to&#160;[GDTLimit].&#160;The&#160;CS selector is&#160;initialized to&#160;the&#160;value&#160;held in&#160;the AC&#160;module header&#160;<br/>field&#160;SegSel,&#160;while&#160;the&#160;DS, SS,&#160;and ES&#160;selectors&#160;are&#160;initialized to CS+8.&#160;The segment descriptor fields are&#160;initialized&#160;<br/>implicitly with BASE=0,&#160;LIMIT=FFFFFh, G=1,&#160;D=1, P=1, S=1,&#160;read/write/accessed&#160;for&#160;DS, SS,&#160;and&#160;ES, while&#160;<br/>execute/read/accessed&#160;for&#160;CS.&#160;Execution in the&#160;authenticated&#160;code&#160;module for the&#160;ILP begins with the&#160;EIP set to&#160;<br/>EBX + [EntryPoint].&#160;AC module&#160;defined fields&#160;used&#160;for initializing processor state&#160;are&#160;consistency&#160;checked with a&#160;<br/>failure&#160;resulting in an&#160;TXT-shutdown&#160;condition.<br/><a href="o_b5573232dd8f1481-1998.html">Table&#160;6-6</a>&#160;provides&#160;a&#160;summary of processor state&#160;initialization for the&#160;ILP and RLP(s) after&#160;successful completion of&#160;<br/>GETSEC[SENTER].&#160;For both&#160;ILP&#160;and RLP(s),&#160;paging&#160;is disabled&#160;upon entry to the&#160;measured environment. It is&#160;up&#160;to&#160;<br/>the ILP&#160;to establish a&#160;trusted&#160;paging&#160;environment,&#160;with&#160;appropriate mappings,&#160;to meet protection requirements&#160;<br/>established during&#160;the launch of the measured&#160;environment.&#160;RLP&#160;state initialization is not completed&#160;until a&#160;subse-<br/>quent wake-up has&#160;been&#160;signaled&#160;by execution&#160;of&#160;the GETSEC[WAKEUP] function&#160;by the&#160;ILP.</p>
</div>
</body>
</html>
