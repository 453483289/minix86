<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1350</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:12px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1350-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_b5573232dd8f14811350.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:690px;white-space:nowrap" class="ft00">SYSENTER—Fast System Call</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">INSTRUCTION SET REFERENCE, M-U</p>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">4-670&#160;Vol. 2B</p>
<p style="position:absolute;top:98px;left:68px;white-space:nowrap" class="ft02">SYSENTER—Fast&#160;System&#160;Call</p>
<p style="position:absolute;top:233px;left:353px;white-space:nowrap" class="ft03">Instruction&#160;Operand&#160;Encoding</p>
<p style="position:absolute;top:320px;left:68px;white-space:nowrap" class="ft03">Description</p>
<p style="position:absolute;top:346px;left:68px;white-space:nowrap" class="ft07">Executes a fast call&#160;to a level 0&#160;system procedure&#160;or routine.&#160;SYSENTER&#160;is a companion instruction to SYSEXIT.&#160;The&#160;<br/>instruction&#160;is optimized&#160;to provide&#160;the maximum performance for system calls&#160;from user&#160;code running at&#160;privilege&#160;<br/>level 3 to operating&#160;system or&#160;executive&#160;procedures running at&#160;privilege level&#160;0.<br/>When&#160;executed in&#160;IA-32e mode, the SYSENTER instruction&#160;transitions&#160;the logical processor to&#160;64-bit mode; other-<br/>wise, the&#160;logical&#160;processor&#160;remains in&#160;protected mode.<br/>Prior to&#160;executing the&#160;SYSENTER instruction,&#160;software must specify the&#160;privilege level&#160;0 code segment and code&#160;<br/>entry point, and&#160;the privilege&#160;level 0&#160;stack segment and&#160;stack pointer&#160;by writing values&#160;to the&#160;following MSRs:</p>
<p style="position:absolute;top:482px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:483px;left:93px;white-space:nowrap" class="ft07"><b>IA32_SYSENTER_CS</b>&#160;(MSR&#160;address&#160;174H) — The lower 16&#160;bits&#160;of&#160;this&#160;MSR&#160;are&#160;the segment selector for the&#160;<br/>privilege level&#160;0&#160;code&#160;segment. This value&#160;is also used&#160;to&#160;determine the&#160;segment&#160;selector of the privilege&#160;level&#160;<br/>0&#160;stack segment (see&#160;the&#160;Operation&#160;section). This&#160;value&#160;cannot indicate&#160;a&#160;null&#160;selector.</p>
<p style="position:absolute;top:538px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:538px;left:93px;white-space:nowrap" class="ft07"><b>IA32_SYSENTER_EIP</b>&#160;(MSR&#160;address 176H) — The&#160;value of&#160;this&#160;MSR is&#160;loaded into RIP (thus, this value&#160;<br/>references the&#160;first instruction of the&#160;selected&#160;operating&#160;procedure&#160;or routine). In&#160;protected mode, only&#160;<br/>bits&#160;31:0 are&#160;loaded.</p>
<p style="position:absolute;top:593px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:594px;left:93px;white-space:nowrap" class="ft07"><b>IA32_SYSENTER_ESP</b>&#160;(MSR&#160;address 175H) — The value&#160;of&#160;this&#160;MSR&#160;is loaded&#160;into RSP (thus, this value&#160;<br/>contains the stack&#160;pointer for the privilege level&#160;0 stack).&#160;This value cannot represent a non-canonical address.&#160;<br/>In&#160;protected&#160;mode,&#160;only bits&#160;31:0&#160;are&#160;loaded.</p>
<p style="position:absolute;top:651px;left:68px;white-space:nowrap" class="ft07">These&#160;MSRs&#160;can be read from and&#160;written&#160;to using&#160;RDMSR/WRMSR.&#160;The&#160;WRMSR instruction ensures&#160;that the&#160;<br/>IA32_SYSENTER_EIP and&#160;IA32_SYSENTER_ESP MSRs&#160;always contain canonical&#160;addresses.<br/>While SYSENTER loads the&#160;CS and SS&#160;selectors&#160;with&#160;values derived from the&#160;IA32_SYSENTER_CS&#160;MSR,&#160;the CS&#160;and&#160;<br/>SS&#160;descriptor&#160;caches are&#160;<b>not</b>&#160;loaded&#160;from the descriptors (in&#160;GDT&#160;or&#160;LDT)&#160;referenced&#160;by those&#160;selectors. Instead,&#160;<br/>the descriptor&#160;caches&#160;are loaded&#160;with fixed values. See&#160;the&#160;Operation&#160;section for details. It&#160;is the&#160;responsibility of&#160;<br/>OS software&#160;to ensure&#160;that the&#160;descriptors (in&#160;GDT or&#160;LDT)&#160;referenced&#160;by those&#160;selector&#160;values correspond to&#160;the&#160;<br/>fixed&#160;values&#160;loaded&#160;into&#160;the&#160;descriptor&#160;caches; the&#160;SYSENTER instruction does&#160;not ensure&#160;this correspondence.<br/>The&#160;SYSENTER&#160;instruction can be invoked from&#160;all operating&#160;modes except&#160;real-address mode.&#160;<br/>The SYSENTER and SYSEXIT instructions are companion&#160;instructions, but&#160;they do not constitute a&#160;call/return&#160;pair.&#160;<br/>When&#160;executing a&#160;SYSENTER instruction,&#160;the processor does&#160;not save&#160;state information for the&#160;user&#160;code&#160;(e.g.,&#160;the&#160;<br/>instruction&#160;pointer), and&#160;neither&#160;the&#160;SYSENTER nor&#160;the&#160;SYSEXIT instruction supports passing parameters&#160;on&#160;the&#160;<br/>stack.<br/>To&#160;use&#160;the&#160;SYSENTER and SYSEXIT instructions&#160;as companion instructions for transitions between privilege&#160;level 3&#160;<br/>code and&#160;privilege level&#160;0&#160;operating system&#160;procedures,&#160;the following&#160;conventions must be followed:</p>
<p style="position:absolute;top:917px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:918px;left:93px;white-space:nowrap" class="ft07">The&#160;segment descriptors for the privilege level 0 code&#160;and stack segments and for&#160;the privilege level 3 code and&#160;<br/>stack segments must be contiguous&#160;in a&#160;descriptor table.&#160;This&#160;convention&#160;allows&#160;the processor to&#160;compute&#160;the&#160;<br/>segment selectors from the&#160;value&#160;entered in&#160;the SYSENTER_CS_MSR&#160;MSR.</p>
<p style="position:absolute;top:973px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:973px;left:93px;white-space:nowrap" class="ft07">The&#160;fast system call&#160;“stub”&#160;routines&#160;executed&#160;by user code&#160;(typically in shared libraries&#160;or&#160;DLLs) must save&#160;the&#160;<br/>required return IP and processor state information if a&#160;return to the calling procedure is&#160;required. Likewise, the&#160;<br/>operating system&#160;or&#160;executive&#160;procedures called with SYSENTER&#160;instructions&#160;must&#160;have access to and use&#160;this&#160;<br/>saved return&#160;and state information&#160;when&#160;returning to&#160;the user&#160;code.</p>
<p style="position:absolute;top:123px;left:73px;white-space:nowrap" class="ft04">Opcode</p>
<p style="position:absolute;top:123px;left:221px;white-space:nowrap" class="ft04">Instruction</p>
<p style="position:absolute;top:123px;left:389px;white-space:nowrap" class="ft04">Op/&#160;</p>
<p style="position:absolute;top:137px;left:389px;white-space:nowrap" class="ft04">En</p>
<p style="position:absolute;top:123px;left:426px;white-space:nowrap" class="ft04">64-Bit&#160;</p>
<p style="position:absolute;top:137px;left:426px;white-space:nowrap" class="ft04">Mode</p>
<p style="position:absolute;top:123px;left:498px;white-space:nowrap" class="ft04">Compat/</p>
<p style="position:absolute;top:137px;left:498px;white-space:nowrap" class="ft04">Leg Mode</p>
<p style="position:absolute;top:123px;left:568px;white-space:nowrap" class="ft04">Description</p>
<p style="position:absolute;top:160px;left:73px;white-space:nowrap" class="ft04">0F&#160;34</p>
<p style="position:absolute;top:160px;left:221px;white-space:nowrap" class="ft04">SYSENTER</p>
<p style="position:absolute;top:160px;left:389px;white-space:nowrap" class="ft04">NP</p>
<p style="position:absolute;top:160px;left:426px;white-space:nowrap" class="ft04">Valid</p>
<p style="position:absolute;top:160px;left:498px;white-space:nowrap" class="ft04">Valid</p>
<p style="position:absolute;top:160px;left:568px;white-space:nowrap" class="ft04">Fast&#160;call to&#160;privilege level 0 system&#160;</p>
<p style="position:absolute;top:177px;left:568px;white-space:nowrap" class="ft04">procedures.</p>
<p style="position:absolute;top:256px;left:83px;white-space:nowrap" class="ft04">Op/En</p>
<p style="position:absolute;top:256px;left:189px;white-space:nowrap" class="ft04">Operand&#160;1</p>
<p style="position:absolute;top:256px;left:363px;white-space:nowrap" class="ft04">Operand&#160;2</p>
<p style="position:absolute;top:256px;left:539px;white-space:nowrap" class="ft04">Operand&#160;3</p>
<p style="position:absolute;top:256px;left:717px;white-space:nowrap" class="ft04">Operand&#160;4</p>
<p style="position:absolute;top:280px;left:92px;white-space:nowrap" class="ft04">NP</p>
<p style="position:absolute;top:280px;left:210px;white-space:nowrap" class="ft04">NA</p>
<p style="position:absolute;top:280px;left:384px;white-space:nowrap" class="ft04">NA</p>
<p style="position:absolute;top:280px;left:560px;white-space:nowrap" class="ft04">NA</p>
<p style="position:absolute;top:280px;left:738px;white-space:nowrap" class="ft04">NA</p>
</div>
</body>
</html>
