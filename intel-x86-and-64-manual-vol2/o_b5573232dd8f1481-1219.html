<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 1219</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:12px;font-family:Times;color:#0860a8;}
	.ft04{font-size:12px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:17px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page1219-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_b5573232dd8f14811219.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">RDPMC—Read&#160;Performance-Monitoring&#160;Counters</p>
<p style="position:absolute;top:47px;left:635px;white-space:nowrap" class="ft01">INSTRUCTION SET REFERENCE,&#160;M-U</p>
<p style="position:absolute;top:1103px;left:763px;white-space:nowrap" class="ft00">Vol. 2B&#160;4-539</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft05">an exact&#160;event&#160;count&#160;is desired,&#160;software&#160;must insert&#160;a serializing instruction (such as&#160;the CPUID&#160;instruction)&#160;<br/>before and/or&#160;after the&#160;RDPMC instruction.<br/>Performing&#160;back-to-back fast reads are&#160;not guaranteed to be monotonic.&#160;To&#160;guarantee&#160;monotonicity&#160;on&#160;back-to-<br/>back reads,&#160;a serializing instruction must be&#160;placed&#160;between&#160;the two RDPMC&#160;instructions.<br/>The RDPMC instruction can execute&#160;in&#160;16-bit addressing mode or virtual-8086 mode; however,&#160;the full contents of&#160;<br/>the ECX register&#160;are used to select the counter,&#160;and the event count is stored&#160;in the full EAX&#160;and EDX registers. The&#160;<br/>RDPMC instruction was&#160;introduced&#160;into&#160;the IA-32 Architecture&#160;in&#160;the Pentium Pro processor and&#160;the Pentium&#160;<br/>processor&#160;with&#160;MMX technology. The&#160;earlier Pentium processors&#160;have&#160;performance-monitoring counters, but&#160;they&#160;<br/>must be read&#160;with&#160;the&#160;RDMSR&#160;instruction.</p>
<p style="position:absolute;top:284px;left:69px;white-space:nowrap" class="ft03">Operation</p>
<p style="position:absolute;top:310px;left:69px;white-space:nowrap" class="ft02">(* Intel processors that&#160;support architectural performance&#160;monitoring&#160;*)</p>
<p style="position:absolute;top:340px;left:69px;white-space:nowrap" class="ft02">Most significant counter bit (MSCB) = 47</p>
<p style="position:absolute;top:370px;left:69px;white-space:nowrap" class="ft02">IF&#160;((CR4.PCE</p>
<p style="position:absolute;top:369px;left:138px;white-space:nowrap" class="ft04">&#160;</p>
<p style="position:absolute;top:371px;left:141px;white-space:nowrap" class="ft02">=&#160;1) or&#160;(CPL&#160;</p>
<p style="position:absolute;top:370px;left:211px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:370px;left:220px;white-space:nowrap" class="ft02">&#160;0) or (CR0.PE&#160;</p>
<p style="position:absolute;top:370px;left:301px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:370px;left:309px;white-space:nowrap" class="ft02">&#160;0))</p>
<p style="position:absolute;top:388px;left:89px;white-space:nowrap" class="ft02">THEN IF (ECX[30]&#160;</p>
<p style="position:absolute;top:388px;left:193px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:388px;left:201px;white-space:nowrap" class="ft02">&#160;1 and&#160;ECX[29:0] in&#160;valid fixed-counter range)</p>
<p style="position:absolute;top:406px;left:116px;white-space:nowrap" class="ft02">EAX&#160;←&#160;IA32_FIXED_CTR(ECX)[30:0];</p>
<p style="position:absolute;top:424px;left:116px;white-space:nowrap" class="ft02">EDX&#160;←&#160;IA32_FIXED_CTR(ECX)[MSCB:32];</p>
<p style="position:absolute;top:442px;left:89px;white-space:nowrap" class="ft02">ELSE IF&#160;(ECX[30]&#160;</p>
<p style="position:absolute;top:442px;left:188px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:442px;left:196px;white-space:nowrap" class="ft02">&#160;0 and ECX[29:0] in&#160;valid&#160;general-purpose&#160;counter&#160;range)</p>
<p style="position:absolute;top:460px;left:116px;white-space:nowrap" class="ft02">EAX&#160;←&#160;PMC(ECX[30:0])[31:0];</p>
<p style="position:absolute;top:478px;left:116px;white-space:nowrap" class="ft02">EDX&#160;←&#160;PMC(ECX[30:0])[MSCB:32];</p>
<p style="position:absolute;top:496px;left:89px;white-space:nowrap" class="ft02">ELSE&#160;(* ECX is&#160;not valid&#160;or&#160;CR4.PCE is&#160;0 and&#160;CPL is&#160;1,&#160;2,&#160;or&#160;3&#160;and&#160;CR0.PE&#160;is&#160;1&#160;*)</p>
<p style="position:absolute;top:514px;left:116px;white-space:nowrap" class="ft02">#GP(0);&#160;</p>
<p style="position:absolute;top:532px;left:69px;white-space:nowrap" class="ft02">FI;</p>
<p style="position:absolute;top:562px;left:69px;white-space:nowrap" class="ft02">(* Intel Core&#160;2 Duo&#160;processor family and Intel Xeon processor 3000, 5100, 5300, 7400 series*)</p>
<p style="position:absolute;top:592px;left:69px;white-space:nowrap" class="ft02">Most significant counter bit (MSCB) = 39</p>
<p style="position:absolute;top:622px;left:69px;white-space:nowrap" class="ft02">IF&#160;((CR4.PCE</p>
<p style="position:absolute;top:621px;left:138px;white-space:nowrap" class="ft04">&#160;</p>
<p style="position:absolute;top:623px;left:141px;white-space:nowrap" class="ft02">=&#160;1) or&#160;(CPL&#160;</p>
<p style="position:absolute;top:622px;left:211px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:622px;left:220px;white-space:nowrap" class="ft02">&#160;0) or (CR0.PE&#160;</p>
<p style="position:absolute;top:622px;left:301px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:622px;left:309px;white-space:nowrap" class="ft02">&#160;0))</p>
<p style="position:absolute;top:640px;left:89px;white-space:nowrap" class="ft02">THEN IF (ECX[30]&#160;</p>
<p style="position:absolute;top:640px;left:193px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:640px;left:201px;white-space:nowrap" class="ft02">&#160;1 and&#160;ECX[29:0] in&#160;valid fixed-counter range)</p>
<p style="position:absolute;top:658px;left:116px;white-space:nowrap" class="ft02">EAX&#160;←&#160;IA32_FIXED_CTR(ECX)[30:0];</p>
<p style="position:absolute;top:676px;left:116px;white-space:nowrap" class="ft02">EDX&#160;←&#160;IA32_FIXED_CTR(ECX)[MSCB:32];</p>
<p style="position:absolute;top:694px;left:89px;white-space:nowrap" class="ft02">ELSE IF&#160;(ECX[30]&#160;</p>
<p style="position:absolute;top:694px;left:188px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:694px;left:196px;white-space:nowrap" class="ft02">&#160;0 and ECX[29:0] in&#160;valid&#160;general-purpose&#160;counter&#160;range)</p>
<p style="position:absolute;top:712px;left:116px;white-space:nowrap" class="ft02">EAX&#160;←&#160;PMC(ECX[30:0])[31:0];</p>
<p style="position:absolute;top:730px;left:116px;white-space:nowrap" class="ft02">EDX&#160;←&#160;PMC(ECX[30:0])[MSCB:32];</p>
<p style="position:absolute;top:748px;left:89px;white-space:nowrap" class="ft02">ELSE IF&#160;(ECX[30]&#160;</p>
<p style="position:absolute;top:748px;left:188px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:748px;left:196px;white-space:nowrap" class="ft02">&#160;0 and ECX[29:0] in&#160;valid&#160;special-purpose counter range)</p>
<p style="position:absolute;top:766px;left:116px;white-space:nowrap" class="ft02">EAX&#160;←&#160;PMC(ECX[30:0])[31:0]; (* 32-bit read&#160;*)</p>
<p style="position:absolute;top:784px;left:89px;white-space:nowrap" class="ft02">ELSE&#160;(* ECX is&#160;not valid&#160;or&#160;CR4.PCE is&#160;0 and&#160;CPL is&#160;1,&#160;2,&#160;or&#160;3&#160;and&#160;CR0.PE&#160;is&#160;1&#160;*)</p>
<p style="position:absolute;top:802px;left:116px;white-space:nowrap" class="ft02">#GP(0);&#160;</p>
<p style="position:absolute;top:820px;left:69px;white-space:nowrap" class="ft02">FI;</p>
<p style="position:absolute;top:850px;left:69px;white-space:nowrap" class="ft02">(* P6 family processors&#160;and Pentium processor with MMX technology *)</p>
<p style="position:absolute;top:880px;left:69px;white-space:nowrap" class="ft02">IF&#160;(ECX&#160;</p>
<p style="position:absolute;top:880px;left:112px;white-space:nowrap" class="ft04">=&#160;</p>
<p style="position:absolute;top:880px;left:124px;white-space:nowrap" class="ft02">0&#160;or&#160;1)&#160;and&#160;((CR4.PCE</p>
<p style="position:absolute;top:879px;left:245px;white-space:nowrap" class="ft04">&#160;</p>
<p style="position:absolute;top:881px;left:249px;white-space:nowrap" class="ft02">=&#160;1)&#160;or&#160;(CPL&#160;</p>
<p style="position:absolute;top:880px;left:319px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:880px;left:327px;white-space:nowrap" class="ft02">&#160;0) or (CR0.PE&#160;</p>
<p style="position:absolute;top:880px;left:409px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:880px;left:417px;white-space:nowrap" class="ft02">&#160;0))</p>
<p style="position:absolute;top:898px;left:89px;white-space:nowrap" class="ft02">THEN&#160;</p>
<p style="position:absolute;top:916px;left:116px;white-space:nowrap" class="ft02">EAX&#160;←&#160;PMC(ECX)[31:0];</p>
<p style="position:absolute;top:934px;left:116px;white-space:nowrap" class="ft02">EDX&#160;←&#160;PMC(ECX)[39:32];</p>
<p style="position:absolute;top:952px;left:89px;white-space:nowrap" class="ft02">ELSE (* ECX is&#160;not 0&#160;or 1 or CR4.PCE is&#160;0&#160;and CPL is&#160;1,&#160;2,&#160;or&#160;3 and&#160;CR0.PE&#160;is&#160;1&#160;*)</p>
<p style="position:absolute;top:970px;left:116px;white-space:nowrap" class="ft02">#GP(0);&#160;</p>
<p style="position:absolute;top:988px;left:69px;white-space:nowrap" class="ft07">FI;<br/>(* Processors based on Intel&#160;NetBurst microarchitecture *)<br/>IF&#160;((CR4.PCE&#160;</p>
<p style="position:absolute;top:1024px;left:141px;white-space:nowrap" class="ft04">=&#160;</p>
<p style="position:absolute;top:1024px;left:153px;white-space:nowrap" class="ft02">1) or (CPL&#160;</p>
<p style="position:absolute;top:1024px;left:212px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:1024px;left:220px;white-space:nowrap" class="ft02">&#160;0)&#160;or (CR0.PE</p>
<p style="position:absolute;top:1023px;left:298px;white-space:nowrap" class="ft04">&#160;</p>
<p style="position:absolute;top:1025px;left:302px;white-space:nowrap" class="ft02">=&#160;0))</p>
<p style="position:absolute;top:1042px;left:89px;white-space:nowrap" class="ft02">THEN IF (ECX[30:0]&#160;</p>
<p style="position:absolute;top:1042px;left:203px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:1042px;left:211px;white-space:nowrap" class="ft02">&#160;0:17)</p>
<p style="position:absolute;top:1060px;left:116px;white-space:nowrap" class="ft02">THEN&#160;IF ECX[31]&#160;</p>
<p style="position:absolute;top:1060px;left:216px;white-space:nowrap" class="ft04">=</p>
<p style="position:absolute;top:1060px;left:224px;white-space:nowrap" class="ft02">&#160;0</p>
</div>
</body>
</html>
