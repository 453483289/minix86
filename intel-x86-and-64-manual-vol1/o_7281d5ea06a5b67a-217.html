<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 217</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:14px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft010{font-size:11px;line-height:21px;font-family:Times;color:#000000;}
	.ft011{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page217-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a217.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:775px;white-space:nowrap" class="ft00">Vol. 1&#160;8-27</p>
<p style="position:absolute;top:47px;left:634px;white-space:nowrap" class="ft01">PROGRAMMING&#160;WITH&#160;THE X87&#160;FPU</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft08"><i>tectures&#160;Software&#160;Developer’s Manual,&#160;Volumes 2A&#160;&amp;&#160;2B,</i>&#160;list the floating-point&#160;exceptions that&#160;can be signaled&#160;for&#160;<br/>each floating-point&#160;instruction.<br/>Se<a href="o_7281d5ea06a5b67a-107.html">e Section 4.9.2,&#160;“Floating-Point&#160;Exception&#160;Priority,”&#160;for&#160;</a>a description of the rules for exception precedence when&#160;<br/>more&#160;than&#160;one floating-point&#160;exception condition&#160;is detected for an&#160;instruction.</p>
<p style="position:absolute;top:208px;left:69px;white-space:nowrap" class="ft04">8.5.1&#160;</p>
<p style="position:absolute;top:208px;left:149px;white-space:nowrap" class="ft04">Invalid Operation Exception</p>
<p style="position:absolute;top:238px;left:69px;white-space:nowrap" class="ft03">The floating-point&#160;invalid-operation&#160;exception&#160;occurs&#160;in&#160;response&#160;to two sub-classes of operations:</p>
<p style="position:absolute;top:260px;left:69px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:261px;left:95px;white-space:nowrap" class="ft03">Stack overflow or&#160;underflow&#160;(#IS)</p>
<p style="position:absolute;top:283px;left:69px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:283px;left:95px;white-space:nowrap" class="ft03">Invalid arithmetic&#160;operand (#IA)</p>
<p style="position:absolute;top:307px;left:69px;white-space:nowrap" class="ft08">The&#160;flag&#160;for this&#160;exception (IE) is&#160;bit&#160;0 of the&#160;x87&#160;FPU status&#160;word, and the&#160;mask&#160;bit (IM) is&#160;bit&#160;0 of the x87&#160;FPU&#160;<br/>control&#160;word. The stack fault flag&#160;(SF) of the&#160;x87 FPU&#160;status&#160;word indicates the&#160;type&#160;of&#160;operation that caused the&#160;<br/>exception. When the SF flag is set to&#160;1,&#160;a stack&#160;operation&#160;has resulted&#160;in stack&#160;overflow or&#160;underflow; when&#160;the flag&#160;<br/>is cleared to&#160;0,&#160;an&#160;arithmetic instruction has encountered&#160;an invalid&#160;operand. Note&#160;that the x87&#160;FPU explicitly&#160;sets&#160;<br/>the SF flag when&#160;it detects a stack overflow or&#160;underflow&#160;condition,&#160;but&#160;it does&#160;not explicitly clear the&#160;flag&#160;when it&#160;<br/>detects an&#160;invalid-arithmetic-operand condition. As a&#160;result, the&#160;state of&#160;the&#160;SF flag&#160;can be&#160;1&#160;following&#160;an invalid-<br/>arithmetic-operation exception, if&#160;it was&#160;not&#160;cleared from&#160;the last&#160;time a&#160;stack overflow&#160;or&#160;underflow&#160;condition&#160;<br/>occurred.&#160;S<a href="o_7281d5ea06a5b67a-196.html">ee Section 8.1.3.4,&#160;“Stack Fault Flag,”&#160;for mo</a>re&#160;information about&#160;the SF flag.</p>
<p style="position:absolute;top:467px;left:69px;white-space:nowrap" class="ft06">8.5.1.1&#160;&#160;</p>
<p style="position:absolute;top:467px;left:153px;white-space:nowrap" class="ft06">Stack Overflow&#160;or&#160;Underflow Exception (#IS)</p>
<p style="position:absolute;top:496px;left:69px;white-space:nowrap" class="ft08">The x87 FPU tag&#160;word keeps track of the contents of the registers in the x87 FPU re<a href="o_7281d5ea06a5b67a-198.html">gister stack (see Section 8.1.7,&#160;<br/>“x87&#160;FPU&#160;Tag Word”). It&#160;</a>then&#160;uses&#160;this information&#160;to detect two different types of stack faults:</p>
<p style="position:absolute;top:534px;left:69px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:535px;left:95px;white-space:nowrap" class="ft08"><b>Stack overflow</b>&#160;— An instruction attempts to load a non-empty x87 FPU register from memory.&#160;A non-empty&#160;<br/>register is defined as&#160;a register containing a zero (tag&#160;value&#160;of&#160;01), a valid value (tag value of 00), or a special&#160;<br/>value (tag&#160;value&#160;of&#160;10).</p>
<p style="position:absolute;top:589px;left:69px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:590px;left:95px;white-space:nowrap" class="ft08"><b>Stack underflow</b>&#160;— An&#160;instruction references&#160;an empty x87&#160;FPU register&#160;as a&#160;source operand, including&#160;<br/>attempting&#160;to&#160;write&#160;the contents&#160;of an empty register to&#160;memory. An empty&#160;register has a&#160;tag&#160;value of 11.</p>
<p style="position:absolute;top:641px;left:428px;white-space:nowrap" class="ft06">NOTES</p>
<p style="position:absolute;top:667px;left:122px;white-space:nowrap" class="ft08">The&#160;term&#160;stack overflow originates from the&#160;situation where&#160;the program has&#160;loaded&#160;(pushed)&#160;<br/>eight values&#160;from memory onto the x87&#160;FPU register&#160;stack and&#160;the next value pushed&#160;on&#160;the stack&#160;<br/>causes&#160;a stack&#160;wraparound to a&#160;register that&#160;already contains&#160;a value.<br/>The&#160;term&#160;stack underflow originates from&#160;the opposite&#160;situation.&#160;Here,&#160;a program has stored&#160;<br/>(popped)&#160;eight&#160;values&#160;from the x87&#160;FPU register&#160;stack to memory and the&#160;next&#160;value&#160;popped from&#160;<br/>the&#160;stack causes&#160;stack wraparound to&#160;an empty&#160;register.</p>
<p style="position:absolute;top:778px;left:69px;white-space:nowrap" class="ft08">When&#160;the x87 FPU&#160;detects stack overflow&#160;or&#160;underflow, it&#160;sets&#160;the&#160;IE&#160;flag (bit 0)&#160;and&#160;the&#160;SF&#160;flag&#160;(bit&#160;6) in&#160;the x87&#160;<br/>FPU&#160;status&#160;word&#160;to&#160;1.&#160;It&#160;then&#160;sets&#160;condition-code&#160;flag&#160;C1&#160;(bit&#160;9)&#160;in&#160;the&#160;x87&#160;FPU&#160;status&#160;word&#160;to&#160;1&#160;if&#160;stack&#160;overflow&#160;<br/>occurred&#160;or&#160;to 0&#160;if stack&#160;underflow occurred.&#160;<br/>If the&#160;invalid-operation exception&#160;is masked,&#160;the x87&#160;FPU&#160;returns&#160;the floating&#160;point, integer,&#160;or&#160;packed decimal&#160;<br/>integer&#160;indefinite value&#160;to the&#160;destination operand, depending on&#160;the instruction being executed. This&#160;value over-<br/>writes&#160;the destination register or&#160;memory&#160;location specified&#160;by the&#160;instruction.<br/>If the&#160;invalid-operation exception&#160;is not masked,&#160;a software&#160;exception handler is&#160;invoked (see&#160;<a href="o_7281d5ea06a5b67a-222.html">Section&#160;8.7,&#160;<br/>“Handling x87 FPU&#160;Exceptions in&#160;Software”) and the</a>&#160;top-of-stack pointer (TOP) and source&#160;operands remain&#160;<br/>unchanged.</p>
<p style="position:absolute;top:969px;left:69px;white-space:nowrap" class="ft06">8.5.1.2 &#160;</p>
<p style="position:absolute;top:969px;left:153px;white-space:nowrap" class="ft06">Invalid&#160;Arithmetic Operand&#160;Exception (#IA)</p>
<p style="position:absolute;top:997px;left:69px;white-space:nowrap" class="ft08">The&#160;x87 FPU is&#160;able&#160;to detect&#160;a variety&#160;of invalid arithmetic operations that&#160;can be coded&#160;in a&#160;program. These&#160;oper-<br/>ations are&#160;<a href="o_7281d5ea06a5b67a-218.html">listed in Table 8-10. (This&#160;</a>list includes&#160;the invalid operations defined&#160;in&#160;IEEE Standard&#160;754.)<br/>When the&#160;x87&#160;FPU&#160;detects an&#160;invalid&#160;arithmetic operand, it&#160;sets&#160;the IE&#160;flag (bit 0) in&#160;the x87 FPU&#160;status word&#160;to 1.&#160;<br/>If&#160;the invalid-operation&#160;exception is&#160;masked, the&#160;x87 FPU then&#160;returns&#160;an indefinite&#160;value or&#160;QNaN to&#160;the destina-</p>
</div>
</body>
</html>
