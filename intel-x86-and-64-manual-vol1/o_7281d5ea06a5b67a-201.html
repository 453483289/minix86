<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 201</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:11px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:9px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page201-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a201.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:775px;white-space:nowrap" class="ft00">Vol. 1&#160;8-11</p>
<p style="position:absolute;top:47px;left:634px;white-space:nowrap" class="ft01">PROGRAMMING&#160;WITH&#160;THE X87&#160;FPU</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft07">The fopcode compatibility mode&#160;should be enabled&#160;only&#160;when x87&#160;FPU floating-point exception handlers are&#160;<br/>designed to&#160;use the&#160;fopcode&#160;to analyze program performance or&#160;restart a&#160;program after an&#160;exception has been&#160;<br/>handled.<br/>More&#160;recent&#160;Intel 64&#160;processors do&#160;not support fopcode&#160;compatibility mode&#160;and do not allow software&#160;to set bit&#160;2&#160;<br/>of the&#160;IA32_MISC_ENABLE&#160;MSR.</p>
<p style="position:absolute;top:224px;left:69px;white-space:nowrap" class="ft03">8.1.10&#160;</p>
<p style="position:absolute;top:224px;left:149px;white-space:nowrap" class="ft03">Saving the x87 FPU‚Äôs State with FSTENV/FNSTENV&#160;and FSAVE/FNSAVE</p>
<p style="position:absolute;top:255px;left:69px;white-space:nowrap" class="ft07">The&#160;FSTENV/FNSTENV and&#160;FSAVE/FNSAVE instructions store x87&#160;FPU&#160;state information&#160;in memory for use&#160;by&#160;<br/>exception handlers&#160;and&#160;other system and&#160;application&#160;software. The&#160;FSTENV/FNSTENV instruction saves the&#160;<br/>contents&#160;of&#160;the status, control, tag, x87 FPU&#160;instruction&#160;pointer,&#160;x87 FPU&#160;data pointer,&#160;and opcode&#160;registers. The&#160;<br/>FSAVE/FNSAVE instruction stores&#160;that information&#160;plus the&#160;contents of the x87&#160;FPU data registers. Note&#160;that the&#160;<br/>FSAVE/FNSAVE instruction also&#160;initializes&#160;the&#160;x87&#160;FPU&#160;to default values&#160;(just&#160;as the&#160;FINIT/FNINIT&#160;instruction&#160;does)&#160;<br/>after it&#160;has saved the&#160;original&#160;state of&#160;the&#160;x87&#160;FPU.<br/>The manner in&#160;which this&#160;information is&#160;stored&#160;in memory depends on the&#160;operating mode&#160;of the&#160;processor&#160;<br/>(protected&#160;mode&#160;or&#160;real-address&#160;mode)&#160;and on the operand-size attribute in effect&#160;(32-bit or&#160;16-bit).&#160;S<a href="o_7281d5ea06a5b67a-201.html">ee Figures&#160;<br/>8-9 t</a>h<a href="o_7281d5ea06a5b67a-202.html">rough 8-12.</a>&#160;In virtual-8086&#160;mode&#160;or SMM,&#160;the real-address mode&#160;<a href="o_7281d5ea06a5b67a-202.html">formats shown in Figure&#160;8-12&#160;is used.</a>&#160;See&#160;<br/><a href="˛ˇ">Chapter 34, ‚ÄúSystem&#160;Management&#160;Mode,‚Äù&#160;o</a>f&#160;the&#160;<i>Intel¬Æ 64 and IA-32 Architectures&#160;Software Developer‚Äôs Manual,&#160;<br/>Volume 3C,</i>&#160;for information&#160;on using the&#160;x87&#160;FPU while in&#160;SMM.<br/>The FLDENV and FRSTOR instructions&#160;allow x87 FPU state information to be loaded from memory into the x87 FPU.&#160;<br/>Here,&#160;the FLDENV instruction loads&#160;only&#160;the&#160;status, control,&#160;tag,&#160;x87 FPU&#160;instruction&#160;pointer,&#160;x87&#160;FPU data pointer,&#160;<br/>and&#160;opcode registers, and&#160;the FRSTOR instruction loads&#160;all&#160;the x87&#160;FPU registers, including the&#160;x87 FPU&#160;stack&#160;<br/>registers.&#160;</p>
<p style="position:absolute;top:787px;left:198px;white-space:nowrap" class="ft05">Figure&#160;8-9. &#160;Protected&#160;Mode&#160;x87 FPU&#160;State Image in Memory, 32-Bit&#160;Format</p>
<p style="position:absolute;top:565px;left:621px;white-space:nowrap" class="ft00">0</p>
<p style="position:absolute;top:565px;left:263px;white-space:nowrap" class="ft00">31</p>
<p style="position:absolute;top:586px;left:635px;white-space:nowrap" class="ft00">0</p>
<p style="position:absolute;top:606px;left:635px;white-space:nowrap" class="ft00">4</p>
<p style="position:absolute;top:626px;left:635px;white-space:nowrap" class="ft00">8</p>
<p style="position:absolute;top:646px;left:635px;white-space:nowrap" class="ft00">12</p>
<p style="position:absolute;top:666px;left:635px;white-space:nowrap" class="ft00">16</p>
<p style="position:absolute;top:686px;left:635px;white-space:nowrap" class="ft00">20</p>
<p style="position:absolute;top:706px;left:635px;white-space:nowrap" class="ft00">24</p>
<p style="position:absolute;top:549px;left:361px;white-space:nowrap" class="ft06"><b>32-Bit Protected&#160;Mode&#160;Format</b></p>
<p style="position:absolute;top:585px;left:503px;white-space:nowrap" class="ft00">Control Word</p>
<p style="position:absolute;top:666px;left:331px;white-space:nowrap" class="ft00">Bits&#160;10:0 of&#160;opcode</p>
<p style="position:absolute;top:605px;left:505px;white-space:nowrap" class="ft00">Status Word</p>
<p style="position:absolute;top:626px;left:512px;white-space:nowrap" class="ft00">Tag Word</p>
<p style="position:absolute;top:666px;left:452px;white-space:nowrap" class="ft00">FPU Instruction Pointer&#160;Selector</p>
<p style="position:absolute;top:707px;left:448px;white-space:nowrap" class="ft00">FPU Data&#160;Pointer Selector (FDS)</p>
<p style="position:absolute;top:686px;left:371px;white-space:nowrap" class="ft00">FPU&#160;Data&#160;Pointer Offset&#160;(FDP)</p>
<p style="position:absolute;top:666px;left:266px;white-space:nowrap" class="ft00">0 0 0&#160;0 0</p>
<p style="position:absolute;top:646px;left:367px;white-space:nowrap" class="ft00">FPU&#160;Instruction Pointer Offset (FIP)</p>
<p style="position:absolute;top:565px;left:424px;white-space:nowrap" class="ft00">16</p>
<p style="position:absolute;top:565px;left:449px;white-space:nowrap" class="ft00">15</p>
<p style="position:absolute;top:726px;left:261px;white-space:nowrap" class="ft02">For&#160;instructions&#160;that&#160;also&#160;store&#160;x87&#160;FPU&#160;data&#160;registers,&#160;the&#160;eight&#160;</p>
<p style="position:absolute;top:742px;left:261px;white-space:nowrap" class="ft02">80-bit&#160;registers (R0-R7) follow&#160;the above structure in&#160;sequence.</p>
</div>
</body>
</html>
