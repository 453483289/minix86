<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 423</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:21px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:8px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:18px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page423-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a423.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:781px;white-space:nowrap" class="ft00">Vol. 1&#160;D-1</p>
<p style="position:absolute;top:96px;left:703px;white-space:nowrap" class="ft01">APPENDIX D</p>
<p style="position:absolute;top:120px;left:456px;white-space:nowrap" class="ft01">GUIDELINES FOR&#160;WRITING X87 FPU</p>
<p style="position:absolute;top:144px;left:591px;white-space:nowrap" class="ft01">EXCEPTION HANDLERS</p>
<p style="position:absolute;top:214px;left:68px;white-space:nowrap" class="ft07">As described in&#160;<a href="o_7281d5ea06a5b67a-191.html">Chapter 8, “Programming with&#160;the&#160;x87 FPU,”&#160;</a>the IA-32 Architecture supports two mechanisms&#160;for&#160;<br/>accessing&#160;exception handlers to&#160;handle unmasked&#160;x87&#160;FPU&#160;exceptions: native&#160;mode&#160;and MS-DOS compatibility&#160;<br/>mode.&#160;The primary&#160;purpose&#160;of&#160;this appendix is&#160;to provide detailed information&#160;to help software&#160;engineers&#160;design&#160;<br/>and write x87 FPU exception-handling facilities to run&#160;on&#160;PC systems that use the MS-DOS compatibility mode</p>
<p style="position:absolute;top:261px;left:804px;white-space:nowrap" class="ft03">1</p>
<p style="position:absolute;top:264px;left:811px;white-space:nowrap" class="ft02">&#160;for&#160;</p>
<p style="position:absolute;top:280px;left:68px;white-space:nowrap" class="ft07">handling x87 FPU&#160;exceptions.&#160;Some of the&#160;information&#160;in&#160;this appendix will also&#160;be&#160;of interest&#160;to engineers who&#160;are&#160;<br/>writing native-mode&#160;x87 FPU exception handlers.&#160;The&#160;information provided&#160;is&#160;as follows:</p>
<p style="position:absolute;top:319px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:319px;left:93px;white-space:nowrap" class="ft07">Discussion of the&#160;origin of the MS-DOS&#160;x87 FPU exception handling mechanism and its relationship to the x87&#160;<br/>FPU’s native exception&#160;handling mechanism.</p>
<p style="position:absolute;top:358px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:358px;left:93px;white-space:nowrap" class="ft07">Description&#160;of&#160;the IA-32 flags&#160;and processor pins&#160;that&#160;control the&#160;MS-DOS&#160;x87 FPU exception handling&#160;<br/>mechanism.</p>
<p style="position:absolute;top:397px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:397px;left:93px;white-space:nowrap" class="ft02">Description of the&#160;external hardware&#160;typically&#160;required&#160;to support MS-DOS exception&#160;handling mechanism.</p>
<p style="position:absolute;top:419px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:420px;left:93px;white-space:nowrap" class="ft07">Description of the&#160;x87 FPU’s exception&#160;handling mechanism and the&#160;typical protocol for x87&#160;FPU exception&#160;<br/>handlers.</p>
<p style="position:absolute;top:458px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:459px;left:93px;white-space:nowrap" class="ft02">Code examples that demonstrate&#160;various&#160;levels of x87&#160;FPU exception&#160;handlers.</p>
<p style="position:absolute;top:481px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:481px;left:93px;white-space:nowrap" class="ft02">Discussion of&#160;x87&#160;FPU&#160;considerations&#160;in multitasking environments.</p>
<p style="position:absolute;top:503px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:504px;left:93px;white-space:nowrap" class="ft02">Discussion of&#160;native mode&#160;x87&#160;FPU exception&#160;handling.</p>
<p style="position:absolute;top:528px;left:68px;white-space:nowrap" class="ft07">The&#160;information given is&#160;oriented&#160;toward&#160;the most&#160;recent&#160;generations of IA-32 processors,&#160;starting&#160;with the&#160;<br/>Intel486.&#160;It is&#160;intended to augment the reference informat<a href="o_7281d5ea06a5b67a-191.html">ion given in Chapter 8,&#160;“Programming with the x87 FPU.”<br/></a>A&#160;more extensive version of this&#160;appendix&#160;is&#160;available in&#160;the application note&#160;AP-578,&#160;<i>Software&#160;and&#160;Hardware&#160;<br/>Considerations for x87 FPU Exception Handlers for Intel Architecture Processors&#160;</i>(Order Number 243291), which is&#160;<br/>available&#160;from&#160;Intel.</p>
<p style="position:absolute;top:657px;left:68px;white-space:nowrap" class="ft06">D.1 MS-DOS&#160;</p>
<p style="position:absolute;top:657px;left:226px;white-space:nowrap" class="ft06">COMPATIBILITY&#160;</p>
<p style="position:absolute;top:657px;left:376px;white-space:nowrap" class="ft06">SUB-MODE&#160;FOR HANDLING X87 FPU EXCEPTIONS</p>
<p style="position:absolute;top:693px;left:68px;white-space:nowrap" class="ft07">The&#160;first generations of IA-32&#160;processors&#160;(starting with&#160;the Intel&#160;8086 and&#160;8088&#160;processors&#160;and going&#160;through the&#160;<br/>Intel&#160;286 and&#160;Intel386&#160;processors) did&#160;not&#160;have an&#160;on-chip floating-point&#160;unit. Instead, floating-point&#160;capability&#160;<br/>was provided on a separate numeric coprocessor chip.&#160;The first of these numeric coprocessors was the Intel 8087,&#160;<br/>which was&#160;followed&#160;by the&#160;Intel 287&#160;and Intel&#160;387&#160;numeric&#160;coprocessors.&#160;<br/>To&#160;allow the 8087&#160;to&#160;signal&#160;floating-point exceptions&#160;to&#160;its companion 8086&#160;or 8088,&#160;the&#160;8087 has&#160;an output pin,&#160;<br/>INT,&#160;which&#160;it asserts when an unmasked floating-point&#160;exception occurs. The&#160;designers of the 8087 recommended&#160;<br/>that&#160;the&#160;output from this&#160;pin be&#160;routed&#160;through a&#160;programmable&#160;interrupt&#160;controller (PIC) such&#160;as the&#160;Intel 8259A&#160;<br/>to&#160;the INTR&#160;pin&#160;of the&#160;8086&#160;or 8088. The handler for the resulting interrupt&#160;could then&#160;be&#160;used&#160;to access the&#160;<br/>floating-point&#160;exception&#160;handler.<br/>However,&#160;the&#160;original IBM* PC design&#160;and MS-DOS operating&#160;system used&#160;a&#160;different mechanism for handling&#160;the&#160;<br/>INT&#160;output from the 8087. It connected the INT pin directly&#160;to&#160;the&#160;NMI&#160;input pin of the 8086 or&#160;8088.&#160;The NMI inter-<br/>rupt handler then&#160;had to&#160;determine if the interrupt&#160;was caused by&#160;a floating-point&#160;exception or&#160;another NMI&#160;event.&#160;<br/>This mechanism is the origin&#160;of what&#160;is now called the “MS-DOS compatibility mode.”&#160;The decision to use this latter&#160;<br/>floating-point exception&#160;handling mechanism came&#160;about&#160;because&#160;when&#160;the IBM&#160;PC&#160;was&#160;first designed, the 8087&#160;<br/>was&#160;not available.&#160;When&#160;the 8087&#160;did&#160;become&#160;available,&#160;other&#160;functions&#160;had already been assigned&#160;to the&#160;eight&#160;<br/>inputs to&#160;the PIC. One&#160;of&#160;these&#160;functions was&#160;a BIOS video interrupt,&#160;which was&#160;assigned&#160;vector 16&#160;for the&#160;8086&#160;<br/>and 8088.</p>
<p style="position:absolute;top:1021px;left:68px;white-space:nowrap" class="ft02">1&#160;&#160;Microsoft Windows* 95&#160;and&#160;Windows 3.1 (and&#160;earlier versions) operating&#160;systems&#160;use&#160;almost&#160;the&#160;same&#160;x87 FPU&#160;exception handling&#160;</p>
<p style="position:absolute;top:1038px;left:89px;white-space:nowrap" class="ft02">interface&#160;as&#160;MS-DOS.&#160;The&#160;recommendations in&#160;this&#160;appendix&#160;for&#160;a&#160;MS-DOS&#160;compatible exception&#160;handler&#160;thus&#160;apply&#160;to&#160;all three&#160;oper-</p>
<p style="position:absolute;top:1054px;left:89px;white-space:nowrap" class="ft02">ating&#160;systems.</p>
</div>
</body>
</html>
