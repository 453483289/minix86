<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 275</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft09{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page275-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a275.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:768px;white-space:nowrap" class="ft00">Vol. 1&#160;11-21</p>
<p style="position:absolute;top:47px;left:401px;white-space:nowrap" class="ft01">PROGRAMMING&#160;WITH INTEL¬Æ STREAMING SIMD EXTENSIONS 2&#160;(INTEL¬Æ SSE2)</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft06">In addition to&#160;saving&#160;and restoring the&#160;SSE and&#160;SSE2&#160;state, FXSAVE&#160;and FXRSTOR also&#160;save and&#160;restore&#160;the x87&#160;<br/>FPU state&#160;(because MMX registers are&#160;aliased to&#160;the x87&#160;FPU data registers&#160;this includes&#160;saving and&#160;restoring&#160;the&#160;<br/>MMX&#160;state). For&#160;greater code efficiency,&#160;it is&#160;suggested&#160;that FXSAVE and&#160;FXRSTOR be substituted for the&#160;FSAVE,&#160;<br/>FNSAVE&#160;and FRSTOR instructions in the&#160;following&#160;situations:</p>
<p style="position:absolute;top:172px;left:69px;white-space:nowrap" class="ft03">‚Ä¢</p>
<p style="position:absolute;top:172px;left:95px;white-space:nowrap" class="ft02">When&#160;a context switch is&#160;being made&#160;in a&#160;multitasking&#160;environment</p>
<p style="position:absolute;top:194px;left:69px;white-space:nowrap" class="ft03">‚Ä¢</p>
<p style="position:absolute;top:195px;left:95px;white-space:nowrap" class="ft02">During calls&#160;and returns&#160;from&#160;interrupt and&#160;exception handlers</p>
<p style="position:absolute;top:219px;left:69px;white-space:nowrap" class="ft06">In situations where&#160;the code&#160;is&#160;switching&#160;between x87&#160;FPU&#160;and MMX technology&#160;computations&#160;(without a&#160;context&#160;<br/>switch or&#160;a call&#160;to an&#160;interrupt or&#160;exception), the&#160;FSAVE/FNSAVE and&#160;FRSTOR&#160;instructions&#160;are more&#160;efficient than&#160;<br/>the FXSAVE&#160;and FXRSTOR instructions.</p>
<p style="position:absolute;top:302px;left:69px;white-space:nowrap" class="ft04">11.6.6&#160;</p>
<p style="position:absolute;top:302px;left:149px;white-space:nowrap" class="ft04">Guidelines for Writing to&#160;the MXCSR Register</p>
<p style="position:absolute;top:333px;left:69px;white-space:nowrap" class="ft07">The MXCSR&#160;has&#160;several reserved&#160;bits,&#160;and attempting&#160;to&#160;write&#160;a 1 to any of these bits will cause a general-protec-<br/>tion exception (#GP)&#160;to be generated. To&#160;allow&#160;software&#160;to&#160;identify these reserved bits,&#160;the MXCSR_MASK value&#160;is&#160;<br/>provided.&#160;Software can&#160;determine&#160;this mask value&#160;as follows:<br/>1.&#160;Establish a&#160;512-byte&#160;FXSAVE&#160;area in memory.<br/>2.&#160;Clear the&#160;FXSAVE area&#160;to&#160;all 0s.<br/>3.&#160;Execute the&#160;FXSAVE instruction,&#160;using the&#160;address of the first&#160;byte&#160;of the&#160;cleared&#160;FXSAVE&#160;area as&#160;a source&#160;</p>
<p style="position:absolute;top:454px;left:95px;white-space:nowrap" class="ft06">operand.&#160;See ‚ÄúFXSAVE‚ÄîSave&#160;x87 FPU,&#160;MMX,&#160;SSE,&#160;and SSE2 State‚Äù in<a href="˛ˇ">&#160;Chapter&#160;3&#160;</a>of&#160;the&#160;<i>Intel¬Æ 64&#160;and&#160;IA-32&#160;<br/>Architectures&#160;Software Developer‚Äôs Manual, Volume&#160;2A,</i>&#160;for&#160;a description&#160;of FXSAVE&#160;and the layout&#160;of&#160;the&#160;<br/>FXSAVE image.</p>
<p style="position:absolute;top:511px;left:69px;white-space:nowrap" class="ft02">4.&#160;Check&#160;the value in&#160;the MXCSR_MASK&#160;field&#160;in&#160;the FXSAVE&#160;image&#160;(bytes 28 through 31).</p>
<p style="position:absolute;top:535px;left:95px;white-space:nowrap" class="ft02">‚Äî&#160;If the&#160;value of the&#160;MXCSR_MASK field&#160;is&#160;00000000H, then&#160;the MXCSR_MASK&#160;value&#160;is the&#160;default value&#160;of&#160;</p>
<p style="position:absolute;top:552px;left:120px;white-space:nowrap" class="ft06">0000FFBFH. Note&#160;that this&#160;value indicates that&#160;bit 6 of&#160;the MXCSR register&#160;is reserved; this&#160;setting&#160;indicates&#160;<br/>that&#160;the denormals-are-zero&#160;mode is&#160;not supported&#160;on&#160;the processor.</p>
<p style="position:absolute;top:592px;left:95px;white-space:nowrap" class="ft02">‚Äî&#160;If the&#160;value of the&#160;MXCSR_MASK field&#160;is&#160;non-zero,&#160;the MXCSR_MASK&#160;value&#160;should be used as&#160;the&#160;</p>
<p style="position:absolute;top:609px;left:120px;white-space:nowrap" class="ft02">MXCSR_MASK.</p>
<p style="position:absolute;top:633px;left:69px;white-space:nowrap" class="ft06">All bits set&#160;to 0 in&#160;the&#160;MXCSR_MASK value&#160;indicate reserved bits in the&#160;MXCSR&#160;register.&#160;Thus,&#160;if the MXCSR_MASK&#160;<br/>value&#160;is AND‚Äôd with a&#160;value&#160;to be written&#160;into&#160;the MXCSR register, the&#160;resulting&#160;value&#160;will&#160;be&#160;assured of having all&#160;<br/>its reserved bits set&#160;to 0,&#160;preventing the&#160;possibility of&#160;a&#160;general-protection&#160;exception&#160;being generated when the&#160;<br/>value&#160;is written to&#160;the MXCSR&#160;register.&#160;<br/>For example,&#160;the&#160;default MXCSR_MASK&#160;value when&#160;00000000H&#160;is returned&#160;in the FXSAVE&#160;image&#160;is 0000FFBFH. If&#160;<br/>software AND‚Äôs&#160;a value&#160;to be&#160;written to&#160;MXCSR register&#160;with 0000FFBFH,&#160;bit&#160;6&#160;of&#160;the result&#160;(the DAZ flag) will be&#160;<br/>ensured of being set to 0, which is the&#160;required setting&#160;to prevent general-protection exceptions on processors that&#160;<br/>do&#160;not support the&#160;denormals-are-zero mode.<br/>To&#160;prevent general-protection exceptions, the&#160;MXCSR_MASK&#160;value&#160;should be AND‚Äôd with the&#160;value to&#160;be&#160;written&#160;<br/>into the&#160;MXCSR register&#160;in the&#160;following situations:</p>
<p style="position:absolute;top:818px;left:69px;white-space:nowrap" class="ft03">‚Ä¢</p>
<p style="position:absolute;top:819px;left:95px;white-space:nowrap" class="ft06">Operating&#160;system&#160;routines&#160;that receive&#160;a parameter&#160;from&#160;an application program and then write&#160;that value to&#160;<br/>the MXCSR&#160;register (either with an&#160;FXRSTOR&#160;or LDMXCSR&#160;instruction)</p>
<p style="position:absolute;top:857px;left:69px;white-space:nowrap" class="ft03">‚Ä¢</p>
<p style="position:absolute;top:858px;left:95px;white-space:nowrap" class="ft06">Any application&#160;program that writes to&#160;the&#160;MXCSR register&#160;and that needs&#160;to run&#160;robustly&#160;on&#160;several different&#160;<br/>IA-32 processors</p>
<p style="position:absolute;top:898px;left:69px;white-space:nowrap" class="ft06">Note&#160;that&#160;all bits in&#160;the MXCSR_MASK value&#160;that are&#160;set&#160;to&#160;1 indicate features&#160;that are supported&#160;by&#160;the MXCSR&#160;<br/>register;&#160;they&#160;can be treated&#160;as feature&#160;flags for&#160;identifying processor capabilities.</p>
<p style="position:absolute;top:965px;left:69px;white-space:nowrap" class="ft04">11.6.7&#160;</p>
<p style="position:absolute;top:965px;left:149px;white-space:nowrap" class="ft04">Interaction of SSE/SSE2 Instructions with x87&#160;FPU and MMX Instructions</p>
<p style="position:absolute;top:996px;left:69px;white-space:nowrap" class="ft06">The XMM&#160;registers and&#160;the x87 FPU&#160;and MMX&#160;registers represent separate&#160;execution environments, which has&#160;<br/>certain ramifications when&#160;executing SSE, SSE2, MMX,&#160;and x87 FPU instructions&#160;in the same&#160;code module&#160;or when&#160;<br/>mixing code modules that contain&#160;these&#160;instructions:</p>
</div>
</body>
</html>
