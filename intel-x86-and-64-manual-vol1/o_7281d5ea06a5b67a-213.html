<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 213</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:18px;font-family:Times;color:#000000;}
	.ft04{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft05{font-size:11px;line-height:23px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page213-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a213.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:775px;white-space:nowrap" class="ft00">Vol. 1&#160;8-23</p>
<p style="position:absolute;top:47px;left:634px;white-space:nowrap" class="ft01">PROGRAMMING&#160;WITH&#160;THE X87&#160;FPU</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft04">With the&#160;Pentium&#160;processor&#160;and&#160;later IA-32 processors,&#160;the worst case&#160;error&#160;on&#160;transcendental functions&#160;is less&#160;<br/>than&#160;1 ulp&#160;when&#160;rounding to&#160;the nearest (even) and&#160;less&#160;than&#160;1.5 ulps when rounding&#160;in&#160;other modes.&#160;The func-<br/>tions are&#160;guaranteed to be monotonic,&#160;with respect&#160;to the input&#160;operands,&#160;throughout&#160;the&#160;domain supported&#160;by&#160;the&#160;<br/>instruction.<br/>However,&#160;for FSIN, FCOS, FSINCOS,&#160;and FPTAN which approximate periodic&#160;trigonometric functions, the previous&#160;<br/>statement about&#160;maximum&#160;ulp&#160;errors is&#160;true only when these instructions are&#160;applied to reduced&#160;argument (see&#160;<br/><a href="o_7281d5ea06a5b67a-211.html">Section 8.3.8,&#160;“Approximation&#160;of Pi”). This</a>&#160;is&#160;due&#160;to the&#160;fact&#160;that only 66 significant&#160;bits are retained in&#160;the finite&#160;<br/>approximation Pi&#160;of the&#160;number&#160;π&#160;(3.1415926…),&#160;used&#160;internally&#160;for&#160;calculating the&#160;reduced argument&#160;in FSIN,&#160;</p>
<p style="position:absolute;top:240px;left:69px;white-space:nowrap" class="ft02">FCOS, FSINCOS,&#160;and FPTAN. This approximation&#160;of&#160;π&#160;is not always&#160;sufficiently accurate for good argument&#160;reduc-</p>
<p style="position:absolute;top:256px;left:69px;white-space:nowrap" class="ft04">tion.&#160;<br/>For single precision,&#160;the&#160;argument of FSIN,&#160;FCOS,&#160;FSINCOS,&#160;and FPTAN must&#160;exceed&#160;200,000&#160;radians&#160;in&#160;order for&#160;<br/>the error&#160;of the&#160;result to&#160;exceed 1 ulp&#160;when&#160;rounding&#160;to&#160;the nearest (even),&#160;or 1.5&#160;ulps when rounding&#160;in other&#160;<br/>(directed) rounding&#160;modes.<br/>For double and&#160;double-extended precision,&#160;the ulp&#160;errors&#160;will grow above&#160;these thresholds for arguments&#160;much&#160;<br/>smaller in magnitude. The ulp errors increase significantly when the argument approaches the value of&#160;π&#160;(or Pi)&#160;for&#160;</p>
<p style="position:absolute;top:370px;left:69px;white-space:nowrap" class="ft04">FSIN, and when it&#160;approaches&#160;π/2(or Pi/2) for FCOS,&#160;FSINCOS,&#160;and&#160;FPTAN.<br/>For&#160;all three&#160;IEEE&#160;precisions&#160;supported (32-bit single&#160;precision,&#160;64-bit double precision, and&#160;80-bit double-<br/>extended&#160;precision),&#160;applying&#160;FSIN,&#160;FCOS,&#160;FSINCOS,&#160;or FPTAN to&#160;arguments larger than a&#160;certain&#160;value&#160;can lead&#160;<br/>to reduced&#160;arguments (calculated internally) that are inaccurate or even&#160;very&#160;inaccurate&#160;in&#160;some cases. This leads&#160;<br/>to&#160;equally inaccurate approximations of the&#160;corresponding&#160;mathematical&#160;functions. In particular, arguments&#160;that&#160;<br/>are close to&#160;certain values&#160;will lose significance&#160;when reduced, leading&#160;to increased&#160;relative&#160;(and ulp)&#160;errors in the&#160;<br/>results&#160;of FSIN,&#160;FCOS, FSINCOS,&#160;and FPTAN. These&#160;values&#160;are:&#160;</p>
<p style="position:absolute;top:499px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:499px;left:95px;white-space:nowrap" class="ft02">any non-zero multiple&#160;of&#160;π&#160;for FSIN,&#160;</p>
<p style="position:absolute;top:521px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:522px;left:95px;white-space:nowrap" class="ft02">any multiple&#160;of&#160;π, plus&#160;π/2&#160;for FCOS,&#160;and&#160;</p>
<p style="position:absolute;top:544px;left:69px;white-space:nowrap" class="ft03">•</p>
<p style="position:absolute;top:544px;left:95px;white-space:nowrap" class="ft02">any non-zero multiple&#160;of&#160;π/2 for FSINCOS&#160;and FPTAN.&#160;</p>
<p style="position:absolute;top:568px;left:69px;white-space:nowrap" class="ft04">If the&#160;arguments passed&#160;to FSIN,&#160;FCOS,&#160;FSINCOS,&#160;and FPTAN are not close to these values&#160;then even the&#160;finite&#160;<br/>approximation Pi&#160;of&#160;π&#160;used internally for argument&#160;reduction&#160;will&#160;allow for results that have good accuracy.<br/>Therefore,&#160;in order to&#160;avoid such&#160;errors it&#160;is recommended&#160;to&#160;perform accurate&#160;argument&#160;reduction&#160;in&#160;software,&#160;<br/>and&#160;to apply FSIN,&#160;FCOS, FSINCOS,&#160;and FPTAN&#160;to reduced arguments&#160;only. Regardless&#160;of&#160;the target precision&#160;<br/>(single, double, or double-extended), it&#160;is safe&#160;to reduce&#160;the&#160;argument to&#160;a value smaller in absolute value&#160;than&#160;<br/>about 3π/4 for FSIN,&#160;and&#160;smaller than about&#160;3π/8 for FCOS,&#160;FSINCOS,&#160;and FPTAN.&#160;<br/>The thresholds shown above are not exact. For example,&#160;accuracy measurements show that the double-extended&#160;<br/>precision result of&#160;FSIN&#160;will not have&#160;errors&#160;larger&#160;than 0.72 ulp for&#160;|x| &lt; 2.82&#160;(so |x|&#160;&lt; 3π/4 will ensure&#160;good accu-</p>
<p style="position:absolute;top:715px;left:69px;white-space:nowrap" class="ft02">racy,&#160;as&#160;3π/4&#160;&lt;&#160;2.82).&#160;On the&#160;same interval,&#160;double&#160;precision results from FSIN will&#160;have&#160;errors&#160;at most&#160;slightly&#160;</p>
<p style="position:absolute;top:732px;left:69px;white-space:nowrap" class="ft04">larger&#160;than 0.5&#160;ulp,&#160;and single&#160;precision results&#160;will&#160;be&#160;correctly rounded in&#160;the&#160;vast majority&#160;of cases.<br/>Likewise, the double-extended precision result of FCOS will not have&#160;errors larger than 0.82&#160;ulp for |x| &lt; 1.31 (so&#160;<br/>|x| &lt; 3π/8&#160;will&#160;ensure good accuracy, as&#160;3π/8 &lt; 1.31).&#160;On&#160;the same&#160;interval,&#160;double precision results&#160;from&#160;FCOS&#160;</p>
<p style="position:absolute;top:789px;left:69px;white-space:nowrap" class="ft04">will&#160;have errors&#160;at most slightly&#160;larger&#160;than&#160;0.5&#160;ulp,&#160;and&#160;single&#160;precision results&#160;will be correctly&#160;rounded in&#160;the vast&#160;<br/>majority&#160;of&#160;cases.<br/>FSINCOS behaves&#160;similarly&#160;to FSIN and FCOS,&#160;combined&#160;as a&#160;pair.<br/>Finally,&#160;the&#160;double-extended precision result&#160;of FPTAN&#160;will&#160;not have&#160;errors&#160;larger&#160;than&#160;0.78&#160;ulp&#160;for |x| &lt; 1.25&#160;(so&#160;<br/>|x| &lt;&#160;3π/8 will ensure good accuracy, as 3π/8&#160;&lt; 1.25). On the&#160;same&#160;interval, double precision results from FPTAN&#160;</p>
<p style="position:absolute;top:886px;left:69px;white-space:nowrap" class="ft04">will&#160;have errors&#160;at most slightly&#160;larger&#160;than&#160;0.5&#160;ulp,&#160;and&#160;single&#160;precision results&#160;will be correctly&#160;rounded in&#160;the vast&#160;<br/>majority&#160;of&#160;cases.<br/>A&#160;recommended&#160;alternative&#160;in order to avoid the&#160;accuracy&#160;issues&#160;that&#160;might be caused by FSIN,&#160;FCOS, FSINCOS,&#160;<br/>and FPTAN, is to use good quality mathematical library implementations of the&#160;sin, cos, sincos, and tan&#160;functions,&#160;<br/>for example those&#160;from&#160;the Intel®&#160;Math&#160;Library available in&#160;the Intel®&#160;Compiler.<br/>The instructions&#160;FYL2X and FYL2XP1&#160;are&#160;two operand&#160;instructions and are guaranteed to&#160;be within 1 ulp only when&#160;<br/>y&#160;equals 1.&#160;When y is not equal to 1,&#160;the maximum&#160;ulp&#160;error is&#160;always&#160;within 1.35&#160;ulps in round to&#160;nearest mode.&#160;<br/>(For the&#160;two&#160;operand functions, monotonicity&#160;was&#160;proved by holding one&#160;of&#160;the operands&#160;constant.)</p>
</div>
</body>
</html>
