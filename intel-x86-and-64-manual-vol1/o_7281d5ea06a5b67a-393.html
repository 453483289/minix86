<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 393</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:16px;font-family:Times;color:#0860a8;}
	.ft04{font-size:12px;font-family:Times;color:#0860a8;}
	.ft05{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft06{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page393-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a393.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:775px;white-space:nowrap" class="ft00">Vol. 1&#160;17-5</p>
<p style="position:absolute;top:47px;left:590px;white-space:nowrap" class="ft01">INTEL®&#160;MEMORY PROTECTION EXTENSIONS</p>
<p style="position:absolute;top:100px;left:69px;white-space:nowrap" class="ft05">programmer&#160;to directly manipulate&#160;any bounds&#160;registers.&#160;Therefore no&#160;new&#160;data type for&#160;a bounds&#160;register is&#160;<br/>needed&#160;in&#160;the syntax of Intel&#160;MPX&#160;intrinsics.&#160;</p>
<p style="position:absolute;top:458px;left:69px;white-space:nowrap" class="ft03">17.4.1 Instruction&#160;</p>
<p style="position:absolute;top:458px;left:242px;white-space:nowrap" class="ft03">Encoding</p>
<p style="position:absolute;top:487px;left:69px;white-space:nowrap" class="ft05">All Intel MPX instructions are NOP&#160;on processors that report CPUID.(EAX=07H,&#160;ECX=0H).EBX.MPX [bit 14] = 0,&#160;or&#160;<br/>if Intel&#160;MPX is&#160;not enabled&#160;by the&#160;operating&#160;system (see<a href="o_7281d5ea06a5b67a-314.html">&#160;Section 13.5).&#160;</a>Applications can&#160;selectively opt-in to use&#160;<br/>Intel MPX instructions.<br/>All Intel MPX&#160;opcodes&#160;encoded to&#160;operate on&#160;BND0-BND3&#160;are valid&#160;Intel&#160;MPX instructions. All&#160;Intel&#160;MPX opcodes&#160;<br/>encoded to&#160;operate&#160;on bound registers&#160;beyond BND3&#160;will #UD if&#160;Intel&#160;MPX&#160;is enabled.<br/>BNDLDX/BNDSTX opcodes require 66H&#160;as a&#160;mandatory&#160;prefix&#160;with its&#160;operand size&#160;tied&#160;to the&#160;address size attri-<br/>bute of the&#160;supported operating&#160;modes. Attempt&#160;to override&#160;operand&#160;size attribute with 66H&#160;or with&#160;REX.W in&#160;64-<br/>bit mode&#160;is ignored.&#160;</p>
<p style="position:absolute;top:665px;left:69px;white-space:nowrap" class="ft03">17.4.2&#160;</p>
<p style="position:absolute;top:665px;left:149px;white-space:nowrap" class="ft03">Usage and Examples</p>
<p style="position:absolute;top:694px;left:69px;white-space:nowrap" class="ft05">BNDMK is&#160;typically used after&#160;memory&#160;is allocated for a&#160;buffer,&#160;e.g.,&#160;by&#160;functions such&#160;as malloc,&#160;calloc, or&#160;when&#160;<br/>the memory is&#160;allocated&#160;on the&#160;stack. However,&#160;many&#160;other usages are&#160;possible such&#160;as when accessing an&#160;array&#160;<br/>member of&#160;a&#160;structure.&#160;</p>
<p style="position:absolute;top:934px;left:69px;white-space:nowrap" class="ft05">BNDMOV&#160;is&#160;typically used&#160;to&#160;copy&#160;bounds from one&#160;bound&#160;register to&#160;another when&#160;a pointer is&#160;copied from one&#160;<br/>general purpose register&#160;to another,&#160;or to&#160;spill/fill bounds&#160;into memory corresponding to&#160;a spill/fill of a&#160;pointer.&#160;</p>
<p style="position:absolute;top:155px;left:305px;white-space:nowrap" class="ft04">Table&#160;17-2.&#160;&#160;&#160;Intel&#160;MPX Instruction Summary</p>
<p style="position:absolute;top:180px;left:107px;white-space:nowrap" class="ft02">Intel MPX&#160;</p>
<p style="position:absolute;top:196px;left:103px;white-space:nowrap" class="ft02">Instruction</p>
<p style="position:absolute;top:188px;left:486px;white-space:nowrap" class="ft02">Description</p>
<p style="position:absolute;top:220px;left:102px;white-space:nowrap" class="ft02">BNDMK&#160;b,&#160;m</p>
<p style="position:absolute;top:220px;left:210px;white-space:nowrap" class="ft02">Create LowerBound&#160;(LB)&#160;and UpperBound&#160;(UB) in&#160;the&#160;bounds&#160;register b</p>
<p style="position:absolute;top:244px;left:99px;white-space:nowrap" class="ft02">BNDCL b,&#160;r/m</p>
<p style="position:absolute;top:244px;left:209px;white-space:nowrap" class="ft02">Checks&#160;the address of&#160;a memory reference&#160;or&#160;address in&#160;r against the lower&#160;bound&#160;</p>
<p style="position:absolute;top:268px;left:98px;white-space:nowrap" class="ft02">BNDCU&#160;b,&#160;r/m</p>
<p style="position:absolute;top:268px;left:210px;white-space:nowrap" class="ft02">Checks the&#160;address&#160;of&#160;a&#160;memory&#160;reference or&#160;address&#160;in&#160;r&#160;against&#160;the&#160;upper bound in&#160;1's&#160;complement&#160;form</p>
<p style="position:absolute;top:300px;left:98px;white-space:nowrap" class="ft02">BNDCN&#160;b,&#160;r/m</p>
<p style="position:absolute;top:292px;left:210px;white-space:nowrap" class="ft02">Checks&#160;the address of&#160;a memory reference&#160;or address in&#160;r against the upper bound&#160;not in&#160;1's complement&#160;</p>
<p style="position:absolute;top:308px;left:210px;white-space:nowrap" class="ft02">form</p>
<p style="position:absolute;top:333px;left:91px;white-space:nowrap" class="ft02">BNDMOV&#160;b,&#160;b/m</p>
<p style="position:absolute;top:333px;left:210px;white-space:nowrap" class="ft02">Copy/load&#160;LB&#160;and UB&#160;bounds from&#160;memory or&#160;a&#160;bounds&#160;register</p>
<p style="position:absolute;top:357px;left:91px;white-space:nowrap" class="ft02">BNDMOV&#160;b/m, b</p>
<p style="position:absolute;top:357px;left:210px;white-space:nowrap" class="ft02">Store&#160;LB and UB bounds&#160;in a bounds register to&#160;memory or another register</p>
<p style="position:absolute;top:381px;left:94px;white-space:nowrap" class="ft02">BNDLDX&#160;b,&#160;mib</p>
<p style="position:absolute;top:381px;left:210px;white-space:nowrap" class="ft02">Load&#160;bounds&#160;using&#160;address&#160;translation using an&#160;sib-addressing expression&#160;mib</p>
<p style="position:absolute;top:404px;left:94px;white-space:nowrap" class="ft02">BNDSTX mib, b</p>
<p style="position:absolute;top:404px;left:210px;white-space:nowrap" class="ft02">Store&#160;bounds using address translation&#160;using&#160;an&#160;sib-addressing&#160;expression&#160;mib</p>
<p style="position:absolute;top:766px;left:69px;white-space:nowrap" class="ft01">Example 17-1. &#160;BNDMK&#160;Example Usage in&#160;Application&#160;and Library Code</p>
<p style="position:absolute;top:789px;left:75px;white-space:nowrap" class="ft02">int A[100];&#160;//assume&#160;the&#160;array&#160;A&#160;is&#160;allocated on the stack&#160;at&#160;‘offset’&#160;</p>
<p style="position:absolute;top:802px;left:75px;white-space:nowrap" class="ft02">from RBP.&#160;</p>
<p style="position:absolute;top:816px;left:75px;white-space:nowrap" class="ft02">//&#160;the&#160;instruction&#160;to&#160;store&#160;starting&#160;address&#160;of&#160;array&#160;will&#160;be:</p>
<p style="position:absolute;top:829px;left:75px;white-space:nowrap" class="ft02">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; LEA RAX, [RBP+offset]</p>
<p style="position:absolute;top:843px;left:75px;white-space:nowrap" class="ft02">//&#160;the instruction to&#160;create&#160;the&#160;bounds&#160;for array A will be:</p>
<p style="position:absolute;top:856px;left:75px;white-space:nowrap" class="ft02">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; BNDMK BND0, [RAX+399]</p>
<p style="position:absolute;top:870px;left:75px;white-space:nowrap" class="ft02">//&#160;Store&#160;RAX into&#160;BND0.LB,&#160;and ~(RAX+399) into&#160;BND0.UB.</p>
<p style="position:absolute;top:789px;left:477px;white-space:nowrap" class="ft02">//&#160;similarly,&#160;for a library implementation of&#160;dynamic allocated&#160;</p>
<p style="position:absolute;top:802px;left:477px;white-space:nowrap" class="ft02">memory</p>
<p style="position:absolute;top:816px;left:477px;white-space:nowrap" class="ft02">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; int * k = malloc(100);</p>
<p style="position:absolute;top:829px;left:477px;white-space:nowrap" class="ft02">//&#160;assuming&#160;that&#160;malloc returns&#160;pointer&#160;k&#160;in&#160;RAX&#160;and&#160;holds&#160;(size&#160;</p>
<p style="position:absolute;top:843px;left:477px;white-space:nowrap" class="ft02">- 1)&#160;in&#160;RCX&#160;</p>
<p style="position:absolute;top:856px;left:477px;white-space:nowrap" class="ft02">//&#160;the malloc implementation&#160;will execute the&#160;following&#160;</p>
<p style="position:absolute;top:870px;left:477px;white-space:nowrap" class="ft02">instruction&#160;before&#160;returning:</p>
<p style="position:absolute;top:883px;left:477px;white-space:nowrap" class="ft02">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;BNDMK BND0, [RAX+RCX]&#160;</p>
<p style="position:absolute;top:897px;left:477px;white-space:nowrap" class="ft02">//&#160;BND0.LB&#160;stores&#160;RAX, and&#160;BND0.UB&#160;stores&#160;~(RAX+RCX)</p>
<p style="position:absolute;top:990px;left:69px;white-space:nowrap" class="ft01">Example 17-2. &#160;BNDMOV&#160;Example&#160;</p>
<p style="position:absolute;top:1012px;left:75px;white-space:nowrap" class="ft02">Spilling or caller save&#160;of&#160;bound register&#160;would use BNDMOV&#160;[RBP+ offset], BNDx.&#160;</p>
<p style="position:absolute;top:1039px;left:75px;white-space:nowrap" class="ft02">Assuming that&#160;the calling convention is that&#160;bound&#160;of&#160;first pointer&#160;is&#160;passed&#160;in&#160;BND0,&#160;and that&#160;bound&#160;happens&#160;to&#160;be&#160;in&#160;BND3&#160;before&#160;</p>
<p style="position:absolute;top:1053px;left:75px;white-space:nowrap" class="ft02">the call, the software&#160;will add instruction BNDMOV&#160;BND0, BND3 prior&#160;to&#160;the call.</p>
</div>
</body>
</html>
