<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 348</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:16px;font-family:Times;color:#0860a8;}
	.ft03{font-size:11px;font-family:Times;color:#000000;}
	.ft04{font-size:18px;font-family:Times;color:#000000;}
	.ft05{font-size:12px;font-family:Times;color:#0860a8;}
	.ft06{font-size:8px;font-family:Times;color:#000000;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:22px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page348-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a348.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">14-20&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROGRAMMING WITH AVX, FMA&#160;AND&#160;AVX2</p>
<p style="position:absolute;top:98px;left:68px;white-space:nowrap" class="ft02">14.4.1&#160;</p>
<p style="position:absolute;top:98px;left:148px;white-space:nowrap" class="ft02">Detection of&#160;F16C Instructions&#160;</p>
<p style="position:absolute;top:127px;left:68px;white-space:nowrap" class="ft03">Application using&#160;float 16&#160;instruction must follow&#160;a detection&#160;sequence&#160;similar to&#160;AVX to&#160;ensure:</p>
<p style="position:absolute;top:149px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:150px;left:93px;white-space:nowrap" class="ft03">The&#160;OS has&#160;enabled YMM state management&#160;support,</p>
<p style="position:absolute;top:172px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:172px;left:93px;white-space:nowrap" class="ft03">The&#160;processor support&#160;AVX&#160;as indicated by&#160;the&#160;CPUID feature&#160;flag,&#160;i.e.&#160;CPUID.01H:ECX.AVX[bit 28] = 1.</p>
<p style="position:absolute;top:194px;left:68px;white-space:nowrap" class="ft04">•</p>
<p style="position:absolute;top:195px;left:93px;white-space:nowrap" class="ft07">The&#160;processor support&#160;16-bit floating-point&#160;conversion&#160;instructions via a&#160;CPUID feature&#160;flag&#160;<br/>(CPUID.01H:ECX.F16C[bit 29] = 1).</p>
<p style="position:absolute;top:234px;left:68px;white-space:nowrap" class="ft03">Application&#160;detection of Float-16 conversion&#160;instructions&#160;follow&#160;the general&#160;procedur<a href="o_7281d5ea06a5b67a-348.html">al flow in Figure 14-3.</a></p>
<p style="position:absolute;top:603px;left:68px;white-space:nowrap" class="ft08">----------------------------------------------------------------------------------------<br/>INT supports_f16c()<br/>{</p>
<p style="position:absolute;top:648px;left:108px;white-space:nowrap" class="ft03">;&#160;result in eax</p>
<p style="position:absolute;top:670px;left:106px;white-space:nowrap" class="ft08">mov&#160;eax,&#160;1<br/>cpuid<br/>and&#160;ecx,&#160;038000000H</p>
<p style="position:absolute;top:738px;left:107px;white-space:nowrap" class="ft03">cmp ecx, 038000000H;&#160;check&#160;OSXSAVE, AVX, F16C&#160;feature&#160;flags</p>
<p style="position:absolute;top:760px;left:106px;white-space:nowrap" class="ft08">&#160;jne not_supported<br/>; processor&#160;supports&#160;AVX,F16C instructions and XGETBV&#160;is enabled&#160;by&#160;OS<br/>mov&#160;ecx,&#160;0;&#160;specify&#160;0&#160;for XCR0&#160;register<br/>XGETBV; result&#160;in EDX:EAX<br/>and&#160;eax,&#160;06H<br/>cmp&#160;eax,&#160;06H; check OS has&#160;enabled both&#160;XMM and&#160;YMM state&#160;support<br/>jne not_supported<br/>mov&#160;eax,&#160;1<br/>jmp done<br/>NOT_SUPPORTED:<br/>mov&#160;eax,&#160;0</p>
<p style="position:absolute;top:1008px;left:107px;white-space:nowrap" class="ft03">done:</p>
<p style="position:absolute;top:1030px;left:68px;white-space:nowrap" class="ft08">}<br/>-------------------------------------------------------------------------------</p>
<p style="position:absolute;top:550px;left:203px;white-space:nowrap" class="ft05">Figure&#160;14-3. &#160;General Procedural&#160;Flow&#160;of&#160;Application Detection of&#160;Float-16&#160;</p>
<p style="position:absolute;top:401px;left:340px;white-space:nowrap" class="ft06">Implied HW support&#160;for</p>
<p style="position:absolute;top:485px;left:245px;white-space:nowrap" class="ft00">Check enabled YMM state in</p>
<p style="position:absolute;top:502px;left:250px;white-space:nowrap" class="ft00">XCR0 via XGETBV</p>
<p style="position:absolute;top:482px;left:488px;white-space:nowrap" class="ft00">Check feature flags&#160;</p>
<p style="position:absolute;top:500px;left:501px;white-space:nowrap" class="ft00">for&#160;AVX and F16C</p>
<p style="position:absolute;top:309px;left:259px;white-space:nowrap" class="ft00">Check feature flag</p>
<p style="position:absolute;top:330px;left:259px;white-space:nowrap" class="ft00">CPUID.1H:ECX.OSXSAVE&#160;= 1?&#160;</p>
<p style="position:absolute;top:368px;left:320px;white-space:nowrap" class="ft06">OS provides processor</p>
<p style="position:absolute;top:383px;left:337px;white-space:nowrap" class="ft06">extended state management</p>
<p style="position:absolute;top:501px;left:420px;white-space:nowrap" class="ft00">State</p>
<p style="position:absolute;top:501px;left:646px;white-space:nowrap" class="ft00">ok to use</p>
<p style="position:absolute;top:417px;left:340px;white-space:nowrap" class="ft06">XSAVE, XRSTOR, XGETBV,&#160;XCR0</p>
<p style="position:absolute;top:514px;left:420px;white-space:nowrap" class="ft00">enabled</p>
<p style="position:absolute;top:515px;left:646px;white-space:nowrap" class="ft00">Instructions</p>
<p style="position:absolute;top:399px;left:287px;white-space:nowrap" class="ft06">Yes&#160;</p>
</div>
</body>
</html>
