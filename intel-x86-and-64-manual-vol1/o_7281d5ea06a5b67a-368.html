<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<title>Page 368</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<style type="text/css">
<!--
	p {margin: 0; padding: 0;}	.ft00{font-size:9px;font-family:Times;color:#000000;}
	.ft01{font-size:11px;font-family:Times;color:#0860a8;}
	.ft02{font-size:11px;font-family:Times;color:#000000;}
	.ft03{font-size:8px;font-family:Times;color:#000000;}
	.ft04{font-size:16px;font-family:Times;color:#0860a8;}
	.ft05{font-size:18px;font-family:Times;color:#000000;}
	.ft06{font-size:12px;font-family:Times;color:#0860a8;}
	.ft07{font-size:11px;line-height:16px;font-family:Times;color:#000000;}
	.ft08{font-size:11px;line-height:24px;font-family:Times;color:#000000;}
-->
</style>
</head>
<body bgcolor="#A0A0A0" vlink="blue" link="blue">
<div id="page368-div" style="position:relative;width:918px;height:1188px;">
<img width="918" height="1188" src="o_7281d5ea06a5b67a368.png" alt="background image"/>
<p style="position:absolute;top:1103px;left:68px;white-space:nowrap" class="ft00">15-4&#160;Vol. 1</p>
<p style="position:absolute;top:47px;left:68px;white-space:nowrap" class="ft01">PROGRAMMING WITH INTEL® AVX-512</p>
<p style="position:absolute;top:463px;left:68px;white-space:nowrap" class="ft08">Prior to&#160;using&#160;AVX-512&#160;Foundation instructions,&#160;the application must identify&#160;that the&#160;operating&#160;system supports&#160;<br/>the XGETBV instruction and&#160;the&#160;ZMM register&#160;state, in addition to&#160;confirming the processor’s&#160;support&#160;for&#160;ZMM state&#160;<br/>management using&#160;XSAVE/XRSTOR&#160;and&#160;AVX-512 Foundation&#160;instructions. The&#160;following simplified sequence&#160;<br/>accomplishes both&#160;and is&#160;strongly recommended.<br/>1.&#160;Detect CPUID.1:ECX.OSXSAVE[bit&#160;27]&#160;=&#160;1 (XGETBV&#160;enabled for&#160;application&#160;use</p>
<p style="position:absolute;top:534px;left:632px;white-space:nowrap" class="ft03">1</p>
<p style="position:absolute;top:537px;left:639px;white-space:nowrap" class="ft02">).</p>
<p style="position:absolute;top:561px;left:68px;white-space:nowrap" class="ft02">2.&#160;Execute XGETBV&#160;and verify that XCR0[7:5] = ‘111b’&#160;(OPMASK&#160;state,&#160;upper 256-bit of ZMM0-ZMM15&#160;and&#160;</p>
<p style="position:absolute;top:577px;left:93px;white-space:nowrap" class="ft07">ZMM16-ZMM31 state are enabled&#160;by OS) and that XCR0[2:1] = ‘11b’ (XMM state&#160;and&#160;YMM state are enabled by&#160;<br/>OS).</p>
<p style="position:absolute;top:618px;left:68px;white-space:nowrap" class="ft02">3.&#160;Detect&#160;CPUID.0x7.0:EBX.AVX512F[bit 16] = 1.</p>
<p style="position:absolute;top:668px;left:68px;white-space:nowrap" class="ft04">15.2.1&#160;</p>
<p style="position:absolute;top:668px;left:148px;white-space:nowrap" class="ft04">Additional 512-bit Instruction Extensions of&#160;the Intel AVX-512 Family</p>
<p style="position:absolute;top:697px;left:68px;white-space:nowrap" class="ft07">Processor support of the&#160;Intel&#160;AVX-512 Exponential&#160;and Reciprocal instructions&#160;are indicated&#160;by&#160;querying the&#160;<br/>feature flag:</p>
<p style="position:absolute;top:736px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:736px;left:93px;white-space:nowrap" class="ft07">If CPUID.(EAX=07H,&#160;ECX=0):EBX.AVX512ER[bit 27] = 1, the&#160;collection&#160;of&#160;<br/>VEXP2PD/VEXP2PS/VRCP28xx/VRSQRT28xx instructions are supported.</p>
<p style="position:absolute;top:775px;left:68px;white-space:nowrap" class="ft02">Processor support of the&#160;Intel&#160;AVX-512 Prefetch&#160;instructions&#160;are&#160;indicated&#160;by querying&#160;the feature&#160;flag:</p>
<p style="position:absolute;top:797px;left:68px;white-space:nowrap" class="ft05">•</p>
<p style="position:absolute;top:798px;left:93px;white-space:nowrap" class="ft07">If CPUID.(EAX=07H,&#160;ECX=0):EBX.AVX512PF[bit 26] = 1,&#160;a collection&#160;of&#160;<br/>VGATHERPF0xxx/VGATHERPF1xxx/VSCATTERPF0xxx/VSCATTERPF1xxx instructions&#160;are supported.&#160;</p>
<p style="position:absolute;top:837px;left:68px;white-space:nowrap" class="ft07">Detection of 512-bit instructions operating&#160;on&#160;ZMM states&#160;and&#160;opmask registers,&#160;outside&#160;of AVX-512&#160;Foundation,&#160;<br/>needs to follow the&#160;general procedural&#160;flow in&#160;<a href="o_7281d5ea06a5b67a-369.html">Figure&#160;15-3</a>.</p>
<p style="position:absolute;top:410px;left:145px;white-space:nowrap" class="ft06">Figure&#160;15-2. &#160;Procedural&#160;Flow&#160;for Application&#160;Detection of&#160;AVX-512 Foundation Instructions</p>
<p style="position:absolute;top:1026px;left:68px;white-space:nowrap" class="ft02">1.&#160;If CPUID.01H:ECX.OSXSAVE reports&#160;1,&#160;it&#160;also indirectly&#160;implies the&#160;processor supports XSAVE, XRSTOR, XGETBV, processor&#160;</p>
<p style="position:absolute;top:1043px;left:89px;white-space:nowrap" class="ft07">extended&#160;state&#160;bit vector XCR0&#160;register. Thus an application may&#160;streamline the&#160;checking&#160;of CPUID&#160;feature flags&#160;for XSAVE and OSX-<br/>SAVE. XSETBV is a privileged instruction.</p>
<p style="position:absolute;top:261px;left:322px;white-space:nowrap" class="ft03">Implied HW&#160;support for</p>
<p style="position:absolute;top:344px;left:249px;white-space:nowrap" class="ft00">Check enabled&#160;state in</p>
<p style="position:absolute;top:366px;left:246px;white-space:nowrap" class="ft00">XCR0 via&#160;XGETBV</p>
<p style="position:absolute;top:348px;left:474px;white-space:nowrap" class="ft00">Check AVX512F&#160;flag&#160;</p>
<p style="position:absolute;top:169px;left:240px;white-space:nowrap" class="ft00">Check feature flag</p>
<p style="position:absolute;top:190px;left:240px;white-space:nowrap" class="ft00">CPUID.1H:ECX.OSXSAVE = 1?&#160;</p>
<p style="position:absolute;top:229px;left:302px;white-space:nowrap" class="ft03">OS provides processor</p>
<p style="position:absolute;top:243px;left:319px;white-space:nowrap" class="ft03">extended state&#160;management</p>
<p style="position:absolute;top:361px;left:402px;white-space:nowrap" class="ft00">States</p>
<p style="position:absolute;top:362px;left:628px;white-space:nowrap" class="ft00">ok to use</p>
<p style="position:absolute;top:278px;left:322px;white-space:nowrap" class="ft03">XSAVE,&#160;XRSTOR,&#160;XGETBV, XCR0</p>
<p style="position:absolute;top:375px;left:402px;white-space:nowrap" class="ft00">enabled</p>
<p style="position:absolute;top:375px;left:628px;white-space:nowrap" class="ft00">Instructions</p>
<p style="position:absolute;top:260px;left:269px;white-space:nowrap" class="ft03">Yes&#160;</p>
<p style="position:absolute;top:335px;left:394px;white-space:nowrap" class="ft00">YMM,ZMM</p>
<p style="position:absolute;top:322px;left:392px;white-space:nowrap" class="ft00">Opmask,</p>
</div>
</body>
</html>
